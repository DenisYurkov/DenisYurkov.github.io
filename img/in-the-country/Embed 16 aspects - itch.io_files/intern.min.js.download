(function(){var calculate_offset,bind=function(fn,me){return function(){return fn.apply(me,arguments)}},extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;if(typeof I!=="undefined"&&I!==null?I.Grapher:void 0){return}calculate_offset=function(el,parent){var offset_parent,ox,oy,ref,ref1,x,y;ref=el.offset(),x=ref.left,y=ref.top;offset_parent=parent.offsetParent();if(!offset_parent.is("html")){ref1=offset_parent.offset(),ox=ref1.left,oy=ref1.top;x-=ox;y-=oy}return[Math.floor(x),Math.floor(y)]};I.Grapher=function(){Grapher.format_number=I.format_integer;Grapher.prototype.chart_svg_class="chart";Grapher.prototype.margin_left=40;Grapher.prototype.margin_bottom=30;Grapher.prototype.margin_right=30;Grapher.prototype.margin_top=20;Grapher.prototype.dot_hitbox_w=30;Grapher.prototype.dot_hitbox_h=120;Grapher.prototype.axis_spacing=8;Grapher.prototype.axis_graph_padding=10;Grapher.prototype.popup_template='<div class="graph_popup">\n  <div class="popup_date">{{ date }}</div>\n  <div class="popup_label">{{ label }}</div>\n</div>';Grapher.prototype.default_opts={label:"Count",y_axis_padding:1.3,min_y:10,x_ticks:10,fit_dots:false};function Grapher(el,data1,opts){var ref,ref1,ref2,ref3;this.data=data1;this.increment_date=bind(this.increment_date,this);this.list_range=bind(this.list_range,this);this.get_range=bind(this.get_range,this);this.format_y_axis=bind(this.format_y_axis,this);this.get_y_scaled=bind(this.get_y_scaled,this);this.get_x_scaled=bind(this.get_x_scaled,this);this.get_y=bind(this.get_y,this);this.get_x=bind(this.get_x,this);this.popup_date=bind(this.popup_date,this);this.axis_offsets=bind(this.axis_offsets,this);if(!this.data){this.data=opts.graph_counts}if(!this.data){throw"No data for graph"}this.el=$(el);this.opts=$.extend({},this.default_opts,opts);this.margin_left=(ref=this.opts.margin_left)!=null?ref:this.margin_left;this.margin_bottom=(ref1=this.opts.margin_bottom)!=null?ref1:this.margin_bottom;this.margin_top=(ref2=this.opts.margin_top)!=null?ref2:this.margin_top;this.margin_right=(ref3=this.opts.margin_right)!=null?ref3:this.margin_right;this.draw();this.setup_popups()}Grapher.prototype.popup_position=function(hitbox){return calculate_offset(hitbox.prev("circle"),this.el)};Grapher.prototype.get_template=function(name){var base;if(name==null){name="poup_template"}this._templates||(this._templates={});(base=this._templates)[name]||(base[name]=_.template(this[name]));return this._templates[name]};Grapher.prototype.setup_popups=function(){var current_popup,el,remove_popup,toggle_popup;current_popup=null;remove_popup=function(popup){if(!popup){return}return popup.stop(true,true).remove()};toggle_popup=_.debounce(function(_this){return function(state,hitbox){var h,pad,popup,ref,template,w,x,y;hitbox=$(hitbox);if(!hitbox.data("popup")){return}switch(state){case"show":template=_this.get_template(hitbox.data("popup_template")||"popup_template");popup=hitbox.data("popup_el");if(current_popup!=null?current_popup.is(popup):void 0){return}remove_popup(current_popup);if(!popup){popup=$(template(hitbox.data("popup")));hitbox.data("popup_el",popup)}current_popup=popup;current_popup.appendTo(_this.el).hide().fadeIn("fast");ref=_this.popup_position(hitbox),x=ref[0],y=ref[1];pad=5;w=current_popup.outerWidth();h=current_popup.outerHeight();current_popup.css({left:x-w-pad+"px",top:y-h-pad+"px"});return typeof _this.on_show_popup==="function"?_this.on_show_popup(current_popup,hitbox):void 0;case"hide":remove_popup(current_popup);if(typeof _this.on_hide_popup==="function"){_this.on_hide_popup(current_popup,hitbox)}return current_popup=null}}}(this),30);el=this.svg.node();el.addEventListener("mouseover",function(_this){return function(e){var ref;if((ref=e.target.getAttribute("class"))!=null?ref.match(/\bhitbox\b/):void 0){return toggle_popup("show",e.target)}}}(this));return el.addEventListener("mouseout",function(_this){return function(e){var ref;if((ref=e.target.getAttribute("class"))!=null?ref.match(/\bhitbox\b/):void 0){return toggle_popup("hide",e.target)}}}(this))};Grapher.prototype.draw=function(){var cls,data,ref,ref1,ref2,ref3,ref4,target_height,target_width,x,y;target_width=(ref=this.opts.width)!=null?ref:this.el.width();target_height=(ref1=this.opts.height)!=null?ref1:this.el.height();this.w=target_width/((ref2=this.opts.scale)!=null?ref2:1);this.h=target_height/((ref3=this.opts.scale)!=null?ref3:1);this.time_format=d3.time.format("%Y-%m-%d");cls=this.chart_svg_class;if(this.opts["class"]){cls+=" "+this.opts["class"]}this.svg=d3.select(this.el[0]).append("svg").attr("class",cls).attr("width",(ref4=this.opts.width)!=null?ref4:"100%").attr("height",target_height).attr("viewBox","0 0 "+this.w+" "+this.h);data=this.format_data();x=this._x_scale=this.x_scale(data);y=this._y_scale=this.y_scale(data);this.draw_guides(x,y);this.draw_area(data);this.draw_axis(x,y);this.draw_dots(data);return this.draw_label()};Grapher.prototype.guide_x_range=function(x,y){return x.range()};Grapher.prototype.draw_guides=function(x,y){var gx,gy,ref,y_guides;y_guides=this.svg.append("g").attr("class","y_guides");ref=this.guide_x_range(x,y),gx=ref[0],gy=ref[1];y_guides.selectAll("line").data(y.ticks(this.y_ticks())).enter().append("line").attr("x1",gx).attr("y1",y).attr("x2",gy).attr("y2",y);if(x.ticks){return this.svg.append("g").attr("class","x_guides").selectAll("line").data(x.ticks(this.x_ticks())).enter().append("line").attr("x1",x).attr("y1",y.range()[0]).attr("x2",x).attr("y2",y.range()[1])}};Grapher.prototype.axis_offsets=function(){return[0,0]};Grapher.prototype.draw_axis=function(x,y){var left,ox,oy,ref,x_axis,y_axis;y_axis=d3.svg.axis().scale(y).orient("left").tickFormat(this.format_y_axis).ticks(this.y_ticks());left=x.domain()[0];ref=this.axis_offsets(),ox=ref[0],oy=ref[1];this.svg.append("g").attr("transform","translate("+(this._x_scale(left)+ox-this.axis_spacing)+", 0)").attr("class","y_axis axis").call(y_axis);x_axis=d3.svg.axis().scale(x).orient("bottom").ticks(this.x_ticks());return this.svg.append("g").attr("transform","translate(0, "+(y.range()[0]+oy+this.axis_spacing)+")").attr("class","x_axis axis").call(x_axis)};Grapher.prototype.draw_area=function(data){var area,line_style;line_style=this.opts.line_style||"area";area=function(){switch(line_style){case"area":return d3.svg.area().x(this.get_x_scaled).y1(this.get_y_scaled).y0(this.h-this.margin_bottom);case"line":return d3.svg.line().x(this.get_x_scaled).y(this.get_y_scaled);default:throw"Unknown line style: "+line_style}}.call(this);return this.svg.append("g").attr("class","graph").append("path").attr("class",line_style).attr("d",area(data))};Grapher.prototype.draw_label=function(){var label;label=this.svg.append("g").attr("class","label").attr("transform","translate("+this.margin_left+", 10)");label.append("circle").attr("cx",0).attr("cy",-5).attr("r",4);return label.append("text").text(this.opts.label).attr("x",10)};Grapher.prototype.draw_dots=function(data,opts){var hitbox_h,hitbox_w,popups,ref;if(opts==null){opts={}}if(this.opts.show_dots===false){return}data=this.filter_dots_data(data);if(this.list_range().length>((ref=this.opts.max_dots)!=null?ref:60)){return}popups=this.svg.append("g").attr("class","popups").selectAll("g").data(data).enter().append("g").attr("class","popup_trigger");hitbox_w=this.dot_hitbox_w;hitbox_h=this.dot_hitbox_h;popups.append("circle").attr("class","dot_outline").attr("cx",this.get_x_scaled).attr("cy",this.get_y_scaled).attr("r",6);popups.append("circle").attr("class","dot").attr("cx",this.get_x_scaled).attr("cy",this.get_y_scaled).attr("r",4);return popups.append("rect").attr("class",function(_this){return function(d){var base,c;c="column_dot hitbox";if(typeof(base=_this.opts).column_url==="function"?base.column_url(d):void 0){c+=" link"}return c}}(this)).attr("transform","translate(-"+hitbox_w/2+", -"+hitbox_h/2+")").attr("x",this.get_x_scaled).attr("y",this.get_y_scaled).attr("width",hitbox_w).attr("height",hitbox_h).attr("data-popup",function(_this){return function(d){return JSON.stringify({date:_this.popup_date.apply(_this,arguments),label:_this.popup_label.apply(_this,arguments)})}}(this))};Grapher.prototype.filter_dots_data=function(data){var can_fit,dots_to_fit,i,real_w,subset,take_every;if(this.opts.fit_dots){real_w=this.w-this.margin_left-this.margin_right-this.axis_graph_padding;can_fit=Math.floor(real_w/this.dot_hitbox_w);if(data.length>can_fit){dots_to_fit=Math.floor((real_w-this.dot_hitbox_w*2)/this.dot_hitbox_w);take_every=Math.floor((data.length-2)/dots_to_fit);subset=function(){var j,ref,ref1,results;results=[];for(i=j=1,ref=data.length-2,ref1=take_every;ref1>0?j<=ref:j>=ref;i=j+=ref1){results.push(data[i])}return results}();subset.push(data[data.length-1]);subset.unshift(data[1]);return subset}}return data};Grapher.prototype.popup_label=function(d){var val;val=this.opts.rate?I.number_format(this.get_y(d),4)+"%":I.number_format(this.get_y(d));return this.opts.label+": "+val};Grapher.prototype.popup_date=function(d){return d.date};Grapher.prototype.get_x=function(d){return this.time_format.parse(d.date)};Grapher.prototype.get_y=function(d){if(this.opts.rate){return d.count*100}else{return d.count}};Grapher.prototype.get_x_scaled=function(){return this._x_scale(this.get_x.apply(this,arguments))};Grapher.prototype.get_y_scaled=function(){return this._y_scale(this.get_y.apply(this,arguments))};Grapher.prototype.format_y_axis=function(num){if(this.opts.rate){if(num<10&&num!==0){return I.number_format(num,1)+"%"}else{return I.number_format(num)+"%"}}else{return I.Grapher.format_number(num)}};Grapher.prototype.x_ticks=function(){return this.opts.x_ticks};Grapher.prototype.y_ticks=function(){if(this.opts.rate){return 5}else{return Math.min(5,this.opts.min_y)}};Grapher.prototype.get_range=function(){var format,left,new_left,offset,out,right,today;if(this.opts.interval!=="data"){if(this.opts.range_left){format=d3.time.format("%Y-%m-%d");out=[format.parse(this.opts.range_left),format.parse(this.opts.range_right)];if(this.opts.interval==="weekly"&&this.data[0]){format=d3.time.format("%Y-%m-%d");left=out[0];new_left=format.parse(this.data[0].date);while(new_left>left){new_left=d3.time.day.offset(new_left,-7)}return[new_left,out[1]]}return out}if(this.opts.num_days){today=d3.time.day(new Date);offset=this.opts.day_offset||0;left=d3.time.day.offset(today,-(this.opts.num_days+offset-1));right=d3.time.day.offset(today,-offset);return[left,right]}}format=d3.time.format("%Y-%m-%d");if(this.data.length<2){throw"Data is too small to get range"}return[format.parse(this.data[0].date),format.parse(this.data[this.data.length-1].date)];throw"Don't know how to calculate range"};Grapher.prototype.map_range=function(fn){var date,format,left,ref,res,results,right,t,val;if(this.opts.interval==="data"){format=d3.time.format("%Y-%m-%d");res=function(){var j,len,ref,results;ref=this.data;results=[];for(j=0,len=ref.length;j<len;j++){date=ref[j].date;val=fn(format.parse(date));if(!val){continue}results.push(val)}return results}.call(this);return res}ref=this.get_range(),left=ref[0],right=ref[1];t=left;results=[];while(t<=right){val=fn(t);t=this.increment_date(t);if(!val){continue}results.push(val)}return results};Grapher.prototype.list_range=function(){var out;out=[];this.map_range(function(d){return out.push(d)});return out};Grapher.prototype.increment_date=function(t){if(this.opts.interval==="weekly"){return d3.time.day.offset(t,7)}else{return d3.time.day.offset(t,1)}};Grapher.prototype.format_data=function(){var counts_by_date,j,len,ref,v;counts_by_date={};ref=this.data;for(j=0,len=ref.length;j<len;j++){v=ref[j];counts_by_date[v.date]=v}return this.map_range(function(_this){return function(t){var formatted;formatted=_this.time_format(t);return counts_by_date[formatted]||{count:0,date:formatted}}}(this))};Grapher.prototype.x_scale=function(data){var left,ref,right;ref=this.get_range(),left=ref[0],right=ref[1];return d3.time.scale().domain([left,right]).rangeRound([this.margin_left+this.axis_graph_padding,this.w-this.margin_right])};Grapher.prototype.y_scale=function(data){var axis_max_y,max,out,out_range,p;max=d3.max(data,this.get_y)||0;p=this.opts.y_axis_padding||1.3;out_range=[this.h-this.margin_bottom,this.margin_top];axis_max_y=this.opts.rate?Math.min(100,Math.max(.5,Math.floor(max*10*p)/10)):Math.max(this.opts.min_y,Math.floor((max+1)*p));out=d3.scale.linear().domain([0,axis_max_y]);if(this.opts.rate){return out.range(out_range)}else{return out.rangeRound(out_range)}};return Grapher}();I.MoneyGrapher=function(superClass){extend(MoneyGrapher,superClass);function MoneyGrapher(){this.format_y_axis=bind(this.format_y_axis,this);return MoneyGrapher.__super__.constructor.apply(this,arguments)}MoneyGrapher.prototype.format_y_axis=function(num){var dollars;dollars=this.opts.currency==="JPY"?num:num/100;if(dollars>9){Math.floor(dollars)}return(I.currency_symbols[this.opts.currency]||"$")+I.Grapher.format_number(dollars)};MoneyGrapher.prototype.popup_label=function(d){return this.opts.label+": "+I.format_money(d.sum,this.opts.currency)};return MoneyGrapher}(I.Grapher);I.CumulativeGraph=function(superClass){extend(CumulativeGraph,superClass);function CumulativeGraph(){this.get_range=bind(this.get_range,this);this.get_y=bind(this.get_y,this);return CumulativeGraph.__super__.constructor.apply(this,arguments)}CumulativeGraph.prototype.default_opts={label:"Amount",min_y:100,x_ticks:8,fit_dots:true,min_range:7,currency:"USD",y_axis_padding:1.3};CumulativeGraph.prototype.get_y=function(d){return d.sum};CumulativeGraph.prototype.get_range=function(){var first,format,last,range_ago;format=d3.time.format("%Y-%m-%d");first=this.data[0];last=this.data[this.data.length-1];first=format.parse(first.date);last=format.parse(last.date);range_ago=d3.time.day.offset(last,-this.opts.min_range);if(range_ago<first){first=range_ago}return[first,last]};CumulativeGraph.prototype.format_data=function(){var by_date,j,last,len,ref,v;by_date={};ref=this.data;for(j=0,len=ref.length;j<len;j++){v=ref[j];by_date[v.date]=v}last=0;return this.map_range(function(_this){return function(t){var formatted,ref1;formatted=_this.time_format(t);last=((ref1=by_date[formatted])!=null?ref1.sum:void 0)||last;return{sum:last,date:formatted}}}(this))};return CumulativeGraph}(I.MoneyGrapher);I.BarGrapher=function(superClass){extend(BarGrapher,superClass);function BarGrapher(){this.get_x=bind(this.get_x,this);return BarGrapher.__super__.constructor.apply(this,arguments)}BarGrapher.prototype.chart_svg_class="chart bar_chart";BarGrapher.prototype.dot_hitbox_w=20;BarGrapher.prototype.dot_hitbox_h=20;BarGrapher.prototype.bar_spacing=5;BarGrapher.prototype.is_ordinal=function(){return this.opts.interval==="ordinal"};BarGrapher.prototype.x_field=function(){if(this.is_ordinal()){return"label"}else{return"date"}};BarGrapher.prototype.popup_date=function(d){return d[this.x_field()]};BarGrapher.prototype.get_x=function(d){if(this.is_ordinal()){return d[this.x_field()]}else{return BarGrapher.__super__.get_x.call(this,d)}};BarGrapher.prototype.format_data=function(){if(this.is_ordinal()){return this.data}else{return BarGrapher.__super__.format_data.call(this)}};BarGrapher.prototype.axis_offsets=function(){return[-Math.floor(this.bar_width()/2),0]};BarGrapher.prototype.map_range=function(fn){var j,len,ref,results,tuple;if(this.is_ordinal()){ref=this.data;results=[];for(j=0,len=ref.length;j<len;j++){tuple=ref[j];results.push(fn(tuple[this.x_field()]))}return results}else{return BarGrapher.__super__.map_range.call(this,fn)}};BarGrapher.prototype.get_range=function(){if(this.is_ordinal()){return[this.data[0][this.x_field()],this.data[this.data.length-1][this.x_field()]]}else{return BarGrapher.__super__.get_range.call(this)}};BarGrapher.prototype.bar_width=function(){var bl,br;switch(this.opts.interval||"daily"){case"weekly":bl=this.get_range()[0];br=d3.time.day.offset(bl,7);break;case"daily":bl=this.get_range()[0];br=d3.time.day.offset(bl,1);break;case"data":bl=this.time_format.parse(this.data[0][this.x_field()]);br=this.time_format.parse(this.data[1][this.x_field()]);break;case"ordinal":bl=this.data[0][this.x_field()];br=this.data[1][this.x_field()]}return this._x_scale(br)-this._x_scale(bl)};BarGrapher.prototype.guide_x_range=function(x,y){var a,b,bw,range,ref;if(this.is_ordinal()){range=x.range();a=range[0];b=range[range.length-1]}else{ref=x.range(),a=ref[0],b=ref[1]}bw=this.bar_width();return[a-bw/2,b+bw/2]};BarGrapher.prototype.x_scale=function(data){var available_width,bar_width,bars,bh,d,j,keys,left,left_date,len,ref,right,right_date,tuple;left=this.margin_left+this.axis_graph_padding;right=this.w-this.margin_right;if(this.is_ordinal()){keys=[];ref=this.data;for(j=0,len=ref.length;j<len;j++){tuple=ref[j];keys.push(tuple[this.x_field()])}return d3.scale.ordinal().domain(keys).rangePoints([left,right])}else{bars=this.list_range();left_date=bars[0];right_date=bars[bars.length-1];available_width=right-left;d=d3.time.scale().domain([left_date,right_date]);bar_width=available_width/bars.length;bh=bar_width/2;return d.rangeRound([left+bh,right-bh])}};BarGrapher.prototype.draw_area=function(data){var bar_width,bars,colors,x_centered;if(this.opts.line_style==="line"){return BarGrapher.__super__.draw_area.call(this,data)}bar_width=this.bar_width();x_centered=function(_this){return function(d){var x;x=_this.get_x_scaled(d);return x-(bar_width-_this.bar_spacing)/2}}(this);bars=this.svg.append("g").attr("class","bars").selectAll("rect").data(data).enter().append("rect").attr("x",x_centered).attr("y",this.get_y_scaled).attr("width",bar_width-this.bar_spacing).attr("height",function(_this){return function(d){return _this._y_scale(0)-_this.get_y_scaled(d)}}(this));if(this.opts.colors){colors=d3.scale.ordinal().range(this.opts.colors);colors=colors.domain(this._x_scale.domain());bars=bars.attr("fill",function(_this){return function(d){return colors(d[_this.x_field()])}}(this))}return bars};return BarGrapher}(I.Grapher);I.StackedBarGrapher=function(superClass){extend(StackedBarGrapher,superClass);StackedBarGrapher.prototype.chart_svg_class="chart bar_chart stacked_bar_chart";StackedBarGrapher.prototype.bar_popup_template='<div class="graph_popup">\n  <div class="popup_date">{{ date }}</div>\n  <div class="popup_group">{{ group }}</div>\n  <div class="popup_label">{{ label }}</div>\n</div>';function StackedBarGrapher(){this.on_hide_popup=bind(this.on_hide_popup,this);this.on_show_popup=bind(this.on_show_popup,this);this.popup_group=bind(this.popup_group,this);StackedBarGrapher.__super__.constructor.apply(this,arguments);if(this.opts.group_url){$(this.svg.node()).on("click","[data-game_id]",function(_this){return function(e){var id,url;id=$(e.target).data("game_id");url=_this.opts.group_url({game_id:id});if(!url){return}return window.location=url}}(this))}if(this.opts.column_url){$(this.svg.node()).on("click",".column_dot[data-popup]",function(_this){return function(e){var data,url;data=$(e.target).data("popup");url=_this.opts.column_url(data);if(!url){return}return window.location=url}}(this))}}StackedBarGrapher.prototype.secondary_field=function(){return this.opts.secondary_field||"game_id"};StackedBarGrapher.prototype.get_y=function(d){return d.max};StackedBarGrapher.prototype.x_ticks=function(){if(this.opts.interval==="weekly"){if(this.list_range().length<15){return d3.time.monday}}return StackedBarGrapher.__super__.x_ticks.call(this)};StackedBarGrapher.prototype.popup_group=function(d){return d[this.secondary_field()]};StackedBarGrapher.prototype.bar_popup_label=function(d){var val;val=I.number_format(d.max-d.min);return this.opts.label+": "+val};StackedBarGrapher.prototype.format_data=function(){var counts_by_date,j,len,ref,v;counts_by_date={};ref=this.data;for(j=0,len=ref.length;j<len;j++){v=ref[j];counts_by_date[v.date]=v}return this.map_range(function(_this){return function(t){var count,formatted,idx,last_sum,stacks,sum,tuple,x;formatted=_this.time_format(t);tuple=counts_by_date[formatted];if(!tuple){return{date:formatted,min:0,max:0,stacks:[]}}sum=0;stacks=function(){var k,len1,ref1,results;ref1=tuple.counts;results=[];for(idx=k=0,len1=ref1.length;k<len1;idx=++k){count=ref1[idx];last_sum=sum;sum+=count.count;x={cap:sum===tuple.count,date:tuple.date,min:last_sum,max:sum};x[this.secondary_field()]=count[this.secondary_field()];results.push(x)}return results}.call(_this);if(!(tuple.count>0)){return}return{date:tuple.date,min:0,max:tuple.count,stacks:stacks}}}(this))};StackedBarGrapher.prototype.popup_position=function(hitbox){return calculate_offset(hitbox,this.el)};StackedBarGrapher.prototype.on_show_popup=function(popup,hitbox){var current_bars,game_bars,secondary_id;secondary_id=hitbox.data(this.secondary_field());if(!secondary_id){this.on_hide_popup();return}this.el.addClass("highlighting_bar");game_bars=this.el.find(".game_bar");current_bars=game_bars.filter("[data-"+this.secondary_field()+"='"+secondary_id+"']");game_bars.css({opacity:.1});return current_bars.css({opacity:""})};StackedBarGrapher.prototype.on_hide_popup=function(popup,hitbox){return this.el.removeClass("highlighting_bar").find(".game_bar").css({opacity:""})};StackedBarGrapher.prototype.draw_area=function(data){var bar_stack,bar_stacks,bar_width,colors,g,item,j,len,position_bars,secondary_ids,stack;bar_width=this.bar_width();colors=d3.scale.ordinal().range(this.opts.colors||["#F3596A","#D34D75","#AE4879","#864477","#5E406D","#39385E"]);data=data.filter(function(d){return d.min!==d.max});secondary_ids={};for(j=0,len=data.length;j<len;j++){item=data[j];secondary_ids[item[this.secondary_field()]]=true}secondary_ids=function(){var results;results=[];for(g in secondary_ids){results.push(+g)}return results}();colors=colors.domain(secondary_ids);stack=this.svg.append("g").attr("class","bars").selectAll("g").data(data).enter().append("g");position_bars=function(_this){return function(group,expand){if(expand==null){expand=0}return group.attr("x",function(d){var x;x=_this.get_x_scaled(d);return-expand+Math.floor(x-(bar_width-5)/2)}).attr("y",function(d){return _this._y_scale(d.max)-expand}).attr("width",bar_width-5+expand*2).attr("height",function(d){return 2*expand+Math.max(1,_this._y_scale(d.min)-_this._y_scale(d.max))})}}(this);bar_stack=stack.attr("class","bar_stack");position_bars(bar_stack.append("rect").attr("class","total_border"),1);position_bars(bar_stack.append("rect").attr("class","total_bar"));bar_stacks=stack.append("g").attr("class","game_counts").selectAll("rect").data(function(d){return d.stacks}).enter();position_bars(bar_stacks.append("rect").attr("class",function(_this){return function(d){var base,c;c="game_bar hitbox";if(typeof(base=_this.opts).group_url==="function"?base.group_url(d):void 0){c+=" link"}return c}}(this)).attr("data-"+this.secondary_field(),function(_this){return function(d){return d[_this.secondary_field()]}}(this)).attr("fill",function(_this){return function(d){return colors(d[_this.secondary_field()])}}(this)).attr("data-popup_template","bar_popup_template").attr("data-popup",function(_this){return function(d){return JSON.stringify({date:_this.popup_date.apply(_this,arguments),label:_this.bar_popup_label.apply(_this,arguments),group:(_this.opts.popup_group||_this.popup_group).apply(null,arguments)})}}(this)));return position_bars(bar_stacks.append("rect").attr("class","bar_border")).attr("height",function(d){if(d.cap){return 0}else{return 1}})};return StackedBarGrapher}(I.BarGrapher)}).call(this);(function(){I.ApiKeys=function(){function ApiKeys(el){this.el=$(el);this.el.dispatch("click",{revoke_key_btn:function(_this){return function(btn){if(confirm("Are you sure you want to delete this key?")){return btn.closest("form").submit()}}}(this),remove_ssh_key_button:function(_this){return function(btn){if(confirm("Are you sure you want to delete this key?")){return btn.closest("form").submit()}}}(this),view_key_btn:function(_this){return function(btn){return btn.closest(".key_cell").toggleClass("show_key")}}(this)})}return ApiKeys}()}).call(this);(function(){var bind=function(fn,me){return function(){return fn.apply(me,arguments)}};I.BlogPostPage=function(){BlogPostPage.prototype.like_button_template=I.lazy_template(BlogPostPage,"like_button");function BlogPostPage(el,data){this.render_like_button=bind(this.render_like_button,this);var grid;this.el=$(el);grid=this.el.find(".browse_game_grid");this.grid=new I.GameGrid(grid,{selector:".browse_game_grid .game_cell .game_thumb",width_selector:".browse_game_grid .game_cell"});this.grid.setup_conversion_tracking("10");new I.GameGrid(this.el.find(".sidebar_game_grid"),{sizer:false});this.render_like_button();this.el.format_timestamps("fromNow");I.setup_grid_referrers(this.el,function(_this){return function(){return"blog_post:"+data.post_id}}(this));I.has_follow_button(this.el);I.setup_sticky_bar(this.el.find(".post_tools"));I.deferred_links(this.el,"a[data-label]");this.el.on("i:delegate_tracking",function(_this){return function(e,push){return push(I.ga_tracker("view_blog_post")($(e.target)))}}(this));this.el.find(".post_body").on("i:delegate_tracking",function(_this){return function(e,push){var game_id;game_id=$(e.target).closest("[data-game_id]").data("game_id");if(!game_id){return}I.ConversionTracker.click("10:1:"+game_id);return push(I.ConversionTracker.flush_now())}}(this))}BlogPostPage.prototype.render_like_button=function(s){var base,child,drop;drop=this.el.find(".like_button_drop");this.like_button_state||(this.like_button_state=drop.data("init"));if(s){$.extend(this.like_button_state,s)}(base=this.like_button_state).classname||(base.classname=this.like_button_state.liked?"liked":"");child=drop.html(this.like_button_template(this.like_button_state)).children();return child.find("form").remote_submit(function(_this){return function(res){return _this.render_like_button({classname:_this.like_button_state.liked?"animate_drop_down":"liked animate_bounce",liked:!_this.like_button_state.liked,likes_count:res.likes_count})}}(this))};return BlogPostPage}()}).call(this);(function(){I.BundleAnalytics=function(){function BundleAnalytics(el,opts){var i,len,ref,tbl;this.el=$(el);ref=this.el.find(".remote_table");for(i=0,len=ref.length;i<len;i++){tbl=ref[i];$(tbl).remote_table()}this.el.format_timestamps("fromNow");if(opts.cumulative_earnings){new I.CumulativeGraph("#cumulative_earnings_graph",opts.cumulative_earnings,{currency:opts.currency})}}return BundleAnalytics}()}).call(this);(function(){var bind=function(fn,me){return function(){return fn.apply(me,arguments)}},extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;I.CollectionPage=function(superClass){extend(CollectionPage,superClass);CollectionPage.prototype.method="get";function CollectionPage(el,opts){var grid;this.opts=opts;this.setup_admin_panel=bind(this.setup_admin_panel,this);CollectionPage.__super__.constructor.apply(this,arguments);this.el.format_timestamps("fromNow");I.has_follow_button(this.el);I.setup_grid_referrers(this.el,function(_this){return function(){return"collection:"+_this.opts.id}}(this));this.el.on("i:delegate_tracking",function(_this){return function(e,push){return push(I.ga_tracker("collection")($(e.target)))}}(this));I.deferred_links(this.el,"a[data-label]",function(_this){return function(el,event){var game_id;if(!I.is_middle_click(event)&&el.is(".game_link")){game_id=el.closest("[data-game_id]").data("game_id");if(game_id!=null&&_this.opts.queue_url&&!I.is_mobile()){el.attr("href",_this.opts.queue_url+"?"+$.param({game_id:game_id}))}}return I.delegate_tracking(el)}}(this));switch(this.opts.layout){case"grid":grid=this.el.find(".browse_game_grid");this.grid=new I.GameGrid(grid,{no_right_margin:true,selector:".browse_game_grid .game_cell .game_thumb",width_selector:".browse_game_grid .game_cell",cell_margin:I.is_mobile()?10:20});this.grid.setup_conversion_tracking("3");break;case"list":this.grid={add_image_loading:I.GameGrid.prototype.add_image_loading,el:this.el.find(".collection_game_list_widget")};I.GameGrid.prototype.setup_lazy_images.call(this.grid);I.GameGrid.prototype.setup_conversion_tracking.call(this.grid,"3");new I.GamePopups(this.el);new I.GameCells(this.el)}this.el.dispatch("click",{edit_collection_admins_btn:function(_this){return function(btn){return I.Lightbox.open_remote(btn.data("lightbox_url"),I.CollectionAdminsLightbox)}}(this),edit_collection_btn:function(_this){return function(btn){return I.Lightbox.open_remote(btn.data("lightbox_url"),I.EditCollectionLightbox)}}(this),edit_collection_game_btn:function(_this){return function(btn){return I.Lightbox.open_remote(btn.data("lightbox_url"),I.CollectionGameLightbox,btn.closest(".game_cell, .game_row"))}}(this)});this.el.remote_link(function(_this){return function(res,btn){var base;if(res.errors){alert(res.errors.join("\n"));return}if(btn.is(".remove_game_btn")){btn.closest(".game_cell").remove();return typeof(base=_this.grid).refresh_images==="function"?base.refresh_images():void 0}}}(this));this.setup_admin_panel()}CollectionPage.prototype.setup_admin_panel=function(){var admin_panel;admin_panel=this.el.find(".admin_tools");if(!admin_panel.length){return}return admin_panel.dispatch("click",{close_btn:function(_this){return function(btn){return admin_panel.remove()}}(this)})};return CollectionPage}(I.InfiniteGameGrid)}).call(this);(function(){var bind=function(fn,me){return function(){return fn.apply(me,arguments)}};I.EditBlogPost=function(){function EditBlogPost(el,opts){var form;this.opts=opts;this.setup_date_pickers=bind(this.setup_date_pickers,this);this.setup_tags=bind(this.setup_tags,this);this.refresh_logform=bind(this.refresh_logform,this);this.el=$(el);this.setup_tags();this.setup_date_pickers();this.el.dispatch("click",{delete_post_btn:function(_this){return function(btn){if(!confirm("Are you sure you want to delete this post?")){return}btn.addClass("disabled").prop("disabled",true);return $.post(btn.data("url"),I.with_csrf()).then(function(res){console.log(res);if(res.errors){form.set_form_errors(res.errors);return}if(res.redirect_to){window.location=res.redirect_to}})}}(this)});form=this.el.find("form").remote_submit(function(_this){return function(res){var base;if(res.errors){form.set_form_errors(res.errors);return}if(res.edit_url){if(typeof(base=window.history).replaceState==="function"){base.replaceState({},"Edit blog post",res.edit_url)}}if(res.redirect_to){window.location=res.redirect_to;return}return I.flash("Saved post")}}(this));this.el.find("input[name='post[user_classification]']").on("change",function(_this){return function(e){return _this.refresh_logform()}}(this));this.refresh_logform()}EditBlogPost.prototype.refresh_logform=function(){var longform,selected_type,value;selected_type=this.el.find("input[name='post[user_classification]']:checked");value=selected_type.val();longform=value&&(value!=="general_update"&&value!=="major_update")||false;return this.el.find(".longform_notification").toggle(longform)};EditBlogPost.prototype.setup_tags=function(){var items,suggested_tags,tag_input;suggested_tags=_.toArray(this.opts.suggested_tags);tag_input=this.el.find(".tags_input");items=_.toArray(tag_input.data("json_value"));return this.tag_input=tag_input.selectize({delimiter:",",plugins:["remove_button"],persist:false,placeholder:tag_input.attr("placeholder"),valueField:"name",labelField:"name",searchField:["name"],closeAfterSelect:true,options:suggested_tags.concat(items).map(function(x){return{name:x}}),create:function(tag){return{name:$.trim(tag)}}})};EditBlogPost.prototype.setup_date_pickers=function(){return I.datepicker(this.el.find(".date_picker"))};return EditBlogPost}()}).call(this);(function(){var bind=function(fn,me){return function(){return fn.apply(me,arguments)}};I.EditBundleForm=function(){EditBundleForm.prototype.date_format="yy-mm-dd";EditBundleForm.prototype.time_format="HH:mm:ss";EditBundleForm.prototype.format_date_time=function(d){var date,time;time=$.datepicker.formatTime(this.time_format,{hour:d.getHours(),minute:d.getMinutes(),second:d.getSeconds()});date=$.datepicker.formatDate(this.date_format,new Date(d));return date+" "+time};function EditBundleForm(el){this.format_date_time=bind(this.format_date_time,this);var area,other_save;this.el=$(el);this.form=this.el.find("form").remote_submit(function(_this){return function(res,form){if(res.errors){form.set_form_errors(res.errors);return}form.set_form_errors([]);if(res.url){return window.location=res.url}else{return I.flash("Co-op bundle updated")}}}(this));other_save=this.el.find(".header_nav").find(".save_btn").on("click",function(_this){return function(){return _this.form.submit()}}(this));this.form.on("i:before_submit",function(_this){return function(){return other_save.prop("disabled",true).addClass("disabled")}}(this));this.form.on("i:after_submit",function(_this){return function(){return other_save.prop("disabled",false).removeClass("disabled")}}(this));I.setup_dirty_warning(this.form);this.setup_datepickers();this.setup_timezone();this.el.format_timestamps();if(area=this.el.find("textarea")){I.redactor(area,{minHeight:80})}this.el.dispatch("click",{delete_bundle_btn:function(_this){return function(btn){if(!confirm("Are you sure you want to delete this bundle?")){return}btn.addClass("disabled");return $.ajax({type:"post",data:I.with_csrf(),url:btn.data("url"),success:function(res){return window.location=res.redirect_to||"/"}})}}(this)})}EditBundleForm.prototype.setup_datepickers=function(){var duration_summary,end,end_picker,pickers,start_picker,update_picker;pickers=this.el.find(".date_picker");if(!pickers.length){return}start_picker=this.el.find(".date_picker.start_date");end_picker=this.el.find(".date_picker.end_date");duration_summary=this.el.find(".duration_summary");update_picker=function(input,set_min){var end,real_date,start;if(set_min==null){set_min=true}if(set_min&&input.is(".start_date")){real_date=input.datetimepicker("getDate");end_picker.datetimepicker("option","minDate",new Date(+real_date))}start=start_picker.datetimepicker("getDate");end=end_picker.datetimepicker("getDate");if(start&&end){return duration_summary.text(I.format_duration(end-start,3,false))}};if(!pickers){return}I.datetimepicker(pickers,{onSelect:function(val){return update_picker($(this))}});if(start_picker.val()){end=$.datepicker.parseDateTime(this.date_format,this.time_format,end_picker.val());end_picker.datetimepicker("setDate",end);return update_picker(start_picker)}};EditBundleForm.prototype.setup_timezone=function(){return this.el.find(".timezone_offset").val((new Date).getTimezoneOffset()/60)};return EditBundleForm}()}).call(this);(function(){var bind=function(fn,me){return function(){return fn.apply(me,arguments)}};I.EditSaleForm=function(){EditSaleForm.prototype.date_format="yy-mm-dd";EditSaleForm.prototype.time_format="HH:mm:ss";EditSaleForm.prototype.format_date_time=function(d){var date,time;time=$.datepicker.formatTime(this.time_format,{hour:d.getHours(),minute:d.getMinutes(),second:d.getSeconds()});date=$.datepicker.formatDate(this.date_format,new Date(d));return date+" "+time};function EditSaleForm(el,opts){var other_save;this.opts=opts;this.setup_game_pickers=bind(this.setup_game_pickers,this);this.format_date_time=bind(this.format_date_time,this);this.sale=this.opts.sale;this.is_new=!this.sale;this.el=$(el);this.setup_datepickers();this.setup_bundle_price();this.setup_goal_amount();this.render();this.setup_game_pickers();this.setup_timezone();this.el.has_tooltips();other_save=this.el.find(".header_nav").find(".save_btn").on("click",function(_this){return function(){return _this.form.submit()}}(this));this.form=this.el.find("form").remote_submit(function(_this){return function(res,form){var base;if(res.errors){form.set_form_errors(res.errors);return}form.set_form_errors([]);if(res.edit_url){if(typeof(base=window.history).replaceState==="function"){base.replaceState({},"Edit sale",res.edit_url)}}if(_this.is_new){return window.location=res.url}else{return I.flash("Sale saved")}}}(this));this.form.on("i:before_submit",function(_this){return function(){return other_save.prop("disabled",true).addClass("disabled")}}(this));this.form.on("i:after_submit",function(_this){return function(){return other_save.prop("disabled",false).removeClass("disabled")}}(this));I.setup_dirty_warning(this.form);this.el.dispatch("click",{select_all_games_btn:function(_this){return function(btn){var checkboxes;checkboxes=btn.closest(".input_group").find(".game_row:not(.disabled) input");checkboxes.prop("checked",true);return _this.el.trigger("i:update_games")}}(this),select_no_games_btn:function(_this){return function(btn){var checkboxes;checkboxes=btn.closest(".input_group").find(".game_row:not(.disabled) input");checkboxes.prop("checked",false);return _this.el.trigger("i:update_games")}}(this)});I.redactor(this.el.find("textarea"),{minHeight:80})}EditSaleForm.prototype.render_errors=function(errors){var err,lis;this.form_errors||(this.form_errors=this.el.find(".form_errors"));this.el.addClass("has_errors");lis=function(){var i,len,results;results=[];for(i=0,len=errors.length;i<len;i++){err=errors[i];results.push($("<li>").text(err))}return results}();this.form_errors.find("ul").empty().append(lis);return this.form_errors.hide().slideDown("fast")};EditSaleForm.prototype.setup_goal_amount=function(){this.goal_input=this.el.find(".goal_input");return I.money_input(this.goal_input)};EditSaleForm.prototype.setup_bundle_price=function(){var game_list,update_suggested_price;this.price_input=this.el.find(".bundle_price_input");I.money_input(this.price_input);this.el.on("change",".bundle_toggle_input",function(_this){return function(e){var target;target=$(e.currentTarget);return _this.el.toggleClass("is_bundle",target.prop("checked"))}}(this));game_list=this.el.find(".game_list");update_suggested_price=function(_this){return function(){var c,can_bundle,checked,input,rate,total;if(_this.current_rate==null){return}rate=_this.reverse_rate?1+_this.current_rate/100:1-_this.current_rate/100;checked=game_list.find("input:checked");can_bundle=rate>0&&checked.length>1;_this.selected_games=function(){var i,len,results;results=[];for(i=0,len=checked.length;i<len;i++){c=checked[i];results.push({id:$(c).data("game_id"),min_price:$(c).data("game_min_price"),paid_status:$(c).data("game_paid_status")})}return results}();_this.suggested_price=function(){var i,len;if(can_bundle){total=0;for(i=0,len=checked.length;i<len;i++){input=checked[i];total+=$(input).data("game_min_price")}return total*rate}}();return _this.render()}}(this);return this.el.on("i:update_rate i:update_games",function(_this){return function(){return update_suggested_price()}}(this))};EditSaleForm.prototype.setup_timezone=function(){return this.el.find(".timezone_offset").val((new Date).getTimezoneOffset()/60)};EditSaleForm.prototype.render=function(){this.render_slider();this.render_bundle_price();this.render_sale_conditions();return this.render_coupon_settings()};EditSaleForm.prototype.render_coupon_settings=function(){var ref,ref1,ref2,ref3,ref4;return ReactDOM.render(R.EditSale.CouponSettings({user_slug:this.opts.user_slug,taken_slugs:_.toArray(this.opts.taken_slugs),coupon:(ref=this.sale)!=null?ref.coupon:void 0,redeems:(ref1=this.sale)!=null?ref1.coupon_redeems:void 0,max_redeems:(ref2=this.sale)!=null?ref2.coupon_max_redeems:void 0,rate:(ref3=this.current_rate)!=null?ref3:(ref4=this.sale)!=null?ref4.rate:void 0}),this.el.find(".coupon_drop")[0])};EditSaleForm.prototype.render_sale_conditions=function(){return ReactDOM.render(R.EditSale.SaleConditions({selected_games:this.selected_games||[],sale_triggers:this.opts.sale_triggers||[],games:this.opts.games||[]}),this.el.find(".sale_conditions_drop")[0])};EditSaleForm.prototype.render_bundle_price=function(){var ref,ref1,ref2;return ReactDOM.render(R.EditSale.BundlePrice({rate:(ref=this.current_rate)!=null?ref:(ref1=this.sale)!=null?ref1.rate:void 0,bundle_price:(ref2=this.sale)!=null?ref2.bundle_price:void 0,currency:this.opts.currency,selected_games:this.selected_games||[],suggested_price:this.suggested_price}),this.el.find(".bundle_price_drop")[0])};EditSaleForm.prototype.render_slider=function(){var ref,ref1;this._set_rate||(this._set_rate=function(_this){return function(){var game_list,prices;game_list=_this.el.find(".game_list");prices=game_list.find(".game_price.after_sale");return function(rate,reverse){var amount,i,len,p,val;val=rate/100;for(i=0,len=prices.length;i<len;i++){p=prices[i];p=$(p);amount=reverse?p.data("default_price")*(1+val):p.data("default_price")*(1-val);p.text(I.format_money(amount,_this.opts.currency))}_this.current_rate=rate;_this.reverse_rate=reverse;return _this.el.trigger("i:update_rate",[val])}}}(this)());return ReactDOM.render(R.EditSale.RatePicker({rate:(ref=this.sale)!=null?ref.rate:void 0,allow_promotion_claim:(ref1=this.sale)!=null?ref1.allow_promotion_claim:void 0,default_rate:this.opts.default_rate,set_rate:this._set_rate}),this.el.find(".sale_rate_drop")[0])};EditSaleForm.prototype.setup_datepickers=function(){var duration_summary,end,end_picker,pickers,start_picker,update_picker;start_picker=this.el.find(".date_picker.start_date");end_picker=this.el.find(".date_picker.end_date");duration_summary=this.el.find(".duration_summary");update_picker=function(input,set_min){var end,real_date,start;if(set_min==null){set_min=true}if(set_min&&input.is(".start_date")){real_date=input.datetimepicker("getDate");end_picker.datetimepicker("option","minDate",new Date(+real_date))}start=start_picker.datetimepicker("getDate");end=end_picker.datetimepicker("getDate");if(start&&end){return duration_summary.text(I.format_duration(end-start,3,false))}};pickers=this.el.find(".date_picker");I.datetimepicker(pickers,{onSelect:function(val){return update_picker($(this))}});if(start_picker.val()){end=$.datepicker.parseDateTime(this.date_format,this.time_format,end_picker.val());end_picker.datetimepicker("setDate",end);return update_picker(start_picker)}};EditSaleForm.prototype.setup_game_pickers=function(){var game_list;game_list=this.el.find(".game_list");return game_list.on("change","input",function(_this){return function(){return _this.el.trigger("i:update_games")}}(this))};return EditSaleForm}()}).call(this);(function(){I.FollowersBase=function(){function FollowersBase(el){this.el=$(el);I.has_follow_button(this.el)}return FollowersBase}()}).call(this);(function(){I.GameCollections=function(){function GameCollections(el){var form;this.el=$(el);I.redactor(this.el.find("textarea"),{toolbarOverflow:true,minHeight:100});this.el.find("input[type='radio']:first").prop("checked",true);this.el.on("click change",".collection_option",function(_this){return function(e){var row;row=$(e.currentTarget);return row.find("input[type='radio']").prop("checked",true)}}(this));form=this.el.find("form").remote_submit(function(_this){return function(res){if(res.errors){form.set_form_errors(errors);return}return window.location=res.url}}(this));I.with_selectize(function(_this){return function(){return _this.el.find("select.collection_input").selectize()}}(this))}return GameCollections}()}).call(this);(function(){var KeyGroupLightbox,bind=function(fn,me){return function(){return fn.apply(me,arguments)}},extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;KeyGroupLightbox=function(superClass){extend(KeyGroupLightbox,superClass);function KeyGroupLightbox(){this.init=bind(this.init,this);return KeyGroupLightbox.__super__.constructor.apply(this,arguments)}KeyGroupLightbox.prototype.init=function(parent){var form;I.money_input(this.el.find(".unlock_price_input"));I.bind_checkbox_to_input(this.el.find(".toggle_unlock_input"),this.el.find(".unlock_price_input"));return form=this.el.find("form").remote_submit(function(_this){return function(res){if(res.errors){form.set_form_errors(res.errors);return}return window.location.reload()}}(this))};return KeyGroupLightbox}(I.Lightbox);I.GameKeys=function(){function GameKeys(el,game){this.game=game;this.el=$(el);this.el.dispatch("click",{create_key_group_btn:function(_this){return function(btn){return I.Lightbox.open_tpl("key_group_lightbox",KeyGroupLightbox,_this)}}(this),create_key_btn:function(_this){return function(btn){return _this.create_download_key().done(function(key){var component;component=R.GameEdit.DownloadKeyLightbox(_this.lightbox_props(key,true));return I.Lightbox.open(component)})}}(this),revoke_key_btn:function(_this){return function(btn){var row;if(confirm("Are you sure you want to revoke this key?")){row=btn.closest(".key_row");row.removeClass("new").addClass("revoked");return _this.revoke_download_key(row.data("key"))}}}(this),show_key_btn:function(_this){return function(btn){var component,key;if(btn.closest(".revoked").length){return}key=btn.closest(".key_row").data("key");component=R.GameEdit.DownloadKeyLightbox(_this.lightbox_props(key));return I.Lightbox.open(component)}}(this)})}GameKeys.prototype.lightbox_props=function(key,is_new){return{new_key:is_new,download_key:key,game:{noun:"game"}}};GameKeys.prototype._download_key=function(action,data){if(data==null){data={}}data.action=action;return $.ajax({url:"/game/keys/"+this.game.id,type:"post",data:I.with_csrf(data)}).then(function(_this){return function(res){if(res.errors){alert(res.errors.join(","));return $.Deferred()}else{return res}}}(this))};GameKeys.prototype.create_download_key=function(){I.Lightbox.open_loading();return this._download_key("create")};GameKeys.prototype.revoke_download_key=function(key,fn){return this._download_key("revoke",{download_key_id:key.id})};return GameKeys}()}).call(this);(function(){var bind=function(fn,me){return function(){return fn.apply(me,arguments)}};I.GameReleaseInfo=function(){function GameReleaseInfo(el,opts){this.opts=opts;this.setup_date_pickers=bind(this.setup_date_pickers,this);I.event2("game release info");this.el=$(el);I.setup_selectize(this.el);this.setup_date_pickers();this.setup_licenses();this.form=this.el.find("form").remote_submit(function(_this){return function(res,form){if(res.errors){form.set_form_errors(res.errors);return}form.set_form_errors([]);return I.flash("Changes saved")}}(this));I.setup_dirty_warning(this.form)}GameReleaseInfo.prototype.setup_licenses=function(){return["code","assets"].forEach(function(_this){return function(type){var on_change,picker;picker=_this.el.find("."+type+"_license_picker");on_change=function(e){var license;license=picker.val();_this.el.find("."+type+"_license").removeClass("shown");return _this.el.find("."+type+"_license.license_"+license).addClass("shown")};picker.on("change",on_change);return on_change()}}(this))};GameReleaseInfo.prototype.setup_date_pickers=function(){this.el.find(".timezone_input").val(jstz.determine().name());return I.datetimepicker(this.el.find(".date_picker"))};return GameReleaseInfo}()}).call(this);(function(){I.PurchaseList=function(){function PurchaseList(el){this.el=$(el);this.el.on("click",".email_cell",function(e){return $(e.currentTarget).closest(".purchase_list_table").addClass("show_emails")})}return PurchaseList}();I.GameSummary=function(){function GameSummary(el){this.el=$(el);this.setup_purchases()}GameSummary.prototype.setup_purchases=function(){new I.PurchaseList(this.el);return this.el.find(".purchases_table.remote_table").remote_table()};return GameSummary}()}).call(this);(function(){var extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;I.GameInteract=function(){function GameInteract(el,opts){this.opts=opts;I.event2(this.opts.page_name);this.el=$(el);I.setup_selectize(this.el);this.el.find(".sort_by_picker").on("change",function(e){return window.location="?sort_by="+$(e.target).val()})}return GameInteract}();I.DashboardGameRatings=function(superClass){extend(DashboardGameRatings,superClass);function DashboardGameRatings(){DashboardGameRatings.__super__.constructor.apply(this,arguments);this.el.dispatch("click",{report_rating_btn:function(_this){return function(el){var url;if(url=el.data("lightbox_url")){return I.Lightbox.open_remote_react(url,function(props){return R.Dashboard.GameRatingsReportLightbox(props)})}}}(this)});this.el.on("change",".rating_toggle_input",function(_this){return function(e){var data,target,top;target=$(e.currentTarget);top=target.closest(".toggle_ratings");if(top.is(".loading")){return false}top.addClass("loading");data=I.with_csrf(target.closest("form").serializeArray());target.prop("disabled",true);return $.ajax({url:"",type:"POST",data:I.with_csrf(data),success:function(res){return window.location.reload()}})}}(this))}return DashboardGameRatings}(I.GameInteract)}).call(this);(function(){var bind=function(fn,me){return function(){return fn.apply(me,arguments)}};I.IoGame=function(){function IoGame(el,opts){var img;this.el=$(el);this.upgrade_sidebar(opts);if(opts.hit_url){img=new Image;img.src=opts.hit_url}}IoGame.prototype.upgrade_sidebar=function(opts){return $.ajax({type:"POST",url:opts.upgrade_url,xhrFields:{withCredentials:true},success:function(_this){return function(res){if(!res.upgrade){return}if(res.header){$("body > .header_widget").replaceWith(res.header)}return _this.el.find(".game_sidebar").html(opts.sidebar)}}(this)})};return IoGame}();I.IoGameSidebar=function(){function IoGameSidebar(el){this.setup_comments=bind(this.setup_comments,this);this.el=$(el);I.has_follow_button(this.el);this.setup_comments();this.el.dispatch("click",{rate_game_btn:function(_this){return function(btn){return I.Lightbox.open_remote_react(btn.data("url"),function(props){return R.Library.RateGameLightbox(props)})}}(this)})}IoGameSidebar.prototype.setup_comments=function(){return this.el.on("focus",".click_input",function(_this){return function(e){var el;el=$(e.target).closest("[data-form_html]");return el.replaceWith(el.data("form_html"))}}(this))};return IoGameSidebar}()}).call(this);(function(){var bind=function(fn,me){return function(){return fn.apply(me,arguments)}};I.UserLogin=function(){function UserLogin(el){this.el=$(el);I.tracked_links(this.el,"login");if(this.el.find(".g-recaptcha").length){I.event("recaptcha","show","login")}}return UserLogin}();I.ForgotPassword=function(){function ForgotPassword(el){I.tracked_links(this.el,"register");this.el=$(el);if(this.el.find(".g-recaptcha").length){I.event("recaptcha","show","forgot_password")}}return ForgotPassword}();I.PurchaseStatus=function(){function PurchaseStatus(el){var checking;this.el=$(el);checking=false;this.timer=setInterval(function(_this){return function(){if(checking){return}checking=true;return $.post("",function(res){checking=false;switch(res.status){case"failed":clearTimeout(_this.timer);return _this.el.addClass("failed");case"complete":clearTimeout(_this.timer);return window.location=res.download_url}})}}(this),1e3)}return PurchaseStatus}();I.ExportPurchases=function(){ExportPurchases.prototype.date_format="yy-mm-dd";ExportPurchases.prototype.time_format="HH:mm:ss";function ExportPurchases(el){this.setup_range_form=bind(this.setup_range_form,this);this.el=$(el);this.setup_range_form();new I.PurchaseList(this.el)}ExportPurchases.prototype.setup_range_form=function(){var end_picker,form,outer,start_picker,update_picker;outer=this.el.find(".range_form_outer");form=outer.find(".range_form");if(!form.length){return}form.find(".timezone_input").val(jstz.determine().name());start_picker=this.el.find(".date_picker.start_date");end_picker=this.el.find(".date_picker.end_date");update_picker=function(input,set_min){var real_date;if(set_min==null){set_min=true}if(set_min&&input.is(".start_date")){real_date=input.datetimepicker("getDate");return end_picker.datetimepicker("option","minDate",new Date(+real_date))}};form.find(".date_picker").datetimepicker({timeFormat:this.time_format,dateFormat:this.date_format,onSelect:function(val){return update_picker($(this))},beforeShow:function(_this){return function(){_.defer(function(){return $("#ui-datepicker-div").css("z-index",2)});return void 0}}(this)});outer.removeClass("has_purchases");return form.remote_submit(function(_this){return function(res){if(res.errors){alert(res.errors.join(", "));return}outer.toggleClass("is_plural",res.count!==1).toggleClass("no_results",res.count===0).find(".purchase_count").text(res.count);return outer.addClass("has_purchases").find(".purchases").html(res.content)}}(this))};return ExportPurchases}()}).call(this);(function(){var BuyBundleLightbox,bind=function(fn,me){return function(){return fn.apply(me,arguments)}},extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;BuyBundleLightbox=function(superClass){extend(BuyBundleLightbox,superClass);function BuyBundleLightbox(){this.load_fingerprint=bind(this.load_fingerprint,this);return BuyBundleLightbox.__super__.constructor.apply(this,arguments)}BuyBundleLightbox.prototype.init=function(bundle,opts){this.bundle=bundle;this.buy=new I.BundleBuyForm(this.el,this.bundle,{});this.buy.submit_handler=this.buy.remote_submit;return this.load_fingerprint(function(_this){return function(){return _this.buy.set_fingerprint()}}(this))};BuyBundleLightbox.prototype.load_fingerprint=function(callback){var html;if(window.Fingerprint2){if(typeof callback==="function"){callback()}return}html=this.el.data("checkout");if(!html){return}$(document.body).append(html);return I.wait_for_object(window,"Fingerprint2",callback)};return BuyBundleLightbox}(I.Lightbox);I.PromotionPage=function(){PromotionPage.prototype.track_category=function(){throw"override me"};PromotionPage.prototype.page_name=function(){throw"override me"};function PromotionPage(el,promotion){var base,c,grid_el,i,len,ref1;this.promotion=promotion;this.page_name=bind(this.page_name,this);this.track_category=bind(this.track_category,this);this.el=$(el);(base=this.promotion).small_grid||(base.small_grid=I.is_mobile());this.el.toggleClass("small_grid",!!this.promotion.small_grid);this.el.format_timestamps();this.el.has_tooltips();ref1=this.el.find(".game_grid_widget");for(i=0,len=ref1.length;i<len;i++){grid_el=ref1[i];new I.GameGrid($(grid_el),{cell_margin:20,available_width:I.GameGridSizer.sizers.el_rect,expected_size:this.promotion.small_grid&&!I.is_mobile()?250:315,selector:".promo_game_grid .game_cell .game_thumb",width_selector:".promo_game_grid .game_cell"})}this.carousels=function(){var j,len1,ref2,results;ref2=this.el.find(".game_carousel_widget");results=[];for(j=0,len1=ref2.length;j<len1;j++){c=ref2[j];results.push(new I.GameCarousel($(c)))}return results}.call(this);this.el.dispatch("click",{buy_game_btn:function(_this){return function(btn){var game;I.event(_this.track_category(),"buy");if(I.is_mobile()){window.location=I.add_params(btn.data("href"),{initiator:"mobile"});return"continue"}game=btn.data("game");return I.Lightbox.open_remote(btn.data("href"),I.BuyGameLightbox,game,{is_donate:false,event_category:"view_sale",pay_in_popup:false})}}(this),buy_bundle_btn:function(_this){return function(btn){var html,url;I.event(_this.track_category(),"buy");if(url=btn.data("lightbox_url")){I.Lightbox.open_remote(url,BuyBundleLightbox,_this.promotion,{});return}el=$("#buy_lightbox_tpl");if(el.length){html=el.html();I.Lightbox.open(html,BuyBundleLightbox,_this.promotion,{});return}throw new Error("don't know how to open buy lightbox for bundle")}}(this)});this.setup_sticking();this.setup_countdown();this.setup_referrer()}PromotionPage.prototype.setup_referrer=function(){var host,ref;if(I.ReferrerTracker.has_ref(this.page_name(),this.promotion.id)){return}host=$(document.body).data("host");ref=document.referrer;if(!ref){return}if(ref.indexOf(host)>=0){return}return I.ReferrerTracker.push(this.page_name(),this.promotion.id,this.page_name()+":"+ref)};PromotionPage.prototype.setup_sticking=function(){var body,check_can_stick,opts,stickable,sticking,win;if(this.promotion.disable_sticky_kit){return}win=$(window);opts={parent:".columns_wrapper"};stickable=this.el.find(".stick_wrapper");sticking=false;check_can_stick=function(){var should_be_sticking;should_be_sticking=win.width()>900;if(should_be_sticking&&!sticking){if(stickable!=null){stickable.stick_in_parent(opts)}}if(!should_be_sticking&&sticking){if(stickable!=null){stickable.trigger("sticky_kit:detach")}}return sticking=should_be_sticking};check_can_stick();win.on("resize",function(_this){return function(){check_can_stick()}}(this));body=$(document.body);return this.el.find(".columns_wrapper").on("i:grid_resize",function(_this){return function(){return body.trigger("sticky_kit:recalc")}}(this))};PromotionPage.prototype.setup_countdown=function(){var el,end,i,len,now,ref1,start;ref1=this.el.find(".countdown");for(i=0,len=ref1.length;i<len;i++){el=ref1[i];el=$(el);now=new Date;start=I.parse_timestamp(this.promotion.start_date);end=I.parse_timestamp(this.promotion.end_date);if(now<start||now>end){return}el.html(el.data("countdown"));new I.Countdown(el,end,{max_blocks:3})}};return PromotionPage}();I.SalePage=function(superClass){extend(SalePage,superClass);function SalePage(){this.page_name=bind(this.page_name,this);this.track_category=bind(this.track_category,this);return SalePage.__super__.constructor.apply(this,arguments)}SalePage.prototype.track_category=function(){return"view_sale"};SalePage.prototype.page_name=function(){return"sale"};return SalePage}(I.PromotionPage);I.BundlePage=function(superClass){extend(BundlePage,superClass);BundlePage.prototype.track_category=function(){return"view_bundle"};BundlePage.prototype.page_name=function(){return"bundle"};function BundlePage(){this.page_name=bind(this.page_name,this);this.track_category=bind(this.track_category,this);BundlePage.__super__.constructor.apply(this,arguments);this.el.dispatch("click",{participants_btn:function(_this){return function(btn){return I.Lightbox.open_remote_react(btn.data("lightbox_url"),function(props){return R.Bundle.ParticipantsLightbox(props)})}}(this)})}return BundlePage}(I.PromotionPage)}).call(this);(function(){I.RegisterForm=function(){function RegisterForm(el,opts){I.event2("register form");if(opts.ref_action){I.set_register_referrer("email")}this.el=$(el);this.el.has_tooltips();this.setup_username_input();this.setup_slug_preview();this.setup_availability_check();if(this.username_input.val().trim().length){this.el.trigger("i:update_username")}if(this.el.find(".g-recaptcha").length){I.event("recaptcha","show","register")}new I.FilterPickers(this.el)}RegisterForm.prototype.setup_username_input=function(){this.username_input=this.el.find("input[name=username]");return this.username_input.on("keyup change",_.debounce(function(_this){return function(){return _this.el.trigger("i:update_username")}}(this),250))};RegisterForm.prototype.setup_slug_preview=function(){var slug;slug=this.el.find(".slug_preview");return this.el.on("i:update_username",function(_this){return function(){var name;name=_this.username_input.val().trim();if(name.length){return slug.val("http://"+I.slugify(name)+".itch.io/")}else{return slug.val(null)}}}(this))};RegisterForm.prototype.get_submit_button=function(){return this.el.find("input[type=submit]")};RegisterForm.prototype.setup_availability_check=function(){var row,submit;row=this.username_input.closest(".validated");submit=this.get_submit_button();return this.el.on("i:update_username",function(_this){return function(){if(_.isEmpty(_this.username_input.val())){row.removeClass("valid invalid");return}return $.ajax({url:"/user/check-availability",type:"POST",data:I.with_csrf({username:_this.username_input.val()}),success:function(res){var has_error,ref;row.removeClass("valid invalid");row.find(".input_error_message").text(((ref=res.errors)!=null?ref[0]:void 0)||"");has_error=!!res.errors;row.toggleClass("invalid",has_error).toggleClass("valid",!has_error);submit.toggleClass("disabled",has_error);submit.prop("disabled",has_error);return _this.el.trigger("i:got_availability")}})}}(this))};return RegisterForm}()}).call(this);(function(){I.SaleAnalytics=function(){function SaleAnalytics(el,opts){var i,len,ref,tbl;this.el=$(el);ref=this.el.find(".remote_table");for(i=0,len=ref.length;i<len;i++){tbl=ref[i];$(tbl).remote_table()}this.el.format_timestamps("fromNow");if(opts.cumulative_earnings){new I.CumulativeGraph("#cumulative_earnings_graph",opts.cumulative_earnings,{currency:opts.currency})}}return SaleAnalytics}()}).call(this);(function(){var bind=function(fn,me){return function(){return fn.apply(me,arguments)}};I.SellerRevenueSharing=function(){function SellerRevenueSharing(el,opts){this.opts=opts;this.render_cut_picker=bind(this.render_cut_picker,this);this.el=$(el);this.render_cut_picker()}SellerRevenueSharing.prototype.render_cut_picker=function(){var el;el=this.el.find(".cut_row_drop");if(!el[0]){return}return ReactDOM.render(R.UserSettings.SellerCutPicker({cut:this.opts.cut,default_cut:this.opts.default_cut,affiliate_cuts:_.toArray(this.opts.affiliate_props)}),el[0])};return SellerRevenueSharing}();I.SellerSettings=function(){function SellerSettings(el,opts){this.opts=opts;this.el=$(el);this.setup_payout_picker()}SellerSettings.prototype.setup_payout_picker=function(){var payout_modes,show_mode_settings;show_mode_settings=function(_this){return function(mode){return _this.el.find("[data-payout_mode]").removeClass("visible").filter("[data-payout_mode='"+mode+"']").addClass("visible")}}(this);payout_modes=this.el.find(".payout_mode");payout_modes.on("change","input",function(_this){return function(e){var input;payout_modes.removeClass("selected");input=$(e.target).closest(".payout_mode").addClass("selected").end();return show_mode_settings(input.val())}}(this));this.el.on("click",".payout_mode",function(_this){return function(e){var toggle;if($(e.target).closest("input").length){return}toggle=$(e.currentTarget).find("input");return toggle.prop("checked",true).trigger("change")}}(this));return show_mode_settings(this.el.find("input[name='data[payout_mode]']:checked").val())};return SellerSettings}()}).call(this);(function(){I.UserTfaApp=function(){function UserTfaApp(el,data){I.event2("tfa app");this.el=$(el);$(".qrcode").qrcode(data.url);this.el.dispatch("click",{show_secret_btn:function(_this){return function(){return _this.el.addClass("secret_shown")}}(this)});this.form=this.el.find("form").remote_submit(function(_this){return function(res){_this.form.set_form_errors(res.errors);if(res.success){return window.location=res.url}}}(this))}return UserTfaApp}();I.UserTfaScratchcodes=function(){function UserTfaScratchcodes(el){I.event2("tfa codes");this.el=$(el);this.el.dispatch("click",{print_btn:function(_this){return function(){return window.print()}}(this)})}return UserTfaScratchcodes}()}).call(this);(function(){var send_message;send_message=function(msg){return top.$(window.top.document).trigger("i:upload_popup_msg",[msg])};I.ManualUpload=function(){ManualUpload.prototype.image_types=/\.jpg$|\.gif$|\.png$/i;function ManualUpload(el,opts){var max_label;this.opts=opts;this.el=$(el);max_label=this.el.find(".max_size_value");if(max_label.length){max_label.text(I.format_bytes(+max_label.text()))}this.el.find("input[type=file]").on("change",function(_this){return function(e){var file;file=e.target.files[0];_this.filename=file.name;_this.size=file.size;_this.mime=file.type;_this.el.toggleClass("show_size_error",!!(_this.size&&_this.size>_this.opts.max_size));if(_this.opts.kind==="image"){return _this.el.toggleClass("show_type_error",!_this.filename.match(_this.image_types))}}}(this));this.el.find("form").on("submit",function(_this){return function(e){var form;if(_this.el.is(".show_size_error, .show_type_error")){e.preventDefault();return}form=$(e.target);if(form.is(".ready")){return}if(!_this.filename){return false}if(_this.mime){I.event("upload_popup","start_"+_this.opts.kind,_this.mime)}I.prepare_upload(_this.opts.prefix,{kind:_this.opts.kind,type:_this.opts.type,thumb_size:_this.opts.thumb_size,filename:_this.filename,redirect:true},function(res){var key,ref,val;if(!$.isPlainObject(res)){I.event("upload_popup","error","failed to prepare upload");alert("Server failed to prepare upload");return false}_this.el.addClass("uploading");send_message({type:"start_upload",name:_this.filename,size:_this.size,data:res},"*");form.find("input[type=hidden]").remove();form.attr("action",res.action);ref=res.post_params;for(key in ref){val=ref[key];$('<input type="hidden" />').attr("name",key).attr("value",val).prependTo(form)}form.addClass("ready");return form.submit()},function(res){I.event("upload_popup","error",res);return alert(res)});return false}}(this))}return ManualUpload}();I.SaveUpload=function(){function SaveUpload(data){this.data=data;I.event("upload_popup","save","save");setTimeout(function(_this){return function(){return send_message({type:"save_upload",data:_this.data})}}(this),100)}return SaveUpload}()}).call(this);(function(){I.UserOauthOob=function(){function UserOauthOob(el){this.el=$(el);this.el.dispatch("click",{api_key_input:function(_this){return function(input){return input.select()}}(this)})}return UserOauthOob}()}).call(this);(function(){I.UserSettingsEmailNotifications=function(){function UserSettingsEmailNotifications(el){var global_disable,other_inputs,update;this.el=$(el);global_disable=this.el.find(".notification_toggle[name='email_settings[disable_all]']");other_inputs=this.el.find(".notification_toggle").not(global_disable);update=function(){return other_inputs.prop("disabled",global_disable.prop("checked"))};global_disable.on("change",update);update()}return UserSettingsEmailNotifications}();I.UserSettingsEmailAddresses=function(){function UserSettingsEmailAddresses(el){this.el=$(el);this.setup_email_verify();this.el.dispatch("click",{resend_verify_email_btn:function(_this){return function(btn){var email;email=btn.closest("[data-email]").data("email");btn.closest("tr").addClass("sent_verify");return $.post(btn.data("href"),I.with_csrf({email:email}),function(res){if(res.errors){alert(res.errors.join(", "))}})}}(this),delete_email_btn:function(_this){return function(btn){var email;email=btn.closest("[data-email]").data("email");if(!confirm("Are you sure you want to delete "+email)){return}btn.closest("tr").remove();return $.post(btn.data("href"),I.with_csrf({action:"delete",email:email}),function(res){if(res.errors){alert(res.errors.join(", "))}})}}(this)})}UserSettingsEmailAddresses.prototype.setup_email_verify=function(){var verify_warning;verify_warning=this.el.find(".verify_warning_box");if(!verify_warning.length){return}return verify_warning.dispatch("click",{verify_email_btn:function(_this){return function(btn){verify_warning.addClass("loading");btn.addClass("disabled").prop("disabled",true);return $.post(btn.data("url"),I.with_csrf(),function(res){verify_warning.removeClass("loading");btn.removeClass("disabled").prop("disabled",false);if(res.errors){alert(res.errors.join(","));return}return verify_warning.addClass("is_complete")})}}(this)})};return UserSettingsEmailAddresses}();I.UserSettingsProfile=function(){function UserSettingsProfile(el,slug){this.slug=slug;this.el=$(el);this.el.has_tooltips();this.setup_redactor();this.el.dispatch("click",{change_username_btn:function(btn){return I.Lightbox.open_remote_react(btn.data("lightbox_url"),R.UserSettings.ChangeUsernameLightbox)}})}UserSettingsProfile.prototype.setup_redactor=function(){return I.with_redactor(function(_this){return function(){return I.redactor(_this.el.find("textarea"))}}(this))};return UserSettingsProfile}();I.UserSettingsOauthAppsNew=function(){function UserSettingsOauthAppsNew(el){var form;this.el=$(el);form=this.el.find("form").remote_submit(function(_this){return function(res){if(res.errors){form.set_form_errors(res.errors);return}return window.location=res.redirect_to}}(this))}return UserSettingsOauthAppsNew}();I.UserSettingsOauthAppsView=function(){function UserSettingsOauthAppsView(el){this.el=$(el);this.el.dispatch("click",{view_key_btn:function(_this){return function(btn){return btn.closest(".key_cell").toggleClass("show_key")}}(this),revoke_all_tokens_btn:function(_this){return function(btn){if(confirm("Are you sure you want to revoke ALL user tokens for this application? All users of this app will be forced back to the authorization flow before they can use your application again.")){return btn.closest("form").submit()}}}(this),reset_secret_btn:function(_this){return function(btn){if(confirm("Are you sure you want to reset your client secret? You will need to update your application to use the new secret. This will not invalidate any user tokens.")){return btn.closest("form").submit()}}}(this)});this.el.find("form").each(function(_this){return function(i,form){var $form;$form=$(form);return $form.remote_submit(function(res){if(res.errors){$form.set_form_errors(res.errors);return}return window.location.reload()})}}(this))}return UserSettingsOauthAppsView}()}).call(this);(function(){I.UserSettingsCreditCards=function(){function UserSettingsCreditCards(el,opts){this.opts=opts;this.el=$(el);this.el.remote_link(function(_this){return function(){return location.reload()}}(this));this.el.dispatch("click",{new_card_btn:function(_this){return function(btn){return I.Lightbox.open(R.UserSettings.CreditCardLightbox(_this.opts.credit_card_lightbox_props))}}(this),edit_card_btn:function(_this){return function(btn){return I.Lightbox.open_remote_react(btn.data("href"),R.UserSettings.EditCreditCardLightbox)}}(this)})}return UserSettingsCreditCards}()}).call(this);(function(){I.libs.react.done(function(){var P,PackageIcon,PlayIcon,_rdf,a,br,button,code,div,em,fieldset,form,fragment,h1,h2,h3,h4,h5,h6,iframe,img,input,label,legend,li,ol,optgroup,option,p,pre,section,select,sketchfab_pattern,span,strong,textarea,types,ul,vimeo_pattern,youtube_pattern,slice=[].slice;_rdf=ReactDOMFactories;div=_rdf.div,span=_rdf.span,a=_rdf.a,br=_rdf.br,p=_rdf.p,ol=_rdf.ol,ul=_rdf.ul,li=_rdf.li,strong=_rdf.strong,em=_rdf.em,img=_rdf.img,form=_rdf.form,label=_rdf.label,input=_rdf.input,textarea=_rdf.textarea,button=_rdf.button,iframe=_rdf.iframe,h1=_rdf.h1,h2=_rdf.h2,h3=_rdf.h3,h4=_rdf.h4,h5=_rdf.h5,h6=_rdf.h6,pre=_rdf.pre,code=_rdf.code,select=_rdf.select,option=_rdf.option,section=_rdf.section,optgroup=_rdf.optgroup,fieldset=_rdf.fieldset,legend=_rdf.legend;fragment=React.createElement.bind(null,React.Fragment);fragment.type=React.fragment;P=R["package"]("BlogPosts");types=PropTypes;youtube_pattern=/https?:\/\/(?:[0-9A-Z-]+\.)?(?:youtu\.be\/|youtube\.com\S*[^\w\-\s])([\w\-]{11})(?=[^\w\-]|$)(?![?=&+%\w.\-]*(?:['"][^<>]*>|<\/a>))[?=&+%\w.-]*/gi;vimeo_pattern=/https?:\/\/(www\.)?vimeo.com\/(\d+)($|\/)/;sketchfab_pattern=/https?:\/\/(?:www\.)?sketchfab\.com\/models\/([\w]+)($|\/)/;PlayIcon=React.createElement("svg",{className:"svgicon icon_play",strokeLinecap:"round",stroke:"currentColor",role:"img",version:"1.1",viewBox:"0 0 24 24",strokeWidth:"2",width:"18",height:"18",strokeLinejoin:"round","aria-hidden":true,fill:"none"},React.createElement("circle",{cx:"12",cy:"12",r:"10"}),React.createElement("polygon",{points:"10 8 16 12 10 16 10 8"}));PackageIcon=React.createElement("svg",{className:"svgicon icon_package",strokeLinecap:"round",stroke:"currentColor",role:"img",version:"1.1",viewBox:"0 0 24 24",strokeWidth:"2",width:"18",height:"18",strokeLinejoin:"round","aria-hidden":true,fill:"none"},React.createElement("path",{d:"M12.89 1.45l8 4A2 2 0 0 1 22 7.24v9.53a2 2 0 0 1-1.11 1.79l-8 4a2 2 0 0 1-1.79 0l-8-4a2 2 0 0 1-1.1-1.8V7.24a2 2 0 0 1 1.11-1.79l8-4a2 2 0 0 1 1.78 0z"}),React.createElement("polyline",{points:"2.32 6.16 12 11 21.68 6.16"}),React.createElement("line",{x1:"12",y1:"22.76",x2:"12",y2:"11"}),React.createElement("line",{x1:"7",y1:"3.5",x2:"17",y2:"8.5"}));P("AttachmentEditor",{propTypes:{available_attachments:types.array,selected_attachments:types.array,object:types.object},getInitialState:function(){return{visible_type:"files",selected_attachments:this.props.selected_attachments,available_attachments:this.props.available_attachments,active_uploads:[]}},split_attachments:function(attachments){var attachment,images,j,len,listed;if(attachments==null){attachments=this.state.selected_attachments}listed=[];images=[];for(j=0,len=attachments.length;j<len;j++){attachment=attachments[j];switch(attachment.type){case"image":images.push(attachment);break;default:listed.push(attachment)}}return[listed,images]},sort_attachments:function(attachments){var images,listed,ref;if(attachments==null){attachments=this.state.selected_attachments}ref=this.split_attachments(attachments),listed=ref[0],images=ref[1];return listed.concat(images)},componentDidMount:function(){return this.dispatch({append_video:function(_this){return function(){var exists,is_valid,url;url=$.trim(_this.refs.video_url.value);if(url===""){return}is_valid=_.any([youtube_pattern,vimeo_pattern,sketchfab_pattern],function(p){return url.match(p)});if(!is_valid){_this.setState({video_error:"That URL is not recognized"});return}exists=_.any(_this.state.selected_attachments,function(attach){return attach.type==="video"&&attach.url===url});if(exists){_this.setState({video_error:"That video has already been added"});return}_this.refs.video_url.value="";return _this.setState({video_error:null,selected_attachments:_this.sort_attachments(_this.state.selected_attachments.concat([{type:"video",url:url}]))})}}(this),pick_images:function(_this){return function(){var format_attachment,seen_attachments;_this.setState({upload_errors:[]});seen_attachments={};format_attachment=function(res){if(res.errors){_this.push_errors(res.errors);return}if(seen_attachments[res.upload.id]){return}seen_attachments[res.upload.id]=true;return{type:"image",upload:res.upload,id:res.upload.id,image_url:res.upload.thumb_url,medium_image_url:res.upload.thumb_url}};return I.upload_image({url:_this.props.upload_image_url,max_size:_this.props.max_upload_size,multiple:true,test_file:function(file,d){return $.when(I.test_image_dimensions(file),I.test_image_format(file)).done(function(){return d.resolve()}).fail(function(err){return d.reject(err)})},on_start_upload:function(file,upload,xhr){var active_upload;active_upload={file:file,upload:upload,xhr:xhr,progress:0};_this.setState(function(state){return{active_uploads:state.active_uploads.concat([active_upload]),uploading:true}});return xhr.progress(function(event,sent,total){var updated_active_upload;updated_active_upload=Object.assign({},active_upload,{progress:sent/total});_this.setState(function(state){return{active_uploads:state.active_uploads.map(function(_this){return function(u){if(u===active_upload){return updated_active_upload}else{return u}}}(this))}});return active_upload=updated_active_upload}).done(function(res){var attachment;if(attachment=format_attachment(res)){return _this.setState(function(state){return{selected_attachments:_this.sort_attachments(state.selected_attachments.concat([attachment]))}})}}).always(function(){return _this.setState(function(state){var remaining;remaining=state.active_uploads.filter(function(_this){return function(u){return u!==active_upload}}(this));return{uploading:!!remaining.length,active_uploads:remaining}})})}}).fail(function(res){return _this.push_errors(res)})}}(this)})},push_errors:function(res){var err,errors,file,msg;if("string"===typeof res){res=[res]}errors=function(){var j,len,results;results=[];for(j=0,len=res.length;j<len;j++){err=res[j];if("string"===typeof err){results.push(err)}else if(Array.isArray(err)){msg=err[0],file=err[1];if(file){results.push(file.name+" - "+msg)}else{results.push(msg)}}else{continue}}return results}();return this.setState(function(state){return{upload_errors:(state.upload_errors||[]).concat(errors)}})},render:function(){var o;return this.enclose({className:"attachment_picker input_row"},div({className:"label"},"Attachments"),(o=this.props.object)?p({className:"attach_summary"},"You can attach things uploaded to ",a({href:o.url,target:"_blank"},o.title)," to this devlog post.",this.props.add_recently_changed?" We've automatically attached some things updated recently.":void 0):void 0,div({className:"attachments_wrapper"},h3({},"Selected Attachments"),this.render_selected_attachments(),h3({},"Add Attachment"),this.render_attachment_picker()))},render_image_uploader:function(){var progress,ref;return div({className:"image_uploader"},h3({},"Upload a new image for this post"),((ref=this.state.upload_errors)!=null?ref.length:void 0)?R.Forms.FormErrors({errors:this.state.upload_errors}):void 0,p({},"Note: this image will not be added to your project's screenshots, it will only be available for this post. If you'd like to add new screenshots add them to your project first, then you can pick them here."),button({type:"button",className:classNames("button",{disabled:!!this.state.uploading}),disabled:!!this.state.uploading,onClick:function(_this){return function(e){e.preventDefault();return _this.trigger("pick_images")}}(this)},this.state.uploading?this.state.active_uploads.length?(progress=Math.min.apply(Math,this.state.active_uploads.map(function(_this){return function(u){return u.progress}}(this))),"Uploading "+((progress||0)*100).toFixed(2)+"%"):"Uploading...":"Select images"))},render_selected_object:function(o,i,list){var input_name,is_first,is_last,position;is_first=i===0;is_last=i===list.length-1;position=this.state.selected_attachments.indexOf(o);if(position<0){throw"object is not selected"}input_name=function(field){return"attachment["+(position+1)+"]["+field+"]"};return this.render_object(o,[!is_first?a({key:"moveup",className:"move_button",href:"#",onClick:function(_this){return function(e){e.preventDefault();return _this.setState({selected_attachments:I.move(_this.state.selected_attachments,o,-1)})}}(this)},o.type==="image"?"left":"up"):void 0,!is_last?a({key:"movedown",className:"move_button",href:"#",onClick:function(_this){return function(e){e.preventDefault();return _this.setState({selected_attachments:I.move(_this.state.selected_attachments,o,1)})}}(this)},o.type==="image"?"right":"down"):void 0,button({key:"remove",type:"button",className:"button small outline remove_button",onClick:function(_this){return function(e){var sa;e.preventDefault();return _this.setState({available_attachments:[o].concat(slice.call(_this.state.available_attachments)),selected_attachments:function(){var j,len,ref,results;ref=this.state.selected_attachments;results=[];for(j=0,len=ref.length;j<len;j++){sa=ref[j];if(sa!==o){results.push(sa)}}return results}.call(_this)})}}(this)},"Remove"),o.attachment_id!=null?input({type:"hidden",name:input_name("attachment_id"),value:o.attachment_id,key:"oai"}):void 0,o.type==="video"?[input({type:"hidden",name:input_name("url"),value:o.url,key:"vurl"}),input({type:"hidden",name:input_name("type"),value:"video_link",key:"ot"}),o.id!=null?input({type:"hidden",name:input_name("id"),value:o.id,key:"oi"}):void 0]:[input({type:"hidden",name:input_name("object_type"),value:o.type,key:"ot"}),input({type:"hidden",name:input_name("object_id"),value:o.id,key:"oi"})]])},render_selected_attachments:function(){var image_attachments,images,listed,listed_attachments,no_attachments_message,ref;no_attachments_message=!this.state.selected_attachments.length?p({className:"no_attachments_message"},"Nothing is attached. Add something from below to include it with your post (optional)"):void 0;ref=this.split_attachments(),listed=ref[0],images=ref[1];listed_attachments=listed.length?ul({className:"listed_attachments",children:listed.map(function(_this){return function(o,i){return _this.render_selected_object(o,i,listed)}}(this))}):void 0;image_attachments=images.length?ul({className:"image_attachments",children:images.map(function(_this){return function(o,i){return _this.render_selected_object(o,i,images)}}(this))}):void 0;return div({className:"selected_attachments"},no_attachments_message,listed_attachments,image_attachments)},render_attachment_picker:function(){var options,visible_type;visible_type=this.state.visible_type;options=function(){switch(visible_type){case"upload_image":return this.render_image_uploader();case"video":return this.render_video_attach();default:return this.render_available_attachments()}}.call(this);return div({className:"object_picker tab_columns"},div({className:"type_filter tab_column"},button({type:"button",className:classNames("tab_btn",{selected:visible_type==="files"}),onClick:function(_this){return function(e){_this.setState({visible_type:"files"});return e.preventDefault()}}(this)},"Files"),button({type:"button",className:classNames("tab_btn",{selected:visible_type==="images"}),onClick:function(_this){return function(e){_this.setState({visible_type:"images"});return e.preventDefault()}}(this)},"Images"),button({type:"button",className:classNames("tab_btn",{selected:visible_type==="upload_image"}),onClick:function(_this){return function(e){e.preventDefault();return _this.setState({visible_type:"upload_image"})}}(this)},"Upload image"),button({type:"button",className:classNames("tab_btn",{selected:visible_type==="video"}),onClick:function(_this){return function(e){_this.setState({visible_type:"video"});return e.preventDefault()}}(this)},"Video")),div({className:"content_column type_"+visible_type},options))},render_video_attach:function(){return div({className:"video_attach"},h3({},"Add a video"),p({},"Provide the link to a video on YouTube, Vimeo, or Sketchfab attach it to the post"),this.state.video_error?p({className:"error_message"},this.state.video_error):void 0,section({className:"video_link_input"},input({type:"text",placeholder:"eg. https://www.youtube.com/watch?v=5JEaA47sPjQ",ref:"video_url",onKeyDown:function(_this){return function(e){if(e.keyCode===13){e.preventDefault();e.stopPropagation();return _this.trigger("append_video")}}}(this)}),button({type:"button",className:"button",onClick:function(_this){return function(e){e.preventDefault();return _this.trigger("append_video")}}(this)},"Add video")))},render_available_attachments:function(){var attachments,image_attachments,images,listed,listed_attachments,ref,render_add_button;attachments=this.available_attachments_by_type(this.state.visible_type);if(!attachments.length){return div({className:"empty_message"},"Nothing is available")}ref=this.split_attachments(attachments),listed=ref[0],images=ref[1];render_add_button=function(_this){return function(object){return button({type:"button",className:"button small",onClick:function(e){var aa;e.preventDefault();return _this.setState({available_attachments:function(){var j,len,ref1,results;ref1=this.state.available_attachments;results=[];for(j=0,len=ref1.length;j<len;j++){aa=ref1[j];if(aa!==object){results.push(aa)}}return results}.call(_this),selected_attachments:_this.sort_attachments(slice.call(_this.state.selected_attachments).concat([object]))})}},"Attach")}}(this);listed_attachments=listed.length?ul({className:"listed_attachments",children:listed.map(function(_this){return function(object){return _this.render_object(object,render_add_button(object))}}(this))}):void 0;image_attachments=images.length?ul({className:"image_attachments",children:images.map(function(_this){return function(object){return _this.render_object(object,render_add_button(object))}}(this))}):void 0;return React.createElement(React.Fragment,{},listed_attachments,image_attachments)},available_attachments_by_type:function(type){var aa,j,len,ref,results;ref=this.state.available_attachments;results=[];for(j=0,len=ref.length;j<len;j++){aa=ref[j];switch(type){case"files":if(!(aa.type==="upload"||aa.type==="build")){continue}break;case"images":if(aa.type!=="image"){continue}}results.push(aa)}return results},render_object:function(){var children,key,object;object=arguments[0],children=2<=arguments.length?slice.call(arguments,1):[];key=object.type+"-"+(object.id||object.attachment_id||object.url);switch(object.type){case"video":return li.apply(null,[{key:key,className:"file_attachment video_attachment"},span({className:"attachment_title"},PlayIcon,a({target:"_blank",rel:"noopener",className:"video_url",href:object.url},object.url))].concat(slice.call(children)));case"upload":case"build":return li.apply(null,[{key:key,className:"file_attachment"},span({className:"attachment_title"},PackageIcon,span({className:"object_title"},object.name)," ",object.sub_name?span({className:"title_tag"},object.sub_name):void 0),span({className:"attachment_date"},I.format_timestamp(object.created_at))].concat(slice.call(children)));case"image":return li({key:key,style:{backgroundImage:"url("+object.medium_image_url+")"},className:"image_preview"},div({className:"hover_overlay"},div.apply(null,[{className:"image_actions"}].concat(slice.call(children)))))}}})})}).call(this);(function(){I.libs.react.done(function(){var P,_rdf,a,br,button,code,div,em,fieldset,form,fragment,h1,h2,h3,h4,h5,h6,iframe,img,input,label,legend,li,ol,optgroup,option,p,pre,section,select,span,strong,textarea,types,ul;_rdf=ReactDOMFactories;div=_rdf.div,span=_rdf.span,a=_rdf.a,br=_rdf.br,p=_rdf.p,ol=_rdf.ol,ul=_rdf.ul,li=_rdf.li,strong=_rdf.strong,em=_rdf.em,img=_rdf.img,form=_rdf.form,label=_rdf.label,input=_rdf.input,textarea=_rdf.textarea,button=_rdf.button,iframe=_rdf.iframe,h1=_rdf.h1,h2=_rdf.h2,h3=_rdf.h3,h4=_rdf.h4,h5=_rdf.h5,h6=_rdf.h6,pre=_rdf.pre,code=_rdf.code,select=_rdf.select,option=_rdf.option,section=_rdf.section,optgroup=_rdf.optgroup,fieldset=_rdf.fieldset,legend=_rdf.legend;fragment=React.createElement.bind(null,React.Fragment);fragment.type=React.fragment;P=R["package"]("BundleBuyForm");types=PropTypes;P("AvailableItems",{propTypes:{tiers:types.array,price:types.number,currency:types.string,group_noun:types.string},count_total_items:function(){var count,i,len,ref,t;count=0;ref=this.props.tiers;for(i=0,len=ref.length;i<len;i++){t=ref[i];count+=t.items_count}return count},count_available_items:function(){var count,i,len,ref,t;count=0;ref=this.props.tiers;for(i=0,len=ref.length;i<len;i++){t=ref[i];if(t.price&&t.price>this.props.price){break}count+=t.items_count}return count},next_tier:function(){var i,len,ref,t;ref=this.props.tiers;for(i=0,len=ref.length;i<len;i++){t=ref[i];if(t.price&&t.price>this.props.price){return t}}},render:function(){var current_count,next,next_cents,next_price;next=this.next_tier();current_count=this.count_available_items();return div({className:"game_list_header"},h3({},this.props.tiers.length>1?"You will receive "+current_count+" of "+this.count_total_items()+" "+this.props.group_noun:"You will receive "+current_count+" "+this.props.group_noun,next?(next_cents=next.price-this.props.price,next_price=I.format_money(next_cents,this.props.currency).replace(/\.00$/,""),button({"data-amount":next_cents,className:"add_btn next_tier_btn textlike"},"Add "+next_price+" for "+next.items_count+" more "+this.props.group_noun)):void 0))}})})}).call(this);(function(){I.libs.react.done(function(){var P,_rdf,a,br,button,code,div,em,fieldset,form,fragment,h1,h2,h3,h4,h5,h6,iframe,img,input,label,legend,li,ol,optgroup,option,p,pre,section,select,span,strong,textarea,types,ul;_rdf=ReactDOMFactories;div=_rdf.div,span=_rdf.span,a=_rdf.a,br=_rdf.br,p=_rdf.p,ol=_rdf.ol,ul=_rdf.ul,li=_rdf.li,strong=_rdf.strong,em=_rdf.em,img=_rdf.img,form=_rdf.form,label=_rdf.label,input=_rdf.input,textarea=_rdf.textarea,button=_rdf.button,iframe=_rdf.iframe,h1=_rdf.h1,h2=_rdf.h2,h3=_rdf.h3,h4=_rdf.h4,h5=_rdf.h5,h6=_rdf.h6,pre=_rdf.pre,code=_rdf.code,select=_rdf.select,option=_rdf.option,section=_rdf.section,optgroup=_rdf.optgroup,fieldset=_rdf.fieldset,legend=_rdf.legend;fragment=React.createElement.bind(null,React.Fragment);fragment.type=React.fragment;P=R["package"]("Bundle");types=PropTypes;P("LoadOnScroll",{componentWillUnmount:function(){return typeof this.unbind_visibility==="function"?this.unbind_visibility():void 0},componentDidMount:function(){var el;el=ReactDOM.findDOMNode(this);return this.unbind_visibility=$(el).lazy_images({elements:[el],show_images:function(_this){return function(){var ref;return(ref=_this.props)!=null?ref.on_seen():void 0}}(this)})},render:function(){return this.props.children}});P("GamesFilter",{pure:true,getInitialState:function(){return{}},render_search_input:function(){return input({type:"text",className:"input",value:this.props.filter.search_query||"",placeholder:"Search by title or creator",onChange:function(_this){return function(e){return _this.props.set_filter("search_query",e.target.value)}}(this)})},render_classification_picker:function(){var c,classifications,count,counts,filter,name,options;options=[];counts=this.props.games?(filter=Object.assign({},this.props.filter),delete filter.classification,delete filter.search_query,this.props.count_games(this.props.games,filter)):void 0;if(!counts){return null}classifications=["game","physical_game","assets","game_mod","soundtrack","tool","comic","book","other"];options=function(){var i,len,results;results=[];for(i=0,len=classifications.length;i<len;i++){c=classifications[i];name=this.props.classification_names[c]||c;count=counts["classification_"+c];if(!count){continue}results.push({name:name+" ("+count+")",value:c})}return results}.call(this);if(!options.length){return null}options.unshift({name:"Any",short_name:"Type",value:""});return R.Forms.SimpleSelect({value:this.props.filter.classification,onChange:function(_this){return function(v){_this.setState({platform:v});return _this.props.set_filter("classification",v)}}(this),options:options})},render_platform_picker:function(){var count,counts,filter,options;options=[];counts=this.props.games?(filter=Object.assign({},this.props.filter),delete filter.platform,delete filter.search_query,this.props.count_games(this.props.games,filter)):void 0;if(!counts){return null}if(count=counts.platform_windows){options.push({name:"Windows ("+count+")",value:"windows"})}if(count=counts.platform_osx){options.push({name:"macOS ("+count+")",value:"osx"})}if(count=counts.platform_linux){options.push({name:"Linux ("+count+")",value:"linux"})}if(count=counts.platform_android){options.push({name:"Android ("+count+")",value:"android"})}if(count=counts.platform_web){options.push({name:"Play in browser ("+count+")",value:"web"})}if(!options.length){return null}options.unshift({name:"Any",short_name:"Platform",value:""});return R.Forms.SimpleSelect({value:this.props.filter.platform,onChange:function(_this){return function(v){_this.setState({platform:v});return _this.props.set_filter("platform",v)}}(this),options:options})},render_sort_picker:function(){var options;if(this.props.filter.search_query){return R.Forms.SimpleSelect({disabled:true,options:[{name:"Search"}]})}options=[{name:"Default",value:"",short_name:"Sort"},{name:"Recently added",value:"recent"},{name:"A-Z",value:"title_asc"},{name:"Z-A",value:"title_desc"},{name:"Random",value:"random"}];return R.Forms.SimpleSelect({value:this.props.filter.sort,onChange:function(_this){return function(v){return _this.props.set_filter("sort",v)}}(this),options:options})},render:function(){return this.enclose({className:classNames(this.enclosing_class_name(),"form")},R.Icons.Filter," ",this.render_search_input(),this.render_classification_picker(),this.render_platform_picker(),this.render_sort_picker())}});P("GameGrid",{getInitialState:function(){return{loading:true,page_number:1,page_size:30,filter:{sort:this.props.default_sort}}},componentDidMount:function(){if(this.props.games){this.provide_games(this.props.games);return}return $.get(this.props.games_url).done(function(_this){return function(res){return _this.provide_games(res.games)}}(this)).fail(function(_this){return function(res){return _this.setState({loading:false,errors:["Due to the size of this bundle, the project list is not available until the bundle is published"]})}}(this))},provide_games:function(games){this.refresh_random_order(games);return this.setState({loading:false,games:games,filtered_games:this.filter_games(games,this.state.filter),filter_counts:this.count_games(games)},function(_this){return function(){return _this.show_visible_games()}}(this))},refresh_random_order:function(games){var i,item,len,results;if(games==null){games=this.state.games}if(!games){return}results=[];for(i=0,len=games.length;i<len;i++){item=games[i];results.push(item.r=Math.random())}return results},transform_query:function(q){var parts;q=q.replace(/[:^~]/g," ");parts=q.match(/[^\s]+/g).map(function(_this){return function(chunk){if(chunk.match(/[*]$/)||chunk.match(/^[-+*]/)){return chunk}else{return chunk+"^2 "+chunk+"*"}}}(this));return parts.join(" ")},filter_games:function(games,filter){var filtered_by_id,filtered_results,game,has_platform,i,len,q,r,search_results,search_results_by_id,sorted_results;if(!filter||$.isEmptyObject(filter)){return games}search_results=false;search_results_by_id=false;if(q=$.trim(filter.search_query)){q=this.transform_query(q);if(this.state.search_index){search_results=this.state.search_index.search(q);search_results_by_id={};for(i=0,len=search_results.length;i<len;i++){r=search_results[i];search_results_by_id[r.ref]=true}}else{this.get_search_index().then(function(_this){return function(){if(filter===_this.state.filter){return _this.setState({filtered_games:_this.filter_games(_this.state.games,filter),page_number:1},function(){return _this.show_visible_games()})}}}(this))}}filtered_results=function(){var j,k,len1,len2,ref,results;results=[];for(j=0,len1=games.length;j<len1;j++){game=games[j];if(search_results_by_id){if(!search_results_by_id[game.id]){continue}}if(filter.classification){if(filter.classification!==game.classification){continue}}if(filter.platform){has_platform=false;if(game.platforms){ref=game.platforms;for(k=0,len2=ref.length;k<len2;k++){p=ref[k];if(p===filter.platform){has_platform=true;break}}}if(!has_platform){continue}}results.push(game)}return results}();sorted_results=function(){var j,k,len1,len2,results;if(search_results){filtered_by_id={};for(j=0,len1=filtered_results.length;j<len1;j++){game=filtered_results[j];filtered_by_id[game.id]=game}results=[];for(k=0,len2=search_results.length;k<len2;k++){r=search_results[k];game=filtered_by_id[r.ref];if(!game){continue}results.push(game)}return results}else{switch(filter.sort){case"recent":return filtered_results.slice().sort(function(a,b){var a_date,b_date;a_date=a.bundle_game.created_at;b_date=b.bundle_game.created_at;if(a_date&&b_date){if(a_date===b_date){a.bundle_game.position-b.bundle_game}else{new Date(a_date)-new Date(b_date)}}if(a_date){return-1}if(b_date){return 1}return a.bundle_game.position-b.bundle_game});case"title_asc":return filtered_results.slice().sort(function(a,b){return a.title.localeCompare(b.title)});case"title_desc":return filtered_results.slice().sort(function(a,b){return b.title.localeCompare(a.title)});case"random":return filtered_results.slice().sort(function(a,b){return a.r-b.r});default:return filtered_results}}}();return sorted_results},count_games:function(games,filter){var c,game,i,j,len,len1,out,plat,ref,ref1;if(filter){games=this.filter_games(games,filter)}out={total:0};for(i=0,len=games.length;i<len;i++){game=games[i];out.total+=1;if((ref=game.platforms)!=null?ref.length:void 0){ref1=game.platforms;for(j=0,len1=ref1.length;j<len1;j++){plat=ref1[j];out["platform_"+plat]=(out["platform_"+plat]||0)+1}}if(c=game.classification){out["classification_"+c]=(out["classification_"+c]||0)+1}}return out},show_next_page:function(){return this.setState(function(state){return{page_number:state.page_number+1}},function(_this){return function(){return _this.show_visible_games()}}(this))},show_visible_games:function(){var games,has_more,num_items,visible_games;if(!this.state.filtered_games){return}games=this.state.filtered_games;num_items=this.state.page_number*this.state.page_size;visible_games=games.slice(0,num_items);has_more=visible_games.length<games.length;return this.setState({visible_games:visible_games,has_more:has_more})},render_filters:function(){return P.GamesFilter({filter:this.state.filter,games:this.state.games,count_games:this.count_games,classification_names:this.props.classification_names,set_filter:this.set_filter})},set_filter:function(name,value){var filter,update;update={};update[name]=value;filter=Object.assign({},this.state.filter,update);if(name==="sort"&&value==="random"){this.refresh_random_order()}return this.setState({filter:filter,filtered_games:this.filter_games(this.state.games,filter),page_number:1},function(_this){return function(){return _this.show_visible_games()}}(this))},get_search_index:function(){return this.lunr_deferred||(this.lunr_deferred=$.Deferred(function(_this){return function(d){var js;js=document.createElement("script");js.type="text/javascript";js.src=_this.props.lunr_js_url;document.body.appendChild(js);return I.wait_for_object(window,"lunr",function(){var games,index;games=_this.state.games;index=lunr(function(){var flat_title,game,i,len,results;this.ref("id");this.field("title");this.field("flat_title");this.field("user_name");results=[];for(i=0,len=games.length;i<len;i++){game=games[i];flat_title=game.title.replace(/\s+/,"");if(flat_title===game.title){flat_title=null}results.push(this.add({id:game.id,title:game.title,flat_title:flat_title,user_name:game.user.name}))}return results});return _this.setState({search_index:index},function(){return d.resolve(index)})})}}(this)))},render:function(){var loading;loading=div({className:"loading_container"},div({className:"loader_spinner"}));return this.enclose({},this.state.errors?R.Forms.FormErrors({title:"The request could not be completed",errors:this.state.errors}):void 0,this.state.loading?loading:void 0,!this.state.loading&&this.state.visible_games?this.render_filters():void 0,this.state.visible_games?this.state.visible_games.length?R.Index.GameGrid({games:this.state.visible_games,cell_props:this.grid_cell_props||(this.grid_cell_props={show_price:false,show_cell_tools:false,show_rating:false})}):this.state.filter.search_query?p({className:"empty_message"},"No results match your search"," ",button({className:"textlike",type:"button",onClick:function(_this){return function(){return _this.set_filter("search_query",null)}}(this)},"Clear search")):void 0:void 0,this.state.has_more?P.LoadOnScroll({key:[this.state.page_number].join("-"),on_seen:this.show_next_page},loading):void 0)}})})}).call(this);(function(){I.libs.react.done(function(){var P,_rdf,a,br,button,code,div,em,fieldset,form,fragment,h1,h2,h3,h4,h5,h6,iframe,img,input,label,legend,li,ol,optgroup,option,p,pre,section,select,span,strong,textarea,types,ul;_rdf=ReactDOMFactories;div=_rdf.div,span=_rdf.span,a=_rdf.a,br=_rdf.br,p=_rdf.p,ol=_rdf.ol,ul=_rdf.ul,li=_rdf.li,strong=_rdf.strong,em=_rdf.em,img=_rdf.img,form=_rdf.form,label=_rdf.label,input=_rdf.input,textarea=_rdf.textarea,button=_rdf.button,iframe=_rdf.iframe,h1=_rdf.h1,h2=_rdf.h2,h3=_rdf.h3,h4=_rdf.h4,h5=_rdf.h5,h6=_rdf.h6,pre=_rdf.pre,code=_rdf.code,select=_rdf.select,option=_rdf.option,section=_rdf.section,optgroup=_rdf.optgroup,fieldset=_rdf.fieldset,legend=_rdf.legend;fragment=React.createElement.bind(null,React.Fragment);fragment.type=React.fragment;P=R["package"]("Bundle");types=PropTypes;P("ParticipantsLightbox",{render:function(){return R.Lightbox({className:classNames(this.enclosing_class_name(),"compact")},h2({},"Participants"),this.props.participants?ul({className:"participants_list"},this.props.participants.map(function(_this){return function(user){return li({key:user.id},a({href:user.url,target:"_blank"},user.name))}}(this))):p({},em({},"No participants")))}})})}).call(this);(function(){I.libs.react.done(function(){var P,_rdf,a,abbr,br,button,code,div,em,fieldset,form,fragment,h1,h2,h3,h4,h5,h6,iframe,img,input,label,legend,li,ol,optgroup,option,p,pre,section,select,span,strong,textarea,ul;_rdf=ReactDOMFactories;div=_rdf.div,span=_rdf.span,a=_rdf.a,br=_rdf.br,p=_rdf.p,ol=_rdf.ol,ul=_rdf.ul,li=_rdf.li,strong=_rdf.strong,em=_rdf.em,img=_rdf.img,form=_rdf.form,label=_rdf.label,input=_rdf.input,textarea=_rdf.textarea,button=_rdf.button,iframe=_rdf.iframe,h1=_rdf.h1,h2=_rdf.h2,h3=_rdf.h3,h4=_rdf.h4,h5=_rdf.h5,h6=_rdf.h6,pre=_rdf.pre,code=_rdf.code,select=_rdf.select,option=_rdf.option,section=_rdf.section,optgroup=_rdf.optgroup,fieldset=_rdf.fieldset,legend=_rdf.legend;fragment=React.createElement.bind(null,React.Fragment);fragment.type=React.fragment;P=R["package"]("UserSettings");abbr=ReactDOMFactories.abbr;P("ChangeUsernameLightbox",{getInitialState:function(){return{}},get_slug:function(){var slug;slug=I.slugify((this.state.new_username||"").trim());if(slug===""){slug=null}return slug},check_availability:function(){var username;if(this.availability_check){this.availability_check.abort()}username=this.state.new_username;if(username&&username!==""){this.setState({availability_error_message:null,is_valid:null});return this.availability_check=$.ajax({url:this.props.check_availability_url,type:"POST",data:I.with_csrf({username:username})}).done(function(_this){return function(res){var ref;if(username===_this.state.new_username){return _this.setState({is_valid:!res.errors,availability_error_message:(ref=res.errors)!=null?ref[0]:void 0})}}}(this))}},componentWillUnmount:function(){if(this.availability_check){return this.availability_check.abort()}},render:function(){return R.Lightbox({className:this.enclosing_class_name()},h2({},"Change username"),this.state.errors?R.Forms.FormErrors({errors:this.state.errors}):void 0,this.state.success?this.render_success():this.render_change_form())},render_success:function(){return fragment({},p({},"Your username has been changed."),div({className:"buttons"},button({type:"button",className:"button",onClick:function(_this){return function(e){return window.location.reload()}}(this)},"Got it")))},on_submit:function(e){e.preventDefault();if(!this.state.is_valid){return}this.setState({loading:true,errors:null});return I.remote_submit($(e.target)).done(function(_this){return function(res){if(res.errors){return _this.setState({loading:false,errors:res.errors})}else{return _this.setState({loading:false,success:true})}}}(this))},render_change_form:function(){var new_url;new_url=this.get_slug();return form({action:this.props.submit_url,method:"post",className:"form user_register_page",onSubmit:this.on_submit},R.CSRF({}),div({className:"input_row"},label({},div({className:"label"},"New username"),div({className:classNames("validated",{valid:this.state.is_valid,invalid:!this.state.is_valid&&this.state.availability_error_message})},span({className:"input_error_message"},this.state.availability_error_message),input({type:"text",name:"username",className:"text_input",value:this.state.new_username||"",required:true,onChange:this.on_change||(this.on_change=function(_this){return function(e){_this.check_availability_debounced||(_this.check_availability_debounced=_.debounce(_this.check_availability,250));return _this.setState({new_username:e.target.value,availability_error_message:null,is_valid:null},_this.check_availability_debounced)}}(this))}),span({className:"icon icon-checkmark"})))),div({className:"input_row"},label({},div({className:"label"},"Your new URL will be"),input({type:"text",className:"slug_preview text_input disabled",disabled:true,value:new_url?"http://"+new_url+".itch.io/":"Enter a username to preview your new URL"}))),this.state.is_valid?div({className:"consequences"},p({},"After changing your username:"),ul({},li({},"Old links will redirect to your new URL: ",code({className:"url_preview"},span({className:"old_username"},this.props.current_slug),".itch.io/"),span({className:"icon icon-arrow-right"})," ",code({className:"url_preview"},span({className:"new_username"},new_url||""),".itch.io/")),this.props.old_redirect?li({},"The previous redirect from ",code({className:"url_preview"},this.props.old_redirect+".itch.io/")," will be removed"):void 0,this.props.change_cooldown?li({},"You won't be able to change your username again until"," ",abbr({title:this.props.change_cooldown},span({className:"icon icon-stopwatch"})," ",I.format_timestamp(this.props.change_cooldown,"calendar"))):void 0)):void 0,this.state.is_valid?div({className:"input_row"},ul({className:"check_list"},li({},label({},input({type:"checkbox",required:true})," "," I confirm my username & URL change")))):void 0,div({className:"buttons"},button({className:classNames("button submit",{disabled:!this.state.is_valid}),disabled:!this.state.is_valid},"Change username")))}})})}).call(this);(function(){I.libs.react.done(function(){var P,_rdf,a,br,button,code,div,em,fieldset,form,fragment,h1,h2,h3,h4,h5,h6,iframe,img,input,label,legend,li,ol,optgroup,option,p,pre,section,secure_message,select,span,strong,textarea,types,ul,indexOf=[].indexOf||function(item){for(var i=0,l=this.length;i<l;i++){if(i in this&&this[i]===item)return i}return-1};_rdf=ReactDOMFactories;div=_rdf.div,span=_rdf.span,a=_rdf.a,br=_rdf.br,p=_rdf.p,ol=_rdf.ol,ul=_rdf.ul,li=_rdf.li,strong=_rdf.strong,em=_rdf.em,img=_rdf.img,form=_rdf.form,label=_rdf.label,input=_rdf.input,textarea=_rdf.textarea,button=_rdf.button,iframe=_rdf.iframe,h1=_rdf.h1,h2=_rdf.h2,h3=_rdf.h3,h4=_rdf.h4,h5=_rdf.h5,h6=_rdf.h6,pre=_rdf.pre,code=_rdf.code,select=_rdf.select,option=_rdf.option,section=_rdf.section,optgroup=_rdf.optgroup,fieldset=_rdf.fieldset,legend=_rdf.legend;fragment=React.createElement.bind(null,React.Fragment);fragment.type=React.fragment;P=R["package"]("UserSettings");types=PropTypes;secure_message=function(props){return div({className:"secure_footer"},div({},img({src:props.lock,height:26,className:"lock_icon"})),div({},a({href:"http://stripe.com",target:"_blank",rel:"noopener"},img({src:props.stripe_logo,className:"stripe_button"}))),div({className:"sub"},strong({},"No credit card numbers are sent to our servers."),br({}),"All storage and processing handled by our gateway."))};P("EditCreditCardLightbox",{getInitialState:function(){return{}},on_submit:function(e){e.preventDefault();if(this.state.loading){return}this.setState({loading:true,errors:null});return I.remote_submit($(this.form_ref.current)).done(function(_this){return function(res){if(res.success){window.location.reload();return}return _this.setState({loading:false,errors:res.errors})}}(this)).fail(function(_this){return function(){return _this.setState({loading:false,errors:[_this.tt("misc.errors.server_error")]})}}(this))},render:function(){return R.Lightbox({className:classNames(this.enclosing_class_name(),"user_settings_credit_card_lightbox_widget")},h2({},"Edit card"),form({ref:this.form_ref||(this.form_ref=React.createRef()),action:this.props.submit_url,method:"post",className:"form",onSubmit:this.on_submit},R.CSRF({}),this.state.errors?R.Forms.FormErrors({errors:this.state.errors}):void 0,p({},"Trying to edit something not listed here? You'll have to remove and re-add the card."),R.Forms.TextInputRow({title:"Expiration date",name:"expiration",class:"expiration_input",placeholder:"MM / YY",defaultValue:this.props.expiration_date,required:true}),R.Forms.TextInputRow({title:"Postal/ZIP",name:"zip",class:"zip_input",required:true,defaultValue:this.props.zip}),div({className:"buttons"},button({className:"button save_card_btn"},"Update card"))),secure_message(this.props.images))}});P("CreditCardLightbox",{getInitialState:function(){return{submit_attempts:0,dark_theme:document.body.classList.contains("dark_theme")}},componentDidMount:function(){this.stripe=Stripe(this.props.publishable_key);this.elements=this.stripe.elements({fonts:[{cssSrc:"https://fonts.googleapis.com/css?family=Lato:400,400i,700,900"}]});this.stripe_card=this.elements.create("card",{iconStyle:"solid",style:{base:{color:this.state.dark_theme?"#ffffff":void 0,fontFamily:"Lato, sans-serif",fontSize:"14px"}}});return this.stripe_card.mount(this.card_input_ref.current)},on_submit:function(e){var f;e.preventDefault();f=$(e.target);if(this.state.loading){return}this.setState({loading:true,errors:null});return this.stripe.createToken(this.stripe_card,{name:this.name_input_ref.current.get_value()}).then(function(_this){return function(res){var token_id;if(res.error){_this.setState({loading:false,errors:[res.error.message]});return}token_id=res.token.id;return I.remote_submit(f,[{name:"card_token",value:token_id}]).done(function(res){if(res.errors){_this.setState(function(s){return{loading:false,errors:res.errors,needs_recaptcha:indexOf.call(res.errors,"recaptcha")>=0,submit_attempts:s.submit_attempts+1}});return}if(_this.props.on_save){return _this.props.on_save(res)}else if(res.redirect_to){if(res.redirect_to===window.location){location.reload()}else{window.location=res.redirect_to}}else{return I.Lightbox.close()}}).fail(function(res){return _this.setState(function(s){return{loading:false,errors:["Server error, please try again later or contact support"],submit_attempts:s.submit_attempts+1}})})}}(this))},render:function(){return R.Lightbox({className:this.enclosing_class_name()},h2({},"Add a new credit card"),this.props.needs_email_verify?p({},"Your account's email address must be verified before you can add a credit card. Check your inbox for a verification email. ",a({href:this.props.email_settings_url,target:"_blank"},"Manage email addresses")):void 0,form({method:"post",className:"form",onSubmit:this.on_submit,action:this.props.action_url},R.CSRF({}),input({type:"hidden",name:"action",value:"add"}),this.state.errors?R.Forms.FormErrors({errors:this.state.errors,animated:true}):void 0,R.Forms.TextInputRow({title:"Full name",sub:"As it appears on the card",name:"name",required:true,ref:this.name_input_ref||(this.name_input_ref=React.createRef())}),div({className:"input_row"},label({},div({className:"label"},"Credit or debit card"),div({ref:this.card_input_ref||(this.card_input_ref=React.createRef()),className:"stripe_elements_card"}))),this.state.needs_recaptcha?section({className:"captcha"},p({},"Our system is detecting unusual traffic right now. Please complete the CAPTCHA to add your credit card. If you have any issues please ",a({href:this.props.support_url,target:"_blank"},"contact support"),"."),R.Forms.RecaptchaInput({key:"attempt-"+this.state.submit_attempts,sitekey:this.props.recaptcha_sitekey})):void 0,div({className:"buttons"},button({className:classNames("button save_card_btn",{disabled:this.state.loading}),disabled:this.state.loading},"Save card"))),secure_message(this.props.images))}})})}).call(this);(function(){I.libs.react.done(function(){var P,_rdf,a,br,button,code,div,em,fieldset,form,fragment,h1,h2,h3,h4,h5,h6,iframe,img,input,label,legend,li,ol,optgroup,option,p,pre,section,select,span,strong,textarea,types,ul;_rdf=ReactDOMFactories;div=_rdf.div,span=_rdf.span,a=_rdf.a,br=_rdf.br,p=_rdf.p,ol=_rdf.ol,ul=_rdf.ul,li=_rdf.li,strong=_rdf.strong,em=_rdf.em,img=_rdf.img,form=_rdf.form,label=_rdf.label,input=_rdf.input,textarea=_rdf.textarea,button=_rdf.button,iframe=_rdf.iframe,h1=_rdf.h1,h2=_rdf.h2,h3=_rdf.h3,h4=_rdf.h4,h5=_rdf.h5,h6=_rdf.h6,pre=_rdf.pre,code=_rdf.code,select=_rdf.select,option=_rdf.option,section=_rdf.section,optgroup=_rdf.optgroup,fieldset=_rdf.fieldset,legend=_rdf.legend;fragment=React.createElement.bind(null,React.Fragment);fragment.type=React.fragment;P=R["package"]("GameEdit");types=PropTypes;P("DownloadKeyLightbox",{propTypes:{new_key:types.bool,download_key:types.shape({id:types.number.isRequired,url:types.string.isRequired,label:types.string,must_be_claimed:types.bool,can_be_claimed:types.bool,owner:types.shape({display_name:types.string.isRequired,url:types.string.isRequired})}).isRequired,game:types.shape({noun:types.string.isRequired}).isRequired},componentWillUnmount:function(){if(this.props.new_key&&!I.Spec){I.Lightbox.open_loading();return window.location.reload()}},getInitialState:function(){var key;key=this.props.download_key;return{changed:false,label:key.label,can_be_claimed:key.can_be_claimed||false,must_be_claimed:key.must_be_claimed||false}},on_save_close:function(){if(this.state.loading){return}if(this.state.changed){return this.save_key()}else{return I.Lightbox.close()}},save_key:function(){var params;this.setState({loading:true,changed:false});params=I.with_csrf({action:"update",download_key_id:this.props.download_key.id,"download_key[label]":this.state.label,"download_key[can_be_claimed]":this.state.can_be_claimed||void 0,"download_key[must_be_claimed]":this.state.must_be_claimed||void 0});return $.post("",params).done(function(_this){return function(res){return window.location.reload()}}(this))},render:function(){var key;key=this.props.download_key;return R.Lightbox({className:"key_lightbox"},h2({},"Download key"),div({className:"unclaimed_message"},key.owner?p({},"This download key has been claimed by ",a({href:key.owner.url},key.owner.display_name),"."):p({},"Share this URL with someone to give them download access to your "+this.props.game.noun+" without paying."),div({className:"form"},input({type:"text",readOnly:true,className:"text_input key_url_input",onClick:function(_this){return function(e){return e.target.select()}}(this),value:key.url})),!key.owner?p({},"This URL can be used by anyone, so don't spread more than necessary. If you think it's being abused you can revoke it."):void 0,this.render_label_form(),this.render_claim_options(),div({className:"button_row"},button({disabled:this.state.loading,className:classNames("button",{disabled:this.state.loading}),onClick:this.on_save_close},this.state.changed&&"Save & close"||"Close"))))},render_label_form:function(){return div({className:"form label_form"},p({},"You can give a private label to the key to easily identify it later."),label({},div({className:"label"},"Label"),input({type:"text",className:"text_input label_input",placeholder:"Unlabeled",value:this.state.label||"",onChange:function(_this){return function(e){return _this.setState({changed:true,label:e.target.value})}}(this)}),span({className:"icon icon-checkmark",title:"Saved"})))},render_claim_options:function(){if(this.props.download_key.owner){return}return div({className:"form claim_options"},p({},"Key claiming options:"),label({className:"claim_toggle"},input({type:"checkbox",name:"can_be_claimed",checked:this.state.can_be_claimed,onChange:function(_this){return function(){return _this.setState({changed:true,can_be_claimed:!_this.state.can_be_claimed})}}(this)}),p({},strong({},"Download key can be claimed")),p({},"Enables anyone with an itch.io account to take ownership of the download key, preventing anyone else from using it.")),this.state.can_be_claimed?label({className:"claim_toggle"},input({type:"checkbox",name:"must_be_claimed",checked:this.state.must_be_claimed,onChange:function(_this){return function(){return _this.setState({changed:true,must_be_claimed:!_this.state.must_be_claimed})}}(this)}),p({},strong({},"Require key to be claimed")),p({},"Forces the key to be claimed before allowing files to be downloaded. This can help prevent the key from being shared.")):void 0)}})})}).call(this);(function(){I.libs.react.done(function(){var P,_rdf,a,br,button,code,div,em,fieldset,form,fragment,h1,h2,h3,h4,h5,h6,iframe,img,input,label,legend,li,ol,optgroup,option,p,pre,section,select,span,strong,textarea,types,ul,slice=[].slice,indexOf=[].indexOf||function(item){for(var i=0,l=this.length;i<l;i++){if(i in this&&this[i]===item)return i}return-1};_rdf=ReactDOMFactories;div=_rdf.div,span=_rdf.span,a=_rdf.a,br=_rdf.br,p=_rdf.p,ol=_rdf.ol,ul=_rdf.ul,li=_rdf.li,strong=_rdf.strong,em=_rdf.em,img=_rdf.img,form=_rdf.form,label=_rdf.label,input=_rdf.input,textarea=_rdf.textarea,button=_rdf.button,iframe=_rdf.iframe,h1=_rdf.h1,h2=_rdf.h2,h3=_rdf.h3,h4=_rdf.h4,h5=_rdf.h5,h6=_rdf.h6,pre=_rdf.pre,code=_rdf.code,select=_rdf.select,option=_rdf.option,section=_rdf.section,optgroup=_rdf.optgroup,fieldset=_rdf.fieldset,legend=_rdf.legend;fragment=React.createElement.bind(null,React.Fragment);fragment.type=React.fragment;P=R["package"]("EditSale");types=PropTypes;P("SaleConditions",{propTypes:{games:types.array.isRequired,selected_games:types.array.isRequired,sale_triggers:types.array.isRequired},getInitialState:function(){var by_id,game,j,len,ref;by_id={};ref=this.props.games;for(j=0,len=ref.length;j<len;j++){game=ref[j];by_id[game.id]=game}return{trigger_games:this.props.sale_triggers.map(function(_this){return function(t){return by_id[t.game_id]}}(this))}},componentDidMount:function(){return this.dispatch({add_trigger:function(_this){return function(e){var game;game=_this.available_for_selection()[0];if(!game){return}return _this.setState({trigger_games:_this.state.trigger_games.concat([game])})}}(this),remove_trigger:function(_this){return function(e,idx){var g,gi;return _this.setState({trigger_games:function(){var j,len,ref,results;ref=this.state.trigger_games;results=[];for(gi=j=0,len=ref.length;j<len;gi=++j){g=ref[gi];if(gi!==idx){results.push(g)}}return results}.call(_this)})}}(this)})},available_games:function(){var g,j,k,len,len1,ref,ref1,results,taken_games;taken_games={};ref=this.props.selected_games;for(j=0,len=ref.length;j<len;j++){g=ref[j];taken_games[g.id]=true}ref1=this.props.games;results=[];for(k=0,len1=ref1.length;k<len1;k++){g=ref1[k];if(g.paid_status>1&&!taken_games[g.id]){results.push(g)}}return results},render:function(){var games;games=this.available_games();return div({className:"sale_conditions"},h2({},"Sale conditions"),p({},"You can restrict who has access to this sale based on their purchase history."),games.length?this.render_trigger_picker():p({},"You don't have any available games to create a condition."))},render_trigger_picker:function(){var available_games;available_games=this.available_games();return div({},div({className:"condition_rows"},this.state.trigger_games.map(function(_this){return function(game,idx){var game_picker;game_picker=_this.available_games_select(game.id,idx);if(!game_picker){return}return div({key:idx,className:"condition_row"},"Must own ",game_picker,button({type:"button",className:"button small",onClick:function(e){return _this.trigger("remove_trigger",idx)}},"Remove condition"))}}(this))),this.available_for_selection().length?div({className:"button_row"},button({type:"button",className:"button",onClick:function(_this){return function(){return _this.trigger("add_trigger")}}(this)},"Add condition")):void 0)},available_for_selection:function(current_id){return this.available_games().filter(function(_this){return function(g){if(g.id===current_id){return true}return!_this.state.trigger_games.some(function(tg){return tg.id===g.id})}}(this))},available_games_select:function(chosen_game_id,idx){var games;games=this.available_for_selection(chosen_game_id);if(chosen_game_id){if(!games.some(function(_this){return function(g){return g.id===chosen_game_id}}(this))){return}}return R.Forms.SimpleSelect({value:chosen_game_id,name:"sale_triggers["+(idx+1)+"]",onChange:function(_this){return function(game_id){var g,j,len,ref,results,trigger_games;game_id=+game_id;ref=_this.props.games;results=[];for(j=0,len=ref.length;j<len;j++){g=ref[j];if(g.id===game_id){trigger_games=slice.call(_this.state.trigger_games);trigger_games[idx]=g;results.push(_this.setState({trigger_games:trigger_games}))}else{results.push(void 0)}}return results}}(this),options:games.map(function(_this){return function(game,idx){return{value:game.id,name:game.title}}}(this))})}});P("BundlePrice",{propTypes:{rate:types.number,bundle_price:types.number,selected_games:types.array.isRequired,suggested_price:types.number,currency:types.string},getInitialState:function(){return{custom_price:!!this.props.bundle_price}},can_bundle:function(){var game,paid_games;paid_games=function(){var j,len,ref,results;ref=this.props.selected_games;results=[];for(j=0,len=ref.length;j<len;j++){game=ref[j];if(game.paid_status>1){results.push(game)}}return results}.call(this);return(this.props.rate||0)<100&&paid_games.length>1},render:function(){return div({className:"input_row bundle_input_row"},h2({},"Bundle"),this.can_bundle()?this.render_bundle_settings():p({},"If your sale has at least two projects and a rate less than 100% it can be bought as a bundle."))},render_bundle_settings:function(){var default_value,suggested_price;suggested_price=I.format_money(this.props.suggested_price,this.props.currency);default_value=this.props.bundle_price||this.props.suggested_price;return div({},p({},"Because you've selected multiple paid projects, your sale will also be available as a bundle for ",strong({},suggested_price)," or more. (Sum of all items with rate applied)"),div({className:"custom_bundle_price_toggle"},label({},input({type:"checkbox",checked:this.state.custom_price,name:"sale[allow_bundle]",onChange:function(_this){return function(e){return _this.setState({custom_price:e.target.checked})}}(this)}),"Provide a custom bundle price")),this.state.custom_price?R.Forms.TextInputRow({title:"Bundle price",sub:"Minimum price to buy all items in sale at once",money_input:true,currency:this.props.currency,name:"sale[bundle_price]",class:"medium_input bundle_price_input money_input",placeholder:I.format_money(0,this.props.currency),defaultValue:default_value?I.format_money(default_value,this.props.currency):void 0}):void 0)}});P("RatePicker",{propTypes:{set_rate:types.func,rate:types.number,allow_promotion_claim:types.bool},componentDidMount:function(){var base,slider;slider=$(this.refs.rate_slider).slider({range:"min",min:0,value:this.state.rate,max:100,slide:function(_this){return function(e,ui){var base,rate;rate=parseInt(ui.value,10);_this.setState({rate:rate});return typeof(base=_this.props).set_rate==="function"?base.set_rate(rate,_this.state.reverse):void 0}}(this)});return typeof(base=this.props).set_rate==="function"?base.set_rate(this.state.rate,this.state.reverse):void 0},getInitialState:function(){var ref,ref1;return{rate:Math.abs((ref=(ref1=this.props.rate)!=null?ref1:this.props.default_rate)!=null?ref:50),reverse:this.props.rate?this.props.rate<0:false}},render_rate_picker:function(){return div({className:"input_row rate_row"},div({className:"label"},"Rate",span({className:"sub"},"  What percentage "+(this.state.reverse&&"increase"||"off")+" is this sale?")),div({className:"inner_toggle"},label({},input({type:"checkbox",name:"sale[reverse_rate]",checked:this.state.reverse,onChange:function(_this){return function(e){var base;_this.setState({reverse:e.target.checked});return typeof(base=_this.props).set_rate==="function"?base.set_rate(_this.state.rate,e.target.checked):void 0}}(this)}),"Reverse sale",span({className:"sub"},"  Make your projects more expensive!"))),div({className:"slider_row"},div({className:"rate_slider_outer"},div({className:"rate_slider",ref:"rate_slider"}),input({type:"hidden",name:"sale[rate]",className:"rate_slider_input",value:this.state.rate})),span({className:"rate_value"},this.state.rate+"%"),span({className:"sub"},this.state.reverse?" increased minimum prices":" off all minimum prices")))},render_rate_settings:function(){var ref;if(!(this.state.rate===100&&!this.state.reverse)){return}return div({className:"input_row"},div({className:"label"},"Additional settings"),ul({className:"check_list"},li({},label({},input({type:"checkbox",defaultChecked:(ref=this.props.allow_promotion_claim)!=null?ref:true,name:"sale[allow_promotion_claim]"}),"Allow items to be claimed",span({className:"sub"},"  People can permanently claim a free copy while the sale is active")))))},render:function(){return div({className:"rate_picker"},this.render_rate_picker(),this.render_rate_settings())}});P("CouponSettings",{propTypes:{user_slug:types.string.isRequired,coupon:types.string,max_redeems:types.number,redeems:types.number,taken_slugs:types.array,rate:types.number},getInitialState:function(){return{coupon:this.props.coupon,max_redeems:this.props.max_redeems===0?"":this.props.max_redeems}},randomize_coupon:function(){var coupon_charset,i;coupon_charset="ABCDEFGHJKMNPQRSTUVWXY3456789";code=function(){var j,results;results=[];for(i=j=1;j<=10;i=++j){results.push(coupon_charset[Math.floor(Math.random()*coupon_charset.length)])}return results}().join("");return this.setState({coupon:code})},render:function(){return div({className:"coupon_settings"},h2({},"Coupon code"),p({},"If a coupon code is provided then the coupons's special URL must be used to access the promotion. The sale will not be listed anywhere on itch.io. You can also limit the quantity available. Coupons are case insensitive."),this.props.redeems&&this.props.redeems>0?p({className:classNames({coupon_error:this.state.redeem_error})},"This coupon has already been claimed ",strong({},this.props.redeems+" times.")):void 0,div({className:"joint_input_row"},R.Forms.TextInputRow({title:"Coupon code",name:"sale[coupon]",placeholder:"Optional",multi:true,slug_input:true,value:this.state.coupon||"",has_error:this.state.slug_error,onChange:function(_this){return function(e){var ref,slug_error;code=e.target.value;slug_error=(ref=code.toLowerCase(),indexOf.call(_this.props.taken_slugs,ref)>=0);return _this.setState({coupon:code,slug_error:slug_error})}}(this),sub:button({"data-tooltip":"Generate random",className:"icon icon-dice random_coupon_btn",onClick:function(_this){return function(e){_this.randomize_coupon();return e.preventDefault()}}(this)})}),this.props.rate!==100?R.Forms.TextInputRow({title:"Maximum redeems",sub:"How many times can the coupon be used",name:"sale[coupon_max_redeems]",has_error:this.state.redeem_error,value:this.state.max_redeems,placeholder:"No limit",pattern:"[0-9]*",integer_input:true,onChange:function(_this){return function(e){var redeem_error,value;value=e.target.value;redeem_error=value&&+value>0?(_this.props.redeems||0)>+value:false;return _this.setState({max_redeems:value,redeem_error:redeem_error})}}(this)}):void 0),(this.state.coupon||"")!==""?this.state.slug_error?p({className:"coupon_error"},"That name is already taken by a project on your account"):p({className:"coupon_preview"},strong({},"Your coupon URL:"),br({}),span({className:"preview_url"},"https://"+this.props.user_slug+".itch.io/"+(this.state.coupon||""))):void 0)}})})}).call(this);(function(){I.libs.react.done(function(){var IndiegogoRow,KickstarterRow,P,_rdf,a,br,button,code,div,em,fieldset,form,fragment,h1,h2,h3,h4,h5,h6,iframe,img,input,label,legend,li,next_group_id,ol,optgroup,option,p,pre,section,select,span,strong,textarea,types,ul;_rdf=ReactDOMFactories;div=_rdf.div,span=_rdf.span,a=_rdf.a,br=_rdf.br,p=_rdf.p,ol=_rdf.ol,ul=_rdf.ul,li=_rdf.li,strong=_rdf.strong,em=_rdf.em,img=_rdf.img,form=_rdf.form,label=_rdf.label,input=_rdf.input,textarea=_rdf.textarea,button=_rdf.button,iframe=_rdf.iframe,h1=_rdf.h1,h2=_rdf.h2,h3=_rdf.h3,h4=_rdf.h4,h5=_rdf.h5,h6=_rdf.h6,pre=_rdf.pre,code=_rdf.code,select=_rdf.select,option=_rdf.option,section=_rdf.section,optgroup=_rdf.optgroup,fieldset=_rdf.fieldset,legend=_rdf.legend;fragment=React.createElement.bind(null,React.Fragment);fragment.type=React.fragment;P=R["package"]("GameEdit");types=PropTypes;next_group_id=1;KickstarterRow=function(){function KickstarterRow(){}KickstarterRow.is_valid=function(row){if(!(row&&row["Pledge Amount"]&&row["Email"]&&row["Pledged Status"])){return false}return true};KickstarterRow.get_currency=function(row){var currency,m;currency="USD";if(row){m=row!=null?row["Pledge Amount"].match(/[ ](\w+)$/):void 0;if(m){currency=m[1]}}return currency};KickstarterRow.normalize_row=function(row){if(row["Pledged Status"]!=="collected"){return}if(!row["Email"]){return}return{original:row,amount:I.parse_money(row["Pledge Amount"]),name:row["Backer Name"],email:row["Email"]}};return KickstarterRow}();IndiegogoRow=function(){function IndiegogoRow(){}IndiegogoRow.is_valid=function(row){if(!(row&&row["Amount"]&&row["Email"])){return false}return true};IndiegogoRow.get_currency=function(row){return"USD"};IndiegogoRow.normalize_row=function(row){var amount;if(!row["Email"]){return}amount=row["Amount"];if(!amount.match(/\.\d\d$/)){amount=amount+".00"}return{original:row,email:row["Email"],amount:I.parse_money(amount),name:row["Name"]}};return IndiegogoRow}();P("KickstarterImport",{propTypes:{currency:types.string.isRequired,money_placeholder:types.string.isRequired,download_key_groups:types.array},getInitialState:function(){return{groups:[],uploads:_.toArray(this.props.uploads)}},assign_backers_to_groups:function(){var backer,found,group,j,k,l,len,len1,ref,ref1,ref2,ungrouped_backers;if(!this.state.backers){return}this.state.groups.sort(function(a,b){return(a.cutoff_price||0)-(b.cutoff_price||0)});ref=this.state.groups;for(j=0,len=ref.length;j<len;j++){group=ref[j];group.backers=[]}ungrouped_backers=[];ref1=this.state.backers;for(k=0,len1=ref1.length;k<len1;k++){backer=ref1[k];found=false;ref2=this.state.groups;for(l=ref2.length-1;l>=0;l+=-1){group=ref2[l];if((group.cutoff_price||0)<=backer.amount){group.backers.push(backer);found=true;break}}if(!found){ungrouped_backers.push(backer)}}return this.setState({ungrouped_backers:ungrouped_backers})},do_submit:function(e){var data,request;e.preventDefault();if(this.state.loading){return}this.setState({loading:true});data=new FormData(this.refs.form);request=new XMLHttpRequest;request.open("POST","");request.send(data);return request.onload=function(_this){return function(e){var res;res=JSON.parse(request.responseText);if(res.errors){return _this.setState({loading:false,error_message:res.errors.join(",")})}else{return window.location.reload()}}}(this)},componentDidMount:function(){return this.dispatch("ks",{set_group_price:function(_this){return function(e,idx,price){_this.state.groups[idx].cutoff_price=price;return _this.assign_backers_to_groups()}}(this),add_group:function(_this){return function(){_this.state.groups.push({id:next_group_id++});return _this.assign_backers_to_groups()}}(this),remove_group:function(_this){return function(e,idx){_this.state.groups.splice(idx,1);return _this.assign_backers_to_groups()}}(this),pick_csv:function(_this){return function(){return I.pick_files({accept:".csv",input:_this.refs.csv_file}).done(function(files){var file,reader;_this.setState({loading:true,file_contents:null,file_name:null,parsed_file:null,backers:null});file=files[0];if(!file){return}reader=new FileReader;reader.readAsText(file);reader.onerror=function(){return _this.setState({loading:false,error_message:"There was an issue reading that file: "+reader.error})};return reader.onload=function(){return _this.load_file(file.name,reader.result)}})}}(this)})},render:function(){return this.enclose({className:"kickstarer_uploader"},form({encType:"multipart/form-data",method:"POST",ref:"form",className:"form group_form",onSubmit:this.do_submit},input({type:"file",ref:"csv_file",name:"csv_file",className:"csv_file"}),input({type:"hidden",name:"file_format_type",value:this.state.file_format_type||""}),this.state.file_contents?this.render_current_file():this.render_action_buttons(),this.state.error_message?p({className:"error_message"},this.state.error_message):void 0))},render_current_file:function(){var ref,ref1;return div({className:"current_file"},h3({className:"filename_row"},"File: ",span({className:"filename"},this.state.file_name)),div({className:"backer_summary"},this.render_summary_stat("Backers",this.state.total_backers),this.render_summary_stat("Min pledge",I.format_money(this.state.min_pledge,this.state.import_currency)),this.render_summary_stat("Max pledge",I.format_money(this.state.max_pledge,this.state.import_currency)),this.render_summary_stat("Currency",this.state.import_currency)),R.Forms.TextInputRow({name:"import_name",title:"Import name",sub:"So you can identify the import later",required:true,placeholder:"required"}),div({},button({className:"button small",type:"button",ref:"split_backers",onClick:function(_this){return function(e){e.preventDefault();return _this.trigger("ks:add_group")}}(this)},"Split backers by pledge amount...")),div({className:"backer_groups"},this.render_groups()),this.state.groups.length&&((ref=this.state.ungrouped_backers)!=null?ref.length:void 0)?div({className:"ungrouped_backers"},((ref1=this.state.ungrouped_backers)!=null?ref1.length:void 0)+" backers not assigned. ",a({href:"#",onClick:function(_this){return function(e){e.preventDefault();return I.Lightbox.open(R.GameEdit.KickstarterBackersLightbox({unassigned:true,backers:_this.state.ungrouped_backers}))}}(this)},"View list")):void 0,div({className:"account_require"},label({},input({defaultChecked:true,type:"checkbox",name:"require_account"}),span({},"Require backers to claim their key with an itch.io account to access it"),R.GameEdit.HelpTooltip({tooltip:"A key that is claimed can not be shared by copying the URL"}))),this.render_action_buttons())},render_groups:function(){if(!this.state.groups.length){return R.GameEdit.KickstarterBackerGroup({key:"default",currency:this.props.currency,import_currency:this.state.import_currency,money_placeholder:this.props.money_placeholder,backers:_.toArray(this.state.ungrouped_backers),default:true,uploads:this.state.uploads,download_key_groups:_.toArray(this.props.download_key_groups)})}return this.state.groups.map(function(_this){return function(group,i){return R.GameEdit.KickstarterBackerGroup({idx:i,default:false,import_currency:_this.state.import_currency,key:group.id,backers:_.toArray(group.backers),currency:_this.props.currency,money_placeholder:_this.props.money_placeholder,uploads:_this.state.uploads,group:group,download_key_groups:_.toArray(_this.props.download_key_groups),update_pledge_cutoff:function(val){group.pledge_cutoff=val;return _this.forceUpdate()}})}}(this))},render_summary_stat:function(label,value){return div({className:"summary_stat"},div({className:"summary_value"},value),div({className:"summary_label"},label))},validate_csv:function(parsed){var first;if(!(parsed&&parsed.data)){return false}first=parsed.data[0];if(KickstarterRow.is_valid(first)){return"kickstarter"}if(IndiegogoRow.is_valid(first)){return"indiegogo"}return false},summarize_file:function(parsed_file,row_parser){var amount,backer,backers,currency,max_pledge,min_pledge,row;if(parsed_file==null){parsed_file=this.state.parsed_file}if(!parsed_file){return}min_pledge=void 0;max_pledge=void 0;currency=row_parser.get_currency(parsed_file.data[0]);backers=function(){var j,len,ref,results;ref=parsed_file.data;results=[];for(j=0,len=ref.length;j<len;j++){backer=ref[j];row=row_parser.normalize_row(backer);if(!row){continue}amount=row.amount;if(min_pledge==null||amount<min_pledge){min_pledge=amount}if(max_pledge==null||amount>max_pledge){max_pledge=amount}results.push(row)}return results}();if(!backers.length){this.setState({error_message:"No backers could be retrieved from the file",file_contents:null,file_name:null,parsed_file:null});return}return this.setState({total_backers:backers.length,import_currency:currency,max_pledge:max_pledge,min_pledge:min_pledge,backers:backers})},load_file:function(name,text){var parsed,row_parser,row_type;parsed=Papa.parse(text,{header:true});row_type=this.validate_csv(parsed);if(!row_type){this.setState({loading:false,error_message:"Failed to parse backers, is the file the correct format?"});return}row_parser=function(){switch(row_type){case"kickstarter":return KickstarterRow;case"indiegogo":return IndiegogoRow;default:throw new Error("No parser for row type: "+row_type)}}();this.summarize_file(parsed,row_parser);return this.setState({error_message:null,file_format_type:row_type,row_parser:row_parser,loading:false,file_contents:text,file_name:name,parsed_file:parsed},function(_this){return function(){return _this.assign_backers_to_groups()}}(this))},render_action_buttons:function(){return div({className:"bottom_buttons"},this.state.file_name?span({},button({className:classNames("button",{disabled:this.state.loading}),disabled:this.state.loading},"Create keys for backers")," or ",a({href:"#",onClick:function(_this){return function(e){e.preventDefault();return _this.trigger("ks:pick_csv")}}(this)},"Select a different CSV")):span({},button({className:"button",disabled:!!this.state.loading,onClick:function(_this){return function(e){e.preventDefault();return _this.trigger("ks:pick_csv")}}(this)},"Select a CSV to import...")," or ",a({href:"#",onClick:function(_this){return function(e){e.preventDefault();return I.Lightbox.open(R.GameEdit.KickstarterApiLightbox({}))}}(this)},"Import using Kickstarter API...")))}});P("KickstarterBackerGroup",{propTypes:{idx:types.number,default:types.bool.isRequired,currency:types.string.isRequired,money_placeholder:types.string.isRequired,backers:types.array.isRequired,uploads:types.array.isRequired,download_key_groups:types.array},getInitialState:function(){return{unlock_all_files:false,download_key_group_id:""}},componentDidMount:function(){if(this.refs.cutoff_price){return $(this.refs.cutoff_price.refs.input).focus()}},input_name:function(name){var idx;idx=this.props.idx!=null?this.props.idx+1:"default";return"group["+idx+"]["+name+"]"},render:function(){return div({className:classNames("backer_group",{default_group:this.props["default"]})},this.render_group_header(),this.render_header(),div({className:"group_columns"},this.render_uploads(),this.render_key_destination()))},render_group_header:function(){if(this.props["default"]){return}return div({className:"group_header"},div({className:"group_summary"},"Backers that pledge",R.GameEdit.MoneyInput({"data-currency":this.props.import_currency,ref:"cutoff_price",className:"cutoff_price",name:this.input_name("cutoff_price"),placeholder:I.format_money(0,this.props.import_currency),onKeyUp:function(_this){return function(e){var val;val=I.parse_money(e.target.value);return _this.trigger("ks:set_group_price",_this.props.idx,val)}}(this)}),"and above"),a({href:"#",className:"sub",onClick:function(_this){return function(e){e.preventDefault();return _this.trigger("ks:remove_group",_this.props.idx)}}(this)},"Delete group"))},render_header:function(){return div({className:classNames("group_counts",{has_error:!this.props.backers.length})},"Matching ",strong({},this.props.backers.length+" backers"),this.props.backers.length>0?span({}," (",a({href:"#",onClick:function(_this){return function(e){e.preventDefault();return I.Lightbox.open(R.GameEdit.KickstarterBackersLightbox({group:_this.props.group,import_currency:_this.props.import_currency,backers:_this.props.backers}))}}(this)},"View list"),")"):void 0)},render_key_destination:function(){return div({className:"key_destination"},div({className:"column_header"},"Put keys in ",R.Forms.SimpleSelect({value:this.state.download_key_group_id,name:this.input_name("download_key_group_id"),onChange:function(_this){return function(value){return _this.setState({download_key_group_id:value})}}(this),options:[{value:"",name:"New download key group"}].concat(this.props.download_key_groups.map(function(_this){return function(group){return{value:""+group.id,name:group.name}}}(this)))})),this.state.download_key_group_id===""?div({className:"new_download_key_group"},this.render_file_unlock(),this.render_external_key_unlock()):p({},strong({},"Note: "),"Email addresses already imported will be skipped"))},render_file_unlock:function(){return div({className:"file_unlock"},R.Forms.TextInputRow({money_input:true,name:this.input_name("unlock_price"),title:"Unlock price",currency:this.props.currency,placeholder:this.props.money_placeholder,disabled:this.state.unlock_all_files,onKeyUp:function(_this){return function(e){return _this.setState({unlock_price:I.parse_money(e.target.value)})}}(this)}),div({className:"unlock_alt"},span({className:"or"}," or "),label({},input({type:"checkbox",name:this.input_name("unlock_all_files"),value:this.state.unlock_all_files,onChange:function(_this){return function(e){return _this.setState({unlock_all_files:e.target.checked})}}(this)}),"Unlock all files")))},render_external_key_unlock:function(){return div({className:"key_unlock"},label({},input({name:this.input_name("unlock_keys"),type:"checkbox"}),"Unlock external keys (Steam, etc.)"))},render_uploads:function(){var ref,upload_unlock_price,uploads;upload_unlock_price=this.state.download_key_group_id===""?this.state.unlock_price:(ref=_.toArray(this.props.download_key_groups).find(function(_this){return function(group){return""+group.id===""+_this.state.download_key_group_id}}(this)))!=null?ref.unlock_price:void 0;uploads=this.props.uploads.map(function(_this){return function(upload){var is_available;is_available=false;if(!upload.min_price){is_available=true}if(upload.min_price&&upload_unlock_price){is_available=upload_unlock_price===-1?true:upload_unlock_price>=upload.min_price}if(_this.state.unlock_all_files){is_available=true}return div({className:classNames("upload",{available:is_available}),key:upload.id},span({className:"icon-download icon"}),span({className:"filename"},upload.filename),upload.min_price?span({className:"price"},"at "+I.format_money(upload.min_price,_this.props.currency)):void 0,span({className:"size"},I.format_bytes(upload.size)))}}(this));if(!uploads.length){uploads=div({className:"empty_message"},"You don't have any files available")}return div({className:"uploads"},div({className:"column_header"},"Files to be given"),div({className:"available_uploads",children:uploads}))}});P("KickstarterBackersLightbox",{propTypes:{import_currency:types.string,group:types.object,backers:types.array.isRequired},render:function(){return R.Lightbox({className:this.enclosing_class_name()},this.props.group?h2({},"Backers that pledged more than "+I.format_money(this.props.group.cutoff_price,this.props.import_currency)):this.props.unassigned?h2({},"Unassigned backers"):h2({},"Selected backers"),div({className:"backer_list_table"},div({className:"backer_list_header"},div({},"Name"),div({},"Email"),div({},"Pledge")),div({className:"backer_list"},this.props.backers.map(function(_this){return function(backer,idx){return div({className:"backer_row",key:backer.name+"-"+backer.email},div({title:backer.name},backer.name||span({className:"sub"},"n/a")),div({title:backer.email},backer.email),div({},I.format_money(backer.amount,_this.props.import_currency)))}}(this)))))}});P("KickstarterApiLightbox",{render:function(){return R.Lightbox({className:this.enclosing_class_name()},h2({},"Import using Kickstarter API"),p({},"You can import your backer list through Kickstarter's API by adding itch.io's account as a collaborator to your project. Add the following email address as a collaborator to begin:"),p({className:"account_email"},"support@itch.io"),p({},"CSV backer import is self-service, so before using the API you might want to try a CSV import."),p({},a({className:"forward_link",href:"#"},"Read more about connecting your Kickstarter account")))}});P("HelpTooltip",{propTypes:{tooltip:types.string.isRequired},componentDidMount:function(){return $(ReactDOM.findDOMNode(this)).has_tooltips()},render:function(){return div({className:"help_hover","data-tooltip":this.props.tooltip})}})})}).call(this);(function(){I.libs.react.done(function(){var _rdf,a,br,button,code,div,em,fieldset,form,fragment,h1,h2,h3,h4,h5,h6,iframe,img,input,key_counter,label,legend,li,ol,optgroup,option,p,pre,section,select,span,strong,textarea,types,ul,slice=[].slice;_rdf=ReactDOMFactories;div=_rdf.div,span=_rdf.span,a=_rdf.a,br=_rdf.br,p=_rdf.p,ol=_rdf.ol,ul=_rdf.ul,li=_rdf.li,strong=_rdf.strong,em=_rdf.em,img=_rdf.img,form=_rdf.form,label=_rdf.label,input=_rdf.input,textarea=_rdf.textarea,button=_rdf.button,iframe=_rdf.iframe,h1=_rdf.h1,h2=_rdf.h2,h3=_rdf.h3,h4=_rdf.h4,h5=_rdf.h5,h6=_rdf.h6,pre=_rdf.pre,code=_rdf.code,select=_rdf.select,option=_rdf.option,section=_rdf.section,optgroup=_rdf.optgroup,fieldset=_rdf.fieldset,legend=_rdf.legend;fragment=React.createElement.bind(null,React.Fragment);fragment.type=React.fragment;key_counter=0;types=PropTypes;R.component("RowMover",{pure:true,render:function(){return this.enclose({},span({className:"mover_label"},"Move"),button({type:"button",className:"move_up_btn",disabled:this.props.first,onClick:this.props.move_up,title:"Move up"},R.Icons.TriUp),button({type:"button",className:"move_down_btn",disabled:this.props.last,onClick:this.props.move_down,title:"Move down"},R.Icons.TriDown))}});R.component("ListManager",{propTypes:{initial_items:types.array,on_list_update:types.func,empty_content:types.node,item_component:types.node},getInitialState:function(){var item;return{rows:function(){var i,len,ref,results;ref=_.toArray(this.props.initial_items);results=[];for(i=0,len=ref.length;i<len;i++){item=ref[i];results.push({item:item})}return results}.call(this)}},componentDidUpdate:function(props,state){var base,row;if(state.rows!==this.state.rows){if(typeof(base=this.props).on_list_update==="function"){base.on_list_update(function(){var i,len,ref,results;ref=this.state.rows;results=[];for(i=0,len=ref.length;i<len;i++){row=ref[i];results.push(row.item)}return results}.call(this))}}return this.state},replace_items:function(items){return this.setState({rows:items.map(function(_this){return function(item){return{item:item}}}(this))})},add:function(item,callback){return this.setState(function(_this){return function(state){return{rows:state.rows.concat([{item:item}])}}}(this),callback?function(_this){return function(){var i,len,ref,ref1,row;ref=_this.state.rows;for(i=0,len=ref.length;i<len;i++){row=ref[i];if(row.item===item){if(typeof callback==="function"){callback((ref1=row.ref)!=null?ref1.current:void 0)}return}}}}(this):void 0)},remove_item:function(item){return this.setState(function(_this){return function(state){var row;return{rows:function(){var i,len,ref,results;ref=state.rows;results=[];for(i=0,len=ref.length;i<len;i++){row=ref[i];if(row.item!==item){results.push(row)}}return results}()}}}(this))},find_row:function(item){var i,len,ref,row;ref=this.state.rows;for(i=0,len=ref.length;i<len;i++){row=ref[i];if(row.item===item){return row}}},update_all:function(callback){return this.setState(function(_this){return function(state){return{rows:state.rows.map(callback)}}}(this))},update_item:function(item,update){return this.update_all(function(_this){return function(row){var out;if(row.item===item){out=Object.assign({},row,{item:Object.assign({},row.item,update)});return out}else{return row}}}(this))},update_row:function(row,update,callback){var new_row,updater;new_row=Object.assign({},row,update);updater=function(_this){return function(state){var found_row,updated_rows;found_row=false;updated_rows=state.rows.map(function(r){if(r===row){found_row=true;return new_row}else{return r}});if(!found_row){console.warn("tried to update row that doesn't exist")}if(found_row){return{rows:updated_rows}}}}(this);this.setState(updater,callback);return new_row},move_item:function(item,dir){var animate_callback,before_left,before_top,el,ref,row;row=this.find_row(item);animate_callback=this.props.animate?(el=ReactDOM.findDOMNode(row.ref.current),ref=el.getBoundingClientRect(),before_top=ref.top,before_left=ref.left,ref,function(_this){return function(){var after_left,after_top,dx,dy,ref1,speed,styles;ref1=el.getBoundingClientRect(),after_top=ref1.top,after_left=ref1.left;dy=after_top-before_top;dx=after_left-before_left;speed=250;styles=[{position:"relative",transform:"translate("+-dx+"px, "+-dy+"px)",zIndex:"1"},{position:"relative",transition:"transform "+speed/1e3+"s ease",transform:"translate(0, 0)",zIndex:"1"},{}];return row=_this.update_row(row,{style:styles[0]},function(){return _.defer(function(){return row=_this.update_row(row,{style:styles[1]},function(){return setTimeout(function(){return _this.update_row(row,{style:styles[2]})},speed)})})})}}(this)):void 0;return this.setState(function(state){return{rows:I.move(state.rows,row,dir)}},animate_callback)},render:function(){var self;if(this.props.empty_content&&!this.state.rows.length){return this.props.empty_content}self=this;return this.state.rows.map(function(_this){return function(row,idx){var props;props={key:row.key||(row.key=row.item.id||"item-"+key_counter++),ref:row.ref||(row.ref=React.createRef()),position:idx,first:idx===0,last:idx===_this.state.rows.length-1,style:row.style,update:_this.props_update||(_this.props_update=function(){var r;r=self.state.rows[this.position];return self.update_item.apply(self,[r.item].concat(slice.call(arguments)))}),update_all:_this.props_update_all||(_this.props_update_all=function(fn){return self.update_all(function(_this){return function(rr){var updates;if(updates=fn(rr.item)){return Object.assign({},rr,{item:Object.assign({},rr.item,updates)})}else{return rr}}}(this))}),remove:_this.props_remove||(_this.props_remove=function(){var r;r=self.state.rows[this.position];return self.remove_item(r.item)}),move_up:_this.props_move_up||(_this.props_move_up=function(){var r;r=self.state.rows[this.position];return self.move_item(r.item,-1)}),move_down:_this.props_move_down||(_this.props_move_down=function(){var r;r=self.state.rows[this.position];return self.move_item(r.item,1)})};props[_this.props.item_name||"item"]=row.item;if(_this.props.item_props){Object.assign(props,_this.props.item_props(row.item,idx))}return _this.props.item_component(props)}}(this))}})})}).call(this);(function(){I.libs.react.done(function(){var P,_rdf,a,br,button,code,div,em,fieldset,form,fragment,h1,h2,h3,h4,h5,h6,iframe,img,input,label,legend,li,ol,optgroup,option,p,pre,section,select,span,strong,textarea,ul;_rdf=ReactDOMFactories;div=_rdf.div,span=_rdf.span,a=_rdf.a,br=_rdf.br,p=_rdf.p,ol=_rdf.ol,ul=_rdf.ul,li=_rdf.li,strong=_rdf.strong,em=_rdf.em,img=_rdf.img,form=_rdf.form,label=_rdf.label,input=_rdf.input,textarea=_rdf.textarea,button=_rdf.button,iframe=_rdf.iframe,h1=_rdf.h1,h2=_rdf.h2,h3=_rdf.h3,h4=_rdf.h4,h5=_rdf.h5,h6=_rdf.h6,pre=_rdf.pre,code=_rdf.code,select=_rdf.select,option=_rdf.option,section=_rdf.section,optgroup=_rdf.optgroup,fieldset=_rdf.fieldset,legend=_rdf.legend;fragment=React.createElement.bind(null,React.Fragment);fragment.type=React.fragment;P=R["package"]("Bundle");P("Timezone",{render:function(){return input({type:"hidden",name:"timezone_offset",className:"timezone_offset",value:(new Date).getTimezoneOffset()/60})}});P("Label",{render:function(){return div({className:"label"},this.props.title,this.props.sub?span({className:"sub"},"  ",this.props.sub):void 0)}});P("BasicInfo",{render:function(){return div({},div({className:"input_row"},label({},P.Label({title:"Title",sub:"What is the name of your bundle?"}),input({type:"text",name:"bundle[title]",className:"big_input title_input"}))),div({className:"input_row"},label({},P.Label({title:"Description",sub:"Optional description of bundle"}),R.Redactor({name:"bundle[description]"}))))}});P("Slider",{componentDidMount:function(){return this.slider=$(ReactDOM.findDOMNode(this)).slider({range:"min",animate:"fast",min:0,max:100,step:.001,value:this.props.value,disabled:!!this.props.disabled,slide:function(_this){return function(e,s){return _this.props.onChange(s.value)}}(this)})},componentDidUpdate:function(prev_props){if(prev_props.value!==this.props.value){this.slider.slider("value",this.props.value)}if(prev_props.disabled!==this.props.disabled){return this.slider.slider("option","disabled",this.props.disabled)}},render:function(){return div({className:"split_slider"},input({type:"hidden",name:"bundle[split]["+this.props.name+"]",className:"split_slider_input",value:this.props.intValue}))}});P("SplitSlider",{render:function(){return li({className:"split_slider_container"},div({}),img({className:"avatar",src:this.props.user.avatar}),div({className:"username"},this.props.user.name),div({className:"split_slider_outer"},P.Slider({name:this.props.user.id,value:this.props.value,intValue:this.props.intValue,onChange:this.props.onChange,disabled:this.props.disabled})),div({className:"split_summary"},span({className:"split_value"},[this.props.intValue,"%"])))}});P("RevenueSplit",{getInitialState:function(){return{parts:[]}},render:function(){if(!(this.state.parts.length>0)){return false}return div({},P.Label({title:"Developer cut distribution",sub:"How revenue is split among participants"}),div({className:"input_row split_row"},ul({className:"split_list",children:this.state.parts.map(function(_this){return function(p,i){return P.SplitSlider({key:p.user.id,user:p.user,value:p.split,intValue:_this.intSplit(i),disabled:_this.state.parts.length===1,onChange:_this.setSplit.bind(_this,p.user.id)})}}(this))}),div({className:"split_presets"},"Choose a preset: ",a({href:"#",className:"equal_split_btn",onClick:this.setEqualSplit},"equal split"))))},setSplit:function(id,v,parts){var diff,index,numOthers,otherTotal,totalValue,wiggle;if(parts==null){parts=this.state.parts}index=_.findIndex(parts,function(p){return p.user.id===id});parts[index].split=v;numOthers=parts.length-1;totalValue=0;otherTotal=0;wiggle=1e-5;parts.forEach(function(p,i){totalValue+=p.split;if(i!==index){return otherTotal+=p.split+wiggle}});diff=100-totalValue;parts.forEach(function(p,i){var weight;if(i===index){return}weight=(p.split+wiggle)/otherTotal;return p.split+=diff*weight});parts.forEach(function(p,i){var backers,deficit,deficitDiff;if(p.split>=0){return}deficit=p.split;backers=parts.filter(function(p,i){return i!==index&&i.split>0});deficitDiff=deficit/backers.length;p.split=0;return backers.forEach(function(_this){return function(backer){return backer.split+=deficitDiff}}(this))});return this.setState({parts:parts})},intSplit:function(i){var idx,j,len,part,parts,rest;parts=function(){var j,len,ref,results;ref=this.state.parts;results=[];for(j=0,len=ref.length;j<len;j++){part=ref[j];results.push($.extend({},part))}return results}.call(this);rest=100;if(parts.length===0){return rest}for(j=0,len=parts.length;j<len;j++){part=parts[j];part.split=Math.floor(part.split);rest-=part.split}idx=0;while(rest>0){rest-=1;parts[idx%parts.length].split+=1;idx+=1}return parts[i].split},setEqualSplit:function(e){var idx,j,len,part,parts,rest,share;if(e!=null){e.preventDefault()}parts=function(){var j,len,ref,results;ref=this.state.parts;results=[];for(j=0,len=ref.length;j<len;j++){part=ref[j];results.push(part)}return results}.call(this);if(parts.length===0){return}share=Math.floor(100/parts.length);rest=100;for(j=0,len=parts.length;j<len;j++){part=parts[j];part.split=share;rest-=share}idx=0;while(rest>0){rest-=1;parts[idx%parts.length].split+=1;idx+=1}return this.setState({parts:parts})},getTotal:function(){return _.reduce(this.state.parts,function(m,p){return m+p.split},0)}});P("GameList",{getInitialState:function(){return{game_url:"",games:[],loading:false}},render_game:function(game){return li({key:game.id,className:"game_row"},input({type:"hidden",name:"bundle[games]["+game.id+"][checked]",value:"true"}),a({className:"remove_game",onClick:this.removeGame.bind(this,game.id)},"Remove"),label({className:"minimum_price_checkbox"},input({type:"checkbox",onChange:this.minPriceToggle.bind(this,game.id)}),"Set minimum price"),div({className:"cover",style:{backgroundImage:"url('"+game.cover+"')"}}),div({className:"game_info"},a({href:game.url,className:"game_link",target:"_blank"},game.title)," by ",a({href:game.user.url,className:"user_link",target:"_blank"},game.user.name)),div({className:"price_tag"},I.format_money(game.price,game.currency)),game.has_min_price?div({className:"minimum_price_picker"},div({className:"label"},"Minimum price"),p({className:"sub"},"The minimum price for an item should be greater than the minimum price for the entire bundle. You should only set this if the item's minimum price is different than the bundle's."),P.MoneyInput({name:"bundle[games]["+game.id+"][min_price]",className:"item_price_input",currency:"USD"})):void 0)},render:function(){return div({className:"input_row game_list_row "+(this.state.loading&&"loading")},p({},"Paste the URL of one game or more on itch.io and click add"),P.Label({title:"Game URL"}),input({type:"text",className:"game_url_input",placeholder:"e.g. http://example.itch.io/game",onChange:function(_this){return function(e){return _this.setState({game_url:e.target.value})}}(this),onKeyPress:function(_this){return function(e){if(e.charCode===13){return _this.submitGame()}}}(this),value:this.state.game_url,disabled:this.state.loading}),a({className:"button add_game_btn",onClick:this.submitGame},"Add"),div({className:"loader form_loader",style:{display:this.state.loading&&"inline-block"}}),this.state.games.length>0?div({},ul({className:"bundle_game_list",children:this.state.games.map(this.render_game)}),div({className:"game_list_summary"},"Sum of all games: ",span({className:"price"},this.priceSummary()))):void 0)},submitGame:function(e){$.ajax({url:"/bundle/game-info",type:"post",data:I.with_csrf({urls:this.state.game_url}),success:function(_this){return function(res){var ref;if(res.errors){I.flash("Error: "+res.errors.join(", "),"error");return}if((ref=I.flasher)!=null){ref.dismiss()}return _this.add_games(res)}}(this),error:function(){return I.flash("Server error, try again later")},complete:function(_this){return function(){return _this.setState({loading:false})}}(this)});return this.setState({loading:true})},add_games:function(data){var games;games=_.union(this.state.games,data.games);games=_.uniq(games,function(g){return g.id});return this.setState({games:games,game_url:""})},removeGame:function(id){var games;games=_.filter(this.state.games,function(g){return g.id!==id});return this.setState({games:games})},minPriceToggle:function(id,e){var games,has;has=e.target.checked;games=_.map(this.state.games,function(g){if(g.id===id){return _.extend(g,{has_min_price:has})}else{return g}});return this.setState({games:games})},componentDidUpdate:function(prev_props,prev_state){if(prev_state.games!==this.state.games){return this.props.on_games(this.state.games)}},priceSummary:function(){var groups,prices;groups=_.groupBy(this.state.games,"currency");prices=_.map(groups,function(games,currency){var g,j,len,total;total=0;for(j=0,len=games.length;j<len;j++){g=games[j];total+=g.price}return I.format_money(total,currency)});return _.reduce(prices,function(memo,price){return memo+" + "+price})}});P("MoneyInput",{componentDidMount:function(){return I.money_input($(ReactDOM.findDOMNode(this)))},render:function(){return input({type:"text",name:this.props.name,className:"medium_input money_input "+this.props.className,placeholder:"$0.00"})}});P("Price",{render:function(){return React.createElement(React.Fragment,{},div({className:"input_row bundle_price_row"},label({},P.Label({title:"Minimum price",sub:"Minimum price to buy this bundle, can be 0"}),P.MoneyInput({name:"bundle[bundle_price]",className:"bundle_price_input",currency:"USD"}))),R.Forms.TextInputRow({title:"Goal",sub:React.createElement(React.Fragment,{},"Publicly show the earnings of the bundle along with the progress towards your goal. Leave blank to disable. ",a({href:"https://itch.io/docs/creators/sales#sale-goals"},"Learn more")),name:"bundle[goal]",placeholder:"Optional",money_input:true,currency:"USD"}))}});P("DatePicker",{componentDidMount:function(){var $el;$el=$(ReactDOM.findDOMNode(this));return I.datetimepicker($el,{onSelect:function(_this){return function(val){return _this.props.onChange($el.datetimepicker("getDate"))}}(this)})},render:function(){return input({type:"text",className:"date_picker",name:this.props.name,readOnly:"readonly"})}});P("Duration",{getInitialState:function(){return{}},render:function(){return div({className:"input_row duration_row"},P.Label({title:"Duration",sub:"When the bundle starts and ends in your local time"}),div({},label({},span({className:"duration_label"},"Start date:"),P.DatePicker({name:"bundle[start_date]",onChange:this.setDate.bind(this,"start")})),label({},span({className:"duration_label"},"End date:"),P.DatePicker({name:"bundle[end_date]",onChange:this.setDate.bind(this,"end")})),span({className:"duration_summary"},this.state.summary)))},setDate:function(which,time){var state;state=this.state;state[which]=time;if(state.start&&state.end){state.summary=I.format_duration(state.end-state.start,3,false)}return this.setState(state)}});P("Published",{render:function(){return div({className:"input_row"},P.Label({title:"Publishing your bundle"}),p({className:"sub"},"Once you create the bundle it will be locked in draft mode. All participants must approve of the bundle before it can be made public. Only minimal edits can be made to a bundle in draft mode so participants can approve it without any surprise changes. Please verify the information you provided above is correct."))}});R("NewBundle",{getInitialState:function(){return{errors:[]}},componentDidMount:function(){return $(this.form_ref.current).remote_submit(function(_this){return function(res,form){_this.setState({errors:res.errors});if(res.errors){return}return window.location=res.url}}(this))},render:function(){var ref;return this.enclose({component:"form",method:"POST",ref:this.form_ref||(this.form_ref=React.createRef())},R.CSRF({}),P.Timezone({}),((ref=this.state.errors)!=null?ref.length:void 0)?R.Forms.FormErrors({errors:this.state.errors,scroll_into_view:true}):void 0,p({},"A co-op bundle is a bundle between multiple creators on itch.io. From this page you can invite others into your bundle by picking their content. After you've created the bundle each participant must approve it before it can be enabled and go live."),this.props.warn_payouts?p({className:"payouts_warning"},"Due to the complexity of distributing purchases across multiple sellers, all purchases of co-op bundles go through ",a({href:"/dashboard/payouts"},"itch.io's payout system"),". Prices are done in USD and VAT will automatically be added if necessary."):void 0,P.BasicInfo({}),h2({},"Add games"),P.GameList({on_games:this.on_games,price:this.state.price,ref:"game_list"}),h2({},"Price & date"),P.Price({}),P.Duration({}),P.RevenueSplit({ref:"split"}),P.Published({}),div({className:"buttons"},button({className:"button save_btn"},"Create co-op bundle")))},on_games:function(games){var had_newcomer,oldParts,parts,rest,split,split_factor,total_split,users;split=this.refs.split;oldParts=_.indexBy(split.state.parts,function(p){return p.user.id});users=_.map(games,function(g){return g.user});users=_.indexBy(users,function(u){return u.id});parts=_.groupBy(games,function(g){return g.user.id});parts=_.map(parts,function(games,userId){var ref;return{user:users[userId],numGames:games.length,split:((ref=oldParts[userId])!=null?ref.split:void 0)||-1}});if(parts.length===1){parts[0].split=100}else if(parts.length>0){had_newcomer=false;_.each(parts,function(p){if(p.split===-1){had_newcomer=true;return split.setSplit(p.user.id,Math.ceil(100/parts.length),parts)}});if(!had_newcomer){total_split=0;_.each(parts,function(p){return total_split+=p.split});split_factor=100/total_split;rest=100;_.each(parts,function(p){p.split=Math.floor(p.split*split_factor);return rest-=p.split});parts[0].split+=rest}}return split.setState({parts:parts})}})})}).call(this);(function(){I.libs.react.done(function(){var P,SLIDE_DELAY,Transition,TransitionGroup,_rdf,a,br,button,code,div,em,fieldset,form,fragment,h1,h2,h3,h4,h5,h6,iframe,img,input,label,legend,li,ol,optgroup,option,p,path,pre,section,select,span,strong,svg,textarea,ul,slice=[].slice;_rdf=ReactDOMFactories;div=_rdf.div,span=_rdf.span,a=_rdf.a,br=_rdf.br,p=_rdf.p,ol=_rdf.ol,ul=_rdf.ul,li=_rdf.li,strong=_rdf.strong,em=_rdf.em,img=_rdf.img,form=_rdf.form,label=_rdf.label,input=_rdf.input,textarea=_rdf.textarea,button=_rdf.button,iframe=_rdf.iframe,h1=_rdf.h1,h2=_rdf.h2,h3=_rdf.h3,h4=_rdf.h4,h5=_rdf.h5,h6=_rdf.h6,pre=_rdf.pre,code=_rdf.code,select=_rdf.select,option=_rdf.option,section=_rdf.section,optgroup=_rdf.optgroup,fieldset=_rdf.fieldset,legend=_rdf.legend;fragment=React.createElement.bind(null,React.Fragment);fragment.type=React.fragment;P=R["package"]("Queue");TransitionGroup=ReactTransitionGroup.TransitionGroup,Transition=ReactTransitionGroup.Transition;svg=ReactDOMFactories.svg,path=ReactDOMFactories.path;SLIDE_DELAY=200;P("TickIcon",{render:function(){return svg({viewBox:"0 0 37 20","aria-hidden":"true",width:this.props.width,height:this.props.height,className:"svgicon",role:"img",version:"1.1"},path({d:"m2.0858 0c-1.1535 0-2.0858 0.86469-2.0858 1.9331 0 0.5139 0.21354 1.0183 0.38704 1.1881l18.113 16.879 18.112-16.879c0.174-0.1696 0.388-0.674 0.388-1.1879 0-1.0684-0.932-1.9331-2.086-1.9331-0.577 0-1.111 0.23008-1.49 0.57992l-14.924 13.894-14.925-13.893c-0.3777-0.34998-0.9134-0.581-1.4902-0.581z"}))}});P("Divider",{pure:true,render:function(){return div({className:"current_location",key:"current"},span({className:"loc_label"},this.props.has_after?["Upcoming",R.Queue.TickIcon({key:"icon",width:10,height:10})]:void 0),span({className:"loc_label prev"},this.props.has_before?[R.Queue.TickIcon({key:"icon",width:10,height:10}),"Previously"]:void 0))}});P("CurrentGame",{pure:true,getInitialState:function(){var blurb,ref;blurb=((ref=this.props.game.blurb)!=null?ref.content:void 0)||"";return{blurb_open:blurb.length<200}},componentDidMount:function(){var ca;if(ca=this.props.game.ca){return I.ConversionTracker.push(ca)}},render:function(){var game,ref,ref1,tags;game=this.props.game;return section({className:"current_game"},h2({className:"game_title"},a({href:game.url,target:"_blank"},game.name)),h3({className:"game_author"},span({},"by ",a({href:game.user.url,target:"_blank"},game.user.name)),game.follow_button&&((ref=I.current_user)!=null?ref.id:void 0)!==game.user.id?R.FollowButton($.extend({show_name:false,className:"small",follow_data:{source:"queue"}},game.follow_button)):void 0),this.props.queue?div({className:"queue"},"from ",a({href:this.props.queue.url,target:"_blank"},this.props.queue.name)):void 0,game.summary||game.short_text?p({className:"game_summary"},_.compact([game.summary,game.short_text]).join(". ")):void 0,game.blurb?div({className:classNames("game_blurb",{truncated:!this.state.blurb_open}),onClick:!this.state.blurb_open?function(_this){return function(e){return _this.setState({blurb_open:true})}}(this):void 0},div({className:"blurb_author"},a({target:"blank",href:game.blurb.author.url},game.blurb.author.name)," says"),div({className:"blurb_wrapper",dangerouslySetInnerHTML:{__html:game.blurb.content}})):void 0,game.tags&&game.tags.length?(tags=_.toArray(game.tags).slice(0,11),div({className:"game_tags"},strong({},"Tags: "),this.comma_list(tags.map(function(_this){return function(tag){return a({key:tag.url,target:"_blank",href:tag.url},tag.name)}}(this))))):void 0,game.collection_url?a({className:"add_to_collection_btn button outline",type:"button",target:"_blank",href:game.collection_url,onClick:function(_this){return function(e){var btn;if(!I.current_user){return}e.preventDefault();btn=$(e.currentTarget);return I.Lightbox.open_remote(btn.attr("href"),I.CollectionLightbox)}}(this)},span({className:"icon icon-playlist_add"})," Add to collection"):void 0,((ref1=game.object)!=null?ref1.css:void 0)?pre({className:"game_css"},game.object.css):void 0)},comma_list:function(_this){return function(items){var i,idx,item,len,out;out=[];for(idx=i=0,len=items.length;i<len;idx=++i){item=items[idx];if(idx){out.push(", ")}out.push(item)}return out}}(this)});P("Viewer",{render:function(){return this.enclose({className:{finished:!this.state.current},children:this.state.current?[this.render_sidebar(),section({className:"object_wrapper",key:"object_wrapper"},this.state.current?iframe({src:this.state.current.embed_url||this.state.current.url}):void 0)]:this.render_empty_page()})},getInitialState:function(){return{loading:false,current:this.props.next_item,remaining:this.props.remaining,next_url:this.props.next_url}},set_url_state:function(object){var base;if(!(object!=null?object.restore_url:void 0)){return}return typeof(base=window.history).replaceState==="function"?base.replaceState({},object.name,object.restore_url):void 0},dismiss_and_next_item:function(){var current,dismiss;current=this.state.current;dismiss=(current!=null?current.dismiss_url:void 0)?$.post(current.dismiss_url,I.with_csrf()):$.when({});return dismiss.then(function(_this){return function(){return _this.next_item()}}(this))},next_item:function(next_url){return $.getJSON(next_url||this.state.next_url||"").then(function(_this){return function(res){var ref;_this.set_url_state(res.next_item);return _this.setState({next_url:res.next_url,current:res.next_item,remaining:(ref=res.remaining)!=null?ref:void 0})}}(this))},render_empty_page:function(){var can_follow,ref;can_follow=((ref=I.current_user)!=null?ref.id:void 0)!==this.props.queue.user.id;return div({className:"empty_message",key:"empty_page"},h2({},"You got to the end!"),p({},"There's nothing left in ",a({href:this.props.queue.url},this.props.queue.name)),can_follow?p({},"Did you like it? Give ",a({href:this.props.queue.user.url},"the author")," a follow!"):void 0,div({className:"action_buttons"},can_follow?R.FollowButton($.extend({follow_data:{source:"queue"}},this.props.queue.user.follow_button)):void 0," ",this.props.queue.queue_url?button({className:"button outline",type:"button",onClick:function(_this){return function(e){return _this.next_item(_this.props.queue.queue_url)}}(this)},"Restart collection"):void 0))},render_sidebar:function(){var current;current=this.state.current;return section({className:"sidebar",key:"sidebar"},this.props.register_url?div({className:"login_message"},a({target:"_blank",href:this.props.register_url,"data-register_action":"nag"},"Create an account on itch.io")," to create your own collections and follow creators"):void 0,div({className:"sidebar_inner"},button({className:classNames("button next_button forward_link",{disabled:this.state.loading}),type:"button",disabled:this.state.loading,onClick:function(_this){return function(e){if(_this.state.loading){return}_this.setState({loading:true});return _this.dismiss_and_next_item().then(function(){return _this.setState({loading:false})})}}(this)},this.state.loading?"Loading...":"Next item"),this.render_current_game(current),this.state.remaining!=null?p({className:"remaining_items_label"},"Remaining items: "+this.state.remaining):void 0,this.render_adjacent_games()))},render_current_game:function(current){return R.Queue.CurrentGame({key:current.id,game:current,queue:this.props.queue})},render_adjacent_game:function(game){var load_position;load_position=function(_this){return function(e){if(game.restore_url==null){return}if(e.button>0||e.ctrlKey){return}e.preventDefault();_this.setState({loading:true});return _this.next_item(game.restore_url).then(function(){return _this.setState({loading:false})})}}(this);return React.createElement(Transition,{key:game.id,timeout:SLIDE_DELAY,unmountOnExit:true,onEnter:function(el,is_appearing){return $(el).hide().slideDown(SLIDE_DELAY)},onExit:function(el){return $(el).slideUp(SLIDE_DELAY)}},div({className:"game_row_wrapper",key:game.id},div({className:"game_row"},a({href:game.url,className:"thumb_link",onClick:load_position},game.cover_thumb_url?img({src:game.cover_thumb_url,className:"thumb"}):void 0),div({className:"game_details"},div({className:"game_title"},a({href:game.url,onClick:load_position},game.title)),div({className:"game_author"},"by ",a({href:game.user.url},game.user.name))))))},render_adjacent_games:function(){var games_after,games_before,ref;ref=this.state.current,games_before=ref.games_before,games_after=ref.games_after;games_before=_.toArray(games_before);games_before=games_before.slice(0,2).reverse();games_after=_.toArray(games_after);if(!(games_before.length||games_after.length)){return}return React.createElement(TransitionGroup,{component:"section",className:"games_around",children:slice.call(games_before.map(this.render_adjacent_game)).concat([P.Divider({key:"divider",has_after:games_after.length,has_before:games_before.length})],slice.call(games_after.map(this.render_adjacent_game)))})}})})}).call(this);(function(){I.libs.react.done(function(){var P,_rdf,a,br,button,code,div,em,fieldset,form,fragment,h1,h2,h3,h4,h5,h6,iframe,img,input,label,legend,li,ol,optgroup,option,p,pre,section,select,span,strong,textarea,types,ul,hasProp={}.hasOwnProperty,slice=[].slice;_rdf=ReactDOMFactories;div=_rdf.div,span=_rdf.span,a=_rdf.a,br=_rdf.br,p=_rdf.p,ol=_rdf.ol,ul=_rdf.ul,li=_rdf.li,strong=_rdf.strong,em=_rdf.em,img=_rdf.img,form=_rdf.form,label=_rdf.label,input=_rdf.input,textarea=_rdf.textarea,button=_rdf.button,iframe=_rdf.iframe,h1=_rdf.h1,h2=_rdf.h2,h3=_rdf.h3,h4=_rdf.h4,h5=_rdf.h5,h6=_rdf.h6,pre=_rdf.pre,code=_rdf.code,select=_rdf.select,option=_rdf.option,section=_rdf.section,optgroup=_rdf.optgroup,fieldset=_rdf.fieldset,legend=_rdf.legend;fragment=React.createElement.bind(null,React.Fragment);fragment.type=React.fragment;P=R["package"]("UserSettings");types=PropTypes;P("SellerCutPicker",{propTypes:{default_cut:types.number,cut:types.number,affiliate_cuts:types.array},getInitialState:function(){var cut,i,len,out,ref,ref1,ref2;out={cut:(ref=this.props.cut)!=null?ref:this.props.default_cut,affiliate_cuts:{}};ref1=_.toArray(this.props.affiliate_cuts);for(i=0,len=ref1.length;i<len;i++){cut=ref1[i];out.affiliate_cuts[""+cut.user.id]=(ref2=cut.rate)!=null?ref2:cut.default_rate}return out},set_affiliate_cut:function(affiliate_id,cut){var _,affiliate_cuts,c,i,id,ids,len,marketplace_cut,sum,t,tuples,val;cut=Math.max(0,Math.min(100,+cut));affiliate_cuts=$.extend({},this.state.affiliate_cuts);affiliate_cuts[-1]=this.state.cut;affiliate_cuts[affiliate_id]=cut;sum=0;for(_ in affiliate_cuts){if(!hasProp.call(affiliate_cuts,_))continue;val=affiliate_cuts[_];sum+=val}if(sum>100){tuples=function(){var results;results=[];for(id in affiliate_cuts){if(!hasProp.call(affiliate_cuts,id))continue;c=affiliate_cuts[id];results.push([id,c])}return results}();tuples.sort(function(a,b){return b[1]-a[1]});ids=function(){var i,len,results;results=[];for(i=0,len=tuples.length;i<len;i++){t=tuples[i];results.push(t[0])}return results}();while(sum>100){for(i=0,len=ids.length;i<len;i++){id=ids[i];id=+id;if(id===affiliate_id){continue}if(affiliate_cuts[""+id]===0){continue}affiliate_cuts[""+id]-=1;sum-=1;if(sum<=100){break}}}}marketplace_cut=affiliate_cuts["-1"];delete affiliate_cuts["-1"];return this.setState({cut:marketplace_cut,affiliate_cuts:affiliate_cuts})},componentDidMount:function(){return this.dispatch({set_affiliate_cut:function(_this){return function(e,affiliate_id,cut){return _this.set_affiliate_cut(affiliate_id,cut)}}(this)})},render:function(){return this.enclose({},this.render_marketplace_cut(),this.render_affiliates())},render_marketplace_cut:function(){return div({className:"input_row cut_row"},input({type:"hidden",name:"data[cut]",value:this.state.cut}),div({className:classNames("cut_icon icon icon-heart-filled",{sad:this.state.cut<10,happy:this.state.cut>=30})}),div({className:"label"},"What percentage do you want to give to support itch.io?"),div({className:"cut_container"},R.Forms.Slider({min:0,max:100,value:this.state.cut,onChange:function(_this){return function(value){return _this.set_affiliate_cut(-1,value)}}(this)}),div({className:"cut_summary"},span({className:"cut_value"},this.state.cut+"%"),span({className:"sub"}," of each transaction"))),div({className:"cut_presets"},"Choose a preset",a({href:"#",className:"set_default_btn",onClick:function(_this){return function(e){e.preventDefault();return _this.set_affiliate_cut(-1,10)}}(this)},"itch.io default (10%)"),a({href:"#",className:"set_standard_btn",onClick:function(_this){return function(e){e.preventDefault();return _this.set_affiliate_cut(-1,30)}}(this)},"Industry standard (30%)")))},render_affiliates:function(){var cuts,ref;if(!((ref=this.props.affiliate_cuts)!=null?ref.length:void 0)){return}cuts=this.props.affiliate_cuts.map(function(_this){return function(cut){return P.AffiliateCutPicker($.extend({cut:_this.state.affiliate_cuts[""+cut.user.id]},cut))}}(this));return div.apply(null,[{className:"affiliate_cuts"},h3({},"Affiliates"),p({},"If an itch.io partner helps sell one of your projects by converting someone through their special URL or profile page then you can share some of the revenue back with them.")].concat(slice.call(cuts)))}});P("AffiliateCutPicker",{pure:true,render:function(){var game_list;return this.enclose({className:"input_row cut_row affiliate_cut_row"},input({type:"hidden",name:"affiliate["+this.props.user.id+"][cut]",value:this.props.cut}),div({className:"label"},this.props.user.name+" revenue share"),this.props.user.avatar?a({href:this.props.user.url,target:"_blank"},img({className:"affiliate_avatar",src:this.props.user.avatar,width:35,height:35})):void 0,this.props.games&&this.props.games.length?(game_list=this.props.games.map(function(_this){return function(game,idx){return[idx>0?", ":void 0,a({href:game.url,key:game.id},game.title)]}}(this)),div.apply(null,[{className:"affected_games"},"Affected games: "].concat(slice.call(game_list)))):void 0,div({className:"cut_container"},R.Forms.Slider({min:0,max:100,value:this.props.cut,onChange:function(_this){return function(value){return _this.trigger("set_affiliate_cut",_this.props.user.id,value)}}(this)}),div({className:"cut_summary"},span({className:"cut_value"},this.props.cut+"%"),span({className:"sub"}," of each transaction"))),div({className:"cut_presets"},"Choose a preset",a({href:"#",className:"set_default_btn",onClick:function(_this){return function(e){e.preventDefault();return _this.trigger("set_affiliate_cut",_this.props.user.id,_this.props.default_rate)}}(this)},this.props.user.name+" default ("+this.props.default_rate+"%)")))}})})}).call(this);(function(){I.libs.react.done(function(){var P,SEEN_EVENTS,_rdf,a,br,button,code,div,em,fieldset,form,fragment,h1,h2,h3,h4,h5,h6,iframe,img,input,label,legend,li,ol,optgroup,option,p,pre,section,select,span,strong,textarea,types,ul;_rdf=ReactDOMFactories;div=_rdf.div,span=_rdf.span,a=_rdf.a,br=_rdf.br,p=_rdf.p,ol=_rdf.ol,ul=_rdf.ul,li=_rdf.li,strong=_rdf.strong,em=_rdf.em,img=_rdf.img,form=_rdf.form,label=_rdf.label,input=_rdf.input,textarea=_rdf.textarea,button=_rdf.button,iframe=_rdf.iframe,h1=_rdf.h1,h2=_rdf.h2,h3=_rdf.h3,h4=_rdf.h4,h5=_rdf.h5,h6=_rdf.h6,pre=_rdf.pre,code=_rdf.code,select=_rdf.select,option=_rdf.option,section=_rdf.section,optgroup=_rdf.optgroup,fieldset=_rdf.fieldset,legend=_rdf.legend;fragment=React.createElement.bind(null,React.Fragment);fragment.type=React.fragment;P=R["package"]("Index");types=PropTypes;SEEN_EVENTS={};P("ConversionLink",{pure:true,propTypes:{source:types.number,object_type:types.number,object_id:types.number,href:types.string,target:types.string,class:types.any,impression:types.bool,on_click:types.func,on_impression:types.func},getInitialState:function(){return{seen:false}},get_suffix:function(){return this.props.source+":"+this.props.object_type+":"+this.props.object_id},on_click:function(e){var el,finished,is_blank,start;if(e.type!=="click"){return}el=ReactDOM.findDOMNode(this);is_blank=e.metaKey||e.ctrlKey||e.shiftKey||this.props.target==="_blank";p=this.handle_click();if(is_blank){return}if(p.state()==="resolved"){return}e.preventDefault();start=new Date;finished=function(_this){return function(){if(!finished){return}finished=null;return window.location=_this.props.href}}(this);setTimeout(function(_this){return function(){return typeof finished==="function"?finished():void 0}}(this),200);return p.done(finished)},on_mouse_up:function(e){if(e.button!==1){return}return this.handle_click()},handle_click:function(){var base,event_name,ref;if(!(this.props.object_type&&this.props.source&&this.props.object_id)){return $.when()}if(this.state.clicked){return this.state.clicked}event_name=I.ConversionTracker.types.click+":"+this.get_suffix();if(SEEN_EVENTS[event_name]){return $.when()}SEEN_EVENTS[event_name]=true;I.ConversionTracker.click(this.get_suffix());p=I.ConversionTracker.flush_now_beacon();if(this.props.track_referrer){(ref=I.ReferrerTracker).push.apply(ref,this.props.track_referrer)}this.setState({clicked:p});if(typeof(base=this.props).on_click==="function"){base.on_click()}return p},componentDidMount:function(){var el;if(!(this.props.object_type&&this.props.source&&this.props.object_id)){return}if(this.props.impression===false){return}if(SEEN_EVENTS[I.ConversionTracker.types.impression+":"+this.get_suffix()]){return}el=ReactDOM.findDOMNode(this);return this.unbind_visibility=$(el).lazy_images({elements:[el],show_images:function(_this){return function(){var base,event_name;event_name=I.ConversionTracker.types.impression+":"+_this.get_suffix();if(!SEEN_EVENTS[event_name]){I.ConversionTracker.push(event_name);SEEN_EVENTS[event_name]=true}_this.setState({seen:true});if(typeof(base=_this.props).on_impression==="function"){base.on_impression()}if(typeof _this.unbind_visibility==="function"){_this.unbind_visibility()}return _this.unbind_visibility=null}}(this)})},componentWillUnmount:function(){return typeof this.unbind_visibility==="function"?this.unbind_visibility():void 0},render:function(){return a({href:this.props.href,className:this.props["class"]||this.props.className,onClick:this.on_click,onMouseUp:this.on_mouse_up,target:this.props.target,tabIndex:this.props.tabindex},this.props.children)}})})}).call(this);(function(){I.libs.react.done(function(){var P,_rdf,a,br,button,code,div,em,fieldset,form,fragment,h1,h2,h3,h4,h5,h6,iframe,img,input,label,legend,li,ol,optgroup,option,p,pre,section,select,span,strong,textarea,types,ul;_rdf=ReactDOMFactories;div=_rdf.div,span=_rdf.span,a=_rdf.a,br=_rdf.br,p=_rdf.p,ol=_rdf.ol,ul=_rdf.ul,li=_rdf.li,strong=_rdf.strong,em=_rdf.em,img=_rdf.img,form=_rdf.form,label=_rdf.label,input=_rdf.input,textarea=_rdf.textarea,button=_rdf.button,iframe=_rdf.iframe,h1=_rdf.h1,h2=_rdf.h2,h3=_rdf.h3,h4=_rdf.h4,h5=_rdf.h5,h6=_rdf.h6,pre=_rdf.pre,code=_rdf.code,select=_rdf.select,option=_rdf.option,section=_rdf.section,optgroup=_rdf.optgroup,fieldset=_rdf.fieldset,legend=_rdf.legend;fragment=React.createElement.bind(null,React.Fragment);fragment.type=React.fragment;P=R["package"]("Index");types=PropTypes;P("LazyImage",{pure:true,propTypes:{src:types.string,src_set:types.string,width:types.number,height:types.number},getInitialState:function(){return{visible:false}},componentDidMount:function(){var el;el=ReactDOM.findDOMNode(this);return this.unbind_lazy_images=$(el).lazy_images({elements:[el],show_images:function(_this){return function(){var base;_this.setState({visible:true});return typeof(base=_this.props).on_reveal==="function"?base.on_reveal():void 0}}(this)})},componentWillUnmount:function(){return typeof this.unbind_lazy_images==="function"?this.unbind_lazy_images():void 0},render:function(){var ref,ref1;return img({className:classNames(this.props["class"],this.props.className,{lazy_loaded:this.state.loaded,lazy_visible:this.state.visible}),alt:this.props.alt,width:this.state.loaded?this.props.width:(ref=this.props.initial_width)!=null?ref:this.props.width,height:this.state.loaded?this.props.height:(ref1=this.props.initial_height)!=null?ref1:this.props.height,src:this.state.visible?this.props.src:void 0,srcSet:this.state.visible?this.props.src_set:void 0,onLoad:this.state.visible&&!this.state.loaded?function(_this){return function(){var base;_this.setState({loaded:true});return typeof(base=_this.props).on_load==="function"?base.on_load():void 0}}(this):void 0})}})})}).call(this);(function(){I.libs.react.done(function(){var P,PLATFORM_ICONS,PLATFORM_NAMES,_rdf,a,br,button,code,div,em,fieldset,form,fragment,h1,h2,h3,h4,h5,h6,iframe,img,input,label,legend,li,ol,optgroup,option,p,pre,section,select,span,strong,textarea,types,ul,slice=[].slice;_rdf=ReactDOMFactories;div=_rdf.div,span=_rdf.span,a=_rdf.a,br=_rdf.br,p=_rdf.p,ol=_rdf.ol,ul=_rdf.ul,li=_rdf.li,strong=_rdf.strong,em=_rdf.em,img=_rdf.img,form=_rdf.form,label=_rdf.label,input=_rdf.input,textarea=_rdf.textarea,button=_rdf.button,iframe=_rdf.iframe,h1=_rdf.h1,h2=_rdf.h2,h3=_rdf.h3,h4=_rdf.h4,h5=_rdf.h5,h6=_rdf.h6,pre=_rdf.pre,code=_rdf.code,select=_rdf.select,option=_rdf.option,section=_rdf.section,optgroup=_rdf.optgroup,fieldset=_rdf.fieldset,legend=_rdf.legend;fragment=React.createElement.bind(null,React.Fragment);fragment.type=React.fragment;P=R["package"]("Index");types=PropTypes;PLATFORM_ICONS={linux:"tux",osx:"apple",windows:"windows8",android:"android"};PLATFORM_NAMES={linux:"Linux",osx:"macOS",windows:"Windows",android:"Android"};P("PlatformList",{pure:true,getDefaultProps:function(){return{prefix:"Available for"}},render:function(){var j,len,name,out,ref;if(!(this.props.platforms&&this.props.platforms.length)){return null}out=[];ref=this.props.platforms;for(j=0,len=ref.length;j<len;j++){name=ref[j];if(out.length>0){out.push(" ")}out.push(span({key:name,className:"icon icon-"+PLATFORM_ICONS[name],title:this.props.prefix+" "+PLATFORM_NAMES[name]}))}return out}});P("StarRating",{propTypes:{average:types.number,count:types.number},pure:true,render:function(){var average,i;average=this.props.average||0;return div({className:"game_rating",title:"Average: "+average.toFixed(2)},div({className:"star_value"},div({className:"star_fill",style:{width:(average/5*100).toFixed(5)+"%"}},function(){var j,results;results=[];for(i=j=1;j<=5;i=++j){results.push(span({key:i,className:"star icon-star"}))}return results}()),div({className:"star_holes"},function(){var j,results;results=[];for(i=j=1;j<=5;i=++j){results.push(span({key:i,className:"star icon-star2"}))}return results}()))," ",span({className:"rating_count"},"("+I.format_integer(this.props.count)+")"))}});P("GameCell",{pure:true,getDefaultProps:function(){return{show_price:true,show_short_text:true,show_platforms:true,show_rating:true,show_cell_tools:true}},getInitialState:function(){return{game:this.build_game()}},componentDidUpdate:function(prev_props){if(prev_props.build_game_object!==this.props.build_game_object||prev_props.game!==this.props.game){return this.setState({game:this.build_game()})}},build_game:function(){if(this.props.build_game_object){return this.props.build_game_object(this.props.game)}else{return this.props.game}},add_to_collection:function(e){if(I.current_user){e.preventDefault();return I.Lightbox.open_remote("/game/collections/"+this.state.game.id,I.CollectionLightbox)}},mark_gif_loaded:function(){return this.setState({gif_loaded:true})},track_grid_referrer:function(){if(!this.props.grid_referrer){return}return I.ReferrerTracker.push("game",this.state.game.id,this.props.grid_referrer)},game_link:function(){var children,link_props,props;props=arguments[0],children=2<=arguments.length?slice.call(arguments,1):[];if(this.props.conversion_source){link_props=$.extend({object_type:1,object_id:this.state.game.id,source:this.props.conversion_source,on_click:this.props.grid_referrer?this.track_grid_referrer:void 0},props);return P.ConversionLink.apply(P,[link_props].concat(slice.call(children)))}return a.apply(null,[props].concat(slice.call(children)))},render_user:function(user,key){if(key==null){key=null}return a({key:key,className:"user_link",href:user.url,target:this.props.target},user.name)},render:function(){var b,base,base1,base2,cover_color,g,game,plat,platforms,r,ref,ref1,user;game=this.state.game;user=game.user;platforms=game.platforms?function(){var j,len,ref,results;ref=game.platforms;results=[];for(j=0,len=ref.length;j<len;j++){plat=ref[j];if(PLATFORM_ICONS[plat]){results.push(plat)}}return results}():void 0;cover_color=game.cover_color&&I.Color?(ref=I.Color.parse_color(game.cover_color),r=ref[0],g=ref[1],b=ref[2],ref,"rgba("+r+", "+g+", "+b+", 0.5)"):void 0;return this.enclose({"data-game_id":game.id,dir:"auto",className:"game_cell",onMouseEnter:this.state.game.gif_cover?function(_this){return function(){return _this.setState({hovering:true})}}(this):void 0,onMouseLeave:this.state.game.gif_cover?function(_this){return function(){return _this.setState({hovering:false})}}(this):void 0},div({className:"bordered",style:cover_color&&{backgroundColor:cover_color}},this.game_link({href:game.url,target:this.props.target,className:"game_thumb"},typeof(base=this.props).render_thumb_extras==="function"?base.render_thumb_extras(game):void 0,game.cover?P.LazyImage({src:game.cover}):div({className:"missing_image"},"no image :("),game.gif_cover?div({className:"gif_label"},"GIF"):void 0,((ref1=this.state)!=null?ref1.hovering:void 0)&&game.gif_cover?React.createElement(React.Fragment,{},!this.state.gif_loaded?div({className:"gif_loading_overlay"}):void 0,P.LazyImage({className:"gif_cover",src:game.gif_cover,on_load:this.mark_gif_loaded})):void 0),this.props.show_price&&game.sale_rate?div({className:classNames("sale_flag",{reverse_sale:game.sale_rate<0})},div({className:"rate"},Math.abs(game.sale_rate)+"%"),div({className:"mini_label"},game.sale_rate<0?"more":"off")):void 0,(platforms!=null?platforms.length:void 0)?div({className:"p_data fading_data"},P.PlatformList({platforms:platforms})):void 0,this.props.show_cell_tools?div({className:"fading_data cell_tools"},typeof(base1=this.props).render_cell_extras==="function"?base1.render_cell_extras(game):void 0,a({href:game.url+"/add-to-collection",title:this.t("add_to_collection.add_button"),className:"add_to_collection_btn",onClick:this.add_to_collection},span({className:"icon icon-playlist_add"}))):void 0),div({className:"label"},function(){if(this.props.show_price){switch(game.flag){case"free":return div({className:"meta_tag free_tag"},"Free");case"web":return div({className:"meta_tag free_tag"},"Web");case"demo":return div({className:"meta_tag demo_tag"},"Demo");default:if(game.price){return div({className:classNames("price_tag meta_tag")},game.price)}}}}.call(this),this.game_link({target:this.props.target,className:"title",title:game.title,href:game.url},game.title)),div({className:"user_row"},game.contributors?game.contributors.map(function(_this){return function(user,idx){if(idx>0){return fragment({key:"user-"+idx},", ",_this.render_user(user))}else{return _this.render_user(user,"user-"+idx)}}}(this)):this.render_user(user)),this.props.show_rating&&game.rating?P.StarRating(game.rating):void 0,game.tags&&game.tags.length?div({className:"sub cell_tags"},game.tags.map(function(_this){return function(tag,idx){return React.createElement(React.Fragment,{key:tag.name},idx>0?", ":void 0,a({href:tag.url,target:_this.props.target},"#"+tag.name))}}(this))):void 0,this.props.show_short_text?game.short_text?div({className:"sub short_text"},game.short_text):void 0:void 0,typeof(base2=this.props).render_cell_below==="function"?base2.render_cell_below(game):void 0)}});P("GameGrid",{calculate_cell_sizes:function(_this){return function(){var ref,ref1;return(ref=_this.grid_sizer_ref)!=null?(ref1=ref.current)!=null?ref1.calculate_cell_sizes():void 0:void 0}}(this),componentDidMount:function(){var container;container=this.container();if(this.props.enable_popups){return new I.GamePopups(container,{x_offset:10})}},getDefaultProps:function(){return{cell_width:I.is_mobile()?300:250,enable_popups:true,render_game:function(game){var cell_props;cell_props={render_thumb_extras:this.props.render_thumb_extras,render_cell_extras:this.props.render_cell_extras,render_cell_below:this.props.render_cell_below,key:game.id,game:game,build_game_object:this.props.build_game_object,conversion_source:this.props.conversion_source,grid_referrer:this.props.grid_referrer};if(this.props.cell_props){cell_props=$.extend(cell_props,this.props.cell_props)}return P.GameCell(cell_props)}}},render:function(){var props,ref;props={ref:this.grid_sizer_ref||(this.grid_sizer_ref=React.createRef()),cell_margin:10,expected_width:this.props.cell_width,fit_rows:this.props.fit_rows,children:(ref=this.props.games)!=null?ref.map(this.props.render_game.bind(this)):void 0};if(this.props.grid_sizer_props){props=$.extend(props,this.props.grid_sizer_props)}return this.enclose({},P.GridSizer(props))}});P("NewFromFollowers",{getInitialState:function(){return{games:this.props.games}},componentDidUpdate:function(prev_props,prev_state){var ref,ref1;if(((ref=prev_state.games)!=null?ref.length:void 0)!==((ref1=this.state.games)!=null?ref1.length:void 0)){return $(window).trigger("i:reshape")}},on_dismiss_games:function(e){var g,grid_sizer,ref,ref1,ref2,ref3,visible_games;if((ref=this.state)!=null?ref.loading:void 0){return}grid_sizer=(ref1=this.game_grid_ref)!=null?(ref2=ref1.current)!=null?(ref3=ref2.grid_sizer_ref)!=null?ref3.current:void 0:void 0:void 0;if(!grid_sizer){return}visible_games=this.state.games.slice(0,grid_sizer.get_num_visible());if(!visible_games.length){return}this.setState({loading:true});return $.post(this.props.dismiss_url,I.with_csrf({object_type:"game",object_id:function(){var j,len,results;results=[];for(j=0,len=visible_games.length;j<len;j++){g=visible_games[j];results.push(g.id)}return results}().join(",")})).done(function(_this){return function(res){return $.get(_this.props.more_results_url).done(function(more_games){return _this.setState({games:_.toArray(more_games.games),loading:false})})}}(this))},render_cell_extras:function(game){return button({type:"button",className:"dismiss_btn",onClick:function(_this){return function(){var g,remaining_games;remaining_games=function(){var j,len,ref,results;ref=this.state.games;results=[];for(j=0,len=ref.length;j<len;j++){g=ref[j];if(g!==game){results.push(g)}}return results}.call(_this);_this.setState({games:remaining_games});return $.post(_this.props.dismiss_url,I.with_csrf({object_type:"game",object_id:game.id})).done(function(res){return _this.fetch_more_if_necessary()})}}(this)},"Dismiss")},fetch_more_if_necessary:function(){var grid,ref,ref1,ref2;if(this.state.loading){return}if(this.state.exhausted){return}grid=(ref=this.game_grid_ref)!=null?(ref1=ref.current)!=null?(ref2=ref1.grid_sizer_ref)!=null?ref2.current:void 0:void 0:void 0;if(!grid){return}if(!(grid.get_max_num_visible()>grid.get_num_visible())){return}this.setState({loading:true});return $.get(this.props.more_results_url).done(function(_this){return function(more_games){more_games=_.toArray(more_games!=null?more_games.games:void 0);return _this.setState({exhausted:more_games.length<grid.get_max_num_visible(),games:more_games,loading:false})}}(this))},render_dismiss_button:function(){var games;games=this.state.games;if(!games.length){return}return button({className:"button outline",type:"button",onClick:this.on_dismiss_games},this.state.games.length>1?"Dismiss these":"Dismiss")},render:function(){var ref;if(!this.state.games.length){return null}return this.enclose({className:classNames({loading:(ref=this.state)!=null?ref.loading:void 0})},div({className:"header_split"},div({},div({className:"section_header"},h2({},"New From Those You Follow")),p({className:"section_description"},"Projects from those you follow that you haven't seen yet.")),this.render_dismiss_button()),P.GameGrid({ref:this.game_grid_ref||(this.game_grid_ref=React.createRef()),games:this.state.games,fit_rows:this.props.fit_rows,conversion_source:this.props.conversion_source,grid_referrer:this.props.grid_referrer,render_cell_extras:this.render_cell_extras}))}})})}).call(this);(function(){I.libs.react.done(function(){var P,_rdf,a,br,button,code,div,em,fieldset,form,fragment,h1,h2,h3,h4,h5,h6,id_incr,iframe,img,input,label,legend,li,ol,optgroup,option,p,pre,section,select,span,strong,textarea,types,ul;_rdf=ReactDOMFactories;div=_rdf.div,span=_rdf.span,a=_rdf.a,br=_rdf.br,p=_rdf.p,ol=_rdf.ol,ul=_rdf.ul,li=_rdf.li,strong=_rdf.strong,em=_rdf.em,img=_rdf.img,form=_rdf.form,label=_rdf.label,input=_rdf.input,textarea=_rdf.textarea,button=_rdf.button,iframe=_rdf.iframe,h1=_rdf.h1,h2=_rdf.h2,h3=_rdf.h3,h4=_rdf.h4,h5=_rdf.h5,h6=_rdf.h6,pre=_rdf.pre,code=_rdf.code,select=_rdf.select,option=_rdf.option,section=_rdf.section,optgroup=_rdf.optgroup,fieldset=_rdf.fieldset,legend=_rdf.legend;fragment=React.createElement.bind(null,React.Fragment);fragment.type=React.fragment;P=R["package"]("Index");types=PropTypes;id_incr=0;P("GridSizer",{propTypes:{children:types.array},getInitialState:function(){return{element_id:this.enclosing_class_name()+"_"+id_incr++}},getDefaultProps:function(){return{cell_margin:20,min_width:0,expected_width:315,min_columns:1,crop_on_resize:true}},componentDidMount:function(){_.defer(function(_this){return function(){return _this.calculate_cell_sizes()}}(this));this.resize_callback=_.debounce(function(_this){return function(){return _this.calculate_cell_sizes()}}(this),250);return $(window).on("resize",this.resize_callback)},componentWillUnmount:function(){this.unmounted=true;return $(window).off("resize",this.resize_callback)},componentDidUpdate:function(prev_props){if(prev_props.children!==this.props.children){return _.defer(function(_this){return function(){return _this.calculate_cell_sizes()}}(this))}},calculate_cell_sizes:function(recurse){var calculated_width,container_width,new_width,num_cells,real_num_cells,real_width;if(recurse==null){recurse=false}if(this.unmounted){return}container_width=this.get_width();if(this.state.container_width===container_width){return}real_width=this.props.expected_width+this.props.cell_margin;calculated_width=container_width+this.props.cell_margin;num_cells=calculated_width/real_width;real_num_cells=Math.ceil(num_cells);if(real_num_cells<this.props.min_columns){real_num_cells=this.props.min_columns}new_width=calculated_width/real_num_cells-this.props.cell_margin;new_width=Math.floor(new_width);if(new_width<this.props.min_width&&real_num_cells>1){real_num_cells-=1;new_width=calculated_width/real_num_cells-this.props.cell_margin;new_width=Math.floor(new_width)}this.setState({container_width:container_width,cell_width:new_width,cells_per_row:real_num_cells},this.props.on_reshape);if(recurse===false){return _.defer(function(_this){return function(){return _this.calculate_cell_sizes(true)}}(this))}},get_width:function(){var el,fraction_el,out,r,ref;el=this.container();fraction_el=(ref=el[0])!=null?ref.getBoundingClientRect().width:void 0;r=fraction_el-Math.floor(fraction_el);out=Math.floor(el.width());if(r>0){out-=1}return out},get_max_num_visible:function(){if(this.props.fit_rows&&this.state.cells_per_row){return this.state.cells_per_row*this.props.fit_rows}},get_num_visible:function(){var num_children;num_children=this.props.children.length;if(this.props.fit_rows&&this.state.cells_per_row){return Math.min(num_children,this.state.cells_per_row*this.props.fit_rows)}else{return num_children}},get_visible_children:function(){var children;children=this.props.children;if(this.props.fit_rows&&this.state.cells_per_row){children=children.slice(0,this.state.cells_per_row*this.props.fit_rows)}return children},render:function(){var children,container_style,sizer_fixed_width;children=this.get_visible_children();container_style=this.props.crop_on_resize?{overflowX:"hidden"}:void 0;sizer_fixed_width=this.props.crop_on_resize?{width:this.state.container_width+"px"}:void 0;return this.enclose({id:this.state.element_id,component:this.props.component,style:container_style},this.state.container_width?React.createElement(this.props.component||"div",{className:"grid_sizer_children",style:sizer_fixed_width},children):void 0,this.state.cell_width?React.createElement("style",{type:"text/css",dangerouslySetInnerHTML:{__html:"#"+this.state.element_id+" > .grid_sizer_children > * {\n  display: inline-block;\n  vertical-align: top;\n  width: "+this.state.cell_width+"px;\n  margin-right: "+this.props.cell_margin+"px;\n}\n\n#"+this.state.element_id+" > .grid_sizer_children > *:nth-child("+this.state.cells_per_row+"n) {\n  margin-right: 0;\n}"}}):void 0)}})})}).call(this);(function(){var extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;I.DashboardPurchaseLightbox=function(superClass){extend(DashboardPurchaseLightbox,superClass);function DashboardPurchaseLightbox(){return DashboardPurchaseLightbox.__super__.constructor.apply(this,arguments)}DashboardPurchaseLightbox.prototype.init=function(){this.el.has_tooltips();return this.el.dispatch("click",{show_download_btn:function(_this){return function(btn){return _this.el.toggleClass("show_download_group")}}(this)})};return DashboardPurchaseLightbox}(I.Lightbox)}).call(this);(function(){var MIN_GCS_CHUNK_SIZE,ResumableUploader,min,bind=function(fn,me){return function(){return fn.apply(me,arguments)}},extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty,slice=[].slice;MIN_GCS_CHUNK_SIZE=262144;min=function(_this){return function(a,b){if(a<b){return a}else{return b}}}(this);ResumableUploader=function(){function ResumableUploader(url,user_data){if(user_data==null){user_data={}}this.process_queue=bind(this.process_queue,this);this.push_chunk=bind(this.push_chunk,this);this.close=bind(this.close,this);this.write=bind(this.write,this);this.user_data=user_data;this.upload_url=url;this.chunk_size=MIN_GCS_CHUNK_SIZE;this.buf=new Uint8Array(this.chunk_size);this.offset=0;this.chunks=[];this.chunk_offset=0;this.total_size="*";this.closed=false}ResumableUploader.prototype.write=function(buf){var buf_offset,buf_remaining,copied,results,sl;buf_offset=0;buf_remaining=buf.byteLength;results=[];while(buf_remaining>0){copied=min(this.chunk_size-this.offset,buf_remaining);sl=buf.slice(buf_offset,buf_offset+copied);buf_offset+=copied;buf_remaining-=copied;this.buf.set(sl,this.offset);this.offset+=copied;if(this.offset===this.chunk_size){this.push_chunk(this.buf.slice());results.push(this.offset=0)}else{results.push(void 0)}}return results};ResumableUploader.prototype.close=function(){this.total_size=this.chunk_offset+this.offset;this.closed=true;return this.push_chunk(this.buf.slice(0,this.offset))};ResumableUploader.prototype.push_chunk=function(buf){var end,len,start;len=buf.byteLength;start=this.chunk_offset;end=start+len-1;this.chunks.push({range:"bytes "+start+"-"+end+"/"+this.total_size,data:buf});this.chunk_offset+=len;return this.process_queue()};ResumableUploader.prototype.process_queue=function(){var chunk,xhr;if(this.pending){return}chunk=this.chunks.shift();if(chunk){this.pending=true;xhr=new XMLHttpRequest;xhr.addEventListener("load",function(_this){return function(){_this.pending=false;console.log("chunk "+chunk.range+" sent!");if(_this.chunks.length){return setTimeout(function(){return _this.process_queue()},1)}else if(_this.closed){return typeof _this.on_complete==="function"?_this.on_complete():void 0}}}(this));xhr.open("PUT",this.upload_url);xhr.setRequestHeader("Content-Range",chunk.range);console.log("sending out ",chunk.range);return xhr.send(chunk.data)}};return ResumableUploader}();I.DashboardGameUploadChannelLightbox=function(superClass){extend(DashboardGameUploadChannelLightbox,superClass);function DashboardGameUploadChannelLightbox(){this.status=bind(this.status,this);this.make_diff=bind(this.make_diff,this);this.create_build_files=bind(this.create_build_files,this);this.download_signature=bind(this.download_signature,this);this.get_signature_url=bind(this.get_signature_url,this);this.list_build_files=bind(this.list_build_files,this);this.do_upload=bind(this.do_upload,this);this.on_container=bind(this.on_container,this);this.hopla_loaded=bind(this.hopla_loaded,this);this.init=bind(this.init,this);return DashboardGameUploadChannelLightbox.__super__.constructor.apply(this,arguments)}DashboardGameUploadChannelLightbox.prototype.init=function(options){var check_if_loaded;console.log("Got options",options);this.channel_name=options.channel_name;this.game=options.game;this.status_el=this.el.find("p.status");this.archive_input=this.el.find("input.archive-input");this.folder_input=this.el.find("input.folder-input");this.el.dispatch("click",{btn_pick_archive:function(_this){return function(){return _this.archive_input.click()}}(this),btn_pick_directory:function(_this){return function(){return _this.folder_input.click()}}(this),btn_upload_build:function(_this){return function(){return _this.do_upload()}}(this)});check_if_loaded=function(_this){return function(){console.log("Waiting for hopla to load...");if(window.Hopla){_this.hopla_loaded();_this.el.addClass("loaded");return setTimeout(function(){return _this.el.find(".loading_lightbox").remove()},500)}else{return setTimeout(check_if_loaded,200)}}}(this);return check_if_loaded()};DashboardGameUploadChannelLightbox.prototype.hopla_loaded=function(){console.log("Hopla loaded!");window.Hopla(this.archive_input[0],function(_this){return function(container){return _this.on_container(container)}}(this));return window.Hopla(this.folder_input[0],function(_this){return function(container){return _this.on_container(container)}}(this))};DashboardGameUploadChannelLightbox.prototype.on_container=function(container){var check_if_loaded;this.el.find(".btn_pick").addClass("disabled");this.container=container;check_if_loaded=function(_this){return function(){console.log("Waiting for wharf to load...");if(window.Wharf){_this.el.find(".btn_upload_build").removeClass("disabled");return _this.status("Ready when you are!")}else{return setTimeout(check_if_loaded,200)}}}(this);return check_if_loaded()};DashboardGameUploadChannelLightbox.prototype.do_upload=function(){if(!this.container){return alert("Please select a .zip file or directory first!")}this.status("Creating new build...");return $.ajax({method:"post",url:"/api/1/me/wharf/builds",data:{game_id:this.game.id,channel:this.channel_name},success:function(_this){return function(res){console.log(res);if(res.errors){throw res.errors.join(", ")}_this.build_id=res.build.id;return _this.list_build_files(res.build.parent_build.id)}}(this)})};DashboardGameUploadChannelLightbox.prototype.list_build_files=function(parent_build_id){this.status("Seeking signature ",parent_build_id);return $.ajax({method:"get",url:"/api/1/me/wharf/builds/"+parent_build_id+"/files",success:function(_this){return function(res){var signature_file;console.log(res);if(res.errors){throw res.errors.join(", ")}signature_file=_.findWhere(res.files,{type:"signature",sub_type:"default"});return _this.get_signature_url(parent_build_id,signature_file.id)}}(this)})};DashboardGameUploadChannelLightbox.prototype.get_signature_url=function(parent_build_id,file_id){this.status("Getting signature url",parent_build_id,file_id);return $.ajax({method:"get",url:"/api/1/me/wharf/builds/"+parent_build_id+"/files/"+file_id+"/download",success:function(_this){return function(res){console.log(res);return _this.download_signature(res.url)}}(this)})};DashboardGameUploadChannelLightbox.prototype.download_signature=function(download_url){var xhr;this.status("Downloading signature",download_url);xhr=new XMLHttpRequest;xhr.addEventListener("load",function(_this){return function(){var sigbytes;if(xhr.status!==200){_this.status("Error while downloading signature: ",xhr.statusCode,xhr.statusText);return}sigbytes=xhr.response;_this.status("Downloaded ",I.format_bytes(sigbytes.byteLength),"signature");return _this.create_build_files(sigbytes)}}(this));xhr.open("GET",download_url);xhr.responseType="arraybuffer";return xhr.send()};DashboardGameUploadChannelLightbox.prototype.create_build_files=function(sigbytes){var on_created,uploaders;uploaders={};on_created=function(_this){return function(type,file){uploaders[type]=new ResumableUploader(file.upload_url,file);if(uploaders.patch&&uploaders.signature){console.log("Both uploaders ready!");return _this.make_diff(sigbytes,uploaders)}}}(this);return _.each(["patch","signature"],function(_this){return function(type){return $.ajax({method:"post",url:"/api/1/me/wharf/builds/"+_this.build_id+"/files",data:{type:type,sub_type:"gzip",upload_type:"resumable"},success:function(res){console.log(res);if(res.errors){throw res.errors.join(", ")}return on_created(type,res.file)}})}}(this))};DashboardGameUploadChannelLightbox.prototype.make_diff=function(sigbytes,uploaders){var on_upload_complete,on_upload_validated,opts,validated;validated={};on_upload_validated=function(_this){return function(type){validated[type]=true;console.log(type+" validated!");if(validated.patch&&validated.signature){return _this.status("Hey, you did it!")}}}(this);on_upload_complete=function(_this){return function(type,uploader){console.log(type+" completed!");return $.ajax({method:"post",url:"/api/1/me/wharf/builds/"+_this.build_id+"/files/"+uploader.user_data.id,data:{size:uploader.total_size},success:function(res){console.log(res);if(res.errors){throw res.errors.join(", ")}return on_upload_validated(type)}})}}(this);_.each(uploaders,function(_this){return function(uploader,type){console.log("Setting up complete hook for "+type);return uploader.on_complete=function(){return on_upload_complete(type,uploader)}}}(this));opts={onMessage:function(_this){return function(level,msg){return _this.status(msg)}}(this),onProgress:function(_this){return function(alpha){return document.title=(alpha*100).toFixed(2)+"% done"}}(this),onPatchWrite:function(_this){return function(buf){return uploaders.patch.write(new Uint8Array(buf))}}(this),onSignatureWrite:function(_this){return function(buf){return uploaders.signature.write(new Uint8Array(buf))}}(this),onComplete:function(_this){return function(){uploaders.patch.close();uploaders.signature.close();return document.title="complete!"}}(this)};return Wharf.diff(sigbytes,this.container,opts)};DashboardGameUploadChannelLightbox.prototype.status=function(){var args;args=1<=arguments.length?slice.call(arguments,0):[];return this.status_el.text(args.map(function(_this){return function(x){return""+x}}(this)).join(" "))};return DashboardGameUploadChannelLightbox}(I.Lightbox)}).call(this);(function(){var extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;I.DashboardGameChannelLightbox=function(superClass){extend(DashboardGameChannelLightbox,superClass);function DashboardGameChannelLightbox(){return DashboardGameChannelLightbox.__super__.constructor.apply(this,arguments)}DashboardGameChannelLightbox.prototype.init=function(data){return this.el.dispatch("click",{channel_upload_btn:function(_this){return function(){return I.Lightbox.open_remote(_this.el.data("upload_lightbox_url"),I.DashboardGameUploadChannelLightbox,data)}}(this)})};return DashboardGameChannelLightbox}(I.Lightbox)}).call(this);
