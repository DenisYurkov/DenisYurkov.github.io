(function(){var calculate_offset,bind=function(fn,me){return function(){return fn.apply(me,arguments)}},extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;if(typeof I!=="undefined"&&I!==null?I.Grapher:void 0){return}calculate_offset=function(el,parent){var offset_parent,ox,oy,ref,ref1,x,y;ref=el.offset(),x=ref.left,y=ref.top;offset_parent=parent.offsetParent();if(!offset_parent.is("html")){ref1=offset_parent.offset(),ox=ref1.left,oy=ref1.top;x-=ox;y-=oy}return[Math.floor(x),Math.floor(y)]};I.Grapher=function(){Grapher.format_number=I.format_integer;Grapher.prototype.chart_svg_class="chart";Grapher.prototype.margin_left=40;Grapher.prototype.margin_bottom=30;Grapher.prototype.margin_right=30;Grapher.prototype.margin_top=20;Grapher.prototype.dot_hitbox_w=30;Grapher.prototype.dot_hitbox_h=120;Grapher.prototype.axis_spacing=8;Grapher.prototype.axis_graph_padding=10;Grapher.prototype.popup_template='<div class="graph_popup">\n  <div class="popup_date">{{ date }}</div>\n  <div class="popup_label">{{ label }}</div>\n</div>';Grapher.prototype.default_opts={label:"Count",y_axis_padding:1.3,min_y:10,x_ticks:10,fit_dots:false};function Grapher(el,data1,opts){var ref,ref1,ref2,ref3;this.data=data1;this.increment_date=bind(this.increment_date,this);this.list_range=bind(this.list_range,this);this.get_range=bind(this.get_range,this);this.format_y_axis=bind(this.format_y_axis,this);this.get_y_scaled=bind(this.get_y_scaled,this);this.get_x_scaled=bind(this.get_x_scaled,this);this.get_y=bind(this.get_y,this);this.get_x=bind(this.get_x,this);this.popup_date=bind(this.popup_date,this);this.axis_offsets=bind(this.axis_offsets,this);if(!this.data){this.data=opts.graph_counts}if(!this.data){throw"No data for graph"}this.el=$(el);this.opts=$.extend({},this.default_opts,opts);this.margin_left=(ref=this.opts.margin_left)!=null?ref:this.margin_left;this.margin_bottom=(ref1=this.opts.margin_bottom)!=null?ref1:this.margin_bottom;this.margin_top=(ref2=this.opts.margin_top)!=null?ref2:this.margin_top;this.margin_right=(ref3=this.opts.margin_right)!=null?ref3:this.margin_right;this.draw();this.setup_popups()}Grapher.prototype.popup_position=function(hitbox){return calculate_offset(hitbox.prev("circle"),this.el)};Grapher.prototype.get_template=function(name){var base;if(name==null){name="poup_template"}this._templates||(this._templates={});(base=this._templates)[name]||(base[name]=_.template(this[name]));return this._templates[name]};Grapher.prototype.setup_popups=function(){var current_popup,el,remove_popup,toggle_popup;current_popup=null;remove_popup=function(popup){if(!popup){return}return popup.stop(true,true).remove()};toggle_popup=_.debounce(function(_this){return function(state,hitbox){var h,pad,popup,ref,template,w,x,y;hitbox=$(hitbox);if(!hitbox.data("popup")){return}switch(state){case"show":template=_this.get_template(hitbox.data("popup_template")||"popup_template");popup=hitbox.data("popup_el");if(current_popup!=null?current_popup.is(popup):void 0){return}remove_popup(current_popup);if(!popup){popup=$(template(hitbox.data("popup")));hitbox.data("popup_el",popup)}current_popup=popup;current_popup.appendTo(_this.el).hide().fadeIn("fast");ref=_this.popup_position(hitbox),x=ref[0],y=ref[1];pad=5;w=current_popup.outerWidth();h=current_popup.outerHeight();current_popup.css({left:x-w-pad+"px",top:y-h-pad+"px"});return typeof _this.on_show_popup==="function"?_this.on_show_popup(current_popup,hitbox):void 0;case"hide":remove_popup(current_popup);if(typeof _this.on_hide_popup==="function"){_this.on_hide_popup(current_popup,hitbox)}return current_popup=null}}}(this),30);el=this.svg.node();el.addEventListener("mouseover",function(_this){return function(e){var ref;if((ref=e.target.getAttribute("class"))!=null?ref.match(/\bhitbox\b/):void 0){return toggle_popup("show",e.target)}}}(this));return el.addEventListener("mouseout",function(_this){return function(e){var ref;if((ref=e.target.getAttribute("class"))!=null?ref.match(/\bhitbox\b/):void 0){return toggle_popup("hide",e.target)}}}(this))};Grapher.prototype.draw=function(){var cls,data,ref,ref1,ref2,ref3,ref4,target_height,target_width,x,y;target_width=(ref=this.opts.width)!=null?ref:this.el.width();target_height=(ref1=this.opts.height)!=null?ref1:this.el.height();this.w=target_width/((ref2=this.opts.scale)!=null?ref2:1);this.h=target_height/((ref3=this.opts.scale)!=null?ref3:1);this.time_format=d3.time.format("%Y-%m-%d");cls=this.chart_svg_class;if(this.opts["class"]){cls+=" "+this.opts["class"]}this.svg=d3.select(this.el[0]).append("svg").attr("class",cls).attr("width",(ref4=this.opts.width)!=null?ref4:"100%").attr("height",target_height).attr("viewBox","0 0 "+this.w+" "+this.h);data=this.format_data();x=this._x_scale=this.x_scale(data);y=this._y_scale=this.y_scale(data);this.draw_guides(x,y);this.draw_area(data);this.draw_axis(x,y);this.draw_dots(data);return this.draw_label()};Grapher.prototype.guide_x_range=function(x,y){return x.range()};Grapher.prototype.draw_guides=function(x,y){var gx,gy,ref,y_guides;y_guides=this.svg.append("g").attr("class","y_guides");ref=this.guide_x_range(x,y),gx=ref[0],gy=ref[1];y_guides.selectAll("line").data(y.ticks(this.y_ticks())).enter().append("line").attr("x1",gx).attr("y1",y).attr("x2",gy).attr("y2",y);if(x.ticks){return this.svg.append("g").attr("class","x_guides").selectAll("line").data(x.ticks(this.x_ticks())).enter().append("line").attr("x1",x).attr("y1",y.range()[0]).attr("x2",x).attr("y2",y.range()[1])}};Grapher.prototype.axis_offsets=function(){return[0,0]};Grapher.prototype.draw_axis=function(x,y){var left,ox,oy,ref,x_axis,y_axis;y_axis=d3.svg.axis().scale(y).orient("left").tickFormat(this.format_y_axis).ticks(this.y_ticks());left=x.domain()[0];ref=this.axis_offsets(),ox=ref[0],oy=ref[1];this.svg.append("g").attr("transform","translate("+(this._x_scale(left)+ox-this.axis_spacing)+", 0)").attr("class","y_axis axis").call(y_axis);x_axis=d3.svg.axis().scale(x).orient("bottom").ticks(this.x_ticks());return this.svg.append("g").attr("transform","translate(0, "+(y.range()[0]+oy+this.axis_spacing)+")").attr("class","x_axis axis").call(x_axis)};Grapher.prototype.draw_area=function(data){var area,line_style;line_style=this.opts.line_style||"area";area=function(){switch(line_style){case"area":return d3.svg.area().x(this.get_x_scaled).y1(this.get_y_scaled).y0(this.h-this.margin_bottom);case"line":return d3.svg.line().x(this.get_x_scaled).y(this.get_y_scaled);default:throw"Unknown line style: "+line_style}}.call(this);return this.svg.append("g").attr("class","graph").append("path").attr("class",line_style).attr("d",area(data))};Grapher.prototype.draw_label=function(){var label;label=this.svg.append("g").attr("class","label").attr("transform","translate("+this.margin_left+", 10)");label.append("circle").attr("cx",0).attr("cy",-5).attr("r",4);return label.append("text").text(this.opts.label).attr("x",10)};Grapher.prototype.draw_dots=function(data,opts){var hitbox_h,hitbox_w,popups,ref;if(opts==null){opts={}}if(this.opts.show_dots===false){return}data=this.filter_dots_data(data);if(this.list_range().length>((ref=this.opts.max_dots)!=null?ref:60)){return}popups=this.svg.append("g").attr("class","popups").selectAll("g").data(data).enter().append("g").attr("class","popup_trigger");hitbox_w=this.dot_hitbox_w;hitbox_h=this.dot_hitbox_h;popups.append("circle").attr("class","dot_outline").attr("cx",this.get_x_scaled).attr("cy",this.get_y_scaled).attr("r",6);popups.append("circle").attr("class","dot").attr("cx",this.get_x_scaled).attr("cy",this.get_y_scaled).attr("r",4);return popups.append("rect").attr("class",function(_this){return function(d){var base,c;c="column_dot hitbox";if(typeof(base=_this.opts).column_url==="function"?base.column_url(d):void 0){c+=" link"}return c}}(this)).attr("transform","translate(-"+hitbox_w/2+", -"+hitbox_h/2+")").attr("x",this.get_x_scaled).attr("y",this.get_y_scaled).attr("width",hitbox_w).attr("height",hitbox_h).attr("data-popup",function(_this){return function(d){return JSON.stringify({date:_this.popup_date.apply(_this,arguments),label:_this.popup_label.apply(_this,arguments)})}}(this))};Grapher.prototype.filter_dots_data=function(data){var can_fit,dots_to_fit,i,real_w,subset,take_every;if(this.opts.fit_dots){real_w=this.w-this.margin_left-this.margin_right-this.axis_graph_padding;can_fit=Math.floor(real_w/this.dot_hitbox_w);if(data.length>can_fit){dots_to_fit=Math.floor((real_w-this.dot_hitbox_w*2)/this.dot_hitbox_w);take_every=Math.floor((data.length-2)/dots_to_fit);subset=function(){var j,ref,ref1,results;results=[];for(i=j=1,ref=data.length-2,ref1=take_every;ref1>0?j<=ref:j>=ref;i=j+=ref1){results.push(data[i])}return results}();subset.push(data[data.length-1]);subset.unshift(data[1]);return subset}}return data};Grapher.prototype.popup_label=function(d){var val;val=this.opts.rate?I.number_format(this.get_y(d),4)+"%":I.number_format(this.get_y(d));return this.opts.label+": "+val};Grapher.prototype.popup_date=function(d){return d.date};Grapher.prototype.get_x=function(d){return this.time_format.parse(d.date)};Grapher.prototype.get_y=function(d){if(this.opts.rate){return d.count*100}else{return d.count}};Grapher.prototype.get_x_scaled=function(){return this._x_scale(this.get_x.apply(this,arguments))};Grapher.prototype.get_y_scaled=function(){return this._y_scale(this.get_y.apply(this,arguments))};Grapher.prototype.format_y_axis=function(num){if(this.opts.rate){if(num<10&&num!==0){return I.number_format(num,1)+"%"}else{return I.number_format(num)+"%"}}else{return I.Grapher.format_number(num)}};Grapher.prototype.x_ticks=function(){return this.opts.x_ticks};Grapher.prototype.y_ticks=function(){if(this.opts.rate){return 5}else{return Math.min(5,this.opts.min_y)}};Grapher.prototype.get_range=function(){var format,left,new_left,offset,out,right,today;if(this.opts.interval!=="data"){if(this.opts.range_left){format=d3.time.format("%Y-%m-%d");out=[format.parse(this.opts.range_left),format.parse(this.opts.range_right)];if(this.opts.interval==="weekly"&&this.data[0]){format=d3.time.format("%Y-%m-%d");left=out[0];new_left=format.parse(this.data[0].date);while(new_left>left){new_left=d3.time.day.offset(new_left,-7)}return[new_left,out[1]]}return out}if(this.opts.num_days){today=d3.time.day(new Date);offset=this.opts.day_offset||0;left=d3.time.day.offset(today,-(this.opts.num_days+offset-1));right=d3.time.day.offset(today,-offset);return[left,right]}}format=d3.time.format("%Y-%m-%d");if(this.data.length<2){throw"Data is too small to get range"}return[format.parse(this.data[0].date),format.parse(this.data[this.data.length-1].date)];throw"Don't know how to calculate range"};Grapher.prototype.map_range=function(fn){var date,format,left,ref,res,results,right,t,val;if(this.opts.interval==="data"){format=d3.time.format("%Y-%m-%d");res=function(){var j,len,ref,results;ref=this.data;results=[];for(j=0,len=ref.length;j<len;j++){date=ref[j].date;val=fn(format.parse(date));if(!val){continue}results.push(val)}return results}.call(this);return res}ref=this.get_range(),left=ref[0],right=ref[1];t=left;results=[];while(t<=right){val=fn(t);t=this.increment_date(t);if(!val){continue}results.push(val)}return results};Grapher.prototype.list_range=function(){var out;out=[];this.map_range(function(d){return out.push(d)});return out};Grapher.prototype.increment_date=function(t){if(this.opts.interval==="weekly"){return d3.time.day.offset(t,7)}else{return d3.time.day.offset(t,1)}};Grapher.prototype.format_data=function(){var counts_by_date,j,len,ref,v;counts_by_date={};ref=this.data;for(j=0,len=ref.length;j<len;j++){v=ref[j];counts_by_date[v.date]=v}return this.map_range(function(_this){return function(t){var formatted;formatted=_this.time_format(t);return counts_by_date[formatted]||{count:0,date:formatted}}}(this))};Grapher.prototype.x_scale=function(data){var left,ref,right;ref=this.get_range(),left=ref[0],right=ref[1];return d3.time.scale().domain([left,right]).rangeRound([this.margin_left+this.axis_graph_padding,this.w-this.margin_right])};Grapher.prototype.y_scale=function(data){var axis_max_y,max,out,out_range,p;max=d3.max(data,this.get_y)||0;p=this.opts.y_axis_padding||1.3;out_range=[this.h-this.margin_bottom,this.margin_top];axis_max_y=this.opts.rate?Math.min(100,Math.max(.5,Math.floor(max*10*p)/10)):Math.max(this.opts.min_y,Math.floor((max+1)*p));out=d3.scale.linear().domain([0,axis_max_y]);if(this.opts.rate){return out.range(out_range)}else{return out.rangeRound(out_range)}};return Grapher}();I.MoneyGrapher=function(superClass){extend(MoneyGrapher,superClass);function MoneyGrapher(){this.format_y_axis=bind(this.format_y_axis,this);return MoneyGrapher.__super__.constructor.apply(this,arguments)}MoneyGrapher.prototype.format_y_axis=function(num){var dollars;dollars=this.opts.currency==="JPY"?num:num/100;if(dollars>9){Math.floor(dollars)}return(I.currency_symbols[this.opts.currency]||"$")+I.Grapher.format_number(dollars)};MoneyGrapher.prototype.popup_label=function(d){return this.opts.label+": "+I.format_money(d.sum,this.opts.currency)};return MoneyGrapher}(I.Grapher);I.CumulativeGraph=function(superClass){extend(CumulativeGraph,superClass);function CumulativeGraph(){this.get_range=bind(this.get_range,this);this.get_y=bind(this.get_y,this);return CumulativeGraph.__super__.constructor.apply(this,arguments)}CumulativeGraph.prototype.default_opts={label:"Amount",min_y:100,x_ticks:8,fit_dots:true,min_range:7,currency:"USD",y_axis_padding:1.3};CumulativeGraph.prototype.get_y=function(d){return d.sum};CumulativeGraph.prototype.get_range=function(){var first,format,last,range_ago;format=d3.time.format("%Y-%m-%d");first=this.data[0];last=this.data[this.data.length-1];first=format.parse(first.date);last=format.parse(last.date);range_ago=d3.time.day.offset(last,-this.opts.min_range);if(range_ago<first){first=range_ago}return[first,last]};CumulativeGraph.prototype.format_data=function(){var by_date,j,last,len,ref,v;by_date={};ref=this.data;for(j=0,len=ref.length;j<len;j++){v=ref[j];by_date[v.date]=v}last=0;return this.map_range(function(_this){return function(t){var formatted,ref1;formatted=_this.time_format(t);last=((ref1=by_date[formatted])!=null?ref1.sum:void 0)||last;return{sum:last,date:formatted}}}(this))};return CumulativeGraph}(I.MoneyGrapher);I.BarGrapher=function(superClass){extend(BarGrapher,superClass);function BarGrapher(){this.get_x=bind(this.get_x,this);return BarGrapher.__super__.constructor.apply(this,arguments)}BarGrapher.prototype.chart_svg_class="chart bar_chart";BarGrapher.prototype.dot_hitbox_w=20;BarGrapher.prototype.dot_hitbox_h=20;BarGrapher.prototype.bar_spacing=5;BarGrapher.prototype.is_ordinal=function(){return this.opts.interval==="ordinal"};BarGrapher.prototype.x_field=function(){if(this.is_ordinal()){return"label"}else{return"date"}};BarGrapher.prototype.popup_date=function(d){return d[this.x_field()]};BarGrapher.prototype.get_x=function(d){if(this.is_ordinal()){return d[this.x_field()]}else{return BarGrapher.__super__.get_x.call(this,d)}};BarGrapher.prototype.format_data=function(){if(this.is_ordinal()){return this.data}else{return BarGrapher.__super__.format_data.call(this)}};BarGrapher.prototype.axis_offsets=function(){return[-Math.floor(this.bar_width()/2),0]};BarGrapher.prototype.map_range=function(fn){var j,len,ref,results,tuple;if(this.is_ordinal()){ref=this.data;results=[];for(j=0,len=ref.length;j<len;j++){tuple=ref[j];results.push(fn(tuple[this.x_field()]))}return results}else{return BarGrapher.__super__.map_range.call(this,fn)}};BarGrapher.prototype.get_range=function(){if(this.is_ordinal()){return[this.data[0][this.x_field()],this.data[this.data.length-1][this.x_field()]]}else{return BarGrapher.__super__.get_range.call(this)}};BarGrapher.prototype.bar_width=function(){var bl,br;switch(this.opts.interval||"daily"){case"weekly":bl=this.get_range()[0];br=d3.time.day.offset(bl,7);break;case"daily":bl=this.get_range()[0];br=d3.time.day.offset(bl,1);break;case"data":bl=this.time_format.parse(this.data[0][this.x_field()]);br=this.time_format.parse(this.data[1][this.x_field()]);break;case"ordinal":bl=this.data[0][this.x_field()];br=this.data[1][this.x_field()]}return this._x_scale(br)-this._x_scale(bl)};BarGrapher.prototype.guide_x_range=function(x,y){var a,b,bw,range,ref;if(this.is_ordinal()){range=x.range();a=range[0];b=range[range.length-1]}else{ref=x.range(),a=ref[0],b=ref[1]}bw=this.bar_width();return[a-bw/2,b+bw/2]};BarGrapher.prototype.x_scale=function(data){var available_width,bar_width,bars,bh,d,j,keys,left,left_date,len,ref,right,right_date,tuple;left=this.margin_left+this.axis_graph_padding;right=this.w-this.margin_right;if(this.is_ordinal()){keys=[];ref=this.data;for(j=0,len=ref.length;j<len;j++){tuple=ref[j];keys.push(tuple[this.x_field()])}return d3.scale.ordinal().domain(keys).rangePoints([left,right])}else{bars=this.list_range();left_date=bars[0];right_date=bars[bars.length-1];available_width=right-left;d=d3.time.scale().domain([left_date,right_date]);bar_width=available_width/bars.length;bh=bar_width/2;return d.rangeRound([left+bh,right-bh])}};BarGrapher.prototype.draw_area=function(data){var bar_width,bars,colors,x_centered;if(this.opts.line_style==="line"){return BarGrapher.__super__.draw_area.call(this,data)}bar_width=this.bar_width();x_centered=function(_this){return function(d){var x;x=_this.get_x_scaled(d);return x-(bar_width-_this.bar_spacing)/2}}(this);bars=this.svg.append("g").attr("class","bars").selectAll("rect").data(data).enter().append("rect").attr("x",x_centered).attr("y",this.get_y_scaled).attr("width",bar_width-this.bar_spacing).attr("height",function(_this){return function(d){return _this._y_scale(0)-_this.get_y_scaled(d)}}(this));if(this.opts.colors){colors=d3.scale.ordinal().range(this.opts.colors);colors=colors.domain(this._x_scale.domain());bars=bars.attr("fill",function(_this){return function(d){return colors(d[_this.x_field()])}}(this))}return bars};return BarGrapher}(I.Grapher);I.StackedBarGrapher=function(superClass){extend(StackedBarGrapher,superClass);StackedBarGrapher.prototype.chart_svg_class="chart bar_chart stacked_bar_chart";StackedBarGrapher.prototype.bar_popup_template='<div class="graph_popup">\n  <div class="popup_date">{{ date }}</div>\n  <div class="popup_group">{{ group }}</div>\n  <div class="popup_label">{{ label }}</div>\n</div>';function StackedBarGrapher(){this.on_hide_popup=bind(this.on_hide_popup,this);this.on_show_popup=bind(this.on_show_popup,this);this.popup_group=bind(this.popup_group,this);StackedBarGrapher.__super__.constructor.apply(this,arguments);if(this.opts.group_url){$(this.svg.node()).on("click","[data-game_id]",function(_this){return function(e){var id,url;id=$(e.target).data("game_id");url=_this.opts.group_url({game_id:id});if(!url){return}return window.location=url}}(this))}if(this.opts.column_url){$(this.svg.node()).on("click",".column_dot[data-popup]",function(_this){return function(e){var data,url;data=$(e.target).data("popup");url=_this.opts.column_url(data);if(!url){return}return window.location=url}}(this))}}StackedBarGrapher.prototype.secondary_field=function(){return this.opts.secondary_field||"game_id"};StackedBarGrapher.prototype.get_y=function(d){return d.max};StackedBarGrapher.prototype.x_ticks=function(){if(this.opts.interval==="weekly"){if(this.list_range().length<15){return d3.time.monday}}return StackedBarGrapher.__super__.x_ticks.call(this)};StackedBarGrapher.prototype.popup_group=function(d){return d[this.secondary_field()]};StackedBarGrapher.prototype.bar_popup_label=function(d){var val;val=I.number_format(d.max-d.min);return this.opts.label+": "+val};StackedBarGrapher.prototype.format_data=function(){var counts_by_date,j,len,ref,v;counts_by_date={};ref=this.data;for(j=0,len=ref.length;j<len;j++){v=ref[j];counts_by_date[v.date]=v}return this.map_range(function(_this){return function(t){var count,formatted,idx,last_sum,stacks,sum,tuple,x;formatted=_this.time_format(t);tuple=counts_by_date[formatted];if(!tuple){return{date:formatted,min:0,max:0,stacks:[]}}sum=0;stacks=function(){var k,len1,ref1,results;ref1=tuple.counts;results=[];for(idx=k=0,len1=ref1.length;k<len1;idx=++k){count=ref1[idx];last_sum=sum;sum+=count.count;x={cap:sum===tuple.count,date:tuple.date,min:last_sum,max:sum};x[this.secondary_field()]=count[this.secondary_field()];results.push(x)}return results}.call(_this);if(!(tuple.count>0)){return}return{date:tuple.date,min:0,max:tuple.count,stacks:stacks}}}(this))};StackedBarGrapher.prototype.popup_position=function(hitbox){return calculate_offset(hitbox,this.el)};StackedBarGrapher.prototype.on_show_popup=function(popup,hitbox){var current_bars,game_bars,secondary_id;secondary_id=hitbox.data(this.secondary_field());if(!secondary_id){this.on_hide_popup();return}this.el.addClass("highlighting_bar");game_bars=this.el.find(".game_bar");current_bars=game_bars.filter("[data-"+this.secondary_field()+"='"+secondary_id+"']");game_bars.css({opacity:.1});return current_bars.css({opacity:""})};StackedBarGrapher.prototype.on_hide_popup=function(popup,hitbox){return this.el.removeClass("highlighting_bar").find(".game_bar").css({opacity:""})};StackedBarGrapher.prototype.draw_area=function(data){var bar_stack,bar_stacks,bar_width,colors,g,item,j,len,position_bars,secondary_ids,stack;bar_width=this.bar_width();colors=d3.scale.ordinal().range(this.opts.colors||["#F3596A","#D34D75","#AE4879","#864477","#5E406D","#39385E"]);data=data.filter(function(d){return d.min!==d.max});secondary_ids={};for(j=0,len=data.length;j<len;j++){item=data[j];secondary_ids[item[this.secondary_field()]]=true}secondary_ids=function(){var results;results=[];for(g in secondary_ids){results.push(+g)}return results}();colors=colors.domain(secondary_ids);stack=this.svg.append("g").attr("class","bars").selectAll("g").data(data).enter().append("g");position_bars=function(_this){return function(group,expand){if(expand==null){expand=0}return group.attr("x",function(d){var x;x=_this.get_x_scaled(d);return-expand+Math.floor(x-(bar_width-5)/2)}).attr("y",function(d){return _this._y_scale(d.max)-expand}).attr("width",bar_width-5+expand*2).attr("height",function(d){return 2*expand+Math.max(1,_this._y_scale(d.min)-_this._y_scale(d.max))})}}(this);bar_stack=stack.attr("class","bar_stack");position_bars(bar_stack.append("rect").attr("class","total_border"),1);position_bars(bar_stack.append("rect").attr("class","total_bar"));bar_stacks=stack.append("g").attr("class","game_counts").selectAll("rect").data(function(d){return d.stacks}).enter();position_bars(bar_stacks.append("rect").attr("class",function(_this){return function(d){var base,c;c="game_bar hitbox";if(typeof(base=_this.opts).group_url==="function"?base.group_url(d):void 0){c+=" link"}return c}}(this)).attr("data-"+this.secondary_field(),function(_this){return function(d){return d[_this.secondary_field()]}}(this)).attr("fill",function(_this){return function(d){return colors(d[_this.secondary_field()])}}(this)).attr("data-popup_template","bar_popup_template").attr("data-popup",function(_this){return function(d){return JSON.stringify({date:_this.popup_date.apply(_this,arguments),label:_this.bar_popup_label.apply(_this,arguments),group:(_this.opts.popup_group||_this.popup_group).apply(null,arguments)})}}(this)));return position_bars(bar_stacks.append("rect").attr("class","bar_border")).attr("height",function(d){if(d.cap){return 0}else{return 1}})};return StackedBarGrapher}(I.BarGrapher)}).call(this);(function(){I.libs.react.done(function(){var _rdf,a,br,button,code,div,em,fieldset,form,fragment,h1,h2,h3,h4,h5,h6,iframe,img,input,key_counter,label,legend,li,ol,optgroup,option,p,pre,section,select,span,strong,textarea,types,ul,slice=[].slice;_rdf=ReactDOMFactories;div=_rdf.div,span=_rdf.span,a=_rdf.a,br=_rdf.br,p=_rdf.p,ol=_rdf.ol,ul=_rdf.ul,li=_rdf.li,strong=_rdf.strong,em=_rdf.em,img=_rdf.img,form=_rdf.form,label=_rdf.label,input=_rdf.input,textarea=_rdf.textarea,button=_rdf.button,iframe=_rdf.iframe,h1=_rdf.h1,h2=_rdf.h2,h3=_rdf.h3,h4=_rdf.h4,h5=_rdf.h5,h6=_rdf.h6,pre=_rdf.pre,code=_rdf.code,select=_rdf.select,option=_rdf.option,section=_rdf.section,optgroup=_rdf.optgroup,fieldset=_rdf.fieldset,legend=_rdf.legend;fragment=React.createElement.bind(null,React.Fragment);fragment.type=React.fragment;key_counter=0;types=PropTypes;R.component("RowMover",{pure:true,render:function(){return this.enclose({},span({className:"mover_label"},"Move"),button({type:"button",className:"move_up_btn",disabled:this.props.first,onClick:this.props.move_up,title:"Move up"},R.Icons.TriUp),button({type:"button",className:"move_down_btn",disabled:this.props.last,onClick:this.props.move_down,title:"Move down"},R.Icons.TriDown))}});R.component("ListManager",{propTypes:{initial_items:types.array,on_list_update:types.func,empty_content:types.node,item_component:types.node},getInitialState:function(){var item;return{rows:function(){var i,len,ref,results;ref=_.toArray(this.props.initial_items);results=[];for(i=0,len=ref.length;i<len;i++){item=ref[i];results.push({item:item})}return results}.call(this)}},componentDidUpdate:function(props,state){var base,row;if(state.rows!==this.state.rows){if(typeof(base=this.props).on_list_update==="function"){base.on_list_update(function(){var i,len,ref,results;ref=this.state.rows;results=[];for(i=0,len=ref.length;i<len;i++){row=ref[i];results.push(row.item)}return results}.call(this))}}return this.state},replace_items:function(items){return this.setState({rows:items.map(function(_this){return function(item){return{item:item}}}(this))})},add:function(item,callback){return this.setState(function(_this){return function(state){return{rows:state.rows.concat([{item:item}])}}}(this),callback?function(_this){return function(){var i,len,ref,ref1,row;ref=_this.state.rows;for(i=0,len=ref.length;i<len;i++){row=ref[i];if(row.item===item){if(typeof callback==="function"){callback((ref1=row.ref)!=null?ref1.current:void 0)}return}}}}(this):void 0)},remove_item:function(item){return this.setState(function(_this){return function(state){var row;return{rows:function(){var i,len,ref,results;ref=state.rows;results=[];for(i=0,len=ref.length;i<len;i++){row=ref[i];if(row.item!==item){results.push(row)}}return results}()}}}(this))},find_row:function(item){var i,len,ref,row;ref=this.state.rows;for(i=0,len=ref.length;i<len;i++){row=ref[i];if(row.item===item){return row}}},update_all:function(callback){return this.setState(function(_this){return function(state){return{rows:state.rows.map(callback)}}}(this))},update_item:function(item,update){return this.update_all(function(_this){return function(row){var out;if(row.item===item){out=Object.assign({},row,{item:Object.assign({},row.item,update)});return out}else{return row}}}(this))},update_row:function(row,update,callback){var new_row,updater;new_row=Object.assign({},row,update);updater=function(_this){return function(state){var found_row,updated_rows;found_row=false;updated_rows=state.rows.map(function(r){if(r===row){found_row=true;return new_row}else{return r}});if(!found_row){console.warn("tried to update row that doesn't exist")}if(found_row){return{rows:updated_rows}}}}(this);this.setState(updater,callback);return new_row},move_item:function(item,dir){var animate_callback,before_left,before_top,el,ref,row;row=this.find_row(item);animate_callback=this.props.animate?(el=ReactDOM.findDOMNode(row.ref.current),ref=el.getBoundingClientRect(),before_top=ref.top,before_left=ref.left,ref,function(_this){return function(){var after_left,after_top,dx,dy,ref1,speed,styles;ref1=el.getBoundingClientRect(),after_top=ref1.top,after_left=ref1.left;dy=after_top-before_top;dx=after_left-before_left;speed=250;styles=[{position:"relative",transform:"translate("+-dx+"px, "+-dy+"px)",zIndex:"1"},{position:"relative",transition:"transform "+speed/1e3+"s ease",transform:"translate(0, 0)",zIndex:"1"},{}];return row=_this.update_row(row,{style:styles[0]},function(){return _.defer(function(){return row=_this.update_row(row,{style:styles[1]},function(){return setTimeout(function(){return _this.update_row(row,{style:styles[2]})},speed)})})})}}(this)):void 0;return this.setState(function(state){return{rows:I.move(state.rows,row,dir)}},animate_callback)},render:function(){var self;if(this.props.empty_content&&!this.state.rows.length){return this.props.empty_content}self=this;return this.state.rows.map(function(_this){return function(row,idx){var props;props={key:row.key||(row.key=row.item.id||"item-"+key_counter++),ref:row.ref||(row.ref=React.createRef()),position:idx,first:idx===0,last:idx===_this.state.rows.length-1,style:row.style,update:_this.props_update||(_this.props_update=function(){var r;r=self.state.rows[this.position];return self.update_item.apply(self,[r.item].concat(slice.call(arguments)))}),update_all:_this.props_update_all||(_this.props_update_all=function(fn){return self.update_all(function(_this){return function(rr){var updates;if(updates=fn(rr.item)){return Object.assign({},rr,{item:Object.assign({},rr.item,updates)})}else{return rr}}}(this))}),remove:_this.props_remove||(_this.props_remove=function(){var r;r=self.state.rows[this.position];return self.remove_item(r.item)}),move_up:_this.props_move_up||(_this.props_move_up=function(){var r;r=self.state.rows[this.position];return self.move_item(r.item,-1)}),move_down:_this.props_move_down||(_this.props_move_down=function(){var r;r=self.state.rows[this.position];return self.move_item(r.item,1)})};props[_this.props.item_name||"item"]=row.item;if(_this.props.item_props){Object.assign(props,_this.props.item_props(row.item,idx))}return _this.props.item_component(props)}}(this))}})})}).call(this);(function(){var AdminLightbox,extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;AdminLightbox=function(superClass){extend(AdminLightbox,superClass);function AdminLightbox(){return AdminLightbox.__super__.constructor.apply(this,arguments)}AdminLightbox.prototype.init=function(id,name){var input,url;this.el.find(".recipient").text(name).end();input=this.el.find(".admin_url");input.on("click",function(){return input.select()});url=_.template(input.data("url_template"))({user_id:id});return input.val(url)};return AdminLightbox}(I.Lightbox);I.AdminsForm=function(){function AdminsForm(el,opts){var form,match;this.opts=opts!=null?opts:{};this.el=$(el).remote_link(function(_this){return function(res){if(res.removed){if(res.is_self){return window.location="/dashboard"}else{return window.location.reload()}}}}(this));this.el.dispatch("click",{show_url_btn:function(_this){return function(btn){var row;row=btn.closest("tr");return I.Lightbox.open_tpl("admin_accept_lightbox",AdminLightbox,row.data("user_id"),row.data("user_name"))}}(this)});this.el.find(".field_toggle_input").on("change",function(_this){return function(e){var input,picker,row;input=$(e.target);picker=input.closest(".field_toggle");if(picker.is(".disabled")){return}picker.addClass("disabled");input.prop("disabled",true);row=input.closest("tr");return $.post("",I.with_csrf({json:true,action:"toggle_field",username:row.data("user_slug"),field:input.data("field"),enabled:""+input.prop("checked")}),function(res){input.prop("disabled",false);input.prop("checked",res[input.data("field")]);return picker.removeClass("disabled")})}}(this));if(match=window.location.search.match(/\bnew_admin=(\d+)/)){this.el.find("[data-user_id="+match[1]+"] .show_url_btn").click()}if(this.opts.async_add){form=this.el.find("form").remote_submit(function(_this){return function(res){if(res.errors){form.set_form_errors(res.errors);return}return I.Lightbox.open_tpl("admin_accept_lightbox",AdminLightbox,res.user_id,res.user_name)}}(this))}}return AdminsForm}()}).call(this);(function(){I.Dashboard=function(){function Dashboard(el,opts){var downloads,g,games,games_by_id,graph_left,graph_right,i,len,views;views=opts.views,downloads=opts.downloads,graph_left=opts.graph_left,graph_right=opts.graph_right,games=opts.games;games_by_id={};for(i=0,len=games.length;i<len;i++){g=games[i];games_by_id[g.id]=g}this.el=$(el);new I.FilterPickers(el,{label_padding:8});I.tracked_links(this.el,"my_games","click");if(views&&$("#views_graph").length){new I.StackedBarGrapher("#views_graph",views,{label:"Views",x_ticks:7,popup_group:function(d){var ref;return((ref=games_by_id[d.game_id])!=null?ref.title:void 0)||""},group_url:function(d){var ref;return(ref=games_by_id[d.game_id])!=null?ref.url:void 0},range_left:graph_left,range_right:graph_right})}if(downloads&&$("#downloads_graph").length){new I.StackedBarGrapher("#downloads_graph",downloads,{label:"Downloads",min_y:3,x_ticks:7,popup_group:function(d){var ref;return((ref=games_by_id[d.game_id])!=null?ref.title:void 0)||""},group_url:function(d){var ref;return(ref=games_by_id[d.game_id])!=null?ref.url:void 0},range_left:graph_left,range_right:graph_right})}this.el.format_timestamps("fromNow")}return Dashboard}()}).call(this);(function(){var RewardResponsesLightbox,bind=function(fn,me){return function(){return fn.apply(me,arguments)}};RewardResponsesLightbox=function(){function RewardResponsesLightbox(){this.init=bind(this.init,this)}RewardResponsesLightbox.prototype.init=function(){};return RewardResponsesLightbox}();I.DashboardGameClaimedRewards=function(){function DashboardGameClaimedRewards(el,opts){this.el=$(el);this.el.has_tooltips();new I.FilterPickers(this.el.find(".rewards_pagination_header"));this.el.dispatch("click",{purchase_info_btn:function(_this){return function(el,e){if(I.is_middle_click(e)){return"continue"}return I.Lightbox.open_remote(el.attr("href"),I.DashboardPurchaseLightbox)}}(this),reward_responses_btn:function(_this){return function(el,e){if(I.is_middle_click(e)){return"continue"}return I.Lightbox.open_remote(el.attr("href"),I.RewardResponsesLightbox)}}(this)});this.el.on("click",".fullfilled_toggle",function(_this){return function(e){var form,msg,setting;setting=e.target.checked;msg=setting?"Mark as fulfilled?":"Mark as unfulfilled?";if(!confirm(msg)){e.preventDefault();return}form=$(e.target).closest("form");return I.remote_submit(form)}}(this))}return DashboardGameClaimedRewards}()}).call(this);(function(){I.DashboardGameClassification=function(){function DashboardGameClassification(el,opts){this.opts=opts;I.event2("game classification");this.el=$(el);I.setup_selectize(this.el);this.setup_sliders();this.setup_mp();this.form=this.el.find("form").remote_submit(function(_this){return function(res,form){if(res.errors){form.set_form_errors(res.errors);return}form.set_form_errors([]);return I.flash("Changes saved")}}(this));I.setup_dirty_warning(this.form);this.setup_nsfw()}DashboardGameClassification.prototype.setup_nsfw=function(){var cw,cw_row,nsfw,nsfw_row,onChange;nsfw=this.form.find("input[name='data[nsfw]']");nsfw_row=nsfw.closest("li");if(this.opts.admin_nsfw){nsfw_row.addClass("disabled")}cw=this.form.find("input[name='data[content_warning]']");cw_row=cw.closest("li");onChange=function(_this){return function(){if(nsfw.prop("checked")||_this.opts.admin_nsfw){return cw_row.removeClass("disabled")}else{cw.prop("checked",false);return cw_row.addClass("disabled")}}}(this);nsfw.on("change",onChange);return onChange()};DashboardGameClassification.prototype.setup_sliders=function(){var input,legend,max,max_value,min,min_value,update_legend,update_value;input=this.el.find(".players_slider_input");legend=this.el.find(".players_slider_row .sub");min_value=this.el.find(".min_players_value");max_value=this.el.find(".max_players_value");min=parseInt(min_value.val(),10);max=parseInt(max_value.val(),10);update_legend=function(_this){return function(text){return legend.text(" — "+text)}}(this);update_value=function(_this){return function(vals){min_value.val(vals[0]);max_value.val(vals[1]);if(vals[0]===vals[1]){if(vals[0]===1){return update_legend(" This is a single-player game")}else{return update_legend(" Exactly "+vals[0]+" players can play on the same device")}}else{return update_legend(" Between "+vals[0]+" and "+vals[1]+" players can play on the same device")}}}(this);this.el.find(".players_slider").slider({range:true,min:1,max:16,values:[min,max],slide:function(_this){return function(e,ui){return update_value(ui.values)}}(this)});return update_value([min,max])};DashboardGameClassification.prototype.setup_mp=function(){var feature_picker,on_feature_change;feature_picker=this.el.find("input[name='data[multiplayer_features]']");on_feature_change=function(_this){return function(e){var has_local_mp,tags;tags=feature_picker.val().split(",");has_local_mp=tags.indexOf("local")>=0;return _this.el.toggleClass("with_local_multiplayer",has_local_mp)}}(this);feature_picker.on("change",on_feature_change);return on_feature_change()};return DashboardGameClassification}()}).call(this);(function(){I.DashboardGameConversionType=function(){function DashboardGameConversionType(el,opts){this.el=$(el);new I.StackedBarGrapher("#conversion_graph",opts.counts,{label:opts.label,secondary_field:"source",x_ticks:7,range_left:opts.stat_left,range_right:opts.stat_right,popup_group:function(d){return opts.groups[d.source]||""}})}return DashboardGameConversionType}()}).call(this);(function(){var extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;I.DashboardGameConversions=function(){function DashboardGameConversions(el,opts){var WideGraph;this.el=$(el);WideGraph=function(superClass){extend(WideGraph,superClass);function WideGraph(){return WideGraph.__super__.constructor.apply(this,arguments)}WideGraph.prototype.default_opts={range_left:opts.stat_left,range_right:opts.stat_right,x_ticks:7,min_y:10};return WideGraph}(I.Grapher);if(opts.counts.impression){new WideGraph("#impressions_graph",opts.counts.impression,{label:"Impressions"})}if(opts.counts.click){new WideGraph("#clicks_graph",opts.counts.click,{label:"Clicks",min_y:3})}if(opts.counts.download){new WideGraph("#downloads_graph",opts.counts.download,{label:"Downloads",min_y:3})}if(opts.counts.purchase){new WideGraph("#purchases_graph",opts.counts.purchase,{label:"Purchases",min_y:3})}}return DashboardGameConversions}()}).call(this);(function(){I.DashboardInvoicesNew=function(){function DashboardInvoicesNew(el,opts){this.el=$(el);I.datepicker($(".start_date, .end_date"));ReactDOM.render(R.Forms.FileUploader({label:"Upload invoice",upload_url:opts.upload_url,name:"invoice[upload_id]"}),this.el.find(".upload_drop")[0]);I.money_input(this.el.find(".amount_input"))}return DashboardInvoicesNew}()}).call(this);(function(){var bind=function(fn,me){return function(){return fn.apply(me,arguments)}};I.DashboardJamEditJamForm=function(){DashboardJamEditJamForm.prototype.date_format="yy-mm-dd";DashboardJamEditJamForm.prototype.time_format="HH:mm:ss";function DashboardJamEditJamForm(el,jam1){var content_input,ref;this.jam=jam1;this.setup_date_pickers=bind(this.setup_date_pickers,this);this.el=$(el);content_input=this.el.find(".content_input");if((ref=this.jam)!=null?ref.html_enabled:void 0){CodeMirror.fromTextArea(content_input[0],{mode:"htmlmixed",lineNumbers:true,tabSize:2})}else{I.redactor(content_input)}I.redactor(this.el.find(".submission_details_input"),{minHeight:80,buttons:["bold","italic","underline","deleted","unorderedlist","orderedlist","link"]});this.setup_date_pickers();this.setup_timezone();this.setup_type_picker();this.el.dispatch("click",{delete_jam_btn:function(_this){return function(btn){if(confirm("Are you sure you want to delete this jam? This can't be undone.")){btn.addClass("disabled");return $.ajax({type:"post",data:I.with_csrf(),url:btn.data("url"),success:function(res){return window.location=res.redirect_to||"/"}})}}}(this)});this.form=this.el.find("form").remote_submit(function(_this){return function(res){var ref1,ref2,ref3,url;if(res.errors){_this.render_errors(res.errors);return}if(!_this.jam){_this.set_jam(res.jam)}if(url=((ref1=res.jam)!=null?ref1.url:void 0)||_this.redirect_on_save){window.location=url}else{I.flash("Jam saved")}if((ref2=R.JamEdit.EditFields.edit_jam_fields)!=null){ref2.set_fields(res.fields||[])}return(ref3=R.JamEdit.EditCriteria.edit_jam_criteria)!=null?ref3.set_criteria(res.criteria||[]):void 0}}(this));I.slug_input(this.el.find(".slug_input"),this.el.find(".title_input"));I.setup_dirty_warning(this.form)}DashboardJamEditJamForm.prototype.save_jam=function(callback){return this.el.find("form").trigger("submit",[callback])};DashboardJamEditJamForm.prototype.render_errors=function(errors){return this.form.set_form_errors(errors,true,"There was a problem with your submission")};DashboardJamEditJamForm.prototype.setup_date_pickers=function(){var all_pickers,end_picker,start_picker,voting_end_picker;start_picker=this.el.find(".date_picker.start_date");end_picker=this.el.find(".date_picker.end_date");voting_end_picker=this.el.find(".date_picker.voting_end_date");all_pickers=this.el.find(".date_picker");return I.datetimepicker(all_pickers,{onSelect:function(val){}})};DashboardJamEditJamForm.prototype.setup_timezone=function(){var tz;tz=jstz.determine().name();this.el.find(".timezone_input").val(tz);return this.el.find(".timezone_label").text(tz)};DashboardJamEditJamForm.prototype.setup_type_picker=function(){this.type_picker=this.el.find(".jam_type_picker");return this.type_picker.on("change",function(_this){return function(e){var type;type=$(e.target).val();return _this.el.removeClass("type_ranked type_non_ranked").addClass("type_"+type)}}(this))};DashboardJamEditJamForm.prototype.set_jam=function(jam){var base,edit_url;if(edit_url=jam!=null?jam.edit_url:void 0){if(typeof(base=window.history).replaceState==="function"){base.replaceState({},"Edit jam",edit_url)}}return this.jam=jam};DashboardJamEditJamForm.prototype.with_jam=function(fn,fail_fn){if(this.jam){return typeof fn==="function"?fn(this.jam):void 0}else{return this.save_jam(function(_this){return function(res){if(res.errors){_this.render_errors(res.errors);alert("Please fix the errors before uploading an image");if(typeof fail_fn==="function"){fail_fn()}return}_this.set_jam(res.jam);_this.form.attr("action",_this.jam.edit_url);_this.redirect_on_save=_this.jam.url;return typeof fn==="function"?fn():void 0}}(this))}};return DashboardJamEditJamForm}()}).call(this);(function(){I.DashboardJamEntryDownloads=function(){function DashboardJamEntryDownloads(el){this.el=$(el);this.setup_downloads()}DashboardJamEntryDownloads.prototype.setup_downloads=function(){return this.el.dispatch("click",{upload_download_btn:function(_this){return function(btn){return $.ajax({url:btn.data("href"),type:"post",data:I.with_csrf(),success:function(res){var err;if(res.errors){err=res.errors.join(", ");alert(err);return}return window.location=res.url}})}}(this)})};return DashboardJamEntryDownloads}()}).call(this);(function(){var bind=function(fn,me){return function(){return fn.apply(me,arguments)}},extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;I.DashboardJamParticipants=function(){function DashboardJamParticipants(el,opts){var Graph;if(opts==null){opts={}}this.el=$(el);new I.FilterPickers(el);if(opts.participants_graph){Graph=function(superClass){extend(Graph,superClass);function Graph(){this.get_y=bind(this.get_y,this);return Graph.__super__.constructor.apply(this,arguments)}Graph.prototype.get_y=function(d){return d.sum};Graph.prototype.format_data=I.CumulativeGraph.prototype.format_data;return Graph}(I.Grapher);new Graph("#participants_graph",opts.participants_graph,{label:"Cumulative participants",range_left:opts.graph_left,range_right:opts.graph_right,x_ticks:7,min_y:10})}}return DashboardJamParticipants}()}).call(this);(function(){I.DashboardJamSubmissions=function(){function DashboardJamSubmissions(el){this.el=$(el);this.setup_late_submit_form();this.el.dispatch("click",{remove_game_btn:function(_this){return function(btn){var jam_game;jam_game=btn.closest(".jam_game");if(jam_game.is(".loading")){return}if(!confirm("Are you sure you want to remove this submission?")){return}jam_game.addClass("loading");return $.post(btn.data("href"),I.with_csrf(),function(res){return jam_game.slideUp(function(){return jam_game.remove()})})}}(this)})}DashboardJamSubmissions.prototype.setup_late_submit_form=function(){this.late_submit=this.el.find(".late_submit_form");return this.late_submit.remote_submit(function(_this){return function(res){I.Lightbox.open(R.JamEdit.LateSubmitLightbox(res));if(!res.errors){return _this.late_submit.find(".game_url_input").val("")}}}(this))};return DashboardJamSubmissions}()}).call(this);(function(){I.DashboardPayout=function(){function DashboardPayout(el){this.el=$(el);this.el.has_tooltips()}return DashboardPayout}()}).call(this);(function(){var extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;I.BankAccountLightbox=function(superClass){extend(BankAccountLightbox,superClass);function BankAccountLightbox(){return BankAccountLightbox.__super__.constructor.apply(this,arguments)}BankAccountLightbox.prototype.init=function(){var form,type_picker,update_type;form=this.el.find("form");type_picker=this.el.find(".type_picker");update_type=function(_this){return function(){var i,len,ref,results,selected,t;ref=["individual","business"];results=[];for(i=0,len=ref.length;i<len;i++){t=ref[i];selected=type_picker.val()===t;_this.el.toggleClass("is_"+t,selected);results.push(_this.el.find(".for_"+t+" input").prop("disabled",!selected))}return results}}(this);update_type();type_picker.on("change",update_type);return form.remote_submit(function(_this){return function(res){if(res.errors){form.set_form_errors(res.errors);return}return window.location.reload()}}(this),function(_this){return function(){var account_number,errors,routing_number;account_number=form.find(".account_number_input").val();routing_number=form.find(".routing_number_input").val();errors=[];if(!Stripe.bankAccount.validateRoutingNumber(routing_number,"US")){errors.push("Invalid routing number")}if(!Stripe.bankAccount.validateAccountNumber(account_number,"US")){errors.push("Invalid account number")}if(errors.length){form.set_form_errors(errors);return false}return true}}(this))};return BankAccountLightbox}(I.Lightbox);I.DashboardPayouts=function(){function DashboardPayouts(el,opts){this.opts=opts;this.el=$(el);this.el.find(".initiate_payout_form").remote_submit(function(_this){return function(res){if(res.success){if(res.redirect_to){window.location=res.redirect_to}else{window.location.reload()}}if(res.errors){return _this.el.find("#error_drop").text(res.errors[0])}}}(this));this.el.has_tooltips();this.el.dispatch("click",{bank_btn:function(_this){return function(btn){return I.Lightbox.open_tpl("bank_account_lightbox",I.BankAccountLightbox)}}(this)})}return DashboardPayouts}()}).call(this);(function(){I.DashboardPurchaseList=function(){function DashboardPurchaseList(el){this.el=$(el);this.el.dispatch("click",{purchase_info_btn:function(_this){return function(el){return I.Lightbox.open_remote(el.attr("href"),I.DashboardPurchaseLightbox)}}(this)})}return DashboardPurchaseList}()}).call(this);(function(){var EarningsGraph,PurchasesGraph,bind=function(fn,me){return function(){return fn.apply(me,arguments)}},extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;I.DashboardPurchases=function(){function DashboardPurchases(el,opts){var currency,earnings,ref;this.el=$(el);this.el.has_tooltips();if(opts.purchases_graph&&$("#purchases_graph").length){new PurchasesGraph("#purchases_graph",opts.purchases_graph,{label:"Payments",min_y:3,unit:opts.unit,left:opts.graph_left,right:opts.graph_right})}if(opts.earnings_graph){ref=opts.earnings_graph;for(currency in ref){earnings=ref[currency];el="#earnings_graph_"+currency;if(!$(el).length){continue}new EarningsGraph(el,earnings,{label:currency+" gross revenue",min_y:3,currency:currency,unit:opts.unit,left:opts.graph_left,right:opts.graph_right})}}}return DashboardPurchases}();PurchasesGraph=function(superClass){extend(PurchasesGraph,superClass);function PurchasesGraph(){this.get_range=bind(this.get_range,this);return PurchasesGraph.__super__.constructor.apply(this,arguments)}PurchasesGraph.prototype.default_opts={num_days:30,x_ticks:7,min_y:10,unit:"daily"};PurchasesGraph.prototype.get_range=function(){var format;format=d3.time.format("%Y-%m-%d");return[format.parse(this.opts.left),format.parse(this.opts.right)]};PurchasesGraph.prototype.increment_date=function(t){if(this.opts.unit==="monthly"){return d3.time.month.offset(t,1)}else{return d3.time.day.offset(t,1)}};return PurchasesGraph}(I.Grapher);EarningsGraph=function(superClass){extend(EarningsGraph,superClass);function EarningsGraph(){this.get_range=bind(this.get_range,this);this.format_data=bind(this.format_data,this);this.popup_date=bind(this.popup_date,this);this.get_y=bind(this.get_y,this);return EarningsGraph.__super__.constructor.apply(this,arguments)}EarningsGraph.prototype.default_opts={label:"Amount",min_y:100,x_ticks:8};EarningsGraph.prototype.get_y=function(d){return d.sum};EarningsGraph.prototype.popup_date=function(d){var format;format=d3.time.format("%Y-%m-%d");d3.time.format("%B %Y")(format.parse(d.date));return d.date};EarningsGraph.prototype.format_data=function(){var by_date,i,len,ref,v;by_date={};ref=this.data;for(i=0,len=ref.length;i<len;i++){v=ref[i];by_date[v.date]=v}return this.map_range(function(_this){return function(t){var formatted,ref1;formatted=_this.time_format(t);return{sum:((ref1=by_date[formatted])!=null?ref1.sum:void 0)||0,date:formatted}}}(this))};EarningsGraph.prototype.get_range=function(){var format;format=d3.time.format("%Y-%m-%d");return[format.parse(this.opts.left),format.parse(this.opts.right)]};EarningsGraph.prototype.increment_date=function(t){if(this.opts.unit==="monthly"){return d3.time.month.offset(t,1)}else{return d3.time.day.offset(t,1)}};return EarningsGraph}(I.MoneyGrapher)}).call(this);(function(){I.DashboardToolGames=function(){function DashboardToolGames(el,opts){this.el=$(el);new I.FilterPickers(this.el);this.el.dispatch("click",{edit_tags_btn:function(_this){return function(btn){return I.Lightbox.open(R.Dashboard.ToolGameTagsLightbox({game:btn.data("game"),tool:opts.tool,url:btn.data("href"),selected_tags:_.toArray(btn.data("tags")),on_save:function(res){btn.data("tags",res.selected_tags);return I.Lightbox.close()}}))}}(this)})}return DashboardToolGames}()}).call(this);(function(){var ExternalFileUpload,FileUpload,ImageUpload,ScreenshotUpload,SlurpFileUpload,Upload,UploadDescriptionLightbox,get_template,lazy_template,upload_error,bind=function(fn,me){return function(){return fn.apply(me,arguments)}},extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty,slice=[].slice;upload_error=function(uploader,msg){if(msg==="title must be provided"){msg="Please enter a title for your game first"}if(msg){return I.flash(msg,"error")}};Upload=I.Upload,ImageUpload=I.ImageUpload,get_template=I.get_template,lazy_template=I.lazy_template;UploadDescriptionLightbox=function(superClass){extend(UploadDescriptionLightbox,superClass);function UploadDescriptionLightbox(){this.init=bind(this.init,this);return UploadDescriptionLightbox.__super__.constructor.apply(this,arguments)}UploadDescriptionLightbox.prototype.init=function(uploader){var input,name,uploader_input;name=uploader.find(".upload_display_name").text();this.el.find(".upload_name").text(name);uploader_input=uploader.find(".description_input");input=this.el.find(".description_input").val(uploader_input.val());I.redactor(input,{minHeight:100});return this.el.dispatch("click",{save_description_btn:function(_this){return function(btn){uploader_input.val(input.val());return I.Lightbox.close()}}(this)})};return UploadDescriptionLightbox}(I.Lightbox);FileUpload=function(superClass){extend(FileUpload,superClass);FileUpload.prototype.kind="upload";FileUpload.type_to_extension={flash:/^swf$/,unity:/^unity3d$/,java:/^jar$/,html:/^zip|html$/};FileUpload.get_extension=function(filename){var m;if(!filename){return}m=filename.match(/\.(\w+)$/);return m!=null?m[1].toLowerCase():void 0};function FileUpload(editor,file1,opts1){var ref,ref1;this.editor=editor;this.file=file1;this.opts=opts1!=null?opts1:{};this.cancel_upload=bind(this.cancel_upload,this);if(this.opts.upload){this.upload=this.opts.upload;this.state="ready"}else{this.state="uploading";this.upload={filename:(ref=this.file)!=null?ref.name:void 0,size:(ref1=this.file)!=null?ref1.size:void 0}}}FileUpload.prototype.have_upload_data=function(){var j,len,ref,ref1,replace_id,results,upload;this.upload.id=this.upload_data.upload_id;if(replace_id=this.upload_data.replaced_upload_id){I.event("upload","replace","replaced");ref=this.editor.game.uploads;results=[];for(j=0,len=ref.length;j<len;j++){upload=ref[j];if(replace_id===((ref1=upload.upload)!=null?ref1.id:void 0)){upload.remove();this.upload=upload.upload;this.upload.id=this.upload_data.upload_id;this.editor.render_uploads();break}else{results.push(void 0)}}return results}};FileUpload.prototype.after_save=function(){this.state="ready";return this.editor.render_uploads()};FileUpload.prototype.valid_for_embed=function(){var extension,pattern;if(!(this.upload&&this.upload.filename)){return false}pattern=FileUpload.type_to_extension[this.editor.get_type()];extension=FileUpload.get_extension(this.upload.filename);return extension&&pattern&&pattern.test(extension)};FileUpload.prototype.progress=function(sent,total){this.progress_percent=Math.round(sent/total*100);return this.editor.render_uploads()};FileUpload.prototype.cancel_upload=function(upload,msg,action){if(action==="remove"){this.remove()}else{this.state="failed"}return this.editor.render_uploads()};FileUpload.prototype.save_upload=function(fn){if(!this.upload_data){return}return $.ajax({url:this.upload_data.success_url,data:I.with_csrf(),type:"post",success:function(_this){return function(res){var err_msg;if(res.errors){err_msg=res.errors.join(", ");I.event("upload_error","file",err_msg);upload_error(_this,err_msg);_this.cancel_upload();return}_this.after_save();return typeof fn==="function"?fn.apply(null,[_this].concat(slice.call(arguments))):void 0}}(this)})};FileUpload.prototype.remove=function(){var idx,j,len,ref,results,upload;ref=this.editor.game.uploads;results=[];for(idx=j=0,len=ref.length;j<len;idx=++j){upload=ref[idx];if(upload===this){this.editor.game.uploads.splice(idx,1);results.push(this.editor.render_uploads())}else{results.push(void 0)}}return results};FileUpload.prototype.delete_upload=function(fn){if(!this.upload){return}this.remove();return $.ajax({url:"/uploads/"+this.upload.id,type:"delete",data:I.with_csrf(),success:fn})};return FileUpload}(Upload);SlurpFileUpload=function(superClass){extend(SlurpFileUpload,superClass);SlurpFileUpload.prototype.ping_time=1e3;function SlurpFileUpload(){var ref,ref1;SlurpFileUpload.__super__.constructor.apply(this,arguments);this.state="uploading";this.upload={filename:(ref=this.file)!=null?ref.name:void 0,size:(ref1=this.file)!=null?ref1.bytes:void 0}}SlurpFileUpload.prototype.start_upload=function(fn,fail_fn){var req;if(this.upload_data){return}this.progress(1,1);req=$.post(this.editor.upload_prefix()+"/upload/slurp",I.with_csrf({filename:this.file.name,kind:"upload",url:this.file.link}));req.done(function(_this){return function(res){if(res.errors){I.event("upload_error","slurp_file",res.errors.join(", "));alert(res.errors.join(", "));_this.cancel_upload();return typeof fail_fn==="function"?fail_fn(_this):void 0}else{_this.upload_data=res;if(typeof _this.have_upload_data==="function"){_this.have_upload_data()}return _this.poll_for_completion(fn)}}}(this));return req.fail(function(_this){return function(){I.event("upload_error","slurp_file","slurp server error");_this.cancel_upload();return typeof fail_fn==="function"?fail_fn(_this):void 0}}(this))};SlurpFileUpload.prototype.poll_for_completion=function(fn,fail_fn){var req;req=$.get(this.editor.upload_prefix()+"/upload/slurp/"+this.upload_data.upload_id);req.done(function(_this){return function(res){if(res.deleted){_this.cancel_upload();if(typeof fail_fn==="function"){fail_fn(_this)}return}if(res.ready){_this.state="ready";_this.editor.render_uploads();return}return setTimeout(function(){_this.ping_time=Math.min(_this.ping_time+100,3e3);return _this.poll_for_completion(fn)},_this.ping_time)}}(this));return req.fail(function(_this){return function(){I.event("upload_error","slurp_file","poll server error");_this.cancel_upload();return typeof fail_fn==="function"?fail_fn(_this):void 0}}(this))};return SlurpFileUpload}(FileUpload);ExternalFileUpload=function(superClass){extend(ExternalFileUpload,superClass);function ExternalFileUpload(){this.load_upload=bind(this.load_upload,this);ExternalFileUpload.__super__.constructor.apply(this,arguments);this.upload.external=true;this.upload.just_created=true;this.progress_percent=100}ExternalFileUpload.prototype.load_upload=function(upload_data){this.upload.id=upload_data.upload_id;this.state="ready";return this.editor.render_uploads()};return ExternalFileUpload}(FileUpload);ScreenshotUpload=function(superClass){extend(ScreenshotUpload,superClass);ScreenshotUpload.prototype.label="screenshot";ScreenshotUpload.prototype.template=lazy_template(ScreenshotUpload,"screenshot_uploader");ScreenshotUpload.prototype.success_params={type:"screenshot",thumb_size:"editor_preview"};function ScreenshotUpload(){ScreenshotUpload.__super__.constructor.apply(this,arguments);this.el=$(this.template(this));this.progress_inner=this.el.find(".progress_inner")}ScreenshotUpload.prototype.progress=function(sent,total){var p,ref;p=Math.round(100*sent/total);return(ref=this.progress_inner)!=null?ref.css("right",100-p+"%"):void 0};return ScreenshotUpload}(ImageUpload);I.EditGame=function(){EditGame.FileUpload=FileUpload;function EditGame(el,game,opts1){var other_save;this.game=game;this.opts=opts1;this.refresh_has_download=bind(this.refresh_has_download,this);this.render_uploads=bind(this.render_uploads,this);this.render_links=bind(this.render_links,this);this.render_tags=bind(this.render_tags,this);this.render_access_control=bind(this.render_access_control,this);this.render_price_picker=bind(this.render_price_picker,this);this.render_embed_options=bind(this.render_embed_options,this);this.render_cover_uploader=bind(this.render_cover_uploader,this);this.state={};this.user_slug=this.opts.user_slug;this.is_new=!this.game.id;this.el=$(el);this.el.has_tooltips();this.setup_uploader();this.setup_type_picker();this.setup_screenshots();this.setup_redactor();this.setup_slug_picker();this.setup_classification_picker();if(this.opts.enable_dropbox){this.setup_dropbox()}this.render_tags();this.render_links();this.render_access_control();this.render_price_picker();this.render_embed_options();this.render_cover_uploader();I.setup_selectize(this.el);other_save=this.el.find(".header_nav").find(".save_btn").on("click",function(_this){return function(){return _this.form.find(".save_btn").trigger("click")}}(this));this.form=this.el.find("form").remote_submit(function(_this){return function(res,form){var base,edit_url;if(res.game){$.extend(_this.game,res.game);if(edit_url=res.game.edit_url){if(typeof(base=window.history).replaceState==="function"){base.replaceState({},"Edit project",edit_url)}}_this.form.attr("action",_this.game_prefix())}if(res.errors){I.Lightbox.open(R.GameEdit.ErrorLightbox({errors:res.errors,sub_text:"Please correct the errors and try again"}));if(_this.game_deferred){_this.game_deferred.reject(res.errors)}return}if(_this.game_deferred){return _this.game_deferred.resolve(_this.game)}else if(_this.is_new){if(_this.game.url){return window.location=_this.game.url}}else{return I.flash("Saved")}}}(this));this.form.on("i:before_submit",function(_this){return function(){return other_save.prop("disabled",true).addClass("disabled")}}(this));this.form.on("i:after_submit",function(_this){return function(){return other_save.prop("disabled",false).removeClass("disabled")}}(this));I.setup_dirty_warning(this.form,function(_this){return function(){if(_.any(_this.game.uploads,function(u){return u.state==="uploading"})){return"There are uploads in progress."}else{return _this.form.data("dirty")}}}(this));R.dispatch(this.el,{"game:set_state":function(_this){return function(event,state){_this.state=$.extend(_this.state,state);_this.render_uploads();_this.render_price_picker();_this.render_tags();_this.render_embed_options();return _this.render_cover_uploader()}}(this),"game:update_upload":function(_this){return function(event,file){return _this.refresh_has_download()}}(this)});this.el.dispatch("click",{external_file_btn:function(_this){return function(btn){var upload;upload=new ExternalFileUpload(_this);_this.append_upload(upload);return _this.prepare_upload(function(){return I.prepare_upload(_this.upload_prefix(),{kind:"upload",storage:"external"},function(data){return upload.load_upload(data)})},function(){return upload.cancel_upload()})}}(this),upload_from_url_btn:function(_this){return function(btn){return I.Lightbox.open(R.GameEdit.UploadUrlLightbox({on_url:function(url,filename){var slurp;slurp=new SlurpFileUpload(_this,{link:url,name:filename});slurp.start_upload();return _this.append_upload(slurp)}}))}}(this),delete_game_btn:function(_this){return function(btn){if(_this.opts.delete_blocked){I.Lightbox.open(R.GameEdit.DeleteBlockedLightbox({}));return}if(confirm("Are you sure you want to delete this game?")){btn.addClass("disabled");return $.ajax({type:"post",data:I.with_csrf(),url:btn.data("url"),success:function(res){return window.location=res.redirect_to||"/"}})}}}(this)})}EditGame.prototype.setup_dropbox=function(){var button;if(window.Dropbox==null){return}button=Dropbox.createChooseButton({linkType:"direct",multiselect:true,success:function(_this){return function(files){return _this.with_game(function(){var file,j,len,results,slurp;I.event("upload","dropbox","slurp");results=[];for(j=0,len=files.length;j<len;j++){file=files[j];slurp=new SlurpFileUpload(_this,file);slurp.start_upload();results.push(_this.append_upload(slurp))}return results})}}(this)});return this.el.find(".upload_buttons .dropbox_drop").append(button)};EditGame.prototype.make_upload_button=function(btn){var ref;if(window.FormData&&!((ref=window.location.hash)!=null?ref.match(/\bold_uploader=1\b/):void 0)){I.make_upload_button.apply(I,[this].concat(slice.call(arguments)));return btn.addClass("has_multi_upload")}else{return I.make_popup_upload_button.apply(I,[this].concat(slice.call(arguments)))}};EditGame.prototype.setup_slug_picker=function(){return I.slug_input(this.el.find(".slug_input"),this.el.find(".title_input"))};EditGame.prototype.setup_redactor=function(){var j,len,ref,results,textarea;if(this.opts.enable_codemirror){ref=this.el.find("textarea");results=[];for(j=0,len=ref.length;j<len;j++){textarea=ref[j];results.push(CodeMirror.fromTextArea(textarea,{mode:"htmlmixed",lineNumbers:true,tabSize:2}))}return results}else{I.redactor(this.el.find(".game_description_input"),{minHeight:200});return I.redactor(this.el.find(".game_instructions_input"),{minHeight:60})}};EditGame.prototype.setup_screenshots=function(){var btn,j,len,ref,screen;this.screen_editor=this.el.find(".screenshot_editor");this.screen_list=this.screen_editor.find(".screenshot_list");this.screen_queue=this.screen_editor.find(".screenshot_queue");btn=this.screen_editor.find(".add_screenshot_btn");this.make_upload_button(btn,ScreenshotUpload,{finish_upload:function(_this){return function(upload,res){upload.el.remove();_this.add_screenshot(res);return _this.update_screenshot_positions()}}(this),cancel_upload:function(_this){return function(upload,err){upload.el.remove();upload_error.apply(null,arguments);return _this.update_screenshot_positions()}}(this),queue_upload:function(_this){return function(upload){return _this.screen_queue.append(upload.el)}}(this)});if(this.game.screenshots){ref=this.game.screenshots;for(j=0,len=ref.length;j<len;j++){screen=ref[j];this.add_screenshot(screen)}}this.update_screenshot_positions();return this.screen_list.dispatch("click",{delete_screen_btn:function(_this){return function(btn){var data,id;screen=btn.closest(".screenshot");data=screen.data("screen");id=data.id;if(confirm("Are you sure you want to delete this screenshot?")){I.ImageUpload.delete_image(_this,id);_this.remove_screenshot(screen);return _this.update_screenshot_positions()}}}(this),move_screen_up_btn:function(_this){return function(btn){var screenshot;screenshot=btn.closest(".screenshot");screenshot.swap_with(screenshot.prev());return _this.update_screenshot_positions()}}(this),move_screen_down_btn:function(_this){return function(btn){var screenshot;screenshot=btn.closest(".screenshot");screenshot.swap_with(screenshot.next());return _this.update_screenshot_positions()}}(this)})};EditGame.prototype.update_screenshot_positions=function(){var i,input,j,len,ref,results;ref=this.screen_list.find(".screenshot_position_input");results=[];for(i=j=0,len=ref.length;j<len;i=++j){input=ref[i];results.push($(input).val(i))}return results};EditGame.prototype.add_screenshot=function(screen){this.screen_template||(this.screen_template=get_template("screenshot"));this.screen_list.addClass("has_image");screen=$(this.screen_template(screen)).data("screen",screen);return screen.appendTo(this.screen_list)};EditGame.prototype.remove_screenshot=function(screen){screen.remove();if(this.screen_list.find("> *").length===0){return this.screen_list.removeClass("has_image")}};EditGame.prototype.get_type=function(){this.type_picker||(this.type_picker=this.el.find(".game_type_picker"));return this.type_picker.find("select").val()};EditGame.prototype.setup_type_picker=function(){this.type_picker||(this.type_picker=this.el.find(".game_type_picker"));return this.type_picker.on("change",function(_this){return function(e){var type;type=$(e.target).val();R.trigger(_this.el,"game:set_state",{type:type});_this.el.removeClass("type_flash type_unity type_java type_html");if(type!=="default"){_this.el.addClass("type_"+type)}_this.refresh_embed_state()}}(this))};EditGame.prototype.setup_classification_picker=function(){var noun_el,nouns,update_classification;this.classification_picker=this.el.find(".classification_picker").find("select");nouns=this.classification_picker.closest("[data-nouns]").data("nouns");noun_el=this.el.find(".user_classification_noun");update_classification=function(_this){return function(){var classify;classify=_this.classification_picker.val();R.trigger(_this.el,"game:set_state",{classification:classify});noun_el.text(nouns[classify]);return _this.el.toggleClass("is_game",classify==="game")}}(this);this.classification_picker.on("change",update_classification);return update_classification()};EditGame.prototype.render_cover_uploader=function(){this.cover_uploader_drop||(this.cover_uploader_drop=this.el.find(".cover_uploader_drop"));return ReactDOM.render(R.GameEdit.CoverUploader({name:"game[cover_image_id]",upload_image_url:this.opts.upload_image_url,max_size:this.opts.upload_image_size_limit,cover_image:this.opts.cover_image}),this.cover_uploader_drop[0])};EditGame.prototype.render_embed_options=function(){var props,ref;this.game_dimensions_drop||(this.game_dimensions_drop=this.el.find(".game_dimensions_drop"));props=$.extend({type:(ref=this.state.type)!=null?ref:this.opts.type},this.opts.embed_options);return ReactDOM.render(R.GameEdit.EmbedOptions(props),this.game_dimensions_drop[0])};EditGame.prototype.render_price_picker=function(){var props;this.price_picker_drop||(this.price_picker_drop=this.el.find(".price_picker_drop"));props={currency:this.opts.currency,min_price:this.opts.min_price,suggested_price:this.opts.suggested_price,disable_payments:this.opts.disable_payments,money_placeholder:this.opts.money_placeholder,is_embed:this.get_type()!=="default",default_donation_amount:this.opts.default_donation_amount,reward_required:this.opts.reward_required,rewards_url:this.opts.rewards_url};return ReactDOM.render(R.GameEdit.PricePicker(props),this.price_picker_drop[0])};EditGame.prototype.render_access_control=function(){this.access_control_drop||(this.access_control_drop=this.el.find(".access_control_drop"));return ReactDOM.render(R.GameEdit.AccessControl({game:this.game,noun:this.opts.noun,published:this.opts.published,active:this.opts.active,unlisted:this.opts.unlisted,restricted:this.opts.restricted,password:this.opts.password,purchases_count:this.opts.purchases_count}),this.access_control_drop[0])};EditGame.prototype.render_tags=function(){var opts,ref;this.tags_drop||(this.tags_drop=this.el.find(".tags_drop"));opts=$.extend({classification:(ref=this.state.classification)!=null?ref:this.opts.classification,on_change_tags:function(_this){return function(tags){_this.current_tags=tags;return _this.render_links()}}(this)},this.opts.game_tags);return ReactDOM.render(R.GameEdit.GameTags(opts),this.tags_drop[0])};EditGame.prototype.render_links=function(){var opts,ref,tags;this.links_drop||(this.links_drop=this.el.find(".links_drop"));tags=_.toArray(this.current_tags||((ref=this.opts.game_tags)!=null?ref.tags:void 0)||[]);opts=$.extend({tags:tags},this.opts.game_links);return ReactDOM.render(R.GameEdit.GameLinks(opts),this.links_drop[0])};EditGame.prototype.render_uploads=function(){var ref,ref1;this.upload_drop||(this.upload_drop=this.upload_editor.find(".upload_drop"));ReactDOM.render(R.GameEdit.UploadList({game_id:this.game.id,uploads:this.game.uploads,game_min_price:(ref=this.state.min_price)!=null?ref:this.opts.min_price,disable_payments:(ref1=this.state.disable_payments)!=null?ref1:this.opts.disable_payments,currency:this.opts.currency,money_placeholder:this.opts.money_placeholder}),this.upload_drop[0]);return this.refresh_has_download()};EditGame.prototype.refresh_has_download=function(){var has_download,j,len,ref,upload;has_download=false;ref=this.game.uploads;for(j=0,len=ref.length;j<len;j++){upload=ref[j].upload;if(upload.embed){continue}if(upload.hidden){continue}has_download=true;break}return this.el.toggleClass("has_download",has_download)};EditGame.prototype.setup_uploader=function(){var btn,upload;this.upload_editor=this.el.find(".upload_editor");this.game.uploads=function(){var j,len,ref,results;ref=this.game.uploads||[];results=[];for(j=0,len=ref.length;j<len;j++){upload=ref[j];results.push(new FileUpload(this,null,{upload:upload}))}return results}.call(this);this.render_uploads();btn=this.el.find(".add_file_btn");return this.make_upload_button(btn,FileUpload,{queue_upload:function(_this){return function(upload){return _this.append_upload(upload)}}(this)})};EditGame.prototype.append_upload=function(upload){this.game.uploads.push(upload);return this.render_uploads()};EditGame.prototype.refresh_embed_state=function(){var pattern,ref,type,upload,valid_uploads;type=this.get_type();pattern=FileUpload.type_to_extension[type];valid_uploads=function(){var j,len,ref,results;ref=this.game.uploads;results=[];for(j=0,len=ref.length;j<len;j++){upload=ref[j];if(upload.valid_for_embed()){results.push(upload)}else{upload.upload.embed=false;continue}}return results}.call(this);if(!_.any(valid_uploads,function(u){return u.embed})){if((ref=valid_uploads[0])!=null){ref.upload.embed=true}}this.render_uploads();return true};EditGame.prototype.game_prefix=function(){return"/game/edit/"+this.game.id};EditGame.prototype.upload_prefix=function(){return this.game_prefix()};EditGame.prototype.prepare_upload=function(fn,fail_fn){return this.with_game(function(_this){return function(){return fn()}}(this),function(_this){return function(){return typeof fail_fn==="function"?fail_fn(void 0,"remove"):void 0}}(this))};EditGame.prototype.with_game=function(fn,fail_fn){if(this.game.id!=null){return typeof fn==="function"?fn(this.game):void 0}if(!this.game_deferred){this.game_deferred=$.Deferred().always(function(_this){return function(){return delete _this.game_deferred}}(this));this.form.trigger("submit")}this.game_deferred.done(fn);if(fail_fn){return this.game_deferred.fail(fail_fn)}};return EditGame}()}).call(this);(function(){I.EmailEditForm=function(){function EmailEditForm(el,opts){var form,update;this.opts=opts;this.el=$(el);update=_.debounce(function(_this){return function(){return _this.update_preview()}}(this),100);this.setup_recipients();this.subject_input=this.el.find(".subject_input").on("change, keyup",update);this.body_input=I.redactor(this.el.find(".body_input"),{changeCallback:update});this.el.on("change",".show_download_input",function(_this){return function(e){return _this.update_preview()}}(this));this.el.find(".send_btn").on("click",function(_this){return function(){if(!confirm("Are you sure you want to send this email? It will be delivered right away.")){return false}}}(this));form=this.el.find("form").remote_submit(function(_this){return function(res){if(res.errors){return form.set_form_errors(res.errors)}else if(res.redirect_to){return window.location=res.redirect_to}}}(this));_.defer(function(_this){return function(){return _this.update_preview()}}(this))}EmailEditForm.prototype.setup_recipients=function(){var input;input=this.el.find(".recipients");return input.selectize({valueField:"id",persist:false,delimiter:",",options:_.toArray(this.opts.recipients),render:{item:function(_this){return function(item,escape){return"<div>"+escape(item.name)+"</div>"}}(this),option:function(_this){return function(item,escape){var label,prefix;label=escape(item.name)+" ("+I.number_format(item.count)+")";prefix=function(){switch(item.type){case"download_key_group":return"<strong>[Group]</strong> ";case"reward":return"<strong>[Reward]</strong> ";default:return""}}();return"<div>"+prefix+escape(label)+"</div>"}}(this)}})};EmailEditForm.prototype.update_preview=function(){var body,real_subject,subject;this.show_link_input||(this.show_link_input=this.el.find(".show_download_input"));this.preview_el||(this.preview_el=this.el.find(".email_preview"));this.preview_subject||(this.preview_subject=this.preview_el.find(".preview_subject"));this.preview_body||(this.preview_body=this.preview_el.find(".body_drop"));if(this.show_link_input.length){this.preview_el.toggleClass("show_download_link",this.show_link_input.prop("checked"))}subject=this.subject_input.val();body=this.body_input.val();real_subject=_.template(this.preview_subject.data("template"))({object_title:this.opts.object_title,subject:subject});this.preview_subject.html(real_subject);return this.preview_body.html(body)};return EmailEditForm}()}).call(this);(function(){I.libs.react.done(function(){var P,_rdf,a,br,button,code,div,em,fieldset,form,fragment,h1,h2,h3,h4,h5,h6,iframe,img,input,label,legend,li,ol,optgroup,option,p,pre,section,select,span,strong,textarea,types,ul;_rdf=ReactDOMFactories;div=_rdf.div,span=_rdf.span,a=_rdf.a,br=_rdf.br,p=_rdf.p,ol=_rdf.ol,ul=_rdf.ul,li=_rdf.li,strong=_rdf.strong,em=_rdf.em,img=_rdf.img,form=_rdf.form,label=_rdf.label,input=_rdf.input,textarea=_rdf.textarea,button=_rdf.button,iframe=_rdf.iframe,h1=_rdf.h1,h2=_rdf.h2,h3=_rdf.h3,h4=_rdf.h4,h5=_rdf.h5,h6=_rdf.h6,pre=_rdf.pre,code=_rdf.code,select=_rdf.select,option=_rdf.option,section=_rdf.section,optgroup=_rdf.optgroup,fieldset=_rdf.fieldset,legend=_rdf.legend;fragment=React.createElement.bind(null,React.Fragment);fragment.type=React.fragment;P=R["package"]("Dashboard");types=PropTypes;P("Analytics",{getInitialState:function(){var graphs;graphs=this.props.graphs;return{range_left:graphs!=null?graphs.range_left:void 0,range_right:graphs!=null?graphs.range_right:void 0,group_by:graphs!=null?graphs.group_by:void 0,render_group_by:graphs!=null?graphs.group_by:void 0,games_by_id:this.make_games_by_id(graphs.games),graphs:graphs,default_graph_opts:{class:"graph_container",y_axis_padding:1.1,popup_group:function(_this){return function(d){var ref;return((ref=_this.state.games_by_id[d.game_id])!=null?ref.title:void 0)||""}}(this),group_url:function(_this){return function(d){var ref;return(ref=_this.state.games_by_id[d.game_id])!=null?ref.url:void 0}}(this)}}},make_games_by_id:function(games){var g,games_by_id,i,len;games_by_id={};for(i=0,len=games.length;i<len;i++){g=games[i];games_by_id[g.id]=g}return games_by_id},refresh_graphs:function(){var group_by;this.setState({loading:true});group_by=this.state.group_by;return $.getJSON("",{range_left:this.state.range_left,range_right:this.state.range_right,group_by:group_by}).done(function(_this){return function(res){if(res.range_left){return _this.setState({loading:false,graphs:res,games_by_id:_this.make_games_by_id(res.games),render_group_by:group_by})}else{return _this.setState({loading:false,errors:res.errors})}}}(this))},on_update_range:function(update){return this.setState(update,function(_this){return function(){return _this.refresh_graphs()}}(this))},render:function(){var graph_type,graphs;graphs=this.state.graphs;graph_type=graphs.num_ticks>52?"line":"stacked";return this.enclose({className:classNames({loading:this.state.loading})},R.Dashboard.RangePicker({loading:this.state.loading,range_left:this.state.range_left,range_right:this.state.range_right,group_by:this.state.group_by,preset_ranges:this.props.preset_ranges,on_update_range:this.on_update_range}),div({className:"graphs"},R.GameEdit.Graph(Object.assign({label:"Views",type:graph_type,data:graphs.views||[],interval:this.state.render_group_by,range_left:graphs.range_left,range_right:graphs.range_right},this.state.default_graph_opts)),_.toArray(graphs.downloads).length?R.GameEdit.Graph(Object.assign({label:"Downloads",type:graph_type,data:graphs.downloads,interval:this.state.render_group_by,range_left:graphs.range_left,range_right:graphs.range_right,min_y:3},this.state.default_graph_opts)):void 0,_.toArray(graphs.plays).length?R.GameEdit.Graph(Object.assign({label:"Browser Plays",type:graph_type,data:graphs.plays,interval:this.state.render_group_by,range_left:graphs.range_left,range_right:graphs.range_right,min_y:3},this.state.default_graph_opts)):void 0))}})})}).call(this);(function(){I.libs.react.done(function(){var P,_rdf,a,br,button,code,div,em,fieldset,form,fragment,h1,h2,h3,h4,h5,h6,iframe,img,input,label,legend,li,ol,optgroup,option,p,pre,section,select,span,stores,strong,textarea,types,ul,slice=[].slice,indexOf=[].indexOf||function(item){for(var i=0,l=this.length;i<l;i++){if(i in this&&this[i]===item)return i}return-1};_rdf=ReactDOMFactories;div=_rdf.div,span=_rdf.span,a=_rdf.a,br=_rdf.br,p=_rdf.p,ol=_rdf.ol,ul=_rdf.ul,li=_rdf.li,strong=_rdf.strong,em=_rdf.em,img=_rdf.img,form=_rdf.form,label=_rdf.label,input=_rdf.input,textarea=_rdf.textarea,button=_rdf.button,iframe=_rdf.iframe,h1=_rdf.h1,h2=_rdf.h2,h3=_rdf.h3,h4=_rdf.h4,h5=_rdf.h5,h6=_rdf.h6,pre=_rdf.pre,code=_rdf.code,select=_rdf.select,option=_rdf.option,section=_rdf.section,optgroup=_rdf.optgroup,fieldset=_rdf.fieldset,legend=_rdf.legend;fragment=React.createElement.bind(null,React.Fragment);fragment.type=React.fragment;P=R["package"]("GameEdit");types=PropTypes;stores=[{label:"Steam",name:"steam_url",example:"http://store.steampowered.com/app/220/HalfLife_2/"},{label:"Apple App Store",name:"app_store_url",example:"https://itunes.apple.com/us/app/my-game/id879877684?mt=8&uo=4"},{label:"Google Play",name:"google_play_url",example:"https://play.google.com/store/apps/details?id=com.mygame.example"},{label:"Amazon App Store",name:"amazon_appstore_url",example:"http://www.amazon.com/Foobar/dp/B00992CF6W"},{label:"Windows Store",name:"windows_phone_url",example:"https://www.microsoft.com/en-us/store/apps/itchio/9nblgggz6166"}];P("ErrorLightbox",{propTypes:{title:types.string,sub_text:types.string,errors:types.array.isRequired},format_field_name:function(field){var parts;switch(field){case"short_text":field="short_description";break}parts=field.split("_").map(function(p){switch(p){case"url":return"URL";case"slug":return"Project URL";default:return p}});return parts.join(" ")},parse_errors:function(){return this.props.errors.map(function(_this){return function(err){var _,field_error,field_name,match;if(match=err.match(/([^:]+):\s*(.+)$/)){_=match[0],field_name=match[1],field_error=match[2];return li({},strong({},_this.format_field_name(field_name))," — ",field_error)}else{return li({},err)}}}(this))},render:function(){return R.Lightbox({className:"game_edit_error_lightbox_widget compact",close:false},h2({},this.props.title||this.tt("dashboard.edit_project.error_dialog.title")),p({className:"sub_text"},this.props.sub_text),ul.apply(null,[{className:"error_list"}].concat(slice.call(this.parse_errors()))),p({className:"buttons"},button({className:"button",type:"button",onClick:function(_this){return function(){return I.Lightbox.close()}}(this)},this.tt("dashboard.edit_project.error_dialog.confirm_button"))))}});P("GameLinks",{propTypes:{tags:types.array,app_store_url:types.string,google_play_url:types.string,amazon_appstore_url:types.string,windows_phone_url:types.string},getInitialState:function(){var name,open_stores;open_stores=function(){var i,len,results;results=[];for(i=0,len=stores.length;i<len;i++){name=stores[i].name;if(!this.props[name]){continue}results.push(name)}return results}.call(this);return{open_stores:open_stores}},store_by_name:function(_this){return function(name){var i,len,store;for(i=0,len=stores.length;i<len;i++){store=stores[i];if(store.name===name){return store}}}}(this),render:function(){return div({className:"links_editor"},this.render_ludum_dare_input(),div({className:"input_row app_store_links_row"},div({className:"label"},"App store links",p({className:"sub"},"If your project is available on any other stores we'll link to it.")),this.render_store_links()))},has_ludum_dare:function(){var i,len,ref,tag;ref=this.props.tags;for(i=0,len=ref.length;i<len;i++){tag=ref[i];if(tag.match(/^ludum-dare/)){return true}}return false},render_ludum_dare_input:function(){if(!this.has_ludum_dare()){return}return div({className:"input_row ludum_dare_input_row"},label({},div({className:"label"},"Ludum Dare submission URL",span({className:"sub"}," — Please include submission URL to be eligible for tag")),input({type:"text",name:"game[ludum_dare_url]",defaultValue:this.props.ludum_dare_url,ref:"ludum_dare_input",placeholder:"eg. https://ldjam.com/events/ludum-dare/"+this.props.current_ludum_dare+"/your-game-name"})))},render_store_links:function(){var closed_stores,n,open_stores,store;open_stores=function(){var i,len,ref,results;ref=this.state.open_stores;results=[];for(i=0,len=ref.length;i<len;i++){n=ref[i];results.push(this.store_by_name(n))}return results}.call(this);closed_stores=function(){var i,len,ref,results;results=[];for(i=0,len=stores.length;i<len;i++){store=stores[i];if(ref=store.name,indexOf.call(this.state.open_stores,ref)<0){results.push(store)}}return results}.call(this);return div({},this.render_open_stores(open_stores),div.apply(null,[{className:"add_buttons"}].concat(slice.call(this.render_closed_stores(closed_stores)))),this.empty_values(closed_stores))},render_open_stores:function(stores){return div({className:"store_url_inputs",children:stores.map(function(_this){return function(store){return div({className:"input_row",key:store.name},p({className:"sub"},store.label),div({className:"input_wrapper"},input({type:"text",ref:store.name,name:"game["+store.name+"]",placeholder:"eg. "+store.example,defaultValue:_this.props[store.name]}),button({className:"clear_store_button",type:"button",onClick:function(e){var s;e.preventDefault();return _this.setState({open_stores:function(){var i,len,ref,results;ref=this.state.open_stores;results=[];for(i=0,len=ref.length;i<len;i++){s=ref[i];if(s!==store.name){results.push(s)}}return results}.call(_this)})}},"×")))}}(this))})},empty_values:function(stores){return stores.map(function(_this){return function(store){return input({key:store.name,type:"hidden",name:"game["+store.name+"]",value:""})}}(this))},render_closed_stores:function(stores){return stores.map(function(_this){return function(store){return button({key:store.name,type:"button",className:"add_link_button",onClick:function(e){_this.setState({open_stores:_this.state.open_stores.concat([store.name])});_.defer(function(){var ref;return(ref=_this.refs[store.name])!=null?ref.focus():void 0});return e.preventDefault()}},span({className:"icon icon-plus"}),store.label)}}(this))}});P("AccessControl",{propTypes:{game:types.object,noun:types.string,published:types.bool,active:types.bool,unlisted:types.bool,restricted:types.bool,password:types.string,purchases_count:types.number},getInitialState:function(){var published,unlisted;published=this.props.published?this.props.restricted?"restricted":"published":"draft";unlisted=published!=="restricted"?this.props.unlisted:void 0;return{published:published,custom_settings_open:!this.props.active||unlisted,prevent_new:!this.props.active,unlisted:unlisted,require_password:!!this.props.password,password:this.props.password}},render:function(){return div({className:"access_control input_row"},div({className:"label"},this.tt("dashboard.edit_project.visibility_access_header")),p({className:"sub"},this.tt("dashboard.edit_project.visibility_access_info",{a:function(x){return a({href:"/docs/creators/access-control",target:"blank"},x)}})),this.render_draft_warning(),R.Forms.RadioButtons({name:"game[published]",value:this.state.published,onChange:function(_this){return function(e){return _this.setState({published:e.target.value})}}(this),options:[["draft",this.tt("misc.project_visibility.draft"),"Only those who can edit the project can view the page"],["restricted",this.tt("misc.project_visibility.restricted"),"Only owners & authorized people can view the page"],["published",this.tt("misc.project_visibility.public"),span({},"Anyone can view the page",this.props.game.id==null?span({},", ",strong({},"you can enable this after you've saved")):void 0,!this.state.custom_settings_open&&this.state.published==="published"?span({}," ",a({href:"#",className:"configure_link",onClick:function(_this){return function(e){e.preventDefault();return _this.setState({custom_settings_open:!_this.state.custom_settings_open})}}(this)},"Configure settings...")):void 0),{disabled:this.props.game.id==null}]]}),this.show_access_settings()?this.render_access_settings():void 0)},show_access_settings:function(){if(this.state.published==="restricted"){return true}if(this.state.published==="published"){return this.state.custom_settings_open}return false},render_draft_warning:function(){var people;if(this.state.published!=="draft"){return}if(!(this.props.purchases_count&&this.props.purchases_count>0)){return}people=this.props.purchases_count>1?"people":"person";return p({className:"sub warning"},strong({},"Warning: "),"The "+this.props.purchases_count+" "+people+" who bought the project will not be able to access it while it's draft.")},render_public_access_options:function(){return React.createElement(React.Fragment,{},div({className:"input_row",key:"prevent_new"},label({},input({type:"checkbox",name:"game[prevent_new]",checked:this.state.prevent_new,onChange:function(_this){return function(e){return _this.setState({prevent_new:e.target.checked})}}(this)}),this.tt("dashboard.edit_project.access_control.disable_downloads_option"),div({className:"help_hover","data-tooltip":"Only those who already own the game or get a download key can download. Does not affect embedded files"}))),div({className:"input_row",key:"unlisted"},label({},input({type:"checkbox",name:"game[unlisted]",checked:this.state.unlisted,onChange:function(_this){return function(e){return _this.setState({unlisted:e.target.checked})}}(this)}),this.tt("dashboard.edit_project.access_control.unlisted_option"))))},render_restricted_access_options:function(){return React.createElement(React.Fragment,{},p({className:"sub"},"Only people who own the project can view the page. You can give access by generating a download key. The page will be unlisted in browse and search."),div({className:"input_row"},label({},input({type:"checkbox",name:"game[require_password]",checked:this.state.require_password,onChange:function(_this){return function(e){return _this.setState({require_password:e.target.checked})}}(this)}),this.tt("dashboard.edit_project.access_control.allow_password_option"),div({className:"help_hover","data-tooltip":"Password not required for owners"})),this.state.require_password?input({type:this.state.password_focused?"text":"password",required:true,className:"password_input",name:"game[password]",autoComplete:"new-password",placeholder:this.t("dashboard.edit_project.access_control.password_label"),value:this.state.password,onFocus:function(_this){return function(){return _this.setState({password_focused:true})}}(this),onBlur:function(_this){return function(){return _this.setState({password_focused:false})}}(this),onChange:function(_this){return function(e){return _this.setState({password:e.target.value})}}(this)}):void 0))},render_access_settings:function(){var box_title,closable;closable=this.state.published==="published";box_title=function(){switch(this.state.published){case"published":return this.tt("dashboard.edit_project.access_control.public_access_settings");case"restricted":return this.tt("dashboard.edit_project.access_control.restricted_access_settings");default:return this.tt("dashboard.edit_project.access_control.access_settings")}}.call(this);return div({className:"publish_toggles"},div({className:"toggle_header"},span({},box_title),closable?button({type:"button",onClick:function(_this){return function(e){return _this.setState({custom_settings_open:false})}}(this)},"×"):void 0),function(){switch(this.state.published){case"published":return this.render_public_access_options();case"restricted":return this.render_restricted_access_options()}}.call(this))}});P("DeleteBlockedLightbox",{render:function(){return R.Lightbox({className:this.enclosing_class_name()},h2({},"This project can't be deleted"),p({},"This project currently has owners. Deleting this project would prevent them from being able to access it. If you want to prevent new people from seeing or buying the page please put it in ",em({},"Restricted")," mode. Alternatively you can just disable purchases."),p({},"If you actually need to delete the project please ",a({href:"/support"},"contact support"),"."),p({},a({href:"#",className:"close_btn"},"Got it")))}});P("GameTags",{propTypes:{genres:types.array.isRequired,classification:types.string,suggested_tags:types.array,on_change_tags:types.func},getInitialState:function(){return{tags:_.toArray(this.props.tags)}},has_tag:function(tag){var i,len,ref,t;ref=this.state.tags;for(i=0,len=ref.length;i<len;i++){t=ref[i];if(tag===t){return true}}return false},add_tag:function(tag){var s;s=this.tags_input[0].selectize;return s.createItem(tag,false)},componentDidMount:function(){var default_tags,items,suggested_tags,tags_input;suggested_tags=_.toArray(this.props.suggested_tags);tags_input=$(this.refs.tags_input);items=tags_input.data("json_value")||[];default_tags=_.toArray(this.props.tags);return this.tags_input=tags_input.selectize({delimiter:",",plugins:["remove_button"],persist:false,placeholder:tags_input.attr("placeholder"),valueField:"slug",labelField:"slug",searchField:["slug"],closeAfterSelect:true,options:suggested_tags.concat(default_tags).map(function(x){return{slug:x}}),create:function(tag){return{slug:I.slugify(tag)}},onChange:function(_this){return function(){var base,tags;tags=_this.tags_input[0].selectize.items||[];_this.setState({tags:tags});return typeof(base=_this.props).on_change_tags==="function"?base.on_change_tags(tags):void 0}}(this)})},hide_genre:function(){return this.props.classification!=="game"},render:function(){return this.enclose({},this.hide_genre()?input({type:"hidden",name:"game[genre]",value:"none"}):div({className:"input_row"},div({className:"label"},this.tt("dashboard.edit_project.details_genre_header")),p({className:"sub"},this.tt("dashboard.edit_project.details_genre_info")),R.Forms.Select({name:"game[genre]",defaultValue:this.state.genre||this.props.genre,selectize:true,onChange:function(_this){return function(e){return _this.setState({genre:e.target.value})}}(this),options:[["none","No genre"]].concat(slice.call(this.props.genres.map(function(_this){return function(arg){var slug,title;title=arg.title,slug=arg.slug;return[slug,title]}}(this))))})),div({className:"input_row tags_input_row"},div({className:"label"},this.tt("dashboard.edit_project.details_tags_header"),span({className:"sub"},"— ",a({href:this.props.tag_guide_url,target:"blank"},"Tips for choosing tags"))),p({className:"sub"},"Any other keywords someone might search to find your game. Max of 10."),this.hide_genre()?p({className:"sub"},"Avoid duplicating any platforms provided on files above."):p({className:"sub"},"Avoid using the genre or platforms provided above."),this.state.tags.length>this.props.max_tags?p({className:"sub error"},"Too many tags! Please choose at most "+this.props.max_tags+" tags."):void 0,div({className:"selectize_group"},input({type:"text",name:"game[tags]",className:"tag_input",ref:"tags_input",defaultValue:_.toArray(this.props.tags).join(","),placeholder:"Click to view options, type to filter or enter custom tag"})),this.props.ludum_dare_tag&&!this.has_tag(this.props.ludum_dare_tag)?div({className:"ludum_dare_tagger"},p({},strong({},"Ludum Dare "+this.props.current_ludum_dare+" submission?")," ",button({type:"button",className:"button small add_tag_btn",onClick:function(_this){return function(e){return _this.add_tag(_this.props.ludum_dare_tag)}}(this)},"Add Ludum Dare tag"))):void 0))}});P("EmbedOptions",{getInitialState:function(){return $.extend({embed_type:"frame",size_type:"manual",width:"",height:"",mobile_friendly:false,fullscreen:false,scrollbars:false,autostart:false},this.props)},render:function(){var ref;if((ref=this.props.type)!=="unity"&&ref!=="java"&&ref!=="html"){return null}return this.enclose({},h2({},this.tt("dashboard.edit_project.embed_options_header")),this.render_embed_mode(),this.render_dimensions(),this.render_frame_options())},render_dimensions:function(){if(this.props.type==="html"){if(this.state.embed_type!=="frame"){return}if(this.state.size_type!=="manual"){return}}return div({className:"input_row"},div({className:"label"},this.tt("dashboard.edit_project.embed_options.viewport_dimensions")),div({className:"dimensions_inputs"},label({},span({className:"dimension_label"},this.tt("dashboard.edit_project.embed_options.width")),input({className:classNames("inline_input",{has_error:this.state.width===""}),name:"embed[width]",type:"text",value:this.state.width,required:true,onChange:function(_this){return function(e){if(e.target.value.match(/^\d*$/)){return _this.setState({width:e.target.value})}}}(this)}),span({className:"size_unit"},"px")),span({className:"mult"},"×"),label({},span({className:"dimension_label"},this.tt("dashboard.edit_project.embed_options.height")),input({className:classNames("inline_input",{has_error:this.state.height===""}),name:"embed[height]",type:"text",required:true,value:this.state.height,onChange:function(_this){return function(e){if(e.target.value.match(/^\d*$/)){return _this.setState({height:e.target.value})}}}(this)}),span({className:"size_unit"},"px"))))},checkbox:function(name){return input({type:"checkbox",name:"embed["+name+"]",checked:this.state[name],onChange:function(_this){return function(e){var update;update={};update[name]=e.target.checked;return _this.setState(update)}}(this)})},render_frame_options:function(){if(this.props.type!=="html"){return}return div({className:"input_row"},div({className:"label"},this.tt("dashboard.edit_project.embed_options.frame_options")),ul({className:"check_list frame_options"},li({},label({},this.checkbox("mobile_friendly"),this.tt("dashboard.edit_project.embed_options.mobile_friendly_option"),span({className:"sub"}," — ",this.tt("dashboard.edit_project.embed_options.mobile_friendly_info"))),this.state.mobile_friendly?div({className:"orientation_options"},label({},strong({},this.tt("dashboard.edit_project.embed_options.orientation")),R.Forms.SimpleSelect({name:"embed[orientation]",value:this.state.orientation||"",onChange:function(_this){return function(orientation){return _this.setState({orientation:orientation===""?null:orientation})}}(this),options:[{name:"Default",value:""},{name:"Landscape",value:"landscape"},{name:"Portrait",value:"portrait"}]}))):void 0),this.state.embed_type!=="maximized"?li({},label({},this.checkbox("autostart"),"Automatically start on page load",span({className:"sub"}," — Not recommended for Unity games, since they can lag the browser when loading"))):void 0,this.state.embed_type!=="maximized"?li({},label({},this.checkbox("fullscreen"),this.tt("dashboard.edit_project.embed_options.fullscreen_button_option"),span({className:"sub"}," — Add a button to the bottom right corner of your embed to make it fullscreen"))):void 0,li({},label({},this.checkbox("scrollbars"),this.tt("dashboard.edit_project.embed_options.enable_scrollbars_option"),span({className:"sub"}," — Enable scrollbars in the iframe that contains your project"))),li({},label({},this.checkbox("cdn_type"),code({},"SharedArrayBuffer")," support",span({className:"sub"}," — ",strong({},"(Experimental)")," This may break parts of the page or your project. Only enable if you know you need it. ",a({href:"https://itch.io/t/2025776/experimental-sharedarraybuffer-support"},"Learn more"))))))},render_embed_mode:function(){if(this.props.type!=="html"){return React.createElement(React.Fragment,{},input({type:"hidden",name:"embed[embed_type]",value:"frame"}),input({type:"hidden",name:"embed[size_type]",value:"manual"}))}return div({className:"input_row"},p({className:"sub"},"How should your project be run in your page?"),div({className:"dimensions_row"},R.Forms.SimpleSelect({name:"embed[embed_type]",value:this.state.embed_type,onChange:function(_this){return function(type){return _this.setState({embed_type:type})}}(this),options:[{name:this.t("dashboard.edit_project.embed_options.embed_in_page_option"),value:"frame"},{name:this.t("dashboard.edit_project.embed_options.launch_fullscreen_option"),value:"maximized"}]})," ",this.state.embed_type==="frame"?R.Forms.SimpleSelect({name:"embed[size_type]",value:this.state.size_type,onChange:function(_this){return function(type){return _this.setState({size_type:type})}}(this),options:[{name:"Manually set size",value:"manual"},{name:"Auto-detect size (Unity HTML only)",value:"auto"}]}):void 0))}});P("UploadUrlLightbox",{getInitialState:function(){return{invalid_url:true}},is_valid_url:function(url){return url.match(/https?:\/\/[^\/]+\/.+/)},render:function(){return R.Lightbox({className:classNames(this.enclosing_class_name(),"compact")},h2({},"Upload file from URL"),form({className:"form",onSubmit:function(_this){return function(e){var base;e.preventDefault();if(_this.state.invalid_url){return}if(typeof(base=_this.props).on_url==="function"){base.on_url(_this.url_input_ref.current.value,_this.filename_input_ref.current.value)}return I.Lightbox.close()}}(this)},div({className:"input_row"},label({},div({className:"label"},"Enter URL"),input({ref:this.url_input_ref||(this.url_input_ref=React.createRef()),autoFocus:true,required:true,type:"text",placeholder:"http://....",onChange:function(_this){return function(e){var filename,is_valid,ref,url;url=e.target.value;is_valid=_this.is_valid_url(url);if(_this.state.invalid_url!==!is_valid){_this.setState({invalid_url:!is_valid})}if(!_this.state.dirty){if(filename=(ref=url.match(/([^\/]+$)/))!=null?ref[1]:void 0){return _this.filename_input_ref.current.value=filename}}}}(this)}))),div({className:"input_row"},label({},div({className:"label"},"Filename"),input({required:true,ref:this.filename_input_ref||(this.filename_input_ref=React.createRef()),type:"text",placeholder:this.t("misc.forms.required"),onChange:function(_this){return function(e){if(!_this.state.dirty){return _this.setState({dirty:true})}}}(this)}))),div({className:"buttons"},button({className:classNames("button",{disabled:!!this.state.invalid_url}),disabled:!!this.state.invalid_url},"Start upload"))))}})})}).call(this);(function(){I.libs.react.done(function(){var LoadingImage,P,_rdf,a,br,button,code,div,em,fieldset,form,fragment,h1,h2,h3,h4,h5,h6,iframe,img,input,label,legend,li,ol,optgroup,option,p,pre,section,select,span,strong,textarea,types,ul;_rdf=ReactDOMFactories;div=_rdf.div,span=_rdf.span,a=_rdf.a,br=_rdf.br,p=_rdf.p,ol=_rdf.ol,ul=_rdf.ul,li=_rdf.li,strong=_rdf.strong,em=_rdf.em,img=_rdf.img,form=_rdf.form,label=_rdf.label,input=_rdf.input,textarea=_rdf.textarea,button=_rdf.button,iframe=_rdf.iframe,h1=_rdf.h1,h2=_rdf.h2,h3=_rdf.h3,h4=_rdf.h4,h5=_rdf.h5,h6=_rdf.h6,pre=_rdf.pre,code=_rdf.code,select=_rdf.select,option=_rdf.option,section=_rdf.section,optgroup=_rdf.optgroup,fieldset=_rdf.fieldset,legend=_rdf.legend;fragment=React.createElement.bind(null,React.Fragment);fragment.type=React.fragment;P=R["package"]("GameEdit");types=PropTypes;I.i18n.preload(["misc.errors","dashboard.edit_project.cover_uploader","dashboard.edit_project.errors"]);LoadingImage=createReactClass({displayName:"LoadingImage",componentDidMount:function(){var base;return typeof(base=this.props).on_mount==="function"?base.on_mount():void 0},componentWillUnmount:function(){var base;return typeof(base=this.props).on_unmount==="function"?base.on_unmount():void 0},render:function(){var props;props=$.extend({},this.props);delete props.on_mount;delete props.on_unmount;return img(props)}});P("CoverUploader",{pure:true,propTypes:{upload_image_url:types.string.isRequired,cover_image:types.object},getInitialState:function(){return{focus_count:0,cover_image:this.props.cover_image,image_loading:!!this.props.cover_image}},start_upload:function(e){e.preventDefault();return I.upload_image({url:this.props.upload_image_url,thumb_size:"cover_big",max_size:this.props.max_size,test_file:function(_this){return function(file,d){return $.when(I.test_image_dimensions(file),I.test_image_format(file)).done(function(){return d.resolve()}).fail(function(err){return d.reject(err)})}}(this),on_pick_files:function(_this){return function(){return _this.setState({picking:true})}}(this),on_start_upload:function(_this){return function(){return _this.setState({upload_progress:0,uploading:true,picking:false})}}(this)}).done(function(_this){return function(res){return _this.setState({uploading:false,upload_progress:1,cover_image:res.upload})}}(this)).progress(function(_this){return function(event,sent,total){return _this.setState({upload_progress:sent/total})}}(this)).fail(function(_this){return function(errors){if(!Array.isArray(errors)){errors=[_this.t("misc.errors.server_error")]}_this.setState({picking:false,uploading:false});return I.Lightbox.open(R.GameEdit.ErrorLightbox({errors:errors.map(function(err){var file,msg;if(Array.isArray(err)){msg=err[0],file=err[1];if(file!=null?file.name:void 0){return file.name+": "+msg}else{return msg}}else{return err}}),title:_this.t("dashboard.edit_project.errors.invalid_file"),sub_text:_this.t("dashboard.edit_project.errors.invalid_image")}))}}(this))},remove_image:function(e){e.preventDefault();if(confirm(this.t("dashboard.edit_project.cover_uploader.confirm_remove"))){return this.setState({cover_image:null})}},increment_focus:function(){return this.setState(function(state){return{focus_count:state.focus_count+1}})},decrement_focus:function(){return this.setState(function(state){return{focus_count:state.focus_count-1}})},on_image_load:function(){return this.setState({image_loading:false})},on_mount_image:function(){return this.setState({image_loading:true})},render:function(){var is_loading;is_loading=this.state.uploading||this.state.image_loading||this.state.picking;return this.enclose({className:classNames({has_image:!is_loading&&!!this.state.cover_image,image_loading:this.state.image_loading,uploading:is_loading})},div({className:classNames("upload_container",{focused:this.state.focus_count>0})},this.state.cover_image&&!(this.state.uploading||this.state.picking)?React.createElement(LoadingImage,{key:"image:"+this.state.cover_image.id,className:"cover_thumb",src:this.state.cover_image.thumb_url,onLoad:this.on_image_load,on_mount:this.on_mount_image,on_unmount:this.on_image_load}):void 0,is_loading?div({className:"upload_progress",key:"upload_progress",style:{width:100*(this.state.upload_progress||0)+"%"}}):this.render_file_tools()),p({className:"sub instructions"},this.props.sub||this.tt("dashboard.edit_project.cover_uploader.cover_description")))},render_file_tools:function(){return div({className:"file_tools",key:"file_tools"},this.props.name?input({type:"hidden",name:this.props.name,value:this.state.cover_image?this.state.cover_image.id:""}):void 0,this.state.cover_image?React.createElement(React.Fragment,{},R.Forms.FocusButton({on_increment_focus:this.increment_focus,on_decrement_focus:this.decrement_focus,className:"button",type:"button",onClick:this.start_upload,key:"replace_button"},this.tt("dashboard.edit_project.cover_uploader.replace_image")),R.Forms.FocusButton({on_increment_focus:this.increment_focus,on_decrement_focus:this.decrement_focus,type:"button",className:"textlike remove_image_btn",onClick:this.remove_image},this.tt("dashboard.edit_project.cover_uploader.remove_image"))):R.Forms.FocusButton({on_increment_focus:this.increment_focus,on_decrement_focus:this.decrement_focus,className:"button",type:"button",onClick:this.start_upload,key:"upload_button"},this.tt("dashboard.edit_project.cover_uploader.upload_button")))}})})}).call(this);(function(){I.libs.react.done(function(){var P,_rdf,a,br,button,code,div,em,fieldset,form,fragment,h1,h2,h3,h4,h5,h6,iframe,img,input,label,legend,li,ol,optgroup,option,p,pre,section,select,span,strong,textarea,types,ul;_rdf=ReactDOMFactories;div=_rdf.div,span=_rdf.span,a=_rdf.a,br=_rdf.br,p=_rdf.p,ol=_rdf.ol,ul=_rdf.ul,li=_rdf.li,strong=_rdf.strong,em=_rdf.em,img=_rdf.img,form=_rdf.form,label=_rdf.label,input=_rdf.input,textarea=_rdf.textarea,button=_rdf.button,iframe=_rdf.iframe,h1=_rdf.h1,h2=_rdf.h2,h3=_rdf.h3,h4=_rdf.h4,h5=_rdf.h5,h6=_rdf.h6,pre=_rdf.pre,code=_rdf.code,select=_rdf.select,option=_rdf.option,section=_rdf.section,optgroup=_rdf.optgroup,fieldset=_rdf.fieldset,legend=_rdf.legend;fragment=React.createElement.bind(null,React.Fragment);fragment.type=React.fragment;P=R["package"]("GameEdit");types=PropTypes;P("EmbedUpload",{propTypes:{embed_url_template:types.string,noun:types.string,uploads:types.array},componentDidMount:function(){this.pick_upload(this.state.selected_upload);return $(document.body).on("keydown",function(_this){return function(e){if(e.keyCode===27){return _this.setState({show_preview:false})}}}(this))},getInitialState:function(){return{show_preview:false,width:this.props.default_width,height:this.props.default_height,color:this.props.default_color,selected_upload:this.default_upload()}},default_upload:function(){var i,j,len,ref,u;if(!this.props.uploads){return}ref=this.props.uploads;for(i=j=0,len=ref.length;j<len;i=++j){u=ref[i];if(u["default"]){return i}}return 0},pick_upload:function(idx){var ref,s,upload;idx=+idx;s={selected_upload:idx};upload=(ref=this.props.uploads)!=null?ref[idx]:void 0;if(!upload){return}if(upload.height){s.height=upload.height}if(upload.width){s.width=upload.width}return this.setState(s)},current_upload:function(){return this.props.uploads[this.state.selected_upload]},set_int:function(field,val){var props;if(!(""+val).match(/^\d*$/)){return}props={};props[field]=val;return this.setState(props)},render:function(){if(!this.props.uploads||this.props.uploads.length===0){return this.render_empty()}return this.enclose({className:"embed_upload"},this.state.show_preview?this.render_preview():void 0,div({className:"form"},div({className:"upload_list"},label({},div({className:"label"},"Select a file"),R.Forms.SimpleSelect({value:this.state.selected_upload,onChange:function(_this){return function(value){return _this.pick_upload(value)}}(this),options:this.props.uploads.map(function(_this){return function(u,idx){return{value:idx,name:u.name}}}(this))}))),div({className:"embed_options"},label({},span({className:"label"},"Width"),input({type:"text",value:this.state.width,onChange:function(_this){return function(e){return _this.set_int("width",e.target.value)}}(this)})),label({},span({className:"label"},"Height"),input({type:"text",value:this.state.height,onChange:function(_this){return function(e){return _this.set_int("height",e.target.value)}}(this)})),label({},span({className:"label"},"Color"),R.Forms.ColorInput({value:this.state.color,onChange:function(_this){return function(color){return _this.setState({color:color})}}(this)})),div({className:"spacer"}),button({className:"button",onClick:function(_this){return function(e){e.preventDefault();return _this.setState({show_preview:true})}}(this)},"Preview")),textarea({readOnly:true,className:"embed_code",ref:function(_this){return function(code_el){_this.code_el=code_el}}(this),onClick:function(_this){return function(e){return e.target.select()}}(this)}),P.RenderMarkup({children:this.render_embed(),on_html:function(_this){return function(html){if(_this.code_el){return _this.code_el.value=html}}}(this)}),div({className:"embed_directions"},strong({},"Directions")," Copy and paste this HTML into your website where you want the "+this.props.noun+" to appear."),div({className:"ludum_dare_directions"},p({},strong({},"Direct link?")," Use this link to go directly to your game:",input({type:"text",readOnly:true,value:this.embed_url(),onClick:function(_this){return function(e){return e.target.select()}}(this)})))))},render_empty:function(){return div({className:"empty_message"},p({},"You currently don't have any uploads available to be embedded."))},render_preview:function(){return div({className:"preview_container",onClick:function(_this){return function(e){if($(e.target).is(".preview_container")){return _this.setState({show_preview:false})}}}(this)},this.render_embed())},embed_url:function(){var c,params,upload,url;upload=this.current_upload();params={};if(c=this.state.color.match(/#([a-fA-F\d]{6})/)){params.color=c[1]}params=$.param(params);url=_.template(this.props.embed_url_template)({id:upload.id});if(params!==""){url+="?"+params}return url},render_embed:function(){var upload;upload=this.current_upload();if(!upload){return}return iframe({frameBorder:"0",src:this.embed_url(),allowFullScreen:true,width:this.state.width,height:this.state.height},a({href:this.props.game_url},this.props.game_link_title))}})})}).call(this);(function(){I.libs.react.done(function(){var P,_rdf,a,br,button,code,div,em,fieldset,form,fragment,h1,h2,h3,h4,h5,h6,iframe,img,input,k,label,legend,li,next_id,ol,optgroup,option,p,pre,section,select,span,strong,textarea,types,ul;_rdf=ReactDOMFactories;div=_rdf.div,span=_rdf.span,a=_rdf.a,br=_rdf.br,p=_rdf.p,ol=_rdf.ol,ul=_rdf.ul,li=_rdf.li,strong=_rdf.strong,em=_rdf.em,img=_rdf.img,form=_rdf.form,label=_rdf.label,input=_rdf.input,textarea=_rdf.textarea,button=_rdf.button,iframe=_rdf.iframe,h1=_rdf.h1,h2=_rdf.h2,h3=_rdf.h3,h4=_rdf.h4,h5=_rdf.h5,h6=_rdf.h6,pre=_rdf.pre,code=_rdf.code,select=_rdf.select,option=_rdf.option,section=_rdf.section,optgroup=_rdf.optgroup,fieldset=_rdf.fieldset,legend=_rdf.legend;fragment=React.createElement.bind(null,React.Fragment);fragment.type=React.fragment;P=R["package"]("GameEdit");types=PropTypes;k=0;next_id=function(){return""+k++};P("GameLinkRow",{pure:true,input_name:function(name){return"links["+(this.props.position+1)+"]["+name+"]"},render:function(){var link;link=this.props.link;return this.enclose({className:"link_row",style:this.props.style},input({type:"hidden",name:this.input_name("id"),value:link.id}),input({type:"hidden",name:this.input_name("type"),value:link.type}),div({className:"label_column"},link.type==="other"?input({type:"text",name:this.input_name("name"),value:link.name||"",placeholder:"Name",required:true,onChange:function(_this){return function(e){return _this.props.update({name:e.target.value})}}(this)}):span({className:"link_type_name"},this.props.link_names[link.type])),input({type:"text",name:this.input_name("url"),value:link.url,autoFocus:link.just_added?true:void 0,placeholder:"http://",required:true,onChange:function(_this){return function(e){return _this.props.update({url:e.target.value})}}(this)}),!(this.props.first&&this.props.last)?R.RowMover({move_up:this.move_up||(this.move_up=function(_this){return function(){return _this.props.move_up()}}(this)),move_down:this.move_down||(this.move_down=function(_this){return function(){return _this.props.move_down()}}(this)),first:this.props.first,last:this.props.last}):void 0,button({type:"button",className:"remove_btn",title:"Remove",onClick:function(_this){return function(e){e.preventDefault();if(link.name||link.url){if(!confirm("Are you sre you want to remove this link?")){return}}return _this.props.remove()}}(this)},R.Icons.Close({width:18})))}});P("EditLinks",{propTypes:{game_link_types:types.array.isRequired,link_names:types.object.isRequired,links:types.arrayOf(types.shape({id:types.number,name:types.string,url:types.string.isRequired,type:types.string.isRequired}))},getInitialState:function(){var l;return{links:function(){var i,len,ref,results;ref=this.props.links||[];results=[];for(i=0,len=ref.length;i<len;i++){l=ref[i];results.push(l)}return results}.call(this)}},add_link:function(type){return this.list_ref.current.add({just_added:true,type:type,name:"",url:""})},render:function(){return this.enclose({component:"form",method:"post",ref:this.form_ref||(this.form_ref=React.createRef()),className:"game_links_editor form",onSubmit:this.on_sumit||(this.on_sumit=function(_this){return function(e){e.preventDefault();if(_this.state.loading){return}_this.setState({loading:true,errors:null});return I.remote_submit($(_this.form_ref.current)).done(function(res){_this.setState({loading:false});if(res.redirect_to){window.location=res.redirect_to}if(res.errors){return _this.setState({errors:res.errors})}})}}(this))},input({type:"hidden",name:"json",value:"1"}),input({type:"hidden",name:"csrf_token",value:I.get_csrf()}),this.state.errors?R.Forms.FormErrors({errors:this.state.errors,animated:true,scroll_into_view:true}):void 0,this.render_links(),div({className:"add_buttons"},label({},span({className:"type_label label"},"Add new link to")," ",R.Forms.SimpleSelect({ref:this.type_picker_ref||(this.type_picker_ref=React.createRef()),options:this.props.game_link_types.map(function(_this){return function(type){return{value:type,name:_this.props.link_names[type]}}}(this))}))," ",button({className:"button",type:"button",onClick:function(_this){return function(e){e.preventDefault();return _this.add_link(_this.type_picker_ref.current.current_option().value)}}(this)},"Enter URL...")),div({className:"buttons"},button({className:"button"},"Save links")))},render_links:function(){return div({className:"link_list"},R.ListManager({animate:true,item_name:"link",ref:this.list_ref||(this.list_ref=React.createRef()),item_component:P.GameLinkRow,initial_items:this.state.links,on_list_update:this.on_list_update||(this.on_list_update=function(_this){return function(links){return _this.setState({links:links})}}(this)),empty_content:em({className:"empty_message"},"No links added yet"),item_props:function(_this){return function(crit){return{link_names:_this.props.link_names}}}(this)}))}})})}).call(this);(function(){I.libs.react.done(function(){var P,_rdf,a,br,button,code,div,em,fieldset,form,fragment,h1,h2,h3,h4,h5,h6,iframe,img,input,label,legend,li,ol,optgroup,option,p,pre,section,select,span,strong,textarea,types,ul;_rdf=ReactDOMFactories;div=_rdf.div,span=_rdf.span,a=_rdf.a,br=_rdf.br,p=_rdf.p,ol=_rdf.ol,ul=_rdf.ul,li=_rdf.li,strong=_rdf.strong,em=_rdf.em,img=_rdf.img,form=_rdf.form,label=_rdf.label,input=_rdf.input,textarea=_rdf.textarea,button=_rdf.button,iframe=_rdf.iframe,h1=_rdf.h1,h2=_rdf.h2,h3=_rdf.h3,h4=_rdf.h4,h5=_rdf.h5,h6=_rdf.h6,pre=_rdf.pre,code=_rdf.code,select=_rdf.select,option=_rdf.option,section=_rdf.section,optgroup=_rdf.optgroup,fieldset=_rdf.fieldset,legend=_rdf.legend;fragment=React.createElement.bind(null,React.Fragment);fragment.type=React.fragment;P=R["package"]("GameEdit");types=PropTypes;P("PatreonAccess",{propTypes:{campaigns:types.array.isRequired},getInitialState:function(){return{currency:this.props.min_pledge_currency}},render:function(){var key_group;return this.enclose({component:"form",className:"form",method:"post"},R.CSRF({}),R.Forms.InputRow({title:"Select Patreon campaign"},R.Forms.SimpleSelect({name:"campaign_id",defaultValue:this.props.selected_campaign_id,options:[{value:"",name:"Disable Patreon access"}].concat(this.props.campaigns.map(function(_this){return function(campaign){return{value:campaign.id,name:campaign.name}}}(this)))})),R.Forms.InputRow({title:"Campaign currency",sub:"Please select the currency to restrict minimum pledge by"},R.Forms.SimpleSelect({name:"minimum_pledge_currency",options:["USD","EUR","GBP"].map(function(_this){return function(name){return{value:name,name:name}}}(this)),value:this.state.currency,onChange:function(_this){return function(value){return _this.setState({currency:value})}}(this)})),R.Forms.TextInputRow({className:"pledge_input",name:"minimum_pledge_amount",title:"Minimum pledge",sub:"Patron must pledge at least this much to get access to your project",defaultValue:this.props.min_pledge_amount,money_input:true,key:"pledge_amount_"+this.state.currency,currency:this.state.currency,placeholder:I.format_money(0,this.state.currency)}),R.Forms.InputRow({title:"Key options"},ul({className:"check_list"},li({},label({},input({type:"checkbox",name:"key_options[must_be_claimed]",defaultChecked:this.props.must_be_claimed}),"Require itch.io account to download",span({className:"sub"}," — ","This can help prevent people from sharing access links"))))),div({className:"buttons"},button({className:"button",name:"action",value:"select_campaign"},"Save")," ",button({name:"action",value:"refresh_campaigns",className:"button outline"},"Refresh campaigns"),(key_group=this.props.patreon_key_group)?a({href:key_group.url},"View claimed keys"):void 0))}})})}).call(this);(function(){I.libs.react.done(function(){var DEFAULT_DONATION,DEFAULT_MIN_PRICE,P,_rdf,a,br,button,code,div,em,fieldset,form,fragment,h1,h2,h3,h4,h5,h6,iframe,img,input,label,legend,li,ol,optgroup,option,p,pre,section,select,span,strong,textarea,types,ul;_rdf=ReactDOMFactories;div=_rdf.div,span=_rdf.span,a=_rdf.a,br=_rdf.br,p=_rdf.p,ol=_rdf.ol,ul=_rdf.ul,li=_rdf.li,strong=_rdf.strong,em=_rdf.em,img=_rdf.img,form=_rdf.form,label=_rdf.label,input=_rdf.input,textarea=_rdf.textarea,button=_rdf.button,iframe=_rdf.iframe,h1=_rdf.h1,h2=_rdf.h2,h3=_rdf.h3,h4=_rdf.h4,h5=_rdf.h5,h6=_rdf.h6,pre=_rdf.pre,code=_rdf.code,select=_rdf.select,option=_rdf.option,section=_rdf.section,optgroup=_rdf.optgroup,fieldset=_rdf.fieldset,legend=_rdf.legend;fragment=React.createElement.bind(null,React.Fragment);fragment.type=React.fragment;P=R["package"]("GameEdit");types=PropTypes;DEFAULT_MIN_PRICE=100;DEFAULT_DONATION=200;P("PricePicker",{pure:true,propTypes:{currency:types.string.isRequired,min_price:types.number,suggested_price:types.number,disable_payments:types.bool,reward_required:types.bool,is_embed:types.bool,default_donation_amount:types.number},getInitialState:function(){return{payment_mode:this.props.disable_payments?"disable_payments":this.props.min_price>0?"paid":"free",show_suggested_price:this.props.suggested_price&&this.props.suggested_price>this.props.min_price||false,min_price:this.props.min_price,suggested_price:this.props.suggested_price}},render:function(){var default_price,payment_modes,price_error;payment_modes=[{label:this.tt("dashboard.edit_project.pricing.free_or_donate",{money:I.format_money(0,this.props.currency).replace(/\.00$/,"")}),name:"free"},{label:this.tt("dashboard.edit_project.pricing.paid"),name:"paid"},{label:this.tt("dashboard.edit_project.pricing.no_payments"),name:"disable_payments"}];return this.enclose({},input({type:"hidden",name:"game[payment_mode]",value:this.state.payment_mode}),this.props.reward_required?p({className:"reward_notice"},strong({},"A reward is required to download. "),"You projects's minimum price is fixed to the lowest available reward. ",a({className:"forward_link",target:"_blank",href:this.props.rewards_url},"Configure rewards")):void 0,div({className:"payment_modes",children:payment_modes.map(function(_this){return function(mode){var active;active=mode.name===_this.state.payment_mode;return button({type:"button",key:mode.name,className:classNames("payment_mode_"+mode.name,{active:active}),onClick:function(){var min_price;_this.setState({payment_mode:mode.name});min_price=mode.name==="paid"?_this.state.min_price||DEFAULT_MIN_PRICE:0;return _this.trigger("game:set_state",{disable_payments:mode.name==="disable_payments",min_price:min_price})}},span({className:classNames("icon",{"icon-checkbox-checked":active,"icon-checkbox-unchecked":!active})}),span({className:"label"},mode.label))}}(this))}),function(){switch(this.state.payment_mode){case"paid":default_price=this.state.min_price||DEFAULT_MIN_PRICE;price_error=default_price<DEFAULT_MIN_PRICE;return div({className:"price_inputs"},this.props.is_embed?p({className:"price_note"},this.tt("dashboard.edit_project.pricing.embed_pricing_info")):void 0,R.Forms.TextInputRow({title:this.tt("dashboard.edit_project.pricing.minimum_price_label"),sub:this.tt("dashboard.edit_project.pricing.minimum_price_info"),name:"game[min_price]",defaultValue:I.format_money(default_price,this.props.currency),money_input:true,currency:this.props.currency,placeholder:I.format_money(0,this.props.currency),has_error:price_error,error_message:price_error?"Please enter a price of at least "+I.format_money(DEFAULT_MIN_PRICE,this.props.currency):void 0,onKeyUp:function(_this){return function(e){var min_price;min_price=I.parse_money(e.target.value);_this.setState({min_price:min_price});return _this.trigger("game:set_state",{min_price:min_price})}}(this)}),this.render_suggested_price());case"free":return div({className:"mode_free"},input({type:"hidden",name:"game[min_price]",value:I.format_money(0,this.props.currency)}),p({className:"sub"},this.tt("dashboard.edit_project.pricing.free_price_info")),div({className:"price_inputs"},this.render_suggested_price({sub:this.tt("dashboard.edit_project.pricing.default_donation_amount_info")})));case"disable_payments":return div({className:"mode_disable_payments"},input({type:"hidden",name:"game[min_price]",value:I.format_money(0,this.props.currency)}),this.props.reward_required?p({className:"warning"},"Your project will be unable to be downloaded or purchased if payments are disabled and a reward is required. Please change one of the options. (Existing owners will still maintain access)"):p({className:"sub"},this.tt("dashboard.edit_project.pricing.payment_disabled_info")))}}.call(this))},suggested_price_enabled:function(){return this.state.show_suggested_price||this.state.payment_mode==="free"},render_suggested_price:function(opts){var default_value,price_error;if(opts==null){opts={}}return div({className:"suggested_price"},this.state.payment_mode==="paid"?div({className:"input_row suggest_alt_input_row"},label({},input({type:"checkbox",className:"suggested_price_toggle",checked:this.state.show_suggested_price,onChange:function(_this){return function(e){var update;update={show_suggested_price:e.target.checked};if(_this.state.payment_mode==="paid"&&update.show_suggested_price){update.suggested_price=Math.max(_this.props.default_donation_amount||DEFAULT_DONATION,_this.state.min_price||0)}return _this.setState(update)}}(this)}),this.tt("dashboard.edit_project.pricing.suggest_default_price_label"))):void 0,this.suggested_price_enabled()?(price_error=this.state.payment_mode==="paid"?(this.state.min_price||0)>(this.state.suggested_price||0):void 0,default_value=this.state.suggested_price||this.props.default_donation_amount||DEFAULT_DONATION,R.Forms.TextInputRow({title:this.state.payment_mode==="free"?this.tt("dashboard.edit_project.pricing.suggested_donation_label"):this.tt("dashboard.edit_project.pricing.suggested_price_label"),sub:opts.sub||this.tt("dashboard.edit_project.pricing.default_price_info"),defaultValue:I.format_money(default_value,this.props.currency),name:"game[suggested_price]",money_input:true,currency:this.props.currency,has_error:price_error,error_message:price_error?this.tt("dashboard.edit_project.pricing.price_too_low_error"):void 0,onKeyUp:function(_this){return function(e){var suggested_price;suggested_price=I.parse_money(e.target.value);return _this.setState({suggested_price:suggested_price})}}(this),placeholder:I.format_money(0,this.props.currency)})):void 0)}})})}).call(this);(function(){I.libs.react.done(function(){var P,_rdf,a,br,button,code,div,em,fieldset,form,fragment,h1,h2,h3,h4,h5,h6,iframe,img,input,key_counter,label,legend,li,ol,optgroup,option,p,pre,section,select,span,strong,textarea,types,ul,slice=[].slice;_rdf=ReactDOMFactories;div=_rdf.div,span=_rdf.span,a=_rdf.a,br=_rdf.br,p=_rdf.p,ol=_rdf.ol,ul=_rdf.ul,li=_rdf.li,strong=_rdf.strong,em=_rdf.em,img=_rdf.img,form=_rdf.form,label=_rdf.label,input=_rdf.input,textarea=_rdf.textarea,button=_rdf.button,iframe=_rdf.iframe,h1=_rdf.h1,h2=_rdf.h2,h3=_rdf.h3,h4=_rdf.h4,h5=_rdf.h5,h6=_rdf.h6,pre=_rdf.pre,code=_rdf.code,select=_rdf.select,option=_rdf.option,section=_rdf.section,optgroup=_rdf.optgroup,fieldset=_rdf.fieldset,legend=_rdf.legend;fragment=React.createElement.bind(null,React.Fragment);fragment.type=React.fragment;P=R["package"]("GameEdit");types=PropTypes;key_counter=0;P("EditRewards",{propTypes:{currency:types.string.isRequired,has_multi_rewards:types.bool,has_tickets:types.bool,game:types.object.isRequired,rewards:types.array},getInitialState:function(){return{rewards:_.toArray(this.props.rewards)}},componentDidMount:function(){$(ReactDOM.findDOMNode(this)).has_tooltips();return this.dispatch("reward",{update:function(_this){return function(e,idx,field,value,render){_this.state.rewards[idx][field]=value;if(render){return _this.forceUpdate()}}}(this),remove:function(_this){return function(e,idx){_this.state.rewards.splice(idx,1);return _this.forceUpdate()}}(this),add_field:function(_this){return function(e,idx){var r;r=_this.state.rewards[idx];r.fields||(r.fields=[]);r.fields.push({});return _this.forceUpdate()}}(this),remove_field:function(_this){return function(e,reward_idx,field_idx){var r;r=_this.state.rewards[reward_idx];r.fields.splice(field_idx,1);return _this.forceUpdate()}}(this),update_field:function(_this){return function(e,reward_idx,field_idx,field,value){var r;r=_this.state.rewards[reward_idx];r.fields[field_idx][field]=value;return _this.forceUpdate()}}(this)})},new_reward:function(){this.state.rewards.push({key:"new-reward-"+(key_counter+=1),title:"",price:""});return this.forceUpdate()},render:function(){return this.enclose({className:"game_edit_rewards"},this.render_reward_settings(),this.render_rewards(),div({className:"button_row"},button({className:"button new_reward_btn",type:"button",onClick:function(_this){return function(e){e.preventDefault();return _this.new_reward()}}(this)},"New reward"),button({className:"button save_btn"},"Save")))},render_rewards:function(){if(!this.state.rewards.length){return}return div({},h3({},"Rewards"),div.apply(null,[{className:"reward_list"}].concat(slice.call(this.state.rewards.map(this.render_reward)))))},render_reward:function(reward,idx){return P.RewardEditor({key:reward.id||reward.key,idx:idx,has_multi_rewards:this.props.has_multi_rewards,has_tickets:this.props.has_tickets,reward:reward,game:this.props.game})},render_reward_settings:function(){if(!this.state.rewards.length){return}return div({className:"reward_settings"},h3({},"Reward settings"),div({className:"input_row reward_noun"},label({},div({className:"label"},"Custom noun",span({className:"sub"}," — Give a custom name to your reward program, optional")),input({type:"text",name:"reward_noun",placeholder:"Rewards",defaultValue:this.props.reward_noun}))),div({className:"input_row require_rewards_toggle"},label({},input({type:"checkbox",name:"reward_required",defaultChecked:this.props.reward_required}),span({className:"label"},"New purchases & downloads require a reward",span({className:"sub"}," — Your project can only be purchased/downloaded by those who claim a reward. Existing purchases and keys are not affected. ",a({className:"forward_link",target:"_blank",href:"/docs/creators/exclusive-content#running-a-limited-release-with-rewards"},"Learn more"))))))}});P("RewardEditor",{propTypes:{reward:types.object.isRequired,has_multi_rewards:types.bool,has_tickets:types.bool,game:types.object.isRequired,idx:types.number.isRequired},getInitialState:function(){return{collapsed:this.props.reward.archived,allow_multiple:this.props.reward.max_purchase_quantity>1}},input_name:function(){var names;names=1<=arguments.length?slice.call(arguments,0):[];return"rewards["+this.props.idx+"]["+names.join("][")+"]"},update_field:function(field,render){if(render==null){render=true}return function(_this){return function(e){return _this.trigger("reward:update",_this.props.idx,field,e.target.value,render)}}(this)},componentDidMount:function(){I.money_input($(this.refs.price));return I.redactor($(this.refs.description),{minHeight:80})},render:function(){var reward;reward=this.props.reward;return div({className:classNames("reward_row",{collapsed:this.state.collapsed})},this.state.collapsed?div({className:"collapsed_notification"},div({className:"collapsed_message"},"Archived reward  — ",strong({className:"reward_title"},reward.title),span({className:"claimed_count"}," — Claimed: "+I.number_format(reward.claimed_count))),button({type:"button",className:"button outline",onClick:function(_this){return function(){return _this.setState({collapsed:false})}}(this)},"Open")):void 0,this.render_form())},render_form:function(){var price_error,quantity_error,ref,reward;reward=this.props.reward;price_error=reward.price&&this.props.game.min_price>reward.price;quantity_error=reward.amount!=null&&reward.amount<(reward.claimed_count||0);return div({className:"reward_editor_form"},reward.id?input({type:"hidden",name:this.input_name("id"),value:reward.id}):void 0,a({href:"#",className:"remove_button",onClick:function(_this){return function(e){e.preventDefault();if(_this.props.reward.claimed_count>0){_this.trigger("reward:update",_this.props.idx,"archived",true);return _this.setState({collapsed:true})}else{return _this.trigger("reward:remove",_this.props.idx)}}}(this)},this.props.reward.claimed_count>0?"Hide":"Remove"),div({className:"reward_primary_column"},label({className:"input_row title_row"},div({className:"label"},"Title"),input({type:"text",name:this.input_name("title"),className:"reward_title_input",required:true,value:reward.title,onChange:this.update_field("title")})),label({className:"input_row description_row"},div({className:"label"},"Description"),textarea({ref:"description",placeholder:"Description",name:this.input_name("description"),className:"reward_description_input",defaultValue:reward.description}))),div({className:"reward_secondary_column"},label({className:"input_row"},div({className:"label"},"Minimum price"),input({type:"text",name:this.input_name("price"),"data-currency":this.props.currency,ref:"price",className:classNames("reward_price_input",{has_error:price_error}),defaultValue:reward.price,placeholder:I.format_money(0,this.props.currency),onKeyUp:function(_this){return function(e){return _this.trigger("reward:update",_this.props.idx,"price",I.parse_money($(e.target).val()),true)}}(this)}),price_error?div({className:"input_error"},"Must be greater than "+I.format_money(this.props.game.min_price,this.props.currency)):void 0),label({className:"input_row"},div({className:"label"},"Total quantity"),input({type:"text",className:classNames("amount_input_row",{has_error:quantity_error}),name:this.input_name("amount"),pattern:"\\d+",required:true,value:(ref=reward.amount)!=null?ref:"",onChange:this.update_field("amount")}),quantity_error?div({className:"input_error"},"Quantity must be greater or equal to amount already claimed"):void 0),reward.id!=null?label({className:"input_row",title:"No new purchases can claim this reward, hide the reward from the page"},input({type:"checkbox",name:this.input_name("archived"),checked:!!reward.archived,onChange:function(_this){return function(e){return _this.trigger("reward:update",_this.props.idx,"archived",e.target.checked,true)}}(this)}),span({className:"label"},"Archived")):void 0,this.props.has_tickets&&label({className:"input_row"},div({className:"label"},"Reward type"),select({name:this.input_name("type"),value:reward.type,disabled:reward.claimed_count>0,onChange:function(_this){return function(e){return _this.trigger("reward:update",_this.props.idx,"type",e.target.value,true)}}(this)},option({value:"default"},"Default"),option({value:"ticket"},"Ticket"))),this.props.has_multi_rewards&&label({className:"input_row"},input({type:"checkbox",checked:this.state.allow_multiple,onChange:function(_this){return function(e){return _this.setState({allow_multiple:e.target.checked})}}(this)}),span({className:"label"},"Allow buying more than one")),this.props.has_multi_rewards&&this.state.allow_multiple&&label({className:"input_row"},div({className:"label"},"Max quantity per purchase"),input({type:"number",name:this.input_name("max_purchase_quantity"),min:1,max:10,value:reward.max_purchase_quantity,onChange:function(_this){return function(e){var max,min,value;value=parseInt(e.target.value,10);min=parseInt(e.target.min,10);max=parseInt(e.target.max,10);if(value<min){value=min}if(value>max){value=max}return _this.trigger("reward:update",_this.props.idx,"max_purchase_quantity",value,true)}}(this)})),this.render_fields_editor(),reward.claimed_count!=null?div({className:"input_row"},div({className:"label"},"Amount claimed"),div({className:"claimed_count"},""+I.number_format(reward.claimed_count))):void 0))},render_field:function(field,idx){var prefix,update_field;prefix=this.input_name("fields",""+(idx+1));update_field=function(_this){return function(name){return function(e){var value;value=e.target.value;return _this.trigger("reward:update_field",_this.props.idx,idx,name,value)}}}(this);return div({className:"reward_field",key:prefix},field.id!=null?input({type:"hidden",name:prefix+"[id]",value:field.id}):void 0,div({className:"field_header"},select({name:prefix+"[type]",className:"field_type_input",value:field.type||"text",onChange:update_field("type")},option({value:"text"},"Single-line text"),option({value:"text_multi"},"Multi-line text"),option({value:"single_choice"},"Single choice"),option({value:"address"},"Address")),button({className:"remove_field_button",type:"button",title:"Remove reward","data-tooltip":"Remove field",onClick:function(_this){return function(e){if(field.filled_count){if(!confirm("Because people have already filled out this field it will be archived instead of deleted")){return}}$(e.target).trigger("i:hide_tooltip");e.preventDefault();return _this.trigger("reward:remove_field",_this.props.idx,idx)}}(this)},"×")),R.Forms.TextInputRow({title:"Field name",required:true,name:prefix+"[name]",required:true,placeholder:"required",value:field.name||"",onChange:update_field("name")}),function(){switch(field.type){case"single_choice":return R.Forms.TextInputRow({title:"Choices",sub:"separate by commas",name:prefix+"[choices]",required:true,placeholder:"required",value:field.choices||"",onChange:update_field("choices")});case"ticket":return label({className:"input_row"},input({type:"checkbox"}),span({className:"label"},"Ask for usual name"))}}())},render_fields_editor:function(){var ref,ref1;return div({className:"fields_editor"},((ref=this.props.reward.fields)!=null?ref.length:void 0)?div({className:"fields_list",children:(ref1=this.props.reward.fields)!=null?ref1.map(this.render_field):void 0}):void 0,div({},button({type:"button",className:"button small new_field_btn",onClick:function(_this){return function(){return _this.trigger("reward:add_field",_this.props.idx)}}(this)},"New field")))}})})}).call(this);(function(){I.libs.react.done(function(){var P,_rdf,a,br,button,code,div,em,fieldset,form,fragment,h1,h2,h3,h4,h5,h6,iframe,img,input,label,legend,li,ol,optgroup,option,p,pre,section,select,span,strong,textarea,types,ul;_rdf=ReactDOMFactories;div=_rdf.div,span=_rdf.span,a=_rdf.a,br=_rdf.br,p=_rdf.p,ol=_rdf.ol,ul=_rdf.ul,li=_rdf.li,strong=_rdf.strong,em=_rdf.em,img=_rdf.img,form=_rdf.form,label=_rdf.label,input=_rdf.input,textarea=_rdf.textarea,button=_rdf.button,iframe=_rdf.iframe,h1=_rdf.h1,h2=_rdf.h2,h3=_rdf.h3,h4=_rdf.h4,h5=_rdf.h5,h6=_rdf.h6,pre=_rdf.pre,code=_rdf.code,select=_rdf.select,option=_rdf.option,section=_rdf.section,optgroup=_rdf.optgroup,fieldset=_rdf.fieldset,legend=_rdf.legend;fragment=React.createElement.bind(null,React.Fragment);fragment.type=React.fragment;P=R["package"]("GameEdit");types=PropTypes;P("Screenshots",{pure:true,propTypes:{},getInitialState:function(){return{}},pick_screenshots:function(){return console.log("pick screenshots")},render:function(){return this.enclose({component:"section",className:"screenshot_editor"},div({className:"label"},this.tt("dashboard.edit_project.screenshots_header")),p({className:"sub"},this.props.is_default?fragment({},"Screenshots will appear on your project's page."," "):void 0,"Optional but highly recommended. Upload 3 to 5 for best results"),div({className:"screenshot_list"}),div({className:"screenshot_queue"}),div({},button({type:"button",className:"button add_screenshot_btn",onClick:this.pick_screenshots},this.tt("dashboard.edit_project.add_screenshots"))))}})})}).call(this);(function(){I.libs.react.done(function(){var P,_rdf,a,br,button,code,div,em,fieldset,form,fragment,h1,h2,h3,h4,h5,h6,iframe,img,input,label,legend,li,ol,optgroup,option,p,pre,section,select,span,strong,textarea,types,ul;_rdf=ReactDOMFactories;div=_rdf.div,span=_rdf.span,a=_rdf.a,br=_rdf.br,p=_rdf.p,ol=_rdf.ol,ul=_rdf.ul,li=_rdf.li,strong=_rdf.strong,em=_rdf.em,img=_rdf.img,form=_rdf.form,label=_rdf.label,input=_rdf.input,textarea=_rdf.textarea,button=_rdf.button,iframe=_rdf.iframe,h1=_rdf.h1,h2=_rdf.h2,h3=_rdf.h3,h4=_rdf.h4,h5=_rdf.h5,h6=_rdf.h6,pre=_rdf.pre,code=_rdf.code,select=_rdf.select,option=_rdf.option,section=_rdf.section,optgroup=_rdf.optgroup,fieldset=_rdf.fieldset,legend=_rdf.legend;fragment=React.createElement.bind(null,React.Fragment);fragment.type=React.fragment;P=R["package"]("GameEdit");types=PropTypes;P("SubProduct",{pure:true,focus:function(){return this.focus_el_ref.current.focus()},render:function(){var out,product;product=this.props.product;out=this.enclose({className:"product_row",style:this.props.style},R.Forms.TextInputRow({title:"Name",placeholder:this.t("misc.forms.required"),ref:this.focus_el_ref||(this.focus_el_ref=React.createRef()),required:true,value:product.name||"",onChange:this.set_name||(this.set_name=function(_this){return function(e){return _this.props.update({name:e.target.value})}}(this))}),R.Forms.ImageUploader({label:"Product cover image",show_replace:true,upload:product.cover_image,thumb_size:this.props.cover_thumb_size,upload_url:this.props.image_upload_url,on_upload:this.set_cover||(this.set_cover=function(_this){return function(upload){return _this.props.update({cover_image_id:upload!=null?upload.id:void 0})}}(this))}),div({className:"input_row"},label({},div({className:"label"},"Description"),R.Redactor({defaultValue:product.description||"",on_change:function(_this){return function(html){return _this.props.update({description:html})}}(this)}))),R.Forms.TextInputRow({title:"Price",money_input:true,currency:this.props.currency,required:true,defaultValue:product.price||"",onKeyUp:this.set_price||(this.set_price=function(_this){return function(e){return _this.props.update({price:e.target.value})}}(this)),placeholder:I.format_money(0,this.props.currency)}),R.Forms.TextInputRow({title:"External ID",sub:"Included in redeem payload & API so your project can identify what is bought",placeholder:"optional",value:product.external_id||"",onChange:this.set_external_id||(this.set_external_id=function(_this){return function(e){return _this.props.update({external_id:e.target.value})}}(this))}),div({className:"input_row"},div({className:"label"},"Options"),ul({className:"check_list"},li({},label({},input({type:"checkbox",checked:product.require_ownership||false,onChange:function(_this){return function(e){return _this.props.update({require_ownership:e.target.checked})}}(this)}),"Require ownership of parent project")),li({},label({},input({type:"checkbox",checked:product.fixed_price||false,onChange:function(_this){return function(e){return _this.props.update({fixed_price:e.target.checked})}}(this)}),"Fixed price",span({className:"sub"}," — Don't let buyers leave a tip above min price with 'Pay What You Want'"))),li({},label({},input({type:"checkbox",checked:product.disable_gifting||false,onChange:function(_this){return function(e){return _this.props.update({disable_gifting:e.target.checked})}}(this)}),"Disable Gifting",span({className:"sub"}," — Prevent purchases being gifted to a different email address"))),li({},label({},input({type:"checkbox",checked:product.published||false,onChange:function(_this){return function(e){return _this.props.update({published:e.target.checked})}}(this)}),"Published")))),div({className:"buttons"},product.url?a({href:product.url,target:"_blank",className:"button small"},"Buy Link"," ",R.Icons.External):void 0," ",!(this.props.first&&this.props.last)?R.RowMover({move_up:this.move_up||(this.move_up=function(_this){return function(){return _this.props.move_up()}}(this)),move_down:this.move_down||(this.move_down=function(_this){return function(){return _this.props.move_down()}}(this)),first:this.props.first,last:this.props.last}):void 0," ",button({type:"button",className:"button small outline delete_btn",onClick:function(_this){return function(){if(confirm("Are you sure you want to remove this product")){return _this.props.remove()}}}(this)},R.Icons.Close({width:14})," ","Delete Product")));if(product.just_added){return R.SlideDown({duration:500},out)}else{return out}}});P("RedeemSettings",{getInitialState:function(){return{}},display_secret:function(){var raw_secret;raw_secret=this.state.secret||this.props.secret;if(this.state.display_secret){return raw_secret}else{return raw_secret.substr(0,5)+"... Click to reveal"}},click_reset_secret:function(){if(!confirm("Are you sure you want to regenerate your secret? Any applications using it will have to be updated")){return}return $.post(this.props.regenerate_secret_url,I.with_csrf()).done(function(_this){return function(res){if(res.success){I.flash("Regenerated secret");return _this.setState({secret:res.secret},function(){var ref,ref1;return(ref=_this.secret_input_ref)!=null?(ref1=ref.current)!=null?typeof ref1.focus==="function"?ref1.focus():void 0:void 0:void 0})}}}(this))},render:function(){return section({},h3({},"Redeem settings"),p({},"Configure a redeem URL to send buyers back to your project to claim access to what they bought. ",a({href:this.props.docs_url,className:"forward_link",target:"_blank"},"Learn more")),R.Forms.TextInputRow({title:"URL",name:"redeem_settings[redeem_url]",placeholder:"Required to redeem products by URL",defaultValue:this.props.redeem_url}),this.props.secret?R.Forms.TextInputRow({title:"Secret",ref:this.secret_input_ref||(this.secret_input_ref=React.createRef()),sub:fragment({},"Secret key used to sign JWT payload"," ",this.props.regenerate_secret_url?button({type:"button",className:"button small outline",onClick:this.click_reset_secret},"Regenerate..."):void 0),className:"redeem_secret_input",readonly:true,value:this.display_secret(),onFocus:function(_this){return function(e){var target;target=e.target;return _this.setState({display_secret:true},function(){return target.select()})}}(this),onBlur:function(_this){return function(){return _this.setState({display_secret:false})}}(this)}):void 0)}});P("EditSubProducts",{getInitialState:function(){return{products:_.toArray(this.props.products)}},add_new_product:function(){return this.list_ref.current.add({just_added:true},function(_this){return function(c){return c.focus()}}(this))},render_products:function(){return div({className:"products"},R.ListManager({animate:true,ref:this.list_ref||(this.list_ref=React.createRef()),on_list_update:function(_this){return function(items){return _this.setState({products:items})}}(this),item_name:"product",initial_items:this.state.products,item_component:P.SubProduct,item_props:function(_this){return function(){return{image_upload_url:_this.props.image_upload_url,cover_thumb_size:_this.props.cover_thumb_size,currency:_this.props.currency}}}(this),empty_content:div({className:"empty_message"},"You don't have any products")}))},render:function(){return this.enclose({},form({method:"POST",className:"form",onSubmit:function(_this){return function(e){e.preventDefault();_this.setState({loading:true,errors:null});return I.remote_submit($(e.target)).then(function(res){if(res.errors){_this.setState({errors:res.errors});return}if(res.redirect_to){return window.location=res.redirect_to}})}}(this)},R.CSRF({}),input({type:"hidden",name:"sub_products",value:JSON.stringify(this.state.products)}),h2({},"Sub-products & DLC"),p({},span({className:"icon-warning"})," ",strong({},"Warning: "),"This is a pre-release feature, use at your own risk!"," ",a({href:this.props.docs_url},"Learn more")),section({},div({className:"buttons"},button({type:"button",onClick:this.add_new_product,className:"button"},span({className:"icon-plus"})," Add new product")),this.state.errors?R.Forms.FormErrors({errors:this.state.errors,scroll_into_view:true}):void 0,this.render_products()),this.props.redeem_settings||this.state.products.length?P.RedeemSettings(Object.assign({docs_url:this.props.docs_url},this.props.redeem_settings)):void 0,div({className:"buttons"},button({className:"button"},"Save"))))}})})}).call(this);(function(){I.libs.react.done(function(){var P,_rdf,a,br,button,code,div,em,fieldset,form,fragment,h1,h2,h3,h4,h5,h6,iframe,img,input,label,legend,li,ol,optgroup,option,p,pre,section,select,span,strong,textarea,types,ul;_rdf=ReactDOMFactories;div=_rdf.div,span=_rdf.span,a=_rdf.a,br=_rdf.br,p=_rdf.p,ol=_rdf.ol,ul=_rdf.ul,li=_rdf.li,strong=_rdf.strong,em=_rdf.em,img=_rdf.img,form=_rdf.form,label=_rdf.label,input=_rdf.input,textarea=_rdf.textarea,button=_rdf.button,iframe=_rdf.iframe,h1=_rdf.h1,h2=_rdf.h2,h3=_rdf.h3,h4=_rdf.h4,h5=_rdf.h5,h6=_rdf.h6,pre=_rdf.pre,code=_rdf.code,select=_rdf.select,option=_rdf.option,section=_rdf.section,optgroup=_rdf.optgroup,fieldset=_rdf.fieldset,legend=_rdf.legend;fragment=React.createElement.bind(null,React.Fragment);fragment.type=React.fragment;P=R["package"]("GameEdit");types=PropTypes;P("EditTools",{propTypes:{tool_tags_url:types.string.isRequired,tools:types.oneOfType([types.array,types.object]),tool_tags:types.oneOfType([types.array,types.object]),selected_tools:types.oneOfType([types.array,types.object]),feedback_url:types.string},getInitialState:function(){var id,out,ref,tool;out={selected_tools:_.toArray(this.props.selected_tools),loading_tools:{},loading_count:0,loaded_tools:{}};if(this.props.preloaded_tool_tags){ref=this.props.preloaded_tool_tags;for(id in ref){tool=ref[id];out.loading_tools[id]=$.when(tool);out.loaded_tools[id]=tool}}return out},componentDidUpdate:function(){return this.load_selected_tools()},load_selected_tools:function(){var i,id,len,ref,results;ref=this.state.selected_tools;results=[];for(i=0,len=ref.length;i<len;i++){id=ref[i];results.push(this.get_tool_tags(id))}return results},find_tool:function(id){var i,len,ref,tool;ref=this.props.tools;for(i=0,len=ref.length;i<len;i++){tool=ref[i];if(tool.id===id){return tool}}},get_tool_tags:function(tool_id){var cache;cache=this.state.loading_tools;if(cache[tool_id]){return cache[tool_id]}this.setState({loading_count:this.state.loading_count+1});cache[tool_id]=$.ajax({url:this.props.tool_tags_url.replace(/:tool_id\b/,tool_id),dataType:"json"}).done(function(_this){return function(res){_this.state.loaded_tools[res.id]=res;return _this.setState({loading_count:_this.state.loading_count-1})}}(this));return this.setState({loading_tools:cache})},componentDidMount:function(){var el;this.load_selected_tools();el=$(this.tool_selector_input_ref.current.get_input_el());return el.selectize({delimiter:",",plugins:["remove_button"],closeAfterSelect:true,valueField:"id",labelField:"name",searchField:["name"],options:this.props.tools,onChange:function(_this){return function(){var id;return _this.setState({selected_tools:function(){var i,len,ref,results;ref=el[0].selectize.items;results=[];for(i=0,len=ref.length;i<len;i++){id=ref[i];results.push(+id)}return results}()})}}(this)})},render:function(){var loading;loading=this.state.loading_count>0;return this.enclose({className:"tool_picker"},form({className:"form",method:"post"},R.CSRF({}),R.Forms.TextInputRow({ref:this.tool_selector_input_ref||(this.tool_selector_input_ref=React.createRef()),title:"Engines & tools",sub:this.props.explanation,name:"tools",placeholder:"Click to view options, type to filter",defaultValue:this.state.selected_tools.join(",")}),p({},"Are we missing an option? Please help our database: ",a({target:"_blank",href:this.props.tool_suggestion_url},"suggest new tool, engine, or device")),this.render_tool_options(),div({className:"button_row"},button({className:classNames("button",{disabled:loading}),disabled:loading},"Save"),loading?div({className:"loader"}):void 0)))},render_tool_options:function(){if(!this.state.selected_tools.length){return}return div({className:"tool_option_list"},this.state.selected_tools.map(function(_this){return function(tool_id){var ref,selected_tags,tool_options;selected_tags=_.toArray(_this.props.tool_tags).filter(function(t){return t.tool_id===tool_id});tool_options=_this.state.loaded_tools[tool_id];if(!(tool_options!=null?(ref=tool_options.groups)!=null?ref.length:void 0:void 0)){return}return R.GameEdit.EditToolOptions({tool:tool_options,key:tool_id,feedback_url:_this.props.feedback_url,selected_tags:selected_tags})}}(this)))}});P("EditToolOptions",{propTypes:{tool:types.object.isRequired,selected_tags:types.array},componentDidMount:function(){var container,el,g,group,group_id,groups_by_id,i,j,len,len1,ref,ref1,results;groups_by_id={};ref=this.props.tool.groups;for(i=0,len=ref.length;i<len;i++){g=ref[i];groups_by_id[g.id]=g}container=$(ReactDOM.findDOMNode(this));ref1=container.find(".multi_input");results=[];for(j=0,len1=ref1.length;j<len1;j++){el=ref1[j];el=$(el);group_id=+el.data("group_id");group=groups_by_id[group_id];if(!group){continue}results.push(function(el,group){return el.selectize({delimiter:",",plugins:["remove_button"],closeAfterSelect:true,valueField:"id",labelField:"name",searchField:["name"],options:group.tags})}(el,group))}return results},render:function(){return this.enclose({className:"tool"},h3({},this.props.tool.name),div({className:"tool_tag_groups",children:this.props.tool.groups.map(function(_this){return function(group,idx){var selected;selected=_this.props.selected_tags.filter(function(t){return t.tool_tag_group_id===group.id});return div({className:"tool_tag_group input_row",key:"group-"+idx},label({},div({className:"group_title label"},group.name),function(){switch(group.type){case"multi":return this.render_multi(group,selected);case"single":return this.render_single(group,selected)}}.call(_this)))}}(this))}),this.props.feedback_url?div({className:"missing_something"},"Don't see something that should be here? ",a({href:"#",onClick:function(_this){return function(e){var url;e.preventDefault();url=_this.props.feedback_url+"?"+$.param({url:window.location.href,type:"tool",tool_id:_this.props.tool.id});return I.Lightbox.open_remote(url,I.FeedbackLightbox)}}(this)},"Tell us")):void 0)},input_name:function(group){return"tool_group_taggings["+group.id+"]"},render_single:function(group,selected){var options,ref;options=group.tags.map(function(_this){return function(option){return[option.id,option.name]}}(this));options.unshift(["",""]);return R.Forms.Select({name:this.input_name(group),defaultValue:(ref=selected[0])!=null?ref.tool_tag_id:void 0,selectize:{placeholder:"Select one, backspace to clear"},options:options})},render_multi:function(group,selected){var s,value;value=function(){var i,len,results;results=[];for(i=0,len=selected.length;i<len;i++){s=selected[i];results.push(s.tool_tag_id)}return results}().join(",");return input({type:"text",className:"multi_input","data-group_id":group.id,name:this.input_name(group),defaultValue:value,placeholder:"Select all that apply"})}})})}).call(this);(function(){I.libs.react.done(function(){var P,_rdf,a,br,button,code,div,em,fieldset,form,fragment,h1,h2,h3,h4,h5,h6,iframe,img,input,key_counter,label,legend,li,ol,optgroup,option,p,pre,section,select,span,strong,textarea,types,ul;_rdf=ReactDOMFactories;div=_rdf.div,span=_rdf.span,a=_rdf.a,br=_rdf.br,p=_rdf.p,ol=_rdf.ol,ul=_rdf.ul,li=_rdf.li,strong=_rdf.strong,em=_rdf.em,img=_rdf.img,form=_rdf.form,label=_rdf.label,input=_rdf.input,textarea=_rdf.textarea,button=_rdf.button,iframe=_rdf.iframe,h1=_rdf.h1,h2=_rdf.h2,h3=_rdf.h3,h4=_rdf.h4,h5=_rdf.h5,h6=_rdf.h6,pre=_rdf.pre,code=_rdf.code,select=_rdf.select,option=_rdf.option,section=_rdf.section,optgroup=_rdf.optgroup,fieldset=_rdf.fieldset,legend=_rdf.legend;fragment=React.createElement.bind(null,React.Fragment);fragment.type=React.fragment;P=R["package"]("GameEdit");types=PropTypes;key_counter=0;P("UploadToolsLightbox",{submit_handler:function(e){var ref;e.preventDefault();if((ref=this.state)!=null?ref.loading:void 0){return}this.setState({loading:true,errors:null});return $.post("/uploads/"+this.props.upload.id,I.with_csrf({action:"download"})).done(function(_this){return function(res){_this.setState({loading:false});if(res.errors){return _this.setState({errors:res.errors})}else if(res.url){return window.location=res.url}}}(this))},render:function(){var ref,ref1,ref2,ref3,ref4;return R.Lightbox({className:classNames(this.enclosing_class_name(),"compact")},h2({},this.props.upload.display_name||this.props.upload.filename),div({className:"download_form"},h3({},"Download"),p({},"Need to make a backup? You can download the file exactly as it was uploaded."),((ref=this.state)!=null?ref.errors:void 0)?ul({className:"form_errors"},this.state.errors.map(function(err){return li({key:err},err)})):void 0,form({className:"form",onSubmit:this.submit_handler},R.CSRF({}),button({name:"action",disabled:(ref1=(ref2=this.state)!=null?ref2.loading:void 0)!=null?ref1:false,value:"download",className:classNames("button",{disabled:(ref3=(ref4=this.state)!=null?ref4.loading:void 0)!=null?ref3:false})},"Download"))))}});P("UploadList",{propTypes:{uploads:types.array.isRequired,game_min_price:types.number,disable_payments:types.bool,currency:types.string.isRequired,money_placeholder:types.string.isRequired},componentDidMount:function(){this.dispatch("upload",{move_up:function(_this){return function(e,idx){var old,uploads;uploads=_this.props.uploads;old=uploads[idx-1];uploads[idx-1]=uploads[idx];uploads[idx]=old;return _this.forceUpdate()}}(this),move_down:function(_this){return function(e,idx){var old,uploads;uploads=_this.props.uploads;old=uploads[idx+1];uploads[idx+1]=uploads[idx];uploads[idx]=old;return _this.forceUpdate()}}(this),delete:function(_this){return function(e,idx){var file_upload;file_upload=_this.props.uploads[idx];if(confirm("Are you sure you want to delete "+(file_upload.upload.filename||"this file")+"?")){return file_upload.delete_upload()}}}(this),update_upload:function(_this){return function(e,upload,field,value){var file,i,len,ref,update,updated_file;updated_file=false;ref=_this.props.uploads;for(i=0,len=ref.length;i<len;i++){file=ref[i];if(file.upload!==upload){continue}update={};update[field]=value;file.upload=$.extend({},upload,update);updated_file=file;break}if(!updated_file){console.error("failed to update upload",upload);return}if(field==="embed"&&value){_this.clear_other_embeds(updated_file)}_this.forceUpdate();return _this.trigger("game:update_upload",updated_file)}}(this),open_channel:function(_this){return function(e,upload){var lightbox_data;lightbox_data={channel_name:upload.channel_name,game:{id:_this.props.game_id}};return I.Lightbox.open_remote(upload.channel_lightbox_url,I.DashboardGameChannelLightbox,lightbox_data)}}(this)});return document.addEventListener("DOMContentLoaded",function(_this){return function(){var i,len,ref,results,upload;ref=_this.props.uploads;results=[];for(i=0,len=ref.length;i<len;i++){upload=ref[i];if(upload.upload.open_lightbox){_this.trigger("upload:open_channel",upload.upload);break}else{results.push(void 0)}}return results}}(this))},clear_other_embeds:function(current_file){var file,i,len,ref,results,upload_idx;ref=this.props.uploads;results=[];for(upload_idx=i=0,len=ref.length;i<len;upload_idx=++i){file=ref[upload_idx];if(file===current_file){continue}results.push(file.upload=$.extend({},file.upload,{embed:false}))}return results},render:function(){var upload_in_progress,uploaders;upload_in_progress=false;uploaders=this.props.uploads.map(function(_this){return function(upload,idx){upload._react_id||(upload._react_id="key-"+key_counter++);if(upload.state==="uploading"){upload_in_progress=true}return P.Uploader(_this.extend_props({key:upload._react_id,idx:idx,upload:upload.upload,progress_percent:upload.progress_percent,state:upload.state,can_embed:upload.valid_for_embed()}))}}(this));return this.enclose({},div({className:classNames("file_list",{has_files:this.props.uploads.length>0})},uploaders),upload_in_progress?div({className:"uploading_message"},div({className:"loader"}),"Do not close this page while uploads are in progress"):void 0)}});P("Uploader",{pure:true,propTypes:{currency:types.string.isRequired,money_placeholder:types.string.isRequired,can_embed:types.bool,state:types.oneOf(["uploading","ready","failed"]).isRequired,idx:types.number.isRequired,progress_percent:types.number,upload:types.shape({id:types.number,position:types.number,filename:types.string}).isRequired},getInitialState:function(){return{min_price_enabled:this.props.upload.min_price&&this.props.upload.min_price>0}},componentDidMount:function(){if(this.props.upload.just_created){delete this.props.upload.just_created;return this.setState({edit_display_name:true})}},input_name:function(name){if(!this.props.upload){return}return"upload["+this.props.upload.id+"]["+name+"]"},update_upload:function(field,value){return this.trigger("upload:update_upload",this.props.upload,field,value)},render:function(){switch(this.props.state){case"ready":return this.render_ready();case"failed":return this.render_failed();case"uploading":return this.render_uploading()}},render_uploading:function(){var upload;upload=this.props.upload;return div({className:"uploader is_uploading"},div({className:"upload_content"},div({className:"upload_title"},upload.external?span({className:"progress_message"},"Creating"):[strong({className:"upload_display_name",key:"dp"},I.truncate(upload.display_name||upload.filename,80)),span({className:"progress_message",key:"pm"}," · Uploading")]),div({className:"progress"},div({className:"progress_inner",style:{right:100-this.props.progress_percent+"%"}}))))},render_failed:function(){return div({className:"uploader"},div({className:"upload_content"},div({className:"error_message"},"There was a problem completing your upload. Try again. If the problem persists ",a({target:"_blank",href:"/support"},"contact support"),".")))},render_ready:function(){var classes,upload;upload=this.props.upload;classes=classNames("uploader",{is_hidden:this.props.upload.hidden,is_embed:this.props.can_embed&&this.props.upload.embed,is_demo:this.props.upload.demo,is_preorder:this.props.upload.preorder,is_external:this.props.upload.external,delete_hover:this.state.hover_delete});return div({className:classes},input({type:"hidden",name:this.input_name("position"),value:this.props.idx}),input({type:"hidden",name:this.input_name("description"),value:upload.description}),div({className:"upload_tools"},button({type:"button",className:"more_btn textlike",onClick:function(_this){return function(){return I.Lightbox.open(R.GameEdit.UploadToolsLightbox({upload:upload}))}}(this)},this.tt("misc.more_ellip")),button({type:"button",className:"delete_btn",onMouseEnter:function(_this){return function(){return _this.setState({hover_delete:true})}}(this),onMouseLeave:function(_this){return function(){return _this.setState({hover_delete:false})}}(this),onClick:function(_this){return function(){return _this.trigger("upload:delete",_this.props.idx)}}(this)},this.tt("dashboard.edit_project.uploads.delete_file_button"))),div({className:"upload_content"},div({className:"upload_title"},input({name:this.input_name("display_name"),type:"hidden",value:upload.display_name||""}),this.state.edit_display_name?P.InlineEdit({initial_value:upload.display_name||upload.filename||"",placeholder:"Enter a display name",finished:function(_this){return function(value){_this.setState({edit_display_name:false});if(value.match(/^\s*$/)){value=null}if(value===upload.filename){value=null}return _this.update_upload("display_name",value)}}(this)}):[strong({className:"upload_display_name",key:"dn"},I.truncate(upload.display_name||upload.filename,80)),this.props.just_uploaded?span({className:"success_message",key:"sm"}," · Success"):void 0,upload.display_name?div({className:"upload_fname",key:"uf"},I.truncate(upload.filename,80)):void 0]),this.render_meta_data(),upload.uploaded_at||upload.downloads?div({className:"upload_stats"},!(this.props.can_embed&&upload.embed)&&upload.downloads!=null?span({},I.number_format(upload.downloads)+" Download"+(upload.downloads===1&&""||"s"),upload.uploaded_at?", ":void 0):void 0,upload.uploaded_at?span({title:upload.uploaded_at+" UTC"},I.format_timestamp(upload.uploaded_at,"calendar")):void 0):void 0,div({className:"upload_type"},this.render_type_picker(),this.render_platform_picker(),this.render_channel()),this.render_external_url_row(),this.render_price_picker(),this.render_demo_toggle(),this.render_preorder_toggle(),this.render_embed_toggle(),this.render_hidden_toggle()))},render_external_url_row:function(){if(!this.props.upload.external){return false}return div({className:"external_url_row"},input({type:"text",defaultValue:this.props.upload.url||"",className:"external_url_input",name:this.input_name("url"),placeholder:"http://",required:"required"}))},render_meta_data:function(){var upload;upload=this.props.upload;return div({className:"meta_data"},upload.external?span({className:"external_label"},"External file"):span({className:"file_size"},I.format_bytes(upload.size)),span({className:"display_name_wrap"}," · ",a({href:"#",className:"set_display_name_btn",onClick:function(_this){return function(e){e.preventDefault();return _this.setState({edit_display_name:!_this.state.edit_display_name})}}(this)},this.tt("dashboard.edit_project.uploads.change_display_name_button"))),span({className:"move_up_wrap"}," · ",a({href:"#",className:"move_up_btn",onClick:function(_this){return function(e){e.preventDefault();return _this.trigger("upload:move_up",_this.props.idx)}}(this)},"Move up")),span({className:"move_down_wrap"}," · ",a({href:"#",className:"move_down_btn",onClick:function(_this){return function(e){e.preventDefault();return _this.trigger("upload:move_down",_this.props.idx)}}(this)},"Move down")))},render_type_picker:function(){var can_embed,ref,upload;ref=this.props,upload=ref.upload,can_embed=ref.can_embed;if(can_embed&&upload.embed){return}return R.Forms.SimpleSelect({name:this.input_name("type"),value:this.props.upload.type||"default",onChange:function(_this){return function(type){return _this.update_upload("type",type)}}(this),options:[{name:"Executable",value:"default"},{name:"Soundtrack",value:"soundtrack"},{name:"Source code",value:"sourcecode"},{name:"Book",value:"book"},{name:"Video",value:"video"},{name:"Documentation",value:"documentation"},{name:"Mod",value:"mod"},{name:"Graphical assets",value:"graphical_assets"},{name:"Audio assets",value:"audio_assets"},{name:"Other",value:"other"}]})},render_channel:function(){if(!this.props.upload.channel_name){return}return a({href:"#",title:"Channel: "+this.props.upload.channel_name,className:"channel_link open_channel_btn",onClick:function(_this){return function(e){e.preventDefault();return _this.trigger("upload:open_channel",_this.props.upload)}}(this)},span({className:"icon icon-upload"}),this.props.upload.channel_name)},render_platform_picker:function(){var can_embed,ref,upload;ref=this.props,upload=ref.upload,can_embed=ref.can_embed;if(can_embed&&upload.embed){return}if(!(this.props.upload.type==="default"||!this.props.upload.type)){return}return div({className:"platform_list"},span({className:"platforms_for"}," for "),[["p_windows","windows8","Download for Windows"],["p_linux","tux","Download for Linux"],["p_osx","apple","Download for Mac OS X"],["p_android","android","Download for Android"]].map(function(_this){return function(arg){var classes,field,icon,title;field=arg[0],icon=arg[1],title=arg[2];classes=classNames({platform_picker:true,chosen:_this.props.upload[field]});return label({key:field,className:classes},input({name:_this.input_name(field),"data-name":field,type:"checkbox",className:"checkbox",checked:_this.props.upload[field]||false,onChange:function(){return _this.update_upload(field,!_this.props.upload[field])}}),span({title:title,className:"icon icon-"+icon}))}}(this)))},render_price_picker:function(){var default_value,has_price_error,min_price,ref;if(this.props.can_embed&&this.props.upload.embed){return false}if(this.props.upload.demo){return false}if(this.props.disable_payments){return false}has_price_error=this.props.upload.min_price&&this.props.upload.min_price<=this.props.game_min_price;return div({className:"upload_price_picker"},div({className:"min_price_toggle"},label({},input({type:"checkbox",className:"checkbox min_price_toggle_input",checked:this.state.min_price_enabled||false,onChange:function(_this){return function(){return _this.setState({min_price_enabled:!_this.state.min_price_enabled})}}(this)}),this.tt("dashboard.edit_project.uploads.set_price_toggle"))),this.state.min_price_enabled?(min_price=(ref=this.props.upload.min_price)!=null?ref:0,default_value=I.format_money(min_price,this.props.currency),div({className:"min_price_input_row input_row"},label({},div({className:"label"},"Minimum Price"),p({className:"sub"},"The minimum price for a file should be greater than the minimum price for the entire project. You should only set this if the file's minimum price is different than the project's."),P.MoneyInput({"data-currency":this.props.currency,name:this.input_name("min_price"),placeholder:this.props.money_placeholder,className:classNames("file_min_price",{has_error:has_price_error}),defaultValue:default_value,onKeyUp:function(_this){return function(e){return _this.update_upload("min_price",I.parse_money($(e.target).val()))}}(this)}),has_price_error?span({className:"price_error"},"Should be greater than the project's minimum price"):void 0))):void 0)},render_field_toggle:function(opts){var classes;if(!opts.field){throw"missing field"}classes=classNames("upload_field_toggle",opts.className);return div({className:classes},label({},input({name:this.input_name(opts.field),type:"checkbox","data-field":opts.field,className:"checkbox",checked:this.props.upload[opts.field]||false,onChange:function(_this){return function(){return _this.update_upload(opts.field,!_this.props.upload[opts.field])}}(this)}),opts.label))},render_demo_toggle:function(){if(this.props.upload.hidden){return false}if(this.props.can_embed&&this.props.upload.embed){return false}if(this.props.game_min_price===0){return false}if(this.props.disable_payments){return false}return this.render_field_toggle({field:"demo",label:this.tt("dashboard.edit_project.uploads.demo_toggle")})},render_preorder_toggle:function(){if(this.props.upload.hidden){return false}if(this.props.can_embed&&this.props.upload.embed){return false}if(this.props.upload.demo){return false}if(this.props.upload.external){return false}if(this.props.game_min_price===0){return false}if(this.props.disable_payments){return false}return this.render_field_toggle({field:"preorder",label:this.tt("dashboard.edit_project.uploads.preorder_toggle")})},render_embed_toggle:function(){if(this.props.upload.hidden){return false}if(this.props.upload.demo){return false}if(this.props.upload.external){return false}if(!this.props.can_embed){return false}return this.render_field_toggle({field:"embed",label:this.tt("dashboard.edit_project.uploads.play_in_browser_toggle")})},render_hidden_toggle:function(){if(this.props.upload.embed){return false}return this.render_field_toggle({field:"hidden",label:this.tt("dashboard.edit_project.uploads.hide_toggle")})}});P("InlineEdit",{propTypes:{initial_value:types.string.isRequired,placeholder:types.string,finished:types.func},componentDidMount:function(){var click_handler,el;el=$(ReactDOM.findDOMNode(this));el.focus().select();click_handler=function(_this){return function(e){var base,inside;if(_this.isMounted()){inside=$(e.target).closest(el).length;if(inside){return}if(typeof(base=_this.props).finished==="function"){base.finished(_this.value())}}return $(document.body).off("click",click_handler)}}(this);return $(document.body).on("click",click_handler)},value:function(){return $(ReactDOM.findDOMNode(this)).val()},render:function(){return input({type:"text",className:"inline_edit_input",placeholder:this.props.placeholder,defaultValue:this.props.initial_value,onKeyDown:function(_this){return function(e){var base,base1;switch(e.keyCode){case 9:return _.defer(function(){var base;return typeof(base=_this.props).finished==="function"?base.finished(_this.value()):void 0});case 13:e.preventDefault();return typeof(base=_this.props).finished==="function"?base.finished(_this.value()):void 0;case 27:e.preventDefault();return typeof(base1=_this.props).finished==="function"?base1.finished(_this.props.initial_value):void 0}}}(this)})}});P("MoneyInput",{componentDidMount:function(){var el;el=$(ReactDOM.findDOMNode(this));return I.money_input(el)},render:function(){return input($.extend({type:"text",ref:"input"},this.props))}})})}).call(this);(function(){I.libs.react.done(function(){var COLOR_FIELDS,P,SIZES,_rdf,a,br,button,code,div,em,fieldset,form,fragment,h1,h2,h3,h4,h5,h6,iframe,img,input,label,legend,li,ol,optgroup,option,p,pre,section,select,span,strong,textarea,types,ul;_rdf=ReactDOMFactories;div=_rdf.div,span=_rdf.span,a=_rdf.a,br=_rdf.br,p=_rdf.p,ol=_rdf.ol,ul=_rdf.ul,li=_rdf.li,strong=_rdf.strong,em=_rdf.em,img=_rdf.img,form=_rdf.form,label=_rdf.label,input=_rdf.input,textarea=_rdf.textarea,button=_rdf.button,iframe=_rdf.iframe,h1=_rdf.h1,h2=_rdf.h2,h3=_rdf.h3,h4=_rdf.h4,h5=_rdf.h5,h6=_rdf.h6,pre=_rdf.pre,code=_rdf.code,select=_rdf.select,option=_rdf.option,section=_rdf.section,optgroup=_rdf.optgroup,fieldset=_rdf.fieldset,legend=_rdf.legend;fragment=React.createElement.bind(null,React.Fragment);fragment.type=React.fragment;P=R["package"]("GameEdit");types=PropTypes;SIZES={rectangle:{width:552,height:167},square:{width:208,height:167}};COLOR_FIELDS=[["Background color","bg_color"],["Text color","fg_color"],["Button color","link_color"],["Border color","border_color"]];P("RenderMarkup",{getInitialState:function(){return{}},componentDidUpdate:function(){return this.updateHTML()},componentDidMount:function(){return this.updateHTML()},updateHTML:function(){var el;el=document.createElement("div");return ReactDOM.render(div({ref:function(_this){return function(container){var base,html;html=container.innerHTML;if(_this.state.html!==html){_this.setState({html:html});return typeof(base=_this.props).on_html==="function"?base.on_html(html):void 0}}}(this)},this.props.children),el)},render:function(){return React.createElement("script",{type:"text/render"})}});P("Widget",{propTypes:{widget_url:types.string,default_style:types.object,dark_style:types.object},getInitialState:function(){return{border_width:1}},render:function(){return this.enclose({className:"edit_widget"},p({},"Customize the widget below, then paste the code into a website where you'd like to embed it."),h3({},"Preview"),div({className:"preview"},this.render_widget(true,false)),form({className:"form"},this.render_check_options([{label:"Square",name:"square"},!this.state.square?{label:"Include link to itch.io page",name:"linkback"}:void 0]),div({className:"style_group"},this.render_presets(),this.render_color_options(),this.render_border_option()),div({className:"widget_code"},label({},div({className:"label"},"Code"),textarea({readOnly:true,ref:function(_this){return function(code_el){_this.code_el=code_el}}(this),onClick:function(_this){return function(e){return e.target.select()}}(this)}),P.RenderMarkup({children:this.render_widget(false),on_html:function(_this){return function(html){if(_this.code_el){return _this.code_el.value=html}}}(this)})))),div({className:"embed_directions"},strong({},"Directions:")," Copy and paste this HTML into your website where you want the widget to appear."))},render_check_options:function(options){return div({className:"input_row widget_options"},div({className:"label"},"Options"),ul({className:"check_list"},options.map(function(_this){return function(opt,idx){if(!opt){return}return li({key:opt.name},label({},input({type:"checkbox",checked:!!_this.state[opt.name],onChange:function(e){var u;u={};u[opt.name]=e.target.checked;return _this.setState(u)}}),opt.label,opt.sub?span({className:"sub"}," — "+opt.sub):void 0))}}(this))))},is_dark_style:function(){var _,i,len,name,ref;if(!this.props.dark_style){return}for(i=0,len=COLOR_FIELDS.length;i<len;i++){ref=COLOR_FIELDS[i],_=ref[0],name=ref[1];if(this.state[name]!==this.props.dark_style[name]){return false}}return true},render_widget:function(primary_widget,with_colors){var _,c,field,i,len,ref,size,url,url_params;if(primary_widget==null){primary_widget=true}if(with_colors==null){with_colors=true}url=this.props.widget_url;url_params={};if(this.state.linkback){url_params.linkback="true"}if(with_colors){if(this.state.border_width!==1){url_params.border_width=this.state.border_width}if(this.is_dark_style()){url_params.dark="true"}else{for(i=0,len=COLOR_FIELDS.length;i<len;i++){ref=COLOR_FIELDS[i],_=ref[0],field=ref[1];c=this.state[field];if(!c){continue}url_params[field]=c.replace(/^#/,"")}}}if(!$.isEmptyObject(url_params)){url=url+="?"+$.param(url_params)}size=this.state.square?SIZES.square:SIZES.rectangle;return iframe({ref:primary_widget?"iframe":void 0,frameBorder:"0",src:url,width:size.width+(this.state.border_width-1)*2,height:size.height+(this.state.border_width-1)*2,onLoad:primary_widget?function(_this){return function(){return _this.refresh_style()}}(this):void 0},a({href:this.props.game_url},this.props.game_link_title))},refresh_style:function(){var ref,ref1,w;w=this.refs.iframe.contentWindow;if(!w){return}return(ref=w.I)!=null?(ref1=ref.embed)!=null?typeof ref1.set_style==="function"?ref1.set_style(this.state):void 0:void 0:void 0},render_color_options:function(){return div({className:"color_options",children:COLOR_FIELDS.map(function(_this){return function(arg){var key,name,value;name=arg[0],key=arg[1];value=_this.state[key]||_this.props.default_style[key];return div({key:key,className:"color_column"},label({},div({className:"label"},name),R.Forms.ColorInput({name:key,value:value,onChange:function(color){if(color===_this.props.default_style[key]){delete _this.state[key]}else{_this.state[key]=color}return _this.forceUpdate(_this.refresh_style)}})))}}(this))})},render_border_option:function(){return div({className:"input_row border_option"},label({},div({className:"label"},"Border size"),R.Forms.Slider({min:0,max:5,value:this.state.border_width,onChange:function(_this){return function(width){return _this.setState({border_width:width},_this.refresh_style)}}(this)}),span({className:"border_value"},this.state.border_width+"px")))},set_preset:function(t){var _,i,j,len,len1,name,ref,ref1,u;if(t){u={};for(i=0,len=COLOR_FIELDS.length;i<len;i++){ref=COLOR_FIELDS[i],_=ref[0],name=ref[1];u[name]=t[name]}return this.setState(u)}else{for(j=0,len1=COLOR_FIELDS.length;j<len1;j++){ref1=COLOR_FIELDS[j],_=ref1[0],name=ref1[1];delete this.state[name]}return this.forceUpdate()}},render_presets:function(){return div({className:"style_presets"},div({className:"label"},"Preset: "),button({type:"button",className:"button outline small",onClick:function(_this){return function(){return _this.set_preset(null)}}(this)},"Default"),button({type:"button",className:"button outline small",onClick:function(_this){return function(){return _this.set_preset(_this.props.dark_style)}}(this)},"Dark"),this.props.game_style?button({type:"button",className:"button outline small",onClick:function(_this){return function(){return _this.set_preset(_this.props.game_style)}}(this)},"Your page style"):void 0)}})})}).call(this);(function(){I.libs.react.done(function(){var P,TWITTER_URLS,_rdf,a,br,button,code,div,em,fieldset,form,fragment,h1,h2,h3,h4,h5,h6,iframe,img,input,label,legend,li,ol,optgroup,option,p,pre,referrer_table_renderers,section,select,span,strong,textarea,types,ul,indexOf=[].indexOf||function(item){for(var i=0,l=this.length;i<l;i++){if(i in this&&this[i]===item)return i}return-1};_rdf=ReactDOMFactories;div=_rdf.div,span=_rdf.span,a=_rdf.a,br=_rdf.br,p=_rdf.p,ol=_rdf.ol,ul=_rdf.ul,li=_rdf.li,strong=_rdf.strong,em=_rdf.em,img=_rdf.img,form=_rdf.form,label=_rdf.label,input=_rdf.input,textarea=_rdf.textarea,button=_rdf.button,iframe=_rdf.iframe,h1=_rdf.h1,h2=_rdf.h2,h3=_rdf.h3,h4=_rdf.h4,h5=_rdf.h5,h6=_rdf.h6,pre=_rdf.pre,code=_rdf.code,select=_rdf.select,option=_rdf.option,section=_rdf.section,optgroup=_rdf.optgroup,fieldset=_rdf.fieldset,legend=_rdf.legend;fragment=React.createElement.bind(null,React.Fragment);fragment.type=React.fragment;P=R["package"]("GameEdit");types=PropTypes;TWITTER_URLS=["https://t.co/","https://t.co/","t.co"];referrer_table_renderers={domain:function(row,col){var value;value=row[col.field];return fragment({},I.truncate(value,80),indexOf.call(TWITTER_URLS,value)>=0?span({className:"sub"}," (Twitter)"):void 0)},referrer:function(row,col){var value;value=row[col.field];return fragment({},a({href:value,rel:"noopener noreferrer",target:"_blank"},I.truncate(value,80)),indexOf.call(TWITTER_URLS,value)>=0?span({className:"sub"}," (Twitter)"):void 0)}};P("ReferrerAnalytics",{getInitialState:function(){return{current_tab:this.props.by_url?"by_url":"by_domain",by_url:this.props.by_url,by_domain:this.props.by_domain}},set_tab:function(name){var name1;this.setState({current_tab:name,errors:null,loading:!this.state[name]});if(!this.state[name]){return this[name1="loading_"+name]||(this[name1]=$.getJSON("",{data:"referrers_"+name}).done(function(_this){return function(res){if(res.errors){_this.setState({errors:res.errors});return}_this.setState(res);if(_this.state.current_tab===name){return _this.set_tab(name)}}}(this)))}},render:function(){return this.enclose({},div({className:"split_tools"},ul({className:"page_tabs"},button({type:"button",className:classNames("tab",{active:this.state.current_tab==="by_url"}),onClick:function(_this){return function(e){return _this.set_tab("by_url")}}(this)},"By URL"),button({type:"button",className:classNames("tab",{active:this.state.current_tab==="by_domain"}),onClick:function(_this){return function(e){return _this.set_tab("by_domain")}}(this)},"By website/domain")),button({type:"button",className:"button outline",onClick:function(_this){return function(e){e.preventDefault();return I.Lightbox.open(R.GameEdit.ReferrerGraphLightbox({}))}}(this)},"Graph by day...")),this.state.errors?R.Forms.FormErrors({errors:this.state.errors,animated:true,scroll_into_view:true}):void 0,function(){if(this.state.loading){return div({className:"loader_spinner"})}else{switch(this.state.current_tab){case"by_url":return R.Dashboard.NiceTable({key:"by_url",className:"referrers",columns:[{field:"referrer",label:"Referrer",type:"referrer"},{field:"count",label:"Visits",type:"number"}],field_renderers:referrer_table_renderers,rows:this.state.by_url});case"by_domain":return R.Dashboard.NiceTable({key:"by_domain",className:"referrers",columns:[{field:"domain",label:"Domain",type:"domain"},{field:"count",label:"Visits",type:"number"}],field_renderers:referrer_table_renderers,rows:this.state.by_domain})}}}.call(this))}});P("ReferrerGraphLightbox",{getInitialState:function(){return{loading:true}},componentDidMount:function(){this.setState({loading:true});return $.getJSON("",{graph:"referrers"}).done(function(_this){return function(res){if(res.errors){return _this.setState({loading:false,errors:res.errors})}else{return _this.setState({loading:false,graph:res})}}}(this))},render:function(){return R.Lightbox({className:this.enclosing_class_name()},h2({},"Referrers by day"),this.state.loading?div({className:"loader_spinner"}):this.state.errors?R.Forms.FormErrors({errors:this.state.errors}):this.state.graph?R.SlideDown({},P.Graph({label:"Views",min_y:3,height:220,range_left:this.state.graph.range_left,range_right:this.state.graph.range_right,data:this.state.graph.referrers,type:"stacked",class:"graph_container",secondary_field:"domain",y_axis_padding:1.1})):void 0)}});P("Graph",{pure:true,componentDidMount:function(){return this.render_graph()},render_graph:function(){var el,graph_options,ref,ref1;el=this.container();el.html("");graph_options={range_left:this.props.range_left,range_right:this.props.range_right,interval:this.props.interval,width:this.props.width,height:this.props.height,secondary_field:this.props.secondary_field,label:(ref=this.props.label)!=null?ref:"Value",x_ticks:7,min_y:(ref1=this.props.min_y)!=null?ref1:10,y_axis_padding:this.props.y_axis_padding,popup_group:this.props.popup_group,group_url:this.props.group_url};if(this.props.type==="stacked"){return new I.StackedBarGrapher(el,this.props.data,graph_options)}else{return new I.Grapher(el,this.props.data,graph_options)}},componentDidUpdate:function(old_props){return this.render_graph()},render:function(){return this.enclose({className:this.props["class"],style:{height:this.props.height}})}});P("Analytics",{getInitialState:function(){return{range_left:this.props.range_left,range_right:this.props.range_right,group_by:this.props.interval,views:this.props.views,downloads:this.props.downloads,purchases:this.props.purchases,plays:this.props.plays,max_date:this.props.today}},refresh_graphs:function(){var i,len,name,params,ref,ref1,value;if(this.state.loading){return}this.setState({loading:true});params={};ref=this.container().find("input, select").serializeArray();for(i=0,len=ref.length;i<len;i++){ref1=ref[i],name=ref1.name,value=ref1.value;params[name]=value}return $.getJSON("",params).then(function(_this){return function(res){if(res.range_left){return _this.setState($.extend(res,{loading:false}))}}}(this))},on_update_range:function(update){return this.setState(update,function(_this){return function(){return _this.refresh_graphs()}}(this))},render:function(){return this.enclose({className:{loading:this.state.loading}},R.Dashboard.RangePicker({loading:this.state.loading,range_left:this.state.range_left,range_right:this.state.range_right,group_by:this.state.group_by,preset_ranges:this.props.preset_ranges,max_date:this.props.max_date,on_update_range:this.on_update_range}),div({className:"graphs"},P.Graph({class:"graph_container",label:"Views",data:this.state.views,interval:this.state.group_by,range_left:this.state.range_left,range_right:this.state.range_right}),this.state.downloads?P.Graph({class:"graph_container",label:"Downloads",min_y:3,data:this.state.downloads,interval:this.state.group_by,range_left:this.state.range_left,range_right:this.state.range_right}):void 0,this.state.plays&&this.state.plays.length?P.Graph({class:"graph_container",label:"Browser Plays",min_y:3,data:this.state.plays,interval:this.state.group_by,range_left:this.state.range_left,range_right:this.state.range_right}):void 0,this.state.purchases?P.Graph({class:"graph_container",label:"Payments",interval:this.state.group_by,min_y:3,data:this.state.purchases,range_left:this.state.range_left,range_right:this.state.range_right}):void 0))}})})}).call(this);(function(){I.libs.react.done(function(){var P,_rdf,a,br,button,code,div,em,fieldset,form,fragment,h1,h2,h3,h4,h5,h6,iframe,img,input,label,legend,li,ol,optgroup,option,p,pre,section,select,span,strong,textarea,types,ul;_rdf=ReactDOMFactories;div=_rdf.div,span=_rdf.span,a=_rdf.a,br=_rdf.br,p=_rdf.p,ol=_rdf.ol,ul=_rdf.ul,li=_rdf.li,strong=_rdf.strong,em=_rdf.em,img=_rdf.img,form=_rdf.form,label=_rdf.label,input=_rdf.input,textarea=_rdf.textarea,button=_rdf.button,iframe=_rdf.iframe,h1=_rdf.h1,h2=_rdf.h2,h3=_rdf.h3,h4=_rdf.h4,h5=_rdf.h5,h6=_rdf.h6,pre=_rdf.pre,code=_rdf.code,select=_rdf.select,option=_rdf.option,section=_rdf.section,optgroup=_rdf.optgroup,fieldset=_rdf.fieldset,legend=_rdf.legend;fragment=React.createElement.bind(null,React.Fragment);fragment.type=React.fragment;P=R["package"]("Dashboard");types=PropTypes;P("GameRatingsReportLightbox",{pure:true,getInitialState:function(){return{submitted:false,reason:null}},show_description:function(){return this.state.reason&&this.state.reason!=="dont_agree"},description_required:function(){switch(this.state.reason){case"other":case"offensive":return true;default:return false}},render:function(){return R.Lightbox({className:classNames(this.enclosing_class_name(),"compact","full_width")},this.state.submitted?this.render_submitted():this.render_report_form())},render_submitted:function(){if(this.state.reason==="dont_agree"){return fragment({},h2({},"Report rating"),p({},"The nature of rating systems is that there will always be a wide range of opinions, and we recognize that a project's average rating is only accurate with a larger number of ratings."),p({},"In order to offset a bad rating we recommend that you encourage those who support your work to leave their own rating & review. The more ratings your project has the more accurate your average rating will be, and the more it can contribute to how your project is discovered across itch.io."),p({},"We do not penalize individual ratings because the creator of the project does not agree with them. Administrative action is only taken if an account is violating our terms or is involved in fraudulent activity to misrepresent a project."),p({},button({className:"button outline",onClick:function(_this){return function(){return I.Lightbox.close()}}(this)},"Got it")))}return fragment({},h2({},"Report submitted"),p({},"Thank you for submitting a report. Our team will review it as soon as we can and take administrative action if necessary."),p({},button({className:"button outline",onClick:function(_this){return function(){return I.Lightbox.close()}}(this)},"Close")))},render_report_form:function(){return fragment({},h2({},"Report rating"),form({className:"form",method:"post",action:this.props.submit_url,onSubmit:function(_this){return function(e){e.preventDefault();if(_this.state.reason==="dont_agree"){_this.setState({submitted:true});return}_this.setState({errors:null,loading:true});return I.remote_submit($(e.target)).done(function(res){if(res.errors){_this.setState({loading:false,errors:res.errors});return}return _this.setState({submitted:true})})}}(this)},this.state.errors?R.Forms.FormErrors({errors:this.state.errors}):void 0,this.props.existing_report?p({},"You already reported this rating ",React.createElement("abbr",{title:this.props.existing_report.created_at},span({className:"icon icon-stopwatch"})," ",I.format_timestamp(this.props.existing_report.created_at)),"."):void 0,R.CSRF({}),div({className:"input_row"},div({className:"label"},"Report reason"),R.Forms.RadioButtons({value:this.state.reason||"",required:true,name:"reason",onChange:function(_this){return function(e){return _this.setState({reason:e.target.value})}}(this),options:this.reason_options||(this.reason_options=[["dont_agree","I don't agree with this rating/review"],["offensive","Abusive or offensive","Violates itch.io community guidelines"],["fraud","Fraudulent or bot activity","Fake account involved with mass rating"],["offtopic","Off-topic","Contents of rating/review unrelated to your project or outside your control (example: An itch.io bug prevented access to project)"],["spam","Spam","Posting unrelated marketing links"],["other","Other"]])})),this.show_description()?label({className:"input_row"},div({className:"label"},"Description"),textarea({maxLength:"2048",name:"description",required:this.description_required(),placeholder:this.description_required()?this.t("misc.forms.required"):this.t("misc.forms.optional")})):void 0,div({className:"buttons"},button({className:classNames("button",{disabled:!this.state.reason||this.state.loading}),disabled:!this.state.reason||this.state.loading},"Submit report"))))}})})}).call(this);(function(){I.libs.react.done(function(){var P,_rdf,a,br,button,code,div,em,fieldset,form,fragment,h1,h2,h3,h4,h5,h6,id,iframe,img,input,label,legend,li,ol,optgroup,option,p,pre,section,select,span,strong,textarea,types,ul,slice=[].slice;_rdf=ReactDOMFactories;div=_rdf.div,span=_rdf.span,a=_rdf.a,br=_rdf.br,p=_rdf.p,ol=_rdf.ol,ul=_rdf.ul,li=_rdf.li,strong=_rdf.strong,em=_rdf.em,img=_rdf.img,form=_rdf.form,label=_rdf.label,input=_rdf.input,textarea=_rdf.textarea,button=_rdf.button,iframe=_rdf.iframe,h1=_rdf.h1,h2=_rdf.h2,h3=_rdf.h3,h4=_rdf.h4,h5=_rdf.h5,h6=_rdf.h6,pre=_rdf.pre,code=_rdf.code,select=_rdf.select,option=_rdf.option,section=_rdf.section,optgroup=_rdf.optgroup,fieldset=_rdf.fieldset,legend=_rdf.legend;fragment=React.createElement.bind(null,React.Fragment);fragment.type=React.fragment;P=R["package"]("JamEdit");types=PropTypes;id=0;P("EditCriteria",{propTypes:{criteria:types.array,can_edit:types.bool},getInitialState:function(){return{criteria:slice.call(this.props.criteria)}},componentDidMount:function(){if(this.props.ref_name){return P.EditCriteria[this.props.ref_name]=this}},set_criteria:function(criteria){return this.list_ref.current.replace_items(criteria)},render:function(){return this.enclose({},this.props.can_edit?input({type:"hidden",name:"jam[update_criteria]",value:"1"}):void 0,this.render_criteria(),this.props.can_edit&&!this.state.criteria.length?p({className:"warning"},"Because this jam is Ranked, you must add at least one criteria for voting to take place."):void 0,this.props.can_edit?div({className:"button_row"},button({type:"button",className:"button add_criteria_btn",onClick:function(_this){return function(e){return _this.list_ref.current.add({just_added:true},function(c){return c.focus()})}}(this)},"Add new criteria")):p({className:"criteria_blocked"},"The submission end date has elapsed and you can no longer edit criteria."))},render_criteria:function(){return div({className:"criteria_list"},R.ListManager({animate:true,item_name:"criteria",ref:this.list_ref||(this.list_ref=React.createRef()),on_list_update:this.on_list_update||(this.on_list_update=function(_this){return function(criteria){return _this.setState({criteria:criteria})}}(this)),initial_items:this.props.criteria,item_component:P.JamCriteriaRow,item_props:function(_this){return function(crit){return{show_primary_toggle:_this.state.criteria.length>1,can_edit:_this.props.can_edit}}}(this)}))}});P("JamCriteriaRow",{pure:true,focus:function(){var ref;return(ref=this.default_input_ref.current)!=null?ref.focus():void 0},render:function(){var crit,criteria_settings,input_name;crit=this.props.criteria;input_name=function(_this){return function(name){return"jam[criteria]["+(_this.props.position+1)+"]["+name+"]"}}(this);criteria_settings=this.props.can_edit?div({className:"sub_criteria_settings"},this.props.show_primary_toggle?label({className:"primary_toggle"},input({type:"checkbox",name:input_name("primary"),checked:crit.primary||false,onChange:function(_this){return function(e){var checked;checked=e.target.checked;return _this.props.update_all(function(item){return{primary:item===crit?checked:false}})}}(this)}),"Primary"):void 0,crit.edit_url?a({href:crit.edit_url,target:"_blank"},"Edit results..."):void 0,div({className:"link_settings"},!(this.props.first&&this.props.last)?R.RowMover({move_up:this.move_up||(this.move_up=function(_this){return function(){return _this.props.move_up()}}(this)),move_down:this.move_down||(this.move_down=function(_this){return function(){return _this.props.move_down()}}(this)),first:this.props.first,last:this.props.last}):void 0," ",a({href:"#",className:"remove_crit_btn",onClick:function(_this){return function(e){e.preventDefault();return _this.props.remove()}}(this)},"Remove"))):crit.primary||crit.edit_url?div({className:"sub_criteria_settings"},crit.primary?strong({},"Primary"):void 0," ",crit.edit_url?a({href:crit.edit_url,target:"_blank"},"Edit results..."):void 0):void 0;return div({className:"criteria_row",style:this.props.style},(crit.just_added?R.SlideDown:fragment)({},input({disabled:!this.props.can_edit,type:"hidden",name:input_name("id"),value:crit.id||""}),div({className:"primary_criteria_settings"},input({disabled:!this.props.can_edit,ref:this.default_input_ref||(this.default_input_ref=React.createRef()),placeholder:"How should the entry be judged?",required:true,type:"text",name:input_name("name"),value:crit.name||"",className:"criteria_input",onChange:function(_this){return function(e){return _this.props.update({name:e.target.value})}}(this)}),R.Forms.SimpleSelect({disabled:!this.props.can_edit,name:input_name("type"),value:crit.type||"default",onChange:function(_this){return function(type){return _this.props.update({type:type})}}(this),options:[{name:"Voted on",value:"default"},{name:"Manually ranked",value:"manual_order"}]})),criteria_settings))}})})}).call(this);(function(){I.libs.react.done(function(){var P,_rdf,a,br,button,code,div,em,fieldset,form,fragment,h1,h2,h3,h4,h5,h6,id,iframe,img,input,label,legend,li,ol,optgroup,option,p,pre,section,select,span,strong,textarea,types,ul;_rdf=ReactDOMFactories;div=_rdf.div,span=_rdf.span,a=_rdf.a,br=_rdf.br,p=_rdf.p,ol=_rdf.ol,ul=_rdf.ul,li=_rdf.li,strong=_rdf.strong,em=_rdf.em,img=_rdf.img,form=_rdf.form,label=_rdf.label,input=_rdf.input,textarea=_rdf.textarea,button=_rdf.button,iframe=_rdf.iframe,h1=_rdf.h1,h2=_rdf.h2,h3=_rdf.h3,h4=_rdf.h4,h5=_rdf.h5,h6=_rdf.h6,pre=_rdf.pre,code=_rdf.code,select=_rdf.select,option=_rdf.option,section=_rdf.section,optgroup=_rdf.optgroup,fieldset=_rdf.fieldset,legend=_rdf.legend;fragment=React.createElement.bind(null,React.Fragment);fragment.type=React.fragment;P=R["package"]("JamEdit");types=PropTypes;id=0;P("EditFields",{propTypes:{fields:types.array,field_types:types.array,disabled:types.bool},set_fields:function(fields){return this.list_ref.current.replace_items(fields)},componentDidMount:function(){if(this.props.ref_name){return P.EditFields[this.props.ref_name]=this}},render:function(){return this.enclose({className:"field_picker"},!this.props.disabled?input({type:"hidden",name:"jam[update_fields]",value:"1"}):void 0,this.render_fields(),this.props.disabled?p({className:"fields_blocked"},"The submission end date has elapsed and you can no longer edit fields."):div({className:"button_row"},button({type:"button",className:"button",onClick:function(_this){return function(){return _this.list_ref.current.add({type:_this.props.field_types[0].type,just_added:true},function(c){return c.focus()})}}(this)},"Add new field")))},render_fields:function(){return div({className:"field_list"},R.ListManager({animate:true,item_name:"field",ref:this.list_ref||(this.list_ref=React.createRef()),initial_items:this.props.fields||[],item_component:P.JamFieldRow,item_props:function(_this){return function(field){return{field_types:_this.props.field_types,disabled:_this.props.disabled}}}(this)}))}});P("JamFieldRow",{focus:function(){var ref;return(ref=this.default_input_ref.current)!=null?ref.focus():void 0},input_name:function(name){return"jam[fields]["+(this.props.position+1)+"]["+name+"]"},has_data:function(){var i,len,ref,type;ref=this.props.field_types;for(i=0,len=ref.length;i<len;i++){type=ref[i];if(type.type===this.props.field.type){return type.has_data}}},render:function(){var field;field=this.props.field;return this.enclose({className:classNames("field_row",{has_data:this.has_data(),disabled:this.props.disabled}),style:this.props.style},(field.just_added?R.SlideDown:fragment)({},this.props.field.id?input({type:"hidden",name:this.input_name("id"),value:this.props.field.id,disabled:this.props.disabled}):void 0,div({className:"field_title"},input({type:"text",required:true,placeholder:"Name",name:this.input_name("name"),defaultValue:this.props.field.name,className:"field_name_input",disabled:this.props.disabled,ref:this.default_input_ref||(this.default_input_ref=React.createRef())})),div({className:"field_options"},span({className:"field_type"},span({className:"label"},"Type")," ",R.Forms.SimpleSelect({value:this.props.field.type,name:this.input_name("type"),disabled:this.props.disabled,onChange:function(_this){return function(v){return _this.props.update({type:v})}}(this),options:this.props.field_types.map(function(_this){return function(ft){return{name:ft.name,value:ft.type}}}(this))})),div({className:"toggles"},div({},label({},input({type:"checkbox",name:this.input_name("required"),defaultChecked:this.props.field.required,disabled:this.props.disabled})," ","Required")),div({},label({title:"Only jam hosts can see responses"},input({type:"checkbox",name:this.input_name("private"),defaultChecked:this.props.field["private"],disabled:this.props.disabled})," ","Private"))),!this.props.disabled?fragment({},!(this.props.first&&this.props.last)?R.RowMover({move_up:this.move_up||(this.move_up=function(_this){return function(){return _this.props.move_up()}}(this)),move_down:this.move_down||(this.move_down=function(_this){return function(){return _this.props.move_down()}}(this)),first:this.props.first,last:this.props.last}):void 0,button({title:"Remove",className:"remove_btn textlike",onClick:function(_this){return function(){return _this.props.remove()}}(this)},"Remove")):void 0),div({className:"field_description"},textarea({name:this.input_name("description"),placeholder:"Description",defaultValue:this.props.field.description,disabled:this.props.disabled})),this.has_data()?div({className:"data_row"},textarea({name:this.input_name("data"),placeholder:"Configure field settings",defaultValue:this.props.field.data,disabled:this.props.disabled})):void 0))}})})}).call(this);(function(){I.libs.react.done(function(){var Date,P,_rdf,a,abbr,br,button,code,div,em,fieldset,form,fragment,h1,h2,h3,h4,h5,h6,iframe,img,input,label,legend,li,ol,optgroup,option,p,pre,section,select,span,strong,textarea,types,ul;_rdf=ReactDOMFactories;div=_rdf.div,span=_rdf.span,a=_rdf.a,br=_rdf.br,p=_rdf.p,ol=_rdf.ol,ul=_rdf.ul,li=_rdf.li,strong=_rdf.strong,em=_rdf.em,img=_rdf.img,form=_rdf.form,label=_rdf.label,input=_rdf.input,textarea=_rdf.textarea,button=_rdf.button,iframe=_rdf.iframe,h1=_rdf.h1,h2=_rdf.h2,h3=_rdf.h3,h4=_rdf.h4,h5=_rdf.h5,h6=_rdf.h6,pre=_rdf.pre,code=_rdf.code,select=_rdf.select,option=_rdf.option,section=_rdf.section,optgroup=_rdf.optgroup,fieldset=_rdf.fieldset,legend=_rdf.legend;fragment=React.createElement.bind(null,React.Fragment);fragment.type=React.fragment;P=R["package"]("JamEdit");abbr=ReactDOMFactories.abbr;types=PropTypes;Date=function(props){var date;date=props.date;return abbr({className:"date_format",title:date},span({className:"icon icon-stopwatch"})," ",""+moment.utc(date).local().fromNow())};Date=React.memo(Date);P("SubmissionReport",{pure:true,getInitialState:function(){return{}},submit_action:function(action){if(action==null){action="dismiss_report"}if(this.state.loading){return}this.setState({loading:true});return $.ajax({type:"POST",url:this.props.update_report_url,data:I.with_csrf({game_report_id:this.props.report.id,action:action}),dataType:"json",xhrFields:{withCredentials:true}}).done(function(_this){return function(res){var base,base1;if(res.errors){return typeof(base=_this.props).set_errors==="function"?base.set_errors(res.errors):void 0}else{return typeof(base1=_this.props).update_report==="function"?base1.update_report(_this.props.report,res.report):void 0}}}(this)).always(function(_this){return function(){return _this.setState({loading:false})}}(this))},render:function(){var object_url,ref,ref1,ref2,ref3,report,review;report=this.props.report;object_url=(ref=(ref1=report.jam_game)!=null?ref1.url:void 0)!=null?ref:report.game.url;return this.enclose({className:classNames({loading:(ref2=this.state)!=null?ref2.loading:void 0})},a({className:"game_cover_link",href:object_url},report.game.cover_url?R.Index.LazyImage({width:105,height:83,src:report.game.cover_url,class:"game_cover",alt:report.game.title+" Cover Image"}):div({className:"game_cover empty"},"no image :(")),div({className:"report_content_column"},div({className:"report_header"},span({className:"report_id"},"#"+report.id)," ",a({href:object_url},report.game.title)," by ",a({href:report.game.user.url},report.game.user.name),!report.jam_game?fragment({}," ",em({},"This game is no longer submitted to the jam")):void 0),report.description?p({className:"report_description"},report.description):void 0,div({className:"report_tools"},((ref3=report.report_review)!=null?ref3.status="dismissed":void 0)?(review=report.report_review,fragment({},button({type:"button",className:"button disabled outline",disabled:true},"Dismissed"),button({type:"button",className:"textlike",onClick:this.requeue_report||(this.requeue_report=function(_this){return function(){return _this.submit_action("requeue_report")}}(this)),title:"Put the report back onto the queue for review"},"Requeue"),review.user?span({className:"report_user"},"Reviewed by ",a({href:review.user.url},review.user.name)," ",React.createElement(Date,{date:review.created_at})):void 0)):button({onClick:this.dismiss_report||(this.dismiss_report=function(_this){return function(){return _this.submit_action("dismiss_report")}}(this)),type:"button",className:"button"},"Dismiss"))))}});P("EditReports",{componentDidMount:function(){return this.fetch_page()},getInitialState:function(){return{loading:true}},fetch_page:function(){return $.getJSON(this.props.reports_url).done(function(_this){return function(res){return _this.setState(Object.assign({loading:false},res))}}(this))},render:function(){return this.enclose({},this.state.errors?R.Forms.FormErrors({errors:this.state.errors,scroll_into_view:true}):void 0,this.state.loading?p({className:"loadin_message"},"Loading..."):this.render_reports())},set_errors:function(errors){return this.setState({errors:errors})},update_report:function(original,replacement){return this.setState(function(state){return{reports:state.reports.map(function(_this){return function(report){if(report===original){return replacement}else{return report}}}(this))}})},render_reports:function(){var ref;if(!((ref=this.state.reports)!=null?ref.length:void 0)){return section({className:"report_list"},p({className:"empty_message"},"No reports"))}return section({className:"report_list"},this.state.reports.map(function(_this){return function(report){return P.SubmissionReport({key:report.id,update_report_url:"",update_report:_this.update_report,set_errors:_this.set_errors,report:report})}}(this)))}})})}).call(this);(function(){I.libs.react.done(function(){var P,_rdf,a,br,button,code,div,em,fieldset,form,fragment,h1,h2,h3,h4,h5,h6,iframe,img,input,label,legend,li,ol,optgroup,option,p,pre,section,select,span,strong,textarea,types,ul;_rdf=ReactDOMFactories;div=_rdf.div,span=_rdf.span,a=_rdf.a,br=_rdf.br,p=_rdf.p,ol=_rdf.ol,ul=_rdf.ul,li=_rdf.li,strong=_rdf.strong,em=_rdf.em,img=_rdf.img,form=_rdf.form,label=_rdf.label,input=_rdf.input,textarea=_rdf.textarea,button=_rdf.button,iframe=_rdf.iframe,h1=_rdf.h1,h2=_rdf.h2,h3=_rdf.h3,h4=_rdf.h4,h5=_rdf.h5,h6=_rdf.h6,pre=_rdf.pre,code=_rdf.code,select=_rdf.select,option=_rdf.option,section=_rdf.section,optgroup=_rdf.optgroup,fieldset=_rdf.fieldset,legend=_rdf.legend;fragment=React.createElement.bind(null,React.Fragment);fragment.type=React.fragment;P=R["package"]("JamEdit");types=PropTypes;P("LateSubmitLightbox",{render:function(){return R.Lightbox({className:classNames(this.enclosing_class_name(),"full_width")},h2({},"Late submit URL"),this.props.errors?fragment({},R.Forms.FormErrors({errors:this.props.errors})):fragment({},p({},"Give this URL to ",span({className:"recipient"},this.props.recipient)," in order to let them submit late. They must visit this URL from their account to complete the submission."),div({className:"form"},input({type:"text",className:"text_input submit_url_input",readOnly:true,onClick:function(_this){return function(e){return e.target.select()}}(this),value:this.props.submit_url}))),div({className:"button_row"},button({type:"button",className:"button",onClick:function(_this){return function(){return I.Lightbox.close()}}(this)},"Close")))}})})}).call(this);(function(){I.libs.react.done(function(){var P,_rdf,a,abbr,br,button,code,div,em,fieldset,form,fragment,h1,h2,h3,h4,h5,h6,iframe,img,input,label,legend,li,ol,optgroup,option,p,pre,section,select,span,strong,tbody,td,textarea,thead,tr,ul,slice=[].slice;_rdf=ReactDOMFactories;div=_rdf.div,span=_rdf.span,a=_rdf.a,br=_rdf.br,p=_rdf.p,ol=_rdf.ol,ul=_rdf.ul,li=_rdf.li,strong=_rdf.strong,em=_rdf.em,img=_rdf.img,form=_rdf.form,label=_rdf.label,input=_rdf.input,textarea=_rdf.textarea,button=_rdf.button,iframe=_rdf.iframe,h1=_rdf.h1,h2=_rdf.h2,h3=_rdf.h3,h4=_rdf.h4,h5=_rdf.h5,h6=_rdf.h6,pre=_rdf.pre,code=_rdf.code,select=_rdf.select,option=_rdf.option,section=_rdf.section,optgroup=_rdf.optgroup,fieldset=_rdf.fieldset,legend=_rdf.legend;fragment=React.createElement.bind(null,React.Fragment);fragment.type=React.fragment;P=R["package"]("Dashboard");thead=ReactDOMFactories.thead,tbody=ReactDOMFactories.tbody,tr=ReactDOMFactories.tr,td=ReactDOMFactories.td,abbr=ReactDOMFactories.abbr;P("NiceTable",{getInitialState:function(){return{rows_sorted:this.props.rows}},componentDidUpdate:function(prev_props,prev_state){if(prev_props.rows!==this.props.rows){return this.setState({rows_sorted:this.props.rows})}},set_sort:function(col){var DOWN,UP,direction,rows,to_sort_value;rows=slice.call(this.state.rows_sorted);direction=function(){var ref;switch(col.sort){case"both":if(this.state.sort_col===col){if(this.state.sort_dir==="asc"){return"desc"}else{return"asc"}}else{if(col.type==="number"){return"desc"}else{return(ref=col.default_sort)!=null?ref:"asc"}}break;case"asc":return"asc";case"desc":return"desc"}}.call(this);DOWN=-1;UP=1;if(direction==="asc"){DOWN=1;UP=-1}to_sort_value=function(_this){return function(row){var fn,ref,ref1;if(fn=(ref=_this.props.field_sorters)!=null?ref[col.type]:void 0){return fn(row,col)}else if(col.value){return col.value(row,col)}else{return row[(ref1=col.sort_field)!=null?ref1:col.field]}}}(this);rows.sort(function(a,b){var val_a,val_b;val_a=to_sort_value(a);val_b=to_sort_value(b);if(val_a==null){return DOWN}if(val_b==null){return UP}if(val_a===val_b){return 0}if(val_a<val_b){return UP}if(val_a>val_b){return DOWN}return 0});return this.setState({rows_sorted:rows,sort_dir:direction,sort_col:col})},render:function(){return this.enclose({component:"table",className:classNames("nice_table",this.props.className)},thead({},tr({},this.render_column_headers())),tbody({},this.render_rows()))},render_column_headers:function(){return this.props.columns.map(function(_this){return function(col,idx){var cls,header,ref,ref1;header=(ref=col.label)!=null?ref:col.field;if(col.sort){header=button({className:"sort_button",type:"button",onClick:function(e){return _this.set_sort(col)}},header,div({className:"sort_directions"},R.Icons.TriUp,R.Icons.TriDown))}cls=col===_this.state.sort_col?classNames({sorted:true,sort_desc:_this.state.sort_dir==="desc",sort_asc:_this.state.sort_dir==="asc"}):void 0;return td({className:cls,key:(ref1=col.field)!=null?ref1:idx},header)}}(this))},render_rows:function(){return this.state.rows_sorted.map(function(_this){return function(row,idx){var key,ref;key=(ref=row.key)!=null?ref:idx;return tr({key:key},_this.props.columns.map(function(col,idx){var ref1;return td({key:key+"-"+((ref1=col.field)!=null?ref1:idx)},_this.render_field(row,col))}))}}(this))},render_field:function(row,col){var out,url,value;value=col.field?row[col.field]:col.value?col.value(row,col):void 0;out=function(){var ref,ref1;switch(col.type){case"number":if(value&&value!==0){return I.number_format(value)}else{return span({className:"sub"},"0")}break;case"boolean":if(value){return div({className:"bool_column"},col.field)}else{return div({className:"bool_column false"},"not "+col.field)}break;case"date":if(value){return abbr({title:value,className:"datetime"},span({className:"icon icon-stopwatch"})," ",I.format_timestamp(value))}else{return span({className:"sub"},"n/a")}break;case"html":return span({dangerouslySetInnerHTML:{__html:value}});default:if(col.render){return col.render(row,col)}else if((ref=this.props.field_renderers)!=null?ref[col.type]:void 0){return(ref1=this.props.field_renderers)!=null?ref1[col.type](row,col):void 0}else if(col.type){return"unhandled type: "+col.type}else{if(value){return value}else if(col.empty_value){return span({className:"sub"},col.empty_value)}}}}.call(this);if(url=col.href&&row[col.href]){return a({className:"field_"+(col.type||"text"),href:url},out)}else{return out}}})})}).call(this);(function(){I.libs.react.done(function(){var P,_rdf,a,br,button,code,div,em,fieldset,form,fragment,h1,h2,h3,h4,h5,h6,iframe,img,input,label,legend,li,ol,optgroup,option,p,pre,section,select,span,strong,textarea,types,ul;_rdf=ReactDOMFactories;div=_rdf.div,span=_rdf.span,a=_rdf.a,br=_rdf.br,p=_rdf.p,ol=_rdf.ol,ul=_rdf.ul,li=_rdf.li,strong=_rdf.strong,em=_rdf.em,img=_rdf.img,form=_rdf.form,label=_rdf.label,input=_rdf.input,textarea=_rdf.textarea,button=_rdf.button,iframe=_rdf.iframe,h1=_rdf.h1,h2=_rdf.h2,h3=_rdf.h3,h4=_rdf.h4,h5=_rdf.h5,h6=_rdf.h6,pre=_rdf.pre,code=_rdf.code,select=_rdf.select,option=_rdf.option,section=_rdf.section,optgroup=_rdf.optgroup,fieldset=_rdf.fieldset,legend=_rdf.legend;fragment=React.createElement.bind(null,React.Fragment);fragment.type=React.fragment;P=R["package"]("Dashboard");types=PropTypes;P("ProjectTotals",{render:function(){return P.NiceTable(Object.assign({className:"summary_table",field_sorters:{publish_status:function(row,col){var value;value=row[col.field];switch(value){case"published":return 0;case"restricted":return 1;case"draft":return 2;default:return 3}}},field_renderers:{publish_status:function(row,col){var value;value=row[col.field];switch(value){case"published":return span({className:"tag_bubble green"},"Published");case"restricted":return span({className:"tag_bubble purple"},"Restricted");case"draft":return span({className:"tag_bubble red"},"Draft")}}}},this.props))}})})}).call(this);(function(){I.libs.react.done(function(){var P,_rdf,a,br,button,code,div,em,fieldset,form,fragment,h1,h2,h3,h4,h5,h6,iframe,img,input,label,legend,li,ol,optgroup,option,p,pre,section,select,span,strong,textarea,types,ul;_rdf=ReactDOMFactories;div=_rdf.div,span=_rdf.span,a=_rdf.a,br=_rdf.br,p=_rdf.p,ol=_rdf.ol,ul=_rdf.ul,li=_rdf.li,strong=_rdf.strong,em=_rdf.em,img=_rdf.img,form=_rdf.form,label=_rdf.label,input=_rdf.input,textarea=_rdf.textarea,button=_rdf.button,iframe=_rdf.iframe,h1=_rdf.h1,h2=_rdf.h2,h3=_rdf.h3,h4=_rdf.h4,h5=_rdf.h5,h6=_rdf.h6,pre=_rdf.pre,code=_rdf.code,select=_rdf.select,option=_rdf.option,section=_rdf.section,optgroup=_rdf.optgroup,fieldset=_rdf.fieldset,legend=_rdf.legend;fragment=React.createElement.bind(null,React.Fragment);fragment.type=React.fragment;P=R["package"]("Dashboard");types=PropTypes;P("RangePicker",{pure:true,current_preset:function(){var i,len,preset,ref;if(!this.props.preset_ranges){return}ref=this.props.preset_ranges;for(i=0,len=ref.length;i<len;i++){preset=ref[i];if(this.props.range_left===preset.left&&this.props.range_right===preset.right){return preset}}},set_range:function(update){var base,day,format,left,ref,ref1,ref2,right;left=(ref=update.left)!=null?ref:this.props.range_left;right=(ref1=update.right)!=null?ref1:this.props.range_right;format=d3.time.format("%Y-%m-%d");left=format.parse(left);right=format.parse(right);if(left>right){ref2=[right,left],left=ref2[0],right=ref2[1]}day=1e3*60*60*24;if(right-left<day*7){if(update.left!=null){right=d3.time.day.offset(left,7)}else{left=d3.time.day.offset(right,-7)}}if(right-left>day*365){if(update.left!=null){right=d3.time.day.offset(left,365)}else{left=d3.time.day.offset(right,-365)}}return typeof(base=this.props).on_update_range==="function"?base.on_update_range({range_left:format(left),range_right:format(right)}):void 0},render:function(){var current_preset,preset_options,ref;current_preset=this.current_preset();preset_options=this.props.preset_ranges?this.props.preset_ranges.map(function(_this){return function(range){return{name:range.label,value:range.label}}}(this)):void 0;if(preset_options&&!current_preset){preset_options.unshift({name:"Custom",value:"custom"})}return this.enclose({className:this.props.className},R.Forms.SimpleSelect({disabled:this.props.loading,name:"group_by",value:this.props.group_by,onChange:function(_this){return function(val){var base;return typeof(base=_this.props).on_update_range==="function"?base.on_update_range({group_by:val}):void 0}}(this),options:[{name:"Daily",value:"daily"},{name:"Weekly",value:"weekly"}]}),label({},span({className:"label"},"From"),P.DatePicker({className:"date_input",name:"range_left",value:this.props.range_left,disabled:this.props.loading,max_date:this.props.max_date,onChange:function(_this){return function(val){return _this.set_range({left:val})}}(this)})),label({},span({className:"label"},"To"),P.DatePicker({className:"date_input",name:"range_right",disabled:this.props.loading,value:this.props.range_right,max_date:this.props.max_date,onChange:function(_this){return function(val){return _this.set_range({right:val})}}(this)})),preset_options?R.Forms.SimpleSelect({disabled:this.props.loading,value:(ref=current_preset!=null?current_preset.label:void 0)!=null?ref:"custom",onChange:function(_this){return function(val){var i,len,preset,ref1,results;if(val==="custom"){return}ref1=_this.props.preset_ranges;results=[];for(i=0,len=ref1.length;i<len;i++){preset=ref1[i];if(preset.label===val){results.push(_this.set_range({left:preset.left,right:preset.right}))}else{results.push(void 0)}}return results}}(this),options:preset_options}):void 0)}});P("DatePicker",{getInitialState:function(){return{value:this.props.value}},componentDidMount:function(){var el,ref;el=this.container();return I.datepicker(el,{maxDate:(ref=this.props.max_date)!=null?ref:1,onSelect:function(_this){return function(val){var base;_this.setState({value:val});return typeof(base=_this.props).onChange==="function"?base.onChange(val):void 0}}(this)})},render:function(){var ref;return input({type:"text",defaultValue:this.props.defaultValue,value:this.props.value,className:classNames(this.enclosing_class_name(),this.props.className,{disabled:this.props.disabled}),name:this.props.name,readOnly:"readonly",disabled:(ref=this.props.disabled)!=null?ref:false})}})})}).call(this);(function(){I.libs.react.done(function(){var P,_rdf,a,br,button,code,div,em,fieldset,form,fragment,g,h1,h2,h3,h4,h5,h6,iframe,img,input,label,legend,li,line,ol,optgroup,option,p,pre,section,select,span,strong,svg,textarea,ul;_rdf=ReactDOMFactories;div=_rdf.div,span=_rdf.span,a=_rdf.a,br=_rdf.br,p=_rdf.p,ol=_rdf.ol,ul=_rdf.ul,li=_rdf.li,strong=_rdf.strong,em=_rdf.em,img=_rdf.img,form=_rdf.form,label=_rdf.label,input=_rdf.input,textarea=_rdf.textarea,button=_rdf.button,iframe=_rdf.iframe,h1=_rdf.h1,h2=_rdf.h2,h3=_rdf.h3,h4=_rdf.h4,h5=_rdf.h5,h6=_rdf.h6,pre=_rdf.pre,code=_rdf.code,select=_rdf.select,option=_rdf.option,section=_rdf.section,optgroup=_rdf.optgroup,fieldset=_rdf.fieldset,legend=_rdf.legend;fragment=React.createElement.bind(null,React.Fragment);fragment.type=React.fragment;P=R["package"]("Dashboard");svg=ReactDOMFactories.svg,line=ReactDOMFactories.line,g=ReactDOMFactories.g;P("SparkGraph",{render:function(){var avg,c,counts,i,idx,j,len,len1,max,min,pairs,scale;counts=this.props.counts;min=Math.min.apply(Math,counts);max=Math.max.apply(Math,counts);avg=0;for(i=0,len=counts.length;i<len;i++){c=counts[i];avg+=c}avg/=counts.length;if(min===max){max+=1}min=0;max=Math.max(max,avg*2);pairs=[];for(idx=j=0,len1=counts.length;j<len1;idx=++j){c=counts[idx];if(idx===counts.length-1){continue}pairs.push([counts[idx],counts[idx+1]])}scale=function(p,s){if(s==null){s=.8}return(p-50)*s+50};return svg({version:"1.1",className:"spark_graph",baseProfile:"full",xmlns:"http://www.w3.org/2000/svg",width:this.props.width,height:this.props.height},pairs.map(function(_this){return function(arg,idx){var a,b,left,right;a=arg[0],b=arg[1];left=idx/pairs.length;right=(idx+1)/pairs.length;return line({key:idx,x1:left*100+"%",y1:scale(100-(a-min)/(max-min)*100)+"%",x2:right*100+"%",y2:scale(100-(b-min)/(max-min)*100)+"%",stroke:_this.props.stroke||"currentColor",strokeWidth:"2"})}}(this)))}})})}).call(this);(function(){I.libs.react.done(function(){var P,_rdf,a,br,button,code,div,em,fieldset,form,fragment,h1,h2,h3,h4,h5,h6,iframe,img,input,label,legend,li,ol,optgroup,option,p,pre,section,select,span,strong,textarea,types,ul;_rdf=ReactDOMFactories;div=_rdf.div,span=_rdf.span,a=_rdf.a,br=_rdf.br,p=_rdf.p,ol=_rdf.ol,ul=_rdf.ul,li=_rdf.li,strong=_rdf.strong,em=_rdf.em,img=_rdf.img,form=_rdf.form,label=_rdf.label,input=_rdf.input,textarea=_rdf.textarea,button=_rdf.button,iframe=_rdf.iframe,h1=_rdf.h1,h2=_rdf.h2,h3=_rdf.h3,h4=_rdf.h4,h5=_rdf.h5,h6=_rdf.h6,pre=_rdf.pre,code=_rdf.code,select=_rdf.select,option=_rdf.option,section=_rdf.section,optgroup=_rdf.optgroup,fieldset=_rdf.fieldset,legend=_rdf.legend;fragment=React.createElement.bind(null,React.Fragment);fragment.type=React.fragment;P=R["package"]("Dashboard");types=PropTypes;P("ToolGameTagsLightbox",{propTypes:{game:types.object.isRequired,tool:types.object.isRequired,selected_tags:types.array.isRequired,url:types.string.isRequired},render:function(){return R.Lightbox({className:"tool_game_tags_lightbox"},this.enclose({},h2({},"Edit tags for "+this.props.game.title),div({className:"content"},form({className:"form",action:this.props.url,method:"post",ref:"form",onSubmit:function(_this){return function(e){e.preventDefault();return I.remote_submit($(_this.refs.form),[{name:"json",value:"1"}]).then(_this.props.on_save)}}(this)},input({type:"hidden",name:"action",value:"update_tags"}),R.CSRF({}),R.GameEdit.EditToolOptions({tool:this.props.tool,selected_tags:this.props.selected_tags}),div({className:"buttons"},button({className:"button"},"Save tags"))))))}})})}).call(this);(function(){I.libs.react.done(function(){var P,_rdf,a,br,button,code,div,em,fieldset,form,fragment,h1,h2,h3,h4,h5,h6,iframe,img,input,label,legend,li,ol,optgroup,option,p,pre,section,select,span,strong,textarea,types,ul;_rdf=ReactDOMFactories;div=_rdf.div,span=_rdf.span,a=_rdf.a,br=_rdf.br,p=_rdf.p,ol=_rdf.ol,ul=_rdf.ul,li=_rdf.li,strong=_rdf.strong,em=_rdf.em,img=_rdf.img,form=_rdf.form,label=_rdf.label,input=_rdf.input,textarea=_rdf.textarea,button=_rdf.button,iframe=_rdf.iframe,h1=_rdf.h1,h2=_rdf.h2,h3=_rdf.h3,h4=_rdf.h4,h5=_rdf.h5,h6=_rdf.h6,pre=_rdf.pre,code=_rdf.code,select=_rdf.select,option=_rdf.option,section=_rdf.section,optgroup=_rdf.optgroup,fieldset=_rdf.fieldset,legend=_rdf.legend;fragment=React.createElement.bind(null,React.Fragment);fragment.type=React.fragment;P=R["package"]("Index");types=PropTypes;P("LazyImage",{pure:true,propTypes:{src:types.string,src_set:types.string,width:types.number,height:types.number},getInitialState:function(){return{visible:false}},componentDidMount:function(){var el;el=ReactDOM.findDOMNode(this);return this.unbind_lazy_images=$(el).lazy_images({elements:[el],show_images:function(_this){return function(){var base;_this.setState({visible:true});return typeof(base=_this.props).on_reveal==="function"?base.on_reveal():void 0}}(this)})},componentWillUnmount:function(){return typeof this.unbind_lazy_images==="function"?this.unbind_lazy_images():void 0},render:function(){var ref,ref1;return img({className:classNames(this.props["class"],this.props.className,{lazy_loaded:this.state.loaded,lazy_visible:this.state.visible}),alt:this.props.alt,width:this.state.loaded?this.props.width:(ref=this.props.initial_width)!=null?ref:this.props.width,height:this.state.loaded?this.props.height:(ref1=this.props.initial_height)!=null?ref1:this.props.height,src:this.state.visible?this.props.src:void 0,srcSet:this.state.visible?this.props.src_set:void 0,onLoad:this.state.visible&&!this.state.loaded?function(_this){return function(){var base;_this.setState({loaded:true});return typeof(base=_this.props).on_load==="function"?base.on_load():void 0}}(this):void 0})}})})}).call(this);(function(){I.JamGrid=function(){function JamGrid(el){var c,countdowns,i,len;this.el=$(el);countdowns=this.el.find(".date_countdown");for(i=0,len=countdowns.length;i<len;i++){c=countdowns[i];new I.TimestampCountdown(c,$(c).text())}_.defer(function(_this){return function(){return _this.el.lazy_images()}}(this))}return JamGrid}()}).call(this);
